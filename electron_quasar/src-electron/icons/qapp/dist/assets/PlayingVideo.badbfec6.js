import{E as Ie,c as G,G as te,H as Ye,i as ct,I as xe,r as re,y as fe,J as st,K as Sr,L as Me,M as ft,N as ht,O as vt,P as Et,R as Lr,S as cr,T as kr,U as Ar,V as Dr,W as _r,X as Rr,Y as Cr,Z as dr,s as Le,_ as _t,$ as bt,a0 as wr,a1 as Ir,a2 as xr,a3 as Or,a4 as Pr,a5 as yt,a6 as Rt,a7 as Fr,a8 as fr,a9 as hr,aa as Mr,ab as St,h as He,ac as xt,ad as Nr,v as Br,ae as Tt,af as Ur,ag as Lt,ah as Gr,ai as jr,aj as Vr,ak as Kr,al as Hr,o as J,m as ae,am as Ze,an as Je,A as q,g as De,d as ot,C as Oe,j as K,e as z,t as le,ao as Ot,f as be,w as Q,F as Be,B as Ge,ap as tt,aq as rt,ar as Qe,as as qr,D as Ct,a as we,at as lt,au as zr,av as Wr,Q as Ae,u as gt,n as Pt,aw as pt,ax as Ft,k as Mt,p as $r}from"./index.b79f9052.js";import{b as dt,u as Yr,c as Xr,d as Qr,e as Nt,Q as Bt,a as Ut}from"./QMenu.c03b1df6.js";import{b as Fe,g as Gt,Q as jt,a as Vt,c as Kt}from"./index.f8810726.js";import{u as Zr,a as Jr,Q as $e}from"./use-page-sticky.61e13b79.js";import{T as it,S as ei,D as ti,R as ri}from"./searchAPI.b1da3c78.js";import{u as ii}from"./axios.a9d686d1.js";import{u as ni}from"./System.e9bed7ab.js";import{a as ai}from"./settingAPI.7d65be4a.js";import{o as Ht}from"./index.21c409de.js";var si=Ie({name:"QToolbarTitle",props:{shrink:Boolean},setup(P,{slots:x}){const h=G(()=>"q-toolbar__title ellipsis"+(P.shrink===!0?" col-shrink":""));return()=>te("div",{class:h.value},Ye(x.default))}});const oi=te("div",{class:"q-space"});var li=Ie({name:"QSpace",setup(){return()=>oi}}),ui=Ie({name:"QToolbar",props:{inset:Boolean},setup(P,{slots:x}){const h=G(()=>"q-toolbar row no-wrap items-center"+(P.inset===!0?" q-toolbar--inset":""));return()=>te("div",{class:h.value,role:"toolbar"},Ye(x.default))}}),qt=Ie({name:"QHeader",props:{modelValue:{type:Boolean,default:!0},reveal:Boolean,revealOffset:{type:Number,default:250},bordered:Boolean,elevated:Boolean,heightHint:{type:[String,Number],default:50}},emits:["reveal","focusin"],setup(P,{slots:x,emit:h}){const{proxy:{$q:D}}=Me(),d=ct(ft,xe);if(d===xe)return console.error("QHeader needs to be child of QLayout"),xe;const L=re(parseInt(P.heightHint,10)),_=re(!0),C=G(()=>P.reveal===!0||d.view.value.indexOf("H")>-1||D.platform.is.ios&&d.isContainer.value===!0),R=G(()=>{if(P.modelValue!==!0)return 0;if(C.value===!0)return _.value===!0?L.value:0;const t=L.value-d.scroll.value.position;return t>0?t:0}),o=G(()=>P.modelValue!==!0||C.value===!0&&_.value!==!0),E=G(()=>P.modelValue===!0&&o.value===!0&&P.reveal===!0),f=G(()=>"q-header q-layout__section--marginal "+(C.value===!0?"fixed":"absolute")+"-top"+(P.bordered===!0?" q-header--bordered":"")+(o.value===!0?" q-header--hidden":"")+(P.modelValue!==!0?" q-layout--prevent-focus":"")),v=G(()=>{const t=d.rows.value.top,s={};return t[0]==="l"&&d.left.space===!0&&(s[D.lang.rtl===!0?"right":"left"]=`${d.left.size}px`),t[2]==="r"&&d.right.space===!0&&(s[D.lang.rtl===!0?"left":"right"]=`${d.right.size}px`),s});function b(t,s){d.update("header",t,s)}function T(t,s){t.value!==s&&(t.value=s)}function u({height:t}){T(L,t),b("size",t)}function e(t){E.value===!0&&T(_,!0),h("focusin",t)}fe(()=>P.modelValue,t=>{b("space",t),T(_,!0),d.animate()}),fe(R,t=>{b("offset",t)}),fe(()=>P.reveal,t=>{t===!1&&T(_,P.modelValue)}),fe(_,t=>{d.animate(),h("reveal",t)}),fe(d.scroll,t=>{P.reveal===!0&&T(_,t.direction==="up"||t.position<=P.revealOffset||t.position-t.inflectionPoint<100)});const i={};return d.instances.header=i,P.modelValue===!0&&b("size",L.value),b("space",P.modelValue),b("offset",R.value),st(()=>{d.instances.header===i&&(d.instances.header=void 0,b("size",0),b("offset",0),b("space",!1))}),()=>{const t=Sr(x.default,[]);return P.elevated===!0&&t.push(te("div",{class:"q-layout__shadow absolute-full overflow-hidden no-pointer-events"})),t.push(te(dt,{debounce:0,onResize:u})),te("header",{class:f.value,style:v.value,onFocusin:e},t)}}}),zt=Ie({name:"QItemLabel",props:{overline:Boolean,caption:Boolean,header:Boolean,lines:[Number,String]},setup(P,{slots:x}){const h=G(()=>parseInt(P.lines,10)),D=G(()=>"q-item__label"+(P.overline===!0?" q-item__label--overline text-overline":"")+(P.caption===!0?" q-item__label--caption text-caption":"")+(P.header===!0?" q-item__label--header":"")+(h.value===1?" ellipsis":"")),d=G(()=>P.lines!==void 0&&h.value>1?{overflow:"hidden",display:"-webkit-box","-webkit-box-orient":"vertical","-webkit-line-clamp":h.value}:null);return()=>te("div",{style:d.value,class:D.value},Ye(x.default))}}),Wt=Ie({name:"QList",props:{...ht,bordered:Boolean,dense:Boolean,separator:Boolean,padding:Boolean,tag:{type:String,default:"div"}},setup(P,{slots:x}){const h=Me(),D=vt(P,h.proxy.$q),d=G(()=>"q-list"+(P.bordered===!0?" q-list--bordered":"")+(P.dense===!0?" q-list--dense":"")+(P.separator===!0?" q-list--separator":"")+(D.value===!0?" q-list--dark":"")+(P.padding===!0?" q-list--padding":""));return()=>te(P.tag,{class:d.value},Ye(x.default))}});const{passive:$t}=kr,ci=["both","horizontal","vertical"];var vr=Ie({name:"QScrollObserver",props:{axis:{type:String,validator:P=>ci.includes(P),default:"vertical"},debounce:[String,Number],scrollTarget:{default:void 0}},emits:["scroll"],setup(P,{emit:x}){const h={position:{top:0,left:0},direction:"down",directionChanged:!1,delta:{top:0,left:0},inflectionPoint:{top:0,left:0}};let D=null,d,L;fe(()=>P.scrollTarget,()=>{R(),C()});function _(){D!==null&&D();const f=Math.max(0,Ar(d)),v=Dr(d),b={top:f-h.position.top,left:v-h.position.left};if(P.axis==="vertical"&&b.top===0||P.axis==="horizontal"&&b.left===0)return;const T=Math.abs(b.top)>=Math.abs(b.left)?b.top<0?"up":"down":b.left<0?"left":"right";h.position={top:f,left:v},h.directionChanged=h.direction!==T,h.delta=b,h.directionChanged===!0&&(h.direction=T,h.inflectionPoint=h.position),x("scroll",{...h})}function C(){d=cr(L,P.scrollTarget),d.addEventListener("scroll",o,$t),o(!0)}function R(){d!==void 0&&(d.removeEventListener("scroll",o,$t),d=void 0)}function o(f){if(f===!0||P.debounce===0||P.debounce==="0")_();else if(D===null){const[v,b]=P.debounce?[setTimeout(_,P.debounce),clearTimeout]:[requestAnimationFrame(_),cancelAnimationFrame];D=()=>{b(v),D=null}}}const{proxy:E}=Me();return fe(()=>E.$q.lang.rtl,_),Et(()=>{L=E.$el.parentNode,C()}),st(()=>{D!==null&&D(),R()}),Object.assign(E,{trigger:o,getPosition:()=>h}),Lr}});const Yt=["vertical","horizontal"],kt={vertical:{offset:"offsetY",scroll:"scrollTop",dir:"down",dist:"y"},horizontal:{offset:"offsetX",scroll:"scrollLeft",dir:"right",dist:"x"}},Xt={prevent:!0,mouse:!0,mouseAllDir:!0},Qt=P=>P>=250?50:Math.ceil(P/5);var di=Ie({name:"QScrollArea",props:{...ht,thumbStyle:Object,verticalThumbStyle:Object,horizontalThumbStyle:Object,barStyle:[Array,String,Object],verticalBarStyle:[Array,String,Object],horizontalBarStyle:[Array,String,Object],contentStyle:[Array,String,Object],contentActiveStyle:[Array,String,Object],delay:{type:[String,Number],default:1e3},visible:{type:Boolean,default:null},tabindex:[String,Number],onScroll:Function},setup(P,{slots:x,emit:h}){const D=re(!1),d=re(!1),L=re(!1),_={vertical:re(0),horizontal:re(0)},C={vertical:{ref:re(null),position:re(0),size:re(0)},horizontal:{ref:re(null),position:re(0),size:re(0)}},{proxy:R}=Me(),o=vt(P,R.$q);let E=null,f;const v=re(null),b=G(()=>"q-scrollarea"+(o.value===!0?" q-scrollarea--dark":""));C.vertical.percentage=G(()=>{const I=C.vertical.size.value-_.vertical.value;if(I<=0)return 0;const w=Fe(C.vertical.position.value/I,0,1);return Math.round(w*1e4)/1e4}),C.vertical.thumbHidden=G(()=>(P.visible===null?L.value:P.visible)!==!0&&D.value===!1&&d.value===!1||C.vertical.size.value<=_.vertical.value+1),C.vertical.thumbStart=G(()=>C.vertical.percentage.value*(_.vertical.value-C.vertical.thumbSize.value)),C.vertical.thumbSize=G(()=>Math.round(Fe(_.vertical.value*_.vertical.value/C.vertical.size.value,Qt(_.vertical.value),_.vertical.value))),C.vertical.style=G(()=>({...P.thumbStyle,...P.verticalThumbStyle,top:`${C.vertical.thumbStart.value}px`,height:`${C.vertical.thumbSize.value}px`})),C.vertical.thumbClass=G(()=>"q-scrollarea__thumb q-scrollarea__thumb--v absolute-right"+(C.vertical.thumbHidden.value===!0?" q-scrollarea__thumb--invisible":"")),C.vertical.barClass=G(()=>"q-scrollarea__bar q-scrollarea__bar--v absolute-right"+(C.vertical.thumbHidden.value===!0?" q-scrollarea__bar--invisible":"")),C.horizontal.percentage=G(()=>{const I=C.horizontal.size.value-_.horizontal.value;if(I<=0)return 0;const w=Fe(Math.abs(C.horizontal.position.value)/I,0,1);return Math.round(w*1e4)/1e4}),C.horizontal.thumbHidden=G(()=>(P.visible===null?L.value:P.visible)!==!0&&D.value===!1&&d.value===!1||C.horizontal.size.value<=_.horizontal.value+1),C.horizontal.thumbStart=G(()=>C.horizontal.percentage.value*(_.horizontal.value-C.horizontal.thumbSize.value)),C.horizontal.thumbSize=G(()=>Math.round(Fe(_.horizontal.value*_.horizontal.value/C.horizontal.size.value,Qt(_.horizontal.value),_.horizontal.value))),C.horizontal.style=G(()=>({...P.thumbStyle,...P.horizontalThumbStyle,[R.$q.lang.rtl===!0?"right":"left"]:`${C.horizontal.thumbStart.value}px`,width:`${C.horizontal.thumbSize.value}px`})),C.horizontal.thumbClass=G(()=>"q-scrollarea__thumb q-scrollarea__thumb--h absolute-bottom"+(C.horizontal.thumbHidden.value===!0?" q-scrollarea__thumb--invisible":"")),C.horizontal.barClass=G(()=>"q-scrollarea__bar q-scrollarea__bar--h absolute-bottom"+(C.horizontal.thumbHidden.value===!0?" q-scrollarea__bar--invisible":""));const T=G(()=>C.vertical.thumbHidden.value===!0&&C.horizontal.thumbHidden.value===!0?P.contentStyle:P.contentActiveStyle),u=[[it,I=>{m(I,"vertical")},void 0,{vertical:!0,...Xt}]],e=[[it,I=>{m(I,"horizontal")},void 0,{horizontal:!0,...Xt}]];function i(){const I={};return Yt.forEach(w=>{const O=C[w];I[w+"Position"]=O.position.value,I[w+"Percentage"]=O.percentage.value,I[w+"Size"]=O.size.value,I[w+"ContainerSize"]=_[w].value}),I}const t=_r(()=>{const I=i();I.ref=R,h("scroll",I)},0);function s(I,w,O){if(Yt.includes(I)===!1){console.error("[QScrollArea]: wrong first param of setScrollPosition (vertical/horizontal)");return}(I==="vertical"?_t:bt)(v.value,w,O)}function l({height:I,width:w}){let O=!1;_.vertical.value!==I&&(_.vertical.value=I,O=!0),_.horizontal.value!==w&&(_.horizontal.value=w,O=!0),O===!0&&a()}function n({position:I}){let w=!1;C.vertical.position.value!==I.top&&(C.vertical.position.value=I.top,w=!0),C.horizontal.position.value!==I.left&&(C.horizontal.position.value=I.left,w=!0),w===!0&&a()}function c({height:I,width:w}){C.horizontal.size.value!==w&&(C.horizontal.size.value=w,a()),C.vertical.size.value!==I&&(C.vertical.size.value=I,a())}function m(I,w){const O=C[w];if(I.isFirst===!0){if(O.thumbHidden.value===!0)return;f=O.position.value,d.value=!0}else if(d.value!==!0)return;I.isFinal===!0&&(d.value=!1);const F=kt[w],M=_[w].value,N=(O.size.value-M)/(M-O.thumbSize.value),B=I.distance[F.dist],U=f+(I.direction===F.dir?1:-1)*B*N;g(U,w)}function p(I,w){const O=C[w];if(O.thumbHidden.value!==!0){const F=I[kt[w].offset];if(F<O.thumbStart.value||F>O.thumbStart.value+O.thumbSize.value){const M=F-O.thumbSize.value/2;g(M/_[w].value*O.size.value,w)}O.ref.value!==null&&O.ref.value.dispatchEvent(new MouseEvent(I.type,I))}}function y(I){p(I,"vertical")}function r(I){p(I,"horizontal")}function a(){D.value=!0,E!==null&&clearTimeout(E),E=setTimeout(()=>{E=null,D.value=!1},P.delay),P.onScroll!==void 0&&t()}function g(I,w){v.value[kt[w].scroll]=I}function k(){L.value=!0}function S(){L.value=!1}let A=null;return fe(()=>R.$q.lang.rtl,I=>{v.value!==null&&bt(v.value,Math.abs(C.horizontal.position.value)*(I===!0?-1:1))}),Rr(()=>{A={top:C.vertical.position.value,left:C.horizontal.position.value}}),Cr(()=>{if(A===null)return;const I=v.value;I!==null&&(bt(I,A.left),_t(I,A.top))}),st(t.cancel),Object.assign(R,{getScrollTarget:()=>v.value,getScroll:i,getScrollPosition:()=>({top:C.vertical.position.value,left:C.horizontal.position.value}),getScrollPercentage:()=>({top:C.vertical.percentage.value,left:C.horizontal.percentage.value}),setScrollPosition:s,setScrollPercentage(I,w,O){s(I,w*(C[I].size.value-_[I].value)*(I==="horizontal"&&R.$q.lang.rtl===!0?-1:1),O)}}),()=>te("div",{class:b.value,onMouseenter:k,onMouseleave:S},[te("div",{ref:v,class:"q-scrollarea__container scroll relative-position fit hide-scrollbar",tabindex:P.tabindex!==void 0?P.tabindex:void 0},[te("div",{class:"q-scrollarea__content absolute",style:T.value},dr(x.default,[te(dt,{debounce:0,onResize:c})])),te(vr,{axis:"both",onScroll:n})]),te(dt,{debounce:0,onResize:l}),te("div",{class:C.vertical.barClass.value,style:[P.barStyle,P.verticalBarStyle],"aria-hidden":"true",onMousedown:y}),te("div",{class:C.horizontal.barClass.value,style:[P.barStyle,P.horizontalBarStyle],"aria-hidden":"true",onMousedown:r}),Le(te("div",{ref:C.vertical.ref,class:C.vertical.thumbClass.value,style:C.vertical.style.value,"aria-hidden":"true"}),u),Le(te("div",{ref:C.horizontal.ref,class:C.horizontal.thumbClass.value,style:C.horizontal.style.value,"aria-hidden":"true"}),e)])}});const Zt=150;var fi=Ie({name:"QDrawer",inheritAttrs:!1,props:{...wr,...ht,side:{type:String,default:"left",validator:P=>["left","right"].includes(P)},width:{type:Number,default:300},mini:Boolean,miniToOverlay:Boolean,miniWidth:{type:Number,default:57},noMiniAnimation:Boolean,breakpoint:{type:Number,default:1023},showIfAbove:Boolean,behavior:{type:String,validator:P=>["default","desktop","mobile"].includes(P),default:"default"},bordered:Boolean,elevated:Boolean,overlay:Boolean,persistent:Boolean,noSwipeOpen:Boolean,noSwipeClose:Boolean,noSwipeBackdrop:Boolean},emits:[...Ir,"onLayout","miniState"],setup(P,{slots:x,emit:h,attrs:D}){const d=Me(),{proxy:{$q:L}}=d,_=vt(P,L),{preventBodyScroll:C}=Fr(),{registerTimeout:R,removeTimeout:o}=xr(),E=ct(ft,xe);if(E===xe)return console.error("QDrawer needs to be child of QLayout"),xe;let f,v=null,b;const T=re(P.behavior==="mobile"||P.behavior!=="desktop"&&E.totalWidth.value<=P.breakpoint),u=G(()=>P.mini===!0&&T.value!==!0),e=G(()=>u.value===!0?P.miniWidth:P.width),i=re(P.showIfAbove===!0&&T.value===!1?!0:P.modelValue===!0),t=G(()=>P.persistent!==!0&&(T.value===!0||M.value===!0));function s(H,ee){if(m(),H!==!1&&E.animate(),ie(0),T.value===!0){const Ee=E.instances[I.value];Ee!==void 0&&Ee.belowBreakpoint===!0&&Ee.hide(!1),he(1),E.isContainer.value!==!0&&C(!0)}else he(0),H!==!1&&se(!1);R(()=>{H!==!1&&se(!0),ee!==!0&&h("show",H)},Zt)}function l(H,ee){p(),H!==!1&&E.animate(),he(0),ie(a.value*e.value),Se(),ee!==!0?R(()=>{h("hide",H)},Zt):o()}const{show:n,hide:c}=Or({showing:i,hideOnRouteChange:t,handleShow:s,handleHide:l}),{addToHistory:m,removeFromHistory:p}=Pr(i,c,t),y={belowBreakpoint:T,hide:c},r=G(()=>P.side==="right"),a=G(()=>(L.lang.rtl===!0?-1:1)*(r.value===!0?1:-1)),g=re(0),k=re(!1),S=re(!1),A=re(e.value*a.value),I=G(()=>r.value===!0?"left":"right"),w=G(()=>i.value===!0&&T.value===!1&&P.overlay===!1?P.miniToOverlay===!0?P.miniWidth:e.value:0),O=G(()=>P.overlay===!0||P.miniToOverlay===!0||E.view.value.indexOf(r.value?"R":"L")>-1||L.platform.is.ios===!0&&E.isContainer.value===!0),F=G(()=>P.overlay===!1&&i.value===!0&&T.value===!1),M=G(()=>P.overlay===!0&&i.value===!0&&T.value===!1),N=G(()=>"fullscreen q-drawer__backdrop"+(i.value===!1&&k.value===!1?" hidden":"")),B=G(()=>({backgroundColor:`rgba(0,0,0,${g.value*.4})`})),U=G(()=>r.value===!0?E.rows.value.top[2]==="r":E.rows.value.top[0]==="l"),j=G(()=>r.value===!0?E.rows.value.bottom[2]==="r":E.rows.value.bottom[0]==="l"),W=G(()=>{const H={};return E.header.space===!0&&U.value===!1&&(O.value===!0?H.top=`${E.header.offset}px`:E.header.space===!0&&(H.top=`${E.header.size}px`)),E.footer.space===!0&&j.value===!1&&(O.value===!0?H.bottom=`${E.footer.offset}px`:E.footer.space===!0&&(H.bottom=`${E.footer.size}px`)),H}),$=G(()=>{const H={width:`${e.value}px`,transform:`translateX(${A.value}px)`};return T.value===!0?H:Object.assign(H,W.value)}),X=G(()=>"q-drawer__content fit "+(E.isContainer.value!==!0?"scroll":"overflow-auto")),Y=G(()=>`q-drawer q-drawer--${P.side}`+(S.value===!0?" q-drawer--mini-animate":"")+(P.bordered===!0?" q-drawer--bordered":"")+(_.value===!0?" q-drawer--dark q-dark":"")+(k.value===!0?" no-transition":i.value===!0?"":" q-layout--prevent-focus")+(T.value===!0?" fixed q-drawer--on-top q-drawer--mobile q-drawer--top-padding":` q-drawer--${u.value===!0?"mini":"standard"}`+(O.value===!0||F.value!==!0?" fixed":"")+(P.overlay===!0||P.miniToOverlay===!0?" q-drawer--on-top":"")+(U.value===!0?" q-drawer--top-padding":""))),Z=G(()=>{const H=L.lang.rtl===!0?P.side:I.value;return[[it,me,void 0,{[H]:!0,mouse:!0}]]}),ue=G(()=>{const H=L.lang.rtl===!0?I.value:P.side;return[[it,pe,void 0,{[H]:!0,mouse:!0}]]}),ce=G(()=>{const H=L.lang.rtl===!0?I.value:P.side;return[[it,pe,void 0,{[H]:!0,mouse:!0,mouseAllDir:!0}]]});function ge(){_e(T,P.behavior==="mobile"||P.behavior!=="desktop"&&E.totalWidth.value<=P.breakpoint)}fe(T,H=>{H===!0?(f=i.value,i.value===!0&&c(!1)):P.overlay===!1&&P.behavior!=="mobile"&&f!==!1&&(i.value===!0?(ie(0),he(0),Se()):n(!1))}),fe(()=>P.side,(H,ee)=>{E.instances[ee]===y&&(E.instances[ee]=void 0,E[ee].space=!1,E[ee].offset=0),E.instances[H]=y,E[H].size=e.value,E[H].space=F.value,E[H].offset=w.value}),fe(E.totalWidth,()=>{(E.isContainer.value===!0||document.qScrollPrevented!==!0)&&ge()}),fe(()=>P.behavior+P.breakpoint,ge),fe(E.isContainer,H=>{i.value===!0&&C(H!==!0),H===!0&&ge()}),fe(E.scrollbarWidth,()=>{ie(i.value===!0?0:void 0)}),fe(w,H=>{Te("offset",H)}),fe(F,H=>{h("onLayout",H),Te("space",H)}),fe(r,()=>{ie()}),fe(e,H=>{ie(),Re(P.miniToOverlay,H)}),fe(()=>P.miniToOverlay,H=>{Re(H,e.value)}),fe(()=>L.lang.rtl,()=>{ie()}),fe(()=>P.mini,()=>{P.noMiniAnimation||P.modelValue===!0&&(oe(),E.animate())}),fe(u,H=>{h("miniState",H)});function ie(H){H===void 0?yt(()=>{H=i.value===!0?0:e.value,ie(a.value*H)}):(E.isContainer.value===!0&&r.value===!0&&(T.value===!0||Math.abs(H)===e.value)&&(H+=a.value*E.scrollbarWidth.value),A.value=H)}function he(H){g.value=H}function se(H){const ee=H===!0?"remove":E.isContainer.value!==!0?"add":"";ee!==""&&document.body.classList[ee]("q-body--drawer-toggle")}function oe(){v!==null&&clearTimeout(v),d.proxy&&d.proxy.$el&&d.proxy.$el.classList.add("q-drawer--mini-animate"),S.value=!0,v=setTimeout(()=>{v=null,S.value=!1,d&&d.proxy&&d.proxy.$el&&d.proxy.$el.classList.remove("q-drawer--mini-animate")},150)}function me(H){if(i.value!==!1)return;const ee=e.value,Ee=Fe(H.distance.x,0,ee);if(H.isFinal===!0){Ee>=Math.min(75,ee)===!0?n():(E.animate(),he(0),ie(a.value*ee)),k.value=!1;return}ie((L.lang.rtl===!0?r.value!==!0:r.value)?Math.max(ee-Ee,0):Math.min(0,Ee-ee)),he(Fe(Ee/ee,0,1)),H.isFirst===!0&&(k.value=!0)}function pe(H){if(i.value!==!0)return;const ee=e.value,Ee=H.direction===P.side,ke=(L.lang.rtl===!0?Ee!==!0:Ee)?Fe(H.distance.x,0,ee):0;if(H.isFinal===!0){Math.abs(ke)<Math.min(75,ee)===!0?(E.animate(),he(1),ie(0)):c(),k.value=!1;return}ie(a.value*ke),he(Fe(1-ke/ee,0,1)),H.isFirst===!0&&(k.value=!0)}function Se(){C(!1),se(!0)}function Te(H,ee){E.update(P.side,H,ee)}function _e(H,ee){H.value!==ee&&(H.value=ee)}function Re(H,ee){Te("size",H===!0?P.miniWidth:ee)}return E.instances[P.side]=y,Re(P.miniToOverlay,e.value),Te("space",F.value),Te("offset",w.value),P.showIfAbove===!0&&P.modelValue!==!0&&i.value===!0&&P["onUpdate:modelValue"]!==void 0&&h("update:modelValue",!0),Et(()=>{h("onLayout",F.value),h("miniState",u.value),f=P.showIfAbove===!0;const H=()=>{(i.value===!0?s:l)(!1,!0)};if(E.totalWidth.value!==0){yt(H);return}b=fe(E.totalWidth,()=>{b(),b=void 0,i.value===!1&&P.showIfAbove===!0&&T.value===!1?n(!1):H()})}),st(()=>{b!==void 0&&b(),v!==null&&(clearTimeout(v),v=null),i.value===!0&&Se(),E.instances[P.side]===y&&(E.instances[P.side]=void 0,Te("size",0),Te("offset",0),Te("space",!1))}),()=>{const H=[];T.value===!0&&(P.noSwipeOpen===!1&&H.push(Le(te("div",{key:"open",class:`q-drawer__opener fixed-${P.side}`,"aria-hidden":"true"}),Z.value)),H.push(Rt("div",{ref:"backdrop",class:N.value,style:B.value,"aria-hidden":"true",onClick:c},void 0,"backdrop",P.noSwipeBackdrop!==!0&&i.value===!0,()=>ce.value)));const ee=u.value===!0&&x.mini!==void 0,Ee=[te("div",{...D,key:""+ee,class:[X.value,D.class]},ee===!0?x.mini():Ye(x.default))];return P.elevated===!0&&i.value===!0&&Ee.push(te("div",{class:"q-layout__shadow absolute-full overflow-hidden no-pointer-events"})),H.push(Rt("aside",{ref:"content",class:Y.value,style:$.value},Ee,"contentclose",P.noSwipeClose!==!0&&T.value===!0,()=>ue.value)),te("div",{class:"q-drawer-container"},H)}}}),Jt=Ie({name:"QPageContainer",setup(P,{slots:x}){const{proxy:{$q:h}}=Me(),D=ct(ft,xe);if(D===xe)return console.error("QPageContainer needs to be child of QLayout"),xe;fr(hr,!0);const d=G(()=>{const L={};return D.header.space===!0&&(L.paddingTop=`${D.header.size}px`),D.right.space===!0&&(L[`padding${h.lang.rtl===!0?"Left":"Right"}`]=`${D.right.size}px`),D.footer.space===!0&&(L.paddingBottom=`${D.footer.size}px`),D.left.space===!0&&(L[`padding${h.lang.rtl===!0?"Right":"Left"}`]=`${D.left.size}px`),L});return()=>te("div",{class:"q-page-container",style:d.value},Ye(x.default))}}),er=Ie({name:"QLayout",props:{container:Boolean,view:{type:String,default:"hhh lpr fff",validator:P=>/^(h|l)h(h|r) lpr (f|l)f(f|r)$/.test(P.toLowerCase())},onScroll:Function,onScrollHeight:Function,onResize:Function},setup(P,{slots:x,emit:h}){const{proxy:{$q:D}}=Me(),d=re(null),L=re(D.screen.height),_=re(P.container===!0?0:D.screen.width),C=re({position:0,direction:"down",inflectionPoint:0}),R=re(0),o=re(Mr.value===!0?0:St()),E=G(()=>"q-layout q-layout--"+(P.container===!0?"containerized":"standard")),f=G(()=>P.container===!1?{minHeight:D.screen.height+"px"}:null),v=G(()=>o.value!==0?{[D.lang.rtl===!0?"left":"right"]:`${o.value}px`}:null),b=G(()=>o.value!==0?{[D.lang.rtl===!0?"right":"left"]:0,[D.lang.rtl===!0?"left":"right"]:`-${o.value}px`,width:`calc(100% + ${o.value}px)`}:null);function T(l){if(P.container===!0||document.qScrollPrevented!==!0){const n={position:l.position.top,direction:l.direction,directionChanged:l.directionChanged,inflectionPoint:l.inflectionPoint.top,delta:l.delta.top};C.value=n,P.onScroll!==void 0&&h("scroll",n)}}function u(l){const{height:n,width:c}=l;let m=!1;L.value!==n&&(m=!0,L.value=n,P.onScrollHeight!==void 0&&h("scrollHeight",n),i()),_.value!==c&&(m=!0,_.value=c),m===!0&&P.onResize!==void 0&&h("resize",l)}function e({height:l}){R.value!==l&&(R.value=l,i())}function i(){if(P.container===!0){const l=L.value>R.value?St():0;o.value!==l&&(o.value=l)}}let t=null;const s={instances:{},view:G(()=>P.view),isContainer:G(()=>P.container),rootRef:d,height:L,containerHeight:R,scrollbarWidth:o,totalWidth:G(()=>_.value+o.value),rows:G(()=>{const l=P.view.toLowerCase().split(" ");return{top:l[0].split(""),middle:l[1].split(""),bottom:l[2].split("")}}),header:He({size:0,offset:0,space:!1}),right:He({size:300,offset:0,space:!1}),footer:He({size:0,offset:0,space:!1}),left:He({size:300,offset:0,space:!1}),scroll:C,animate(){t!==null?clearTimeout(t):document.body.classList.add("q-body--layout-animate"),t=setTimeout(()=>{t=null,document.body.classList.remove("q-body--layout-animate")},155)},update(l,n,c){s[l][n]=c}};if(fr(ft,s),St()>0){let c=function(){l=null,n.classList.remove("hide-scrollbar")},m=function(){if(l===null){if(n.scrollHeight>D.screen.height)return;n.classList.add("hide-scrollbar")}else clearTimeout(l);l=setTimeout(c,300)},p=function(y){l!==null&&y==="remove"&&(clearTimeout(l),c()),window[`${y}EventListener`]("resize",m)},l=null;const n=document.body;fe(()=>P.container!==!0?"add":"remove",p),P.container!==!0&&p("add"),xt(()=>{p("remove")})}return()=>{const l=dr(x.default,[te(vr,{onScroll:T}),te(dt,{onResize:u})]),n=te("div",{class:E.value,style:f.value,ref:P.container===!0?void 0:d,tabindex:-1},l);return P.container===!0?te("div",{class:"q-layout-container overflow-hidden",ref:d},[te(dt,{onResize:e}),te("div",{class:"absolute-full",style:v.value},[te("div",{class:"scroll",style:b.value},[n])])]):n}}}),hi=Ie({name:"QBar",props:{...ht,dense:Boolean},setup(P,{slots:x}){const{proxy:{$q:h}}=Me(),D=vt(P,h),d=G(()=>`q-bar row no-wrap items-center q-bar--${P.dense===!0?"dense":"standard"}  q-bar--${D.value===!0?"dark":"light"}`);return()=>te("div",{class:d.value,role:"toolbar"},Ye(x.default))}}),tr=Ie({name:"QPopupProxy",props:{...Yr,breakpoint:{type:[String,Number],default:450}},emits:["show","hide"],setup(P,{slots:x,emit:h,attrs:D}){const{proxy:d}=Me(),{$q:L}=d,_=re(!1),C=re(null),R=G(()=>parseInt(P.breakpoint,10)),{canShow:o}=Xr({showing:_});function E(){return L.screen.width<R.value||L.screen.height<R.value?"dialog":"menu"}const f=re(E()),v=G(()=>f.value==="menu"?{maxHeight:"99vh"}:{});fe(()=>E(),u=>{_.value!==!0&&(f.value=u)});function b(u){_.value=!0,h("show",u)}function T(u){_.value=!1,f.value=E(),h("hide",u)}return Object.assign(d,{show(u){o(u)===!0&&C.value.show(u)},hide(u){C.value.hide(u)},toggle(u){C.value.toggle(u)}}),Nr(d,"currentComponent",()=>({type:f.value,ref:C.value})),()=>{const u={ref:C,...v.value,...D,onShow:b,onHide:T};let e;return f.value==="dialog"?e=Br:(e=Qr,Object.assign(u,{target:P.target,contextMenu:P.contextMenu,noParentEvent:!0,separateClosePopup:!0})),te(e,u,x.default)}}}),rr=Ie({name:"QPageScroller",props:{...Zr,scrollOffset:{type:Number,default:1e3},reverse:Boolean,duration:{type:Number,default:300},offset:{default:()=>[18,18]}},emits:["click"],setup(P,{slots:x,emit:h}){const{proxy:{$q:D}}=Me(),{$layout:d,getStickyContent:L}=Jr(),_=re(null);let C;const R=G(()=>d.height.value-(d.isContainer.value===!0?d.containerHeight.value:D.screen.height));function o(){return P.reverse===!0?R.value-d.scroll.value.position>P.scrollOffset:d.scroll.value.position>P.scrollOffset}const E=re(o());function f(){const e=o();E.value!==e&&(E.value=e)}function v(){P.reverse===!0?C===void 0&&(C=fe(R,f)):b()}fe(d.scroll,f),fe(()=>P.reverse,v);function b(){C!==void 0&&(C(),C=void 0)}function T(e){const i=cr(d.isContainer.value===!0?_.value:d.rootRef.value);_t(i,P.reverse===!0?d.height.value:0,P.duration),h("click",e)}function u(){return E.value===!0?te("div",{ref:_,class:"q-page-scroller",onClick:T},L(x)):null}return v(),st(b),()=>te(Tt,{name:"q-transition--fade"},u)}}),ir=Ie({name:"QPage",props:{padding:Boolean,styleFn:Function},setup(P,{slots:x}){const{proxy:{$q:h}}=Me(),D=ct(ft,xe);if(D===xe)return console.error("QPage needs to be a deep child of QLayout"),xe;if(ct(hr,xe)===xe)return console.error("QPage needs to be child of QPageContainer"),xe;const L=G(()=>{const C=(D.header.space===!0?D.header.size:0)+(D.footer.space===!0?D.footer.size:0);if(typeof P.styleFn=="function"){const R=D.isContainer.value===!0?D.containerHeight.value:h.screen.height;return P.styleFn(C,R)}return{minHeight:D.isContainer.value===!0?D.containerHeight.value-C+"px":h.screen.height===0?C!==0?`calc(100vh - ${C}px)`:"100vh":h.screen.height-C+"px"}}),_=G(()=>`q-page${P.padding===!0?" q-layout-padding":""}`);return()=>te("main",{class:_.value,style:L.value},Ye(x.default))}});const nr="q-slider__marker-labels",vi=P=>({value:P}),gi=({marker:P})=>te("div",{key:P.value,style:P.style,class:P.classes},P.label),gr=[34,37,40,33,39,38],pi={...ht,...Gr,min:{type:Number,default:0},max:{type:Number,default:100},innerMin:Number,innerMax:Number,step:{type:Number,default:1,validator:P=>P>=0},snap:Boolean,vertical:Boolean,reverse:Boolean,hideSelection:Boolean,color:String,markerLabelsClass:String,label:Boolean,labelColor:String,labelTextColor:String,labelAlways:Boolean,switchLabelSide:Boolean,markers:[Boolean,Number],markerLabels:[Boolean,Array,Object,Function],switchMarkerLabelsSide:Boolean,trackImg:String,trackColor:String,innerTrackImg:String,innerTrackColor:String,selectionColor:String,selectionImg:String,thumbSize:{type:String,default:"20px"},trackSize:{type:String,default:"4px"},disable:Boolean,readonly:Boolean,dense:Boolean,tabindex:[String,Number],thumbColor:String,thumbPath:{type:String,default:"M 4, 10 a 6,6 0 1,0 12,0 a 6,6 0 1,0 -12,0"}},mi=["pan","update:modelValue","change"];function yi({updateValue:P,updatePosition:x,getDragging:h,formAttrs:D}){const{props:d,emit:L,slots:_,proxy:{$q:C}}=Me(),R=vt(d,C),o=Vr(D),E=re(!1),f=re(!1),v=re(!1),b=re(!1),T=G(()=>d.vertical===!0?"--v":"--h"),u=G(()=>"-"+(d.switchLabelSide===!0?"switched":"standard")),e=G(()=>d.vertical===!0?d.reverse===!0:d.reverse!==(C.lang.rtl===!0)),i=G(()=>isNaN(d.innerMin)===!0||d.innerMin<d.min?d.min:d.innerMin),t=G(()=>isNaN(d.innerMax)===!0||d.innerMax>d.max?d.max:d.innerMax),s=G(()=>d.disable!==!0&&d.readonly!==!0&&i.value<t.value),l=G(()=>(String(d.step).trim().split(".")[1]||"").length),n=G(()=>d.step===0?1:d.step),c=G(()=>s.value===!0?d.tabindex||0:-1),m=G(()=>d.max-d.min),p=G(()=>t.value-i.value),y=G(()=>ce(i.value)),r=G(()=>ce(t.value)),a=G(()=>d.vertical===!0?e.value===!0?"bottom":"top":e.value===!0?"right":"left"),g=G(()=>d.vertical===!0?"height":"width"),k=G(()=>d.vertical===!0?"width":"height"),S=G(()=>d.vertical===!0?"vertical":"horizontal"),A=G(()=>{const V={role:"slider","aria-valuemin":i.value,"aria-valuemax":t.value,"aria-orientation":S.value,"data-step":d.step};return d.disable===!0?V["aria-disabled"]="true":d.readonly===!0&&(V["aria-readonly"]="true"),V}),I=G(()=>`q-slider q-slider${T.value} q-slider--${E.value===!0?"":"in"}active inline no-wrap `+(d.vertical===!0?"row":"column")+(d.disable===!0?" disabled":" q-slider--enabled"+(s.value===!0?" q-slider--editable":""))+(v.value==="both"?" q-slider--focus":"")+(d.label||d.labelAlways===!0?" q-slider--label":"")+(d.labelAlways===!0?" q-slider--label-always":"")+(R.value===!0?" q-slider--dark":"")+(d.dense===!0?" q-slider--dense q-slider--dense"+T.value:""));function w(V){const ne="q-slider__"+V;return`${ne} ${ne}${T.value} ${ne}${T.value}${u.value}`}function O(V){const ne="q-slider__"+V;return`${ne} ${ne}${T.value}`}const F=G(()=>{const V=d.selectionColor||d.color;return"q-slider__selection absolute"+(V!==void 0?` text-${V}`:"")}),M=G(()=>O("markers")+" absolute overflow-hidden"),N=G(()=>O("track-container")),B=G(()=>w("pin")),U=G(()=>w("label")),j=G(()=>w("text-container")),W=G(()=>w("marker-labels-container")+(d.markerLabelsClass!==void 0?` ${d.markerLabelsClass}`:"")),$=G(()=>"q-slider__track relative-position no-outline"+(d.trackColor!==void 0?` bg-${d.trackColor}`:"")),X=G(()=>{const V={[k.value]:d.trackSize};return d.trackImg!==void 0&&(V.backgroundImage=`url(${d.trackImg}) !important`),V}),Y=G(()=>"q-slider__inner absolute"+(d.innerTrackColor!==void 0?` bg-${d.innerTrackColor}`:"")),Z=G(()=>{const V=r.value-y.value,ne={[a.value]:`${100*y.value}%`,[g.value]:V===0?"2px":`${100*V}%`};return d.innerTrackImg!==void 0&&(ne.backgroundImage=`url(${d.innerTrackImg}) !important`),ne});function ue(V){const{min:ne,max:de,step:ve}=d;let ye=ne+V*(de-ne);if(ve>0){const Ce=(ye-ne)%ve;ye+=(Math.abs(Ce)>=ve/2?(Ce<0?-1:1)*ve:0)-Ce}return l.value>0&&(ye=parseFloat(ye.toFixed(l.value))),Fe(ye,i.value,t.value)}function ce(V){return m.value===0?0:(V-d.min)/m.value}function ge(V,ne){const de=jr(V),ve=d.vertical===!0?Fe((de.top-ne.top)/ne.height,0,1):Fe((de.left-ne.left)/ne.width,0,1);return Fe(e.value===!0?1-ve:ve,y.value,r.value)}const ie=G(()=>Ur(d.markers)===!0?d.markers:n.value),he=G(()=>{const V=[],ne=ie.value,de=d.max;let ve=d.min;do V.push(ve),ve+=ne;while(ve<de);return V.push(de),V}),se=G(()=>{const V=` ${nr}${T.value}-`;return nr+`${V}${d.switchMarkerLabelsSide===!0?"switched":"standard"}${V}${e.value===!0?"rtl":"ltr"}`}),oe=G(()=>d.markerLabels===!1?null:Se(d.markerLabels).map((V,ne)=>({index:ne,value:V.value,label:V.label||V.value,classes:se.value+(V.classes!==void 0?" "+V.classes:""),style:{...Te(V.value),...V.style||{}}}))),me=G(()=>({markerList:oe.value,markerMap:_e.value,classes:se.value,getStyle:Te})),pe=G(()=>{const V=p.value===0?"2px":100*ie.value/p.value;return{...Z.value,backgroundSize:d.vertical===!0?`2px ${V}%`:`${V}% 2px`}});function Se(V){if(V===!1)return null;if(V===!0)return he.value.map(vi);if(typeof V=="function")return he.value.map(de=>{const ve=V(de);return Lt(ve)===!0?{...ve,value:de}:{value:de,label:ve}});const ne=({value:de})=>de>=d.min&&de<=d.max;return Array.isArray(V)===!0?V.map(de=>Lt(de)===!0?de:{value:de}).filter(ne):Object.keys(V).map(de=>{const ve=V[de],ye=Number(de);return Lt(ve)===!0?{...ve,value:ye}:{value:ye,label:ve}}).filter(ne)}function Te(V){return{[a.value]:`${100*(V-d.min)/m.value}%`}}const _e=G(()=>{if(d.markerLabels===!1)return null;const V={};return oe.value.forEach(ne=>{V[ne.value]=ne}),V});function Re(){if(_["marker-label-group"]!==void 0)return _["marker-label-group"](me.value);const V=_["marker-label"]||gi;return oe.value.map(ne=>V({marker:ne,...me.value}))}const H=G(()=>[[it,ee,void 0,{[S.value]:!0,prevent:!0,stop:!0,mouse:!0,mouseAllDir:!0}]]);function ee(V){V.isFinal===!0?(b.value!==void 0&&(x(V.evt),V.touch===!0&&P(!0),b.value=void 0,L("pan","end")),E.value=!1,v.value=!1):V.isFirst===!0?(b.value=h(V.evt),x(V.evt),P(),E.value=!0,L("pan","start")):(x(V.evt),P())}function Ee(){v.value=!1}function ke(V){x(V,h(V)),P(),f.value=!0,E.value=!0,document.addEventListener("mouseup",Ne,!0)}function Ne(){f.value=!1,E.value=!1,P(!0),Ee(),document.removeEventListener("mouseup",Ne,!0)}function ze(V){x(V,h(V)),P(!0)}function qe(V){gr.includes(V.keyCode)&&P(!0)}function je(V){if(d.vertical===!0)return null;const ne=C.lang.rtl!==d.reverse?1-V:V;return{transform:`translateX(calc(${2*ne-1} * ${d.thumbSize} / 2 + ${50-100*ne}%))`}}function Xe(V){const ne=G(()=>f.value===!1&&(v.value===V.focusValue||v.value==="both")?" q-slider--focus":""),de=G(()=>`q-slider__thumb q-slider__thumb${T.value} q-slider__thumb${T.value}-${e.value===!0?"rtl":"ltr"} absolute non-selectable`+ne.value+(V.thumbColor.value!==void 0?` text-${V.thumbColor.value}`:"")),ve=G(()=>({width:d.thumbSize,height:d.thumbSize,[a.value]:`${100*V.ratio.value}%`,zIndex:v.value===V.focusValue?2:void 0})),ye=G(()=>V.labelColor.value!==void 0?` text-${V.labelColor.value}`:""),Ce=G(()=>je(V.ratio.value)),Pe=G(()=>"q-slider__text"+(V.labelTextColor.value!==void 0?` text-${V.labelTextColor.value}`:""));return()=>{const Ve=[te("svg",{class:"q-slider__thumb-shape absolute-full",viewBox:"0 0 20 20","aria-hidden":"true"},[te("path",{d:d.thumbPath})]),te("div",{class:"q-slider__focus-ring fit"})];return(d.label===!0||d.labelAlways===!0)&&(Ve.push(te("div",{class:B.value+" absolute fit no-pointer-events"+ye.value},[te("div",{class:U.value,style:{minWidth:d.thumbSize}},[te("div",{class:j.value,style:Ce.value},[te("span",{class:Pe.value},V.label.value)])])])),d.name!==void 0&&d.disable!==!0&&o(Ve,"push")),te("div",{class:de.value,style:ve.value,...V.getNodeData()},Ve)}}function We(V,ne,de,ve){const ye=[];d.innerTrackColor!=="transparent"&&ye.push(te("div",{key:"inner",class:Y.value,style:Z.value})),d.selectionColor!=="transparent"&&ye.push(te("div",{key:"selection",class:F.value,style:V.value})),d.markers!==!1&&ye.push(te("div",{key:"marker",class:M.value,style:pe.value})),ve(ye);const Ce=[Rt("div",{key:"trackC",class:N.value,tabindex:ne.value,...de.value},[te("div",{class:$.value,style:X.value},ye)],"slide",s.value,()=>H.value)];if(d.markerLabels!==!1){const Pe=d.switchMarkerLabelsSide===!0?"unshift":"push";Ce[Pe](te("div",{key:"markerL",class:W.value},Re()))}return Ce}return st(()=>{document.removeEventListener("mouseup",Ne,!0)}),{state:{active:E,focus:v,preventFocus:f,dragging:b,editable:s,classes:I,tabindex:c,attributes:A,step:n,decimals:l,trackLen:m,innerMin:i,innerMinRatio:y,innerMax:t,innerMaxRatio:r,positionProp:a,sizeProp:g,isReversed:e},methods:{onActivate:ke,onMobileClick:ze,onBlur:Ee,onKeyup:qe,getContent:We,getThumbRenderFn:Xe,convertRatioToModel:ue,convertModelToRatio:ce,getDraggingRatio:ge}}}const Ti=()=>({});var Ei=Ie({name:"QSlider",props:{...pi,modelValue:{required:!0,default:null,validator:P=>typeof P=="number"||P===null},labelValue:[String,Number]},emits:mi,setup(P,{emit:x}){const{proxy:{$q:h}}=Me(),{state:D,methods:d}=yi({updateValue:T,updatePosition:e,getDragging:u,formAttrs:Kr(P)}),L=re(null),_=re(0),C=re(0);function R(){C.value=P.modelValue===null?D.innerMin.value:Fe(P.modelValue,D.innerMin.value,D.innerMax.value)}fe(()=>`${P.modelValue}|${D.innerMin.value}|${D.innerMax.value}`,R),R();const o=G(()=>d.convertModelToRatio(C.value)),E=G(()=>D.active.value===!0?_.value:o.value),f=G(()=>{const s={[D.positionProp.value]:`${100*D.innerMinRatio.value}%`,[D.sizeProp.value]:`${100*(E.value-D.innerMinRatio.value)}%`};return P.selectionImg!==void 0&&(s.backgroundImage=`url(${P.selectionImg}) !important`),s}),v=d.getThumbRenderFn({focusValue:!0,getNodeData:Ti,ratio:E,label:G(()=>P.labelValue!==void 0?P.labelValue:C.value),thumbColor:G(()=>P.thumbColor||P.color),labelColor:G(()=>P.labelColor),labelTextColor:G(()=>P.labelTextColor)}),b=G(()=>D.editable.value!==!0?{}:h.platform.is.mobile===!0?{onClick:d.onMobileClick}:{onMousedown:d.onActivate,onFocus:i,onBlur:d.onBlur,onKeydown:t,onKeyup:d.onKeyup});function T(s){C.value!==P.modelValue&&x("update:modelValue",C.value),s===!0&&x("change",C.value)}function u(){return L.value.getBoundingClientRect()}function e(s,l=D.dragging.value){const n=d.getDraggingRatio(s,l);C.value=d.convertRatioToModel(n),_.value=P.snap!==!0||P.step===0?n:d.convertModelToRatio(C.value)}function i(){D.focus.value=!0}function t(s){if(!gr.includes(s.keyCode))return;Hr(s);const l=([34,33].includes(s.keyCode)?10:1)*D.step.value,n=([34,37,40].includes(s.keyCode)?-1:1)*(D.isReversed.value===!0?-1:1)*(P.vertical===!0?-1:1)*l;C.value=Fe(parseFloat((C.value+n).toFixed(D.decimals.value)),D.innerMin.value,D.innerMax.value),T()}return()=>{const s=d.getContent(f,D.tabindex,b,l=>{l.push(v())});return te("div",{ref:L,class:D.classes.value+(P.modelValue===null?" q-slider--no-value":""),...D.attributes.value,"aria-valuenow":P.modelValue},s)}}}),bi=Object.defineProperty,Si=Object.defineProperties,Li=Object.getOwnPropertyDescriptors,ar=Object.getOwnPropertySymbols,ki=Object.prototype.hasOwnProperty,Ai=Object.prototype.propertyIsEnumerable,sr=(P,x,h)=>x in P?bi(P,x,{enumerable:!0,configurable:!0,writable:!0,value:h}):P[x]=h,wt=(P,x)=>{for(var h in x||(x={}))ki.call(x,h)&&sr(P,h,x[h]);if(ar)for(var h of ar(x))Ai.call(x,h)&&sr(P,h,x[h]);return P},It=(P,x)=>Si(P,Li(x));function or(P,x,h,D){var d,L=!1,_=0;function C(){d&&clearTimeout(d)}function R(){for(var o=arguments.length,E=new Array(o),f=0;f<o;f++)E[f]=arguments[f];var v=this,b=Date.now()-_;function T(){_=Date.now(),h.apply(v,E)}function u(){d=void 0}L||(D&&!d&&T(),C(),D===void 0&&b>P?T():x!==!0&&(d=setTimeout(D?u:T,D===void 0?P-b:P)))}return typeof x!="boolean"&&(D=h,h=x,x=void 0),R.cancel=function(){C(),L=!0},R}function lr(P,x,h){return h===void 0?or(P,x,!1):or(P,h,x!==!1)}function Di(P){return P&&P.__esModule&&Object.prototype.hasOwnProperty.call(P,"default")?P.default:P}var pr={exports:{}};typeof window!="undefined"&&(pr.exports=function(P){var x={};function h(D){if(x[D])return x[D].exports;var d=x[D]={i:D,l:!1,exports:{}};return P[D].call(d.exports,d,d.exports,h),d.l=!0,d.exports}return h.m=P,h.c=x,h.d=function(D,d,L){h.o(D,d)||Object.defineProperty(D,d,{enumerable:!0,get:L})},h.r=function(D){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(D,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(D,"__esModule",{value:!0})},h.t=function(D,d){if(1&d&&(D=h(D)),8&d||4&d&&typeof D=="object"&&D&&D.__esModule)return D;var L=Object.create(null);if(h.r(L),Object.defineProperty(L,"default",{enumerable:!0,value:D}),2&d&&typeof D!="string")for(var _ in D)h.d(L,_,function(C){return D[C]}.bind(null,_));return L},h.n=function(D){var d=D&&D.__esModule?function(){return D.default}:function(){return D};return h.d(d,"a",d),d},h.o=function(D,d){return Object.prototype.hasOwnProperty.call(D,d)},h.p="/dist/",h(h.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(P,x,h){var D=Object.prototype.hasOwnProperty,d="~";function L(){}function _(E,f,v){this.fn=E,this.context=f,this.once=v||!1}function C(E,f,v,b,T){if(typeof v!="function")throw new TypeError("The listener must be a function");var u=new _(v,b||E,T),e=d?d+f:f;return E._events[e]?E._events[e].fn?E._events[e]=[E._events[e],u]:E._events[e].push(u):(E._events[e]=u,E._eventsCount++),E}function R(E,f){--E._eventsCount==0?E._events=new L:delete E._events[f]}function o(){this._events=new L,this._eventsCount=0}Object.create&&(L.prototype=Object.create(null),new L().__proto__||(d=!1)),o.prototype.eventNames=function(){var E,f,v=[];if(this._eventsCount===0)return v;for(f in E=this._events)D.call(E,f)&&v.push(d?f.slice(1):f);return Object.getOwnPropertySymbols?v.concat(Object.getOwnPropertySymbols(E)):v},o.prototype.listeners=function(E){var f=d?d+E:E,v=this._events[f];if(!v)return[];if(v.fn)return[v.fn];for(var b=0,T=v.length,u=new Array(T);b<T;b++)u[b]=v[b].fn;return u},o.prototype.listenerCount=function(E){var f=d?d+E:E,v=this._events[f];return v?v.fn?1:v.length:0},o.prototype.emit=function(E,f,v,b,T,u){var e=d?d+E:E;if(!this._events[e])return!1;var i,t,s=this._events[e],l=arguments.length;if(s.fn){switch(s.once&&this.removeListener(E,s.fn,void 0,!0),l){case 1:return s.fn.call(s.context),!0;case 2:return s.fn.call(s.context,f),!0;case 3:return s.fn.call(s.context,f,v),!0;case 4:return s.fn.call(s.context,f,v,b),!0;case 5:return s.fn.call(s.context,f,v,b,T),!0;case 6:return s.fn.call(s.context,f,v,b,T,u),!0}for(t=1,i=new Array(l-1);t<l;t++)i[t-1]=arguments[t];s.fn.apply(s.context,i)}else{var n,c=s.length;for(t=0;t<c;t++)switch(s[t].once&&this.removeListener(E,s[t].fn,void 0,!0),l){case 1:s[t].fn.call(s[t].context);break;case 2:s[t].fn.call(s[t].context,f);break;case 3:s[t].fn.call(s[t].context,f,v);break;case 4:s[t].fn.call(s[t].context,f,v,b);break;default:if(!i)for(n=1,i=new Array(l-1);n<l;n++)i[n-1]=arguments[n];s[t].fn.apply(s[t].context,i)}}return!0},o.prototype.on=function(E,f,v){return C(this,E,f,v,!1)},o.prototype.once=function(E,f,v){return C(this,E,f,v,!0)},o.prototype.removeListener=function(E,f,v,b){var T=d?d+E:E;if(!this._events[T])return this;if(!f)return R(this,T),this;var u=this._events[T];if(u.fn)u.fn!==f||b&&!u.once||v&&u.context!==v||R(this,T);else{for(var e=0,i=[],t=u.length;e<t;e++)(u[e].fn!==f||b&&!u[e].once||v&&u[e].context!==v)&&i.push(u[e]);i.length?this._events[T]=i.length===1?i[0]:i:R(this,T)}return this},o.prototype.removeAllListeners=function(E){var f;return E?(f=d?d+E:E,this._events[f]&&R(this,f)):(this._events=new L,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=d,o.EventEmitter=o,P.exports=o},"./node_modules/url-toolkit/src/url-toolkit.js":function(P,x,h){var D,d,L,_,C;D=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#[^]*)?$/,d=/^([^\/?#]*)([^]*)$/,L=/(?:\/|^)\.(?=\/)/g,_=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,C={buildAbsoluteURL:function(R,o,E){if(E=E||{},R=R.trim(),!(o=o.trim())){if(!E.alwaysNormalize)return R;var f=C.parseURL(R);if(!f)throw new Error("Error trying to parse base URL.");return f.path=C.normalizePath(f.path),C.buildURLFromParts(f)}var v=C.parseURL(o);if(!v)throw new Error("Error trying to parse relative URL.");if(v.scheme)return E.alwaysNormalize?(v.path=C.normalizePath(v.path),C.buildURLFromParts(v)):o;var b=C.parseURL(R);if(!b)throw new Error("Error trying to parse base URL.");if(!b.netLoc&&b.path&&b.path[0]!=="/"){var T=d.exec(b.path);b.netLoc=T[1],b.path=T[2]}b.netLoc&&!b.path&&(b.path="/");var u={scheme:b.scheme,netLoc:v.netLoc,path:null,params:v.params,query:v.query,fragment:v.fragment};if(!v.netLoc&&(u.netLoc=b.netLoc,v.path[0]!=="/"))if(v.path){var e=b.path,i=e.substring(0,e.lastIndexOf("/")+1)+v.path;u.path=C.normalizePath(i)}else u.path=b.path,v.params||(u.params=b.params,v.query||(u.query=b.query));return u.path===null&&(u.path=E.alwaysNormalize?C.normalizePath(v.path):v.path),C.buildURLFromParts(u)},parseURL:function(R){var o=D.exec(R);return o?{scheme:o[1]||"",netLoc:o[2]||"",path:o[3]||"",params:o[4]||"",query:o[5]||"",fragment:o[6]||""}:null},normalizePath:function(R){for(R=R.split("").reverse().join("").replace(L,"");R.length!==(R=R.replace(_,"")).length;);return R.split("").reverse().join("")},buildURLFromParts:function(R){return R.scheme+R.netLoc+R.path+R.params+R.query+R.fragment}},P.exports=C},"./node_modules/webworkify-webpack/index.js":function(P,x,h){function D(o){var E={};function f(b){if(E[b])return E[b].exports;var T=E[b]={i:b,l:!1,exports:{}};return o[b].call(T.exports,T,T.exports,f),T.l=!0,T.exports}f.m=o,f.c=E,f.i=function(b){return b},f.d=function(b,T,u){f.o(b,T)||Object.defineProperty(b,T,{configurable:!1,enumerable:!0,get:u})},f.r=function(b){Object.defineProperty(b,"__esModule",{value:!0})},f.n=function(b){var T=b&&b.__esModule?function(){return b.default}:function(){return b};return f.d(T,"a",T),T},f.o=function(b,T){return Object.prototype.hasOwnProperty.call(b,T)},f.p="/",f.oe=function(b){throw console.error(b),b};var v=f(f.s=ENTRY_MODULE);return v.default||v}var d="[\\.|\\-|\\+|\\w|/|@]+",L="\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)";function _(o){return(o+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function C(o,E,f){var v={};v[f]=[];var b=E.toString(),T=b.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!T)return v;for(var u,e=T[1],i=new RegExp("(\\\\n|\\W)"+_(e)+L,"g");u=i.exec(b);)u[3]!=="dll-reference"&&v[f].push(u[3]);for(i=new RegExp("\\("+_(e)+'\\("(dll-reference\\s('+d+'))"\\)\\)'+L,"g");u=i.exec(b);)o[u[2]]||(v[f].push(u[1]),o[u[2]]=h(u[1]).m),v[u[2]]=v[u[2]]||[],v[u[2]].push(u[4]);for(var t,s=Object.keys(v),l=0;l<s.length;l++)for(var n=0;n<v[s[l]].length;n++)t=v[s[l]][n],isNaN(1*t)||(v[s[l]][n]=1*v[s[l]][n]);return v}function R(o){return Object.keys(o).reduce(function(E,f){return E||o[f].length>0},!1)}P.exports=function(o,E){E=E||{};var f={main:h.m},v=E.all?{main:Object.keys(f.main)}:function(i,t){for(var s={main:[t]},l={main:[]},n={main:{}};R(s);)for(var c=Object.keys(s),m=0;m<c.length;m++){var p=c[m],y=s[p].pop();if(n[p]=n[p]||{},!n[p][y]&&i[p][y]){n[p][y]=!0,l[p]=l[p]||[],l[p].push(y);for(var r=C(i,i[p][y],p),a=Object.keys(r),g=0;g<a.length;g++)s[a[g]]=s[a[g]]||[],s[a[g]]=s[a[g]].concat(r[a[g]])}}return l}(f,o),b="";Object.keys(v).filter(function(i){return i!=="main"}).forEach(function(i){for(var t=0;v[i][t];)t++;v[i].push(t),f[i][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",b=b+"var "+i+" = ("+D.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+v[i].map(function(s){return JSON.stringify(s)+": "+f[i][s].toString()}).join(",")+`});
`}),b=b+"new (("+D.toString().replace("ENTRY_MODULE",JSON.stringify(o))+")({"+v.main.map(function(i){return JSON.stringify(i)+": "+f.main[i].toString()}).join(",")+"}))(self);";var T=new window.Blob([b],{type:"text/javascript"});if(E.bare)return T;var u=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(T),e=new window.Worker(u);return e.objectURL=u,e}},"./src/config.ts":function(P,x,h){h.r(x),h.d(x,"hlsDefaultConfig",function(){return c}),h.d(x,"mergeConfig",function(){return m}),h.d(x,"enableStreamingMode",function(){return p});var D=h("./src/controller/abr-controller.ts"),d=h("./src/controller/audio-stream-controller.ts"),L=h("./src/controller/audio-track-controller.ts"),_=h("./src/controller/subtitle-stream-controller.ts"),C=h("./src/controller/subtitle-track-controller.ts"),R=h("./src/controller/buffer-controller.ts"),o=h("./src/controller/timeline-controller.ts"),E=h("./src/controller/cap-level-controller.ts"),f=h("./src/controller/fps-controller.ts"),v=h("./src/controller/eme-controller.ts"),b=h("./src/utils/xhr-loader.ts"),T=h("./src/utils/fetch-loader.ts"),u=h("./src/utils/cues.ts"),e=h("./src/utils/mediakeys-helper.ts"),i=h("./src/utils/logger.ts");function t(){return(t=Object.assign||function(y){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var g in a)Object.prototype.hasOwnProperty.call(a,g)&&(y[g]=a[g])}return y}).apply(this,arguments)}function s(y,r){var a=Object.keys(y);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(y);r&&(g=g.filter(function(k){return Object.getOwnPropertyDescriptor(y,k).enumerable})),a.push.apply(a,g)}return a}function l(y){for(var r=1;r<arguments.length;r++){var a=arguments[r]!=null?arguments[r]:{};r%2?s(Object(a),!0).forEach(function(g){n(y,g,a[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(y,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach(function(g){Object.defineProperty(y,g,Object.getOwnPropertyDescriptor(a,g))})}return y}function n(y,r,a){return r in y?Object.defineProperty(y,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):y[r]=a,y}var c=l(l({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:b.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:D.default,bufferController:R.default,capLevelController:E.default,fpsController:f.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:e.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0},{cueHandler:u.default,enableCEA708Captions:!0,enableWebVTT:!0,enableIMSC1:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:_.SubtitleStreamController,subtitleTrackController:C.default,timelineController:o.TimelineController,audioStreamController:d.default,audioTrackController:L.default,emeController:v.default});function m(y,r){if((r.liveSyncDurationCount||r.liveMaxLatencyDurationCount)&&(r.liveSyncDuration||r.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(r.liveMaxLatencyDurationCount!==void 0&&(r.liveSyncDurationCount===void 0||r.liveMaxLatencyDurationCount<=r.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(r.liveMaxLatencyDuration!==void 0&&(r.liveSyncDuration===void 0||r.liveMaxLatencyDuration<=r.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return t({},y,r)}function p(y){var r=y.loader;r!==T.default&&r!==b.default?(i.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),y.progressive=!1):Object(T.fetchSupported)()&&(y.loader=T.default,y.progressive=!0,y.enableSoftwareAES=!0,i.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}},"./src/controller/abr-controller.ts":function(P,x,h){h.r(x);var D=h("./src/polyfills/number.ts"),d=h("./src/utils/ewma-bandwidth-estimator.ts"),L=h("./src/events.ts"),_=h("./src/utils/buffer-helper.ts"),C=h("./src/errors.ts"),R=h("./src/types/loader.ts"),o=h("./src/utils/logger.ts");function E(v,b){for(var T=0;T<b.length;T++){var u=b[T];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(v,u.key,u)}}var f=function(){function v(e){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=e;var i=e.config;this.bwEstimator=new d.default(i.abrEwmaSlowVoD,i.abrEwmaFastVoD,i.abrEwmaDefaultEstimate),this.registerListeners()}var b,T,u=v.prototype;return u.registerListeners=function(){var e=this.hls;e.on(L.Events.FRAG_LOADING,this.onFragLoading,this),e.on(L.Events.FRAG_LOADED,this.onFragLoaded,this),e.on(L.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.on(L.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.Events.ERROR,this.onError,this)},u.unregisterListeners=function(){var e=this.hls;e.off(L.Events.FRAG_LOADING,this.onFragLoading,this),e.off(L.Events.FRAG_LOADED,this.onFragLoaded,this),e.off(L.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.off(L.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.Events.ERROR,this.onError,this)},u.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},u.onFragLoading=function(e,i){var t,s=i.frag;s.type===R.PlaylistLevelType.MAIN&&(this.timer||(this.fragCurrent=s,this.partCurrent=(t=i.part)!=null?t:null,this.timer=self.setInterval(this.onCheck,100)))},u.onLevelLoaded=function(e,i){var t=this.hls.config;i.details.live?this.bwEstimator.update(t.abrEwmaSlowLive,t.abrEwmaFastLive):this.bwEstimator.update(t.abrEwmaSlowVoD,t.abrEwmaFastVoD)},u._abandonRulesCheck=function(){var e=this.fragCurrent,i=this.partCurrent,t=this.hls,s=t.autoLevelEnabled,l=t.config,n=t.media;if(e&&n){var c=i?i.stats:e.stats,m=i?i.duration:e.duration;if(c.aborted)return o.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);if(s&&!n.paused&&n.playbackRate&&n.readyState){var p=performance.now()-c.loading.start,y=Math.abs(n.playbackRate);if(!(p<=500*m/y)){var r=t.levels,a=t.minAutoLevel,g=r[e.level],k=c.total||Math.max(c.loaded,Math.round(m*g.maxBitrate/8)),S=Math.max(1,c.bwEstimate?c.bwEstimate/8:1e3*c.loaded/p),A=(k-c.loaded)/S,I=n.currentTime,w=(_.BufferHelper.bufferInfo(n,I,l.maxBufferHole).end-I)/y;if(!(w>=2*m/y||A<=w)){var O,F=Number.POSITIVE_INFINITY;for(O=e.level-1;O>a&&!((F=m*r[O].maxBitrate/(6.4*S))<w);O--);if(!(F>=A)){var M=this.bwEstimator.getEstimate();o.logger.warn("Fragment "+e.sn+(i?" part "+i.index:"")+" of level "+e.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+O+`
      Current BW estimate: `+(Object(D.isFiniteNumber)(M)?(M/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+A.toFixed(3)+` s
      Estimated load time for the next fragment: `+F.toFixed(3)+` s
      Time to underbuffer: `+w.toFixed(3)+" s"),t.nextLoadLevel=O,this.bwEstimator.sample(p,c.loaded),this.clearTimer(),e.loader&&(this.fragCurrent=this.partCurrent=null,e.loader.abort()),t.trigger(L.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:e,part:i,stats:c})}}}}}},u.onFragLoaded=function(e,i){var t=i.frag,s=i.part;if(t.type===R.PlaylistLevelType.MAIN&&Object(D.isFiniteNumber)(t.sn)){var l=s?s.stats:t.stats,n=s?s.duration:t.duration;if(this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var c=this.hls.levels[t.level],m=(c.loaded?c.loaded.bytes:0)+l.loaded,p=(c.loaded?c.loaded.duration:0)+n;c.loaded={bytes:m,duration:p},c.realBitrate=Math.round(8*m/p)}if(t.bitrateTest){var y={stats:l,frag:t,part:s,id:t.type};this.onFragBuffered(L.Events.FRAG_BUFFERED,y),t.bitrateTest=!1}}},u.onFragBuffered=function(e,i){var t=i.frag,s=i.part,l=s?s.stats:t.stats;if(!l.aborted&&t.type===R.PlaylistLevelType.MAIN&&t.sn!=="initSegment"){var n=l.parsing.end-l.loading.start;this.bwEstimator.sample(n,l.loaded),l.bwEstimate=this.bwEstimator.getEstimate(),t.bitrateTest?this.bitrateTestDelay=n/1e3:this.bitrateTestDelay=0}},u.onError=function(e,i){switch(i.details){case C.ErrorDetails.FRAG_LOAD_ERROR:case C.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},u.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},u.getNextABRAutoLevel=function(){var e=this.fragCurrent,i=this.partCurrent,t=this.hls,s=t.maxAutoLevel,l=t.config,n=t.minAutoLevel,c=t.media,m=i?i.duration:e?e.duration:0,p=c?c.currentTime:0,y=c&&c.playbackRate!==0?Math.abs(c.playbackRate):1,r=this.bwEstimator?this.bwEstimator.getEstimate():l.abrEwmaDefaultEstimate,a=(_.BufferHelper.bufferInfo(c,p,l.maxBufferHole).end-p)/y,g=this.findBestLevel(r,n,s,a,l.abrBandWidthFactor,l.abrBandWidthUpFactor);if(g>=0)return g;o.logger.trace((a?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var k=m?Math.min(m,l.maxStarvationDelay):l.maxStarvationDelay,S=l.abrBandWidthFactor,A=l.abrBandWidthUpFactor;if(!a){var I=this.bitrateTestDelay;I&&(k=(m?Math.min(m,l.maxLoadingDelay):l.maxLoadingDelay)-I,o.logger.trace("bitrate test took "+Math.round(1e3*I)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*k)+" ms"),S=A=1)}return g=this.findBestLevel(r,n,s,a+k,S,A),Math.max(g,0)},u.findBestLevel=function(e,i,t,s,l,n){for(var c,m=this.fragCurrent,p=this.partCurrent,y=this.lastLoadedFragLevel,r=this.hls.levels,a=r[y],g=!(a==null||(c=a.details)===null||c===void 0||!c.live),k=a==null?void 0:a.codecSet,S=p?p.duration:m?m.duration:0,A=t;A>=i;A--){var I=r[A];if(I&&(!k||I.codecSet===k)){var w=I.details,O=(p?w==null?void 0:w.partTarget:w==null?void 0:w.averagetargetduration)||S,F=void 0;F=A<=y?l*e:n*e;var M=r[A].maxBitrate,N=M*O/F;if(o.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+A+"/"+Math.round(F)+"/"+M+"/"+O+"/"+s+"/"+N),F>M&&(!N||g&&!this.bitrateTestDelay||N<s))return A}}return-1},b=v,(T=[{key:"nextAutoLevel",get:function(){var e=this._nextAutoLevel,i=this.bwEstimator;if(!(e===-1||i&&i.canEstimate()))return e;var t=this.getNextABRAutoLevel();return e!==-1&&(t=Math.min(e,t)),t},set:function(e){this._nextAutoLevel=e}}])&&E(b.prototype,T),v}();x.default=f},"./src/controller/audio-stream-controller.ts":function(P,x,h){h.r(x);var D=h("./src/polyfills/number.ts"),d=h("./src/controller/base-stream-controller.ts"),L=h("./src/events.ts"),_=h("./src/utils/buffer-helper.ts"),C=h("./src/controller/fragment-tracker.ts"),R=h("./src/types/level.ts"),o=h("./src/types/loader.ts"),E=h("./src/loader/fragment.ts"),f=h("./src/demux/chunk-cache.ts"),v=h("./src/demux/transmuxer-interface.ts"),b=h("./src/types/transmuxer.ts"),T=h("./src/controller/fragment-finders.ts"),u=h("./src/utils/discontinuities.ts"),e=h("./src/errors.ts"),i=h("./src/utils/logger.ts");function t(){return(t=Object.assign||function(n){for(var c=1;c<arguments.length;c++){var m=arguments[c];for(var p in m)Object.prototype.hasOwnProperty.call(m,p)&&(n[p]=m[p])}return n}).apply(this,arguments)}function s(n,c){return(s=Object.setPrototypeOf||function(m,p){return m.__proto__=p,m})(n,c)}var l=function(n){var c,m;function p(r,a){var g;return(g=n.call(this,r,a,"[audio-stream-controller]")||this).videoBuffer=null,g.videoTrackCC=-1,g.waitingVideoCC=-1,g.audioSwitch=!1,g.trackId=-1,g.waitingData=null,g.mainDetails=null,g.bufferFlushed=!1,g._registerListeners(),g}m=n,(c=p).prototype=Object.create(m.prototype),c.prototype.constructor=c,s(c,m);var y=p.prototype;return y.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},y._registerListeners=function(){var r=this.hls;r.on(L.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(L.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(L.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(L.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.on(L.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),r.on(L.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.on(L.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.on(L.Events.ERROR,this.onError,this),r.on(L.Events.BUFFER_RESET,this.onBufferReset,this),r.on(L.Events.BUFFER_CREATED,this.onBufferCreated,this),r.on(L.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.on(L.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),r.on(L.Events.FRAG_BUFFERED,this.onFragBuffered,this)},y._unregisterListeners=function(){var r=this.hls;r.off(L.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(L.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(L.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(L.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.off(L.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),r.off(L.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.off(L.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.off(L.Events.ERROR,this.onError,this),r.off(L.Events.BUFFER_RESET,this.onBufferReset,this),r.off(L.Events.BUFFER_CREATED,this.onBufferCreated,this),r.off(L.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.off(L.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),r.off(L.Events.FRAG_BUFFERED,this.onFragBuffered,this)},y.onInitPtsFound=function(r,a){var g=a.frag,k=a.id,S=a.initPTS;if(k==="main"){var A=g.cc;this.initPTS[g.cc]=S,this.log("InitPTS for cc: "+A+" found from main: "+S),this.videoTrackCC=A,this.state===d.State.WAITING_INIT_PTS&&this.tick()}},y.startLoad=function(r){if(!this.levels)return this.startPosition=r,void(this.state=d.State.STOPPED);var a=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,a>0&&r===-1?(this.log("Override startPosition with lastCurrentTime @"+a.toFixed(3)),this.state=d.State.IDLE):(this.loadedmetadata=!1,this.state=d.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=r,this.tick()},y.doTick=function(){switch(this.state){case d.State.IDLE:this.doTickIdle();break;case d.State.WAITING_TRACK:var r,a=this.levels,g=this.trackId,k=a==null||(r=a[g])===null||r===void 0?void 0:r.details;if(k){if(this.waitForCdnTuneIn(k))break;this.state=d.State.WAITING_INIT_PTS}break;case d.State.FRAG_LOADING_WAITING_RETRY:var S,A=performance.now(),I=this.retryDate;(!I||A>=I||(S=this.media)!==null&&S!==void 0&&S.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state=d.State.IDLE);break;case d.State.WAITING_INIT_PTS:var w=this.waitingData;if(w){var O=w.frag,F=w.part,M=w.cache,N=w.complete;if(this.initPTS[O.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=d.State.FRAG_LOADING;var B={frag:O,part:F,payload:M.flush(),networkDetails:null};this._handleFragmentLoadProgress(B),N&&n.prototype._handleFragmentLoadComplete.call(this,B)}else if(this.videoTrackCC!==this.waitingVideoCC)i.logger.log("Waiting fragment cc ("+O.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var U=this.getLoadPosition(),j=_.BufferHelper.bufferInfo(this.mediaBuffer,U,this.config.maxBufferHole);Object(T.fragmentWithinToleranceTest)(j.end,this.config.maxFragLookUpTolerance,O)<0&&(i.logger.log("Waiting fragment cc ("+O.cc+") @ "+O.start+" cancelled because another fragment at "+j.end+" is needed"),this.clearWaitingFragment())}}else this.state=d.State.IDLE}this.onTickEnd()},y.clearWaitingFragment=function(){var r=this.waitingData;r&&(this.fragmentTracker.removeFragment(r.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=d.State.IDLE)},y.onTickEnd=function(){var r=this.media;if(r&&r.readyState){var a=(this.mediaBuffer?this.mediaBuffer:r).buffered;!this.loadedmetadata&&a.length&&(this.loadedmetadata=!0),this.lastCurrentTime=r.currentTime}},y.doTickIdle=function(){var r,a,g=this.hls,k=this.levels,S=this.media,A=this.trackId,I=g.config;if(k&&k[A]&&(S||!this.startFragRequested&&I.startFragPrefetch)){var w=k[A].details;if(!w||w.live&&this.levelLastLoaded!==A||this.waitForCdnTuneIn(w))this.state=d.State.WAITING_TRACK;else{this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer?this.mediaBuffer:this.media,E.ElementaryStreamTypes.AUDIO,o.PlaylistLevelType.AUDIO));var O=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,o.PlaylistLevelType.AUDIO);if(O!==null){var F=O.len,M=this.getMaxBufferLength(),N=this.audioSwitch;if(!(F>=M)||N){if(!N&&this._streamEnded(O,w))return g.trigger(L.Events.BUFFER_EOS,{type:"audio"}),void(this.state=d.State.ENDED);var B=w.fragments[0].start,U=O.end;if(N){var j=this.getLoadPosition();U=j,w.PTSKnown&&j<B&&(O.end>B||O.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),S.currentTime=B+.05)}var W=this.getNextFragment(U,w);W?((r=W.decryptdata)===null||r===void 0?void 0:r.keyFormat)!=="identity"||(a=W.decryptdata)!==null&&a!==void 0&&a.key?this.loadFragment(W,w,U):this.loadKey(W,w):this.bufferFlushed=!0}}}}},y.getMaxBufferLength=function(){var r=n.prototype.getMaxBufferLength.call(this),a=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,o.PlaylistLevelType.MAIN);return a===null?r:Math.max(r,a.len)},y.onMediaDetaching=function(){this.videoBuffer=null,n.prototype.onMediaDetaching.call(this)},y.onAudioTracksUpdated=function(r,a){var g=a.audioTracks;this.resetTransmuxer(),this.levels=g.map(function(k){return new R.Level(k)})},y.onAudioTrackSwitching=function(r,a){var g=!!a.url;this.trackId=a.id;var k=this.fragCurrent;k!=null&&k.loader&&k.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),g?this.setInterval(100):this.resetTransmuxer(),g?(this.audioSwitch=!0,this.state=d.State.IDLE):this.state=d.State.STOPPED,this.tick()},y.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},y.onLevelLoaded=function(r,a){this.mainDetails=a.details},y.onAudioTrackLoaded=function(r,a){var g,k=this.levels,S=a.details,A=a.id;if(k){this.log("Track "+A+" loaded ["+S.startSN+","+S.endSN+"],duration:"+S.totalduration);var I=k[A],w=0;if(S.live||(g=I.details)!==null&&g!==void 0&&g.live){var O=this.mainDetails;if(S.fragments[0]||(S.deltaUpdateFailed=!0),S.deltaUpdateFailed||!O)return;!I.details&&S.hasProgramDateTime&&O.hasProgramDateTime?(Object(u.alignPDT)(S,O),w=S.fragments[0].start):w=this.alignPlaylists(S,I.details)}I.details=S,this.levelLastLoaded=A,this.startFragRequested||!this.mainDetails&&S.live||this.setStartPosition(I.details,w),this.state!==d.State.WAITING_TRACK||this.waitForCdnTuneIn(S)||(this.state=d.State.IDLE),this.tick()}else this.warn("Audio tracks were reset while loading level "+A)},y._handleFragmentLoadProgress=function(r){var a,g=r.frag,k=r.part,S=r.payload,A=this.config,I=this.trackId,w=this.levels;if(w){var O=w[I];console.assert(O,"Audio track is defined on fragment load progress");var F=O.details;console.assert(F,"Audio track details are defined on fragment load progress");var M=A.defaultAudioCodec||O.audioCodec||"mp4a.40.2",N=this.transmuxer;N||(N=this.transmuxer=new v.default(this.hls,o.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var B=this.initPTS[g.cc],U=(a=g.initSegment)===null||a===void 0?void 0:a.data;if(B!==void 0){var j=k?k.index:-1,W=j!==-1,$=new b.ChunkMetadata(g.level,g.sn,g.stats.chunkCount,S.byteLength,j,W);N.push(S,U,M,"",g,k,F.totalduration,!1,$,B)}else i.logger.log("Unknown video PTS for cc "+g.cc+", waiting for video PTS before demuxing audio frag "+g.sn+" of ["+F.startSN+" ,"+F.endSN+"],track "+I),(this.waitingData=this.waitingData||{frag:g,part:k,cache:new f.default,complete:!1}).cache.push(new Uint8Array(S)),this.waitingVideoCC=this.videoTrackCC,this.state=d.State.WAITING_INIT_PTS}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+g.sn+" of level "+g.level+" will not be buffered")},y._handleFragmentLoadComplete=function(r){this.waitingData?this.waitingData.complete=!0:n.prototype._handleFragmentLoadComplete.call(this,r)},y.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},y.onBufferCreated=function(r,a){var g=a.tracks.audio;g&&(this.mediaBuffer=g.buffer),a.tracks.video&&(this.videoBuffer=a.tracks.video.buffer)},y.onFragBuffered=function(r,a){var g=a.frag,k=a.part;g.type===o.PlaylistLevelType.AUDIO&&(this.fragContextChanged(g)?this.warn("Fragment "+g.sn+(k?" p: "+k.index:"")+" of level "+g.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch):(g.sn!=="initSegment"&&(this.fragPrevious=g,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(L.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(g,k)))},y.onError=function(r,a){switch(a.details){case e.ErrorDetails.FRAG_LOAD_ERROR:case e.ErrorDetails.FRAG_LOAD_TIMEOUT:case e.ErrorDetails.KEY_LOAD_ERROR:case e.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(o.PlaylistLevelType.AUDIO,a);break;case e.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case e.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==d.State.ERROR&&this.state!==d.State.STOPPED&&(this.state=a.fatal?d.State.ERROR:d.State.IDLE,this.warn(a.details+" while loading frag, switching to "+this.state+" state"));break;case e.ErrorDetails.BUFFER_FULL_ERROR:if(a.parent==="audio"&&(this.state===d.State.PARSING||this.state===d.State.PARSED)){var g=!0,k=this.getFwdBufferInfo(this.mediaBuffer,o.PlaylistLevelType.AUDIO);k&&k.len>.5&&(g=!this.reduceMaxBufferLength(k.len)),g&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,n.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}}},y.onBufferFlushed=function(r,a){a.type===E.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},y._handleTransmuxComplete=function(r){var a,g="audio",k=this.hls,S=r.remuxResult,A=r.chunkMeta,I=this.getCurrentContext(A);if(!I)return this.warn("The loading context changed while buffering fragment "+A.sn+" of level "+A.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(A.level);var w=I.frag,O=I.part,F=S.audio,M=S.text,N=S.id3,B=S.initSegment;if(!this.fragContextChanged(w)){if(this.state=d.State.PARSING,this.audioSwitch&&F&&this.completeAudioSwitch(),B!=null&&B.tracks&&(this._bufferInitSegment(B.tracks,w,A),k.trigger(L.Events.FRAG_PARSING_INIT_SEGMENT,{frag:w,id:g,tracks:B.tracks})),F){var U=F.startPTS,j=F.endPTS,W=F.startDTS,$=F.endDTS;O&&(O.elementaryStreams[E.ElementaryStreamTypes.AUDIO]={startPTS:U,endPTS:j,startDTS:W,endDTS:$}),w.setElementaryStreamInfo(E.ElementaryStreamTypes.AUDIO,U,j,W,$),this.bufferFragmentData(F,w,O,A)}if(N!=null&&(a=N.samples)!==null&&a!==void 0&&a.length){var X=t({frag:w,id:g},N);k.trigger(L.Events.FRAG_PARSING_METADATA,X)}if(M){var Y=t({frag:w,id:g},M);k.trigger(L.Events.FRAG_PARSING_USERDATA,Y)}}},y._bufferInitSegment=function(r,a,g){if(this.state===d.State.PARSING){r.video&&delete r.video;var k=r.audio;if(k){k.levelCodec=k.codec,k.id="audio",this.log("Init audio buffer, container:"+k.container+", codecs[parsed]=["+k.codec+"]"),this.hls.trigger(L.Events.BUFFER_CODECS,r);var S=k.initSegment;if(S!=null&&S.byteLength){var A={type:"audio",frag:a,part:null,chunkMeta:g,parent:a.type,data:S};this.hls.trigger(L.Events.BUFFER_APPENDING,A)}this.tick()}}},y.loadFragment=function(r,a,g){var k=this.fragmentTracker.getState(r);this.fragCurrent=r,(this.audioSwitch||k===C.FragmentState.NOT_LOADED||k===C.FragmentState.PARTIAL)&&(r.sn==="initSegment"?this._loadInitSegment(r):a.live&&!Object(D.isFiniteNumber)(this.initPTS[r.cc])?(this.log("Waiting for video PTS in continuity counter "+r.cc+" of live stream before loading audio fragment "+r.sn+" of level "+this.trackId),this.state=d.State.WAITING_INIT_PTS):(this.startFragRequested=!0,n.prototype.loadFragment.call(this,r,a,g)))},y.completeAudioSwitch=function(){var r=this.hls,a=this.media,g=this.trackId;a&&(this.log("Switching audio track : flushing all audio"),n.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,r.trigger(L.Events.AUDIO_TRACK_SWITCHED,{id:g})},p}(d.default);x.default=l},"./src/controller/audio-track-controller.ts":function(P,x,h){h.r(x);var D=h("./src/events.ts"),d=h("./src/errors.ts"),L=h("./src/controller/base-playlist-controller.ts"),_=h("./src/types/loader.ts");function C(E,f){for(var v=0;v<f.length;v++){var b=f[v];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(E,b.key,b)}}function R(E,f){return(R=Object.setPrototypeOf||function(v,b){return v.__proto__=b,v})(E,f)}var o=function(E){var f,v;function b(i){var t;return(t=E.call(this,i,"[audio-track-controller]")||this).tracks=[],t.groupId=null,t.tracksInGroup=[],t.trackId=-1,t.trackName="",t.selectDefaultTrack=!0,t.registerListeners(),t}v=E,(f=b).prototype=Object.create(v.prototype),f.prototype.constructor=f,R(f,v);var T,u,e=b.prototype;return e.registerListeners=function(){var i=this.hls;i.on(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.on(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),i.on(D.Events.LEVEL_LOADING,this.onLevelLoading,this),i.on(D.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),i.on(D.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),i.on(D.Events.ERROR,this.onError,this)},e.unregisterListeners=function(){var i=this.hls;i.off(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.off(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),i.off(D.Events.LEVEL_LOADING,this.onLevelLoading,this),i.off(D.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),i.off(D.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),i.off(D.Events.ERROR,this.onError,this)},e.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,E.prototype.destroy.call(this)},e.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},e.onManifestParsed=function(i,t){this.tracks=t.audioTracks||[]},e.onAudioTrackLoaded=function(i,t){var s=t.id,l=t.details,n=this.tracksInGroup[s];if(n){var c=n.details;n.details=t.details,this.log("audioTrack "+s+" loaded ["+l.startSN+"-"+l.endSN+"]"),s===this.trackId&&(this.retryCount=0,this.playlistLoaded(s,t,c))}else this.warn("Invalid audio track id "+s)},e.onLevelLoading=function(i,t){this.switchLevel(t.level)},e.onLevelSwitching=function(i,t){this.switchLevel(t.level)},e.switchLevel=function(i){var t=this.hls.levels[i];if(t!=null&&t.audioGroupIds){var s=t.audioGroupIds[t.urlId];if(this.groupId!==s){this.groupId=s;var l=this.tracks.filter(function(c){return!s||c.groupId===s});this.selectDefaultTrack&&!l.some(function(c){return c.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=l;var n={audioTracks:l};this.log("Updating audio tracks, "+l.length+' track(s) found in "'+s+'" group-id'),this.hls.trigger(D.Events.AUDIO_TRACKS_UPDATED,n),this.selectInitialTrack()}}},e.onError=function(i,t){E.prototype.onError.call(this,i,t),!t.fatal&&t.context&&t.context.type===_.PlaylistContextType.AUDIO_TRACK&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&this.retryLoadingOrFail(t)},e.setAudioTrack=function(i){var t=this.tracksInGroup;if(i<0||i>=t.length)this.warn("Invalid id passed to audio-track controller");else{this.clearTimer();var s=t[this.trackId];this.log("Now switching to audio-track index "+i);var l=t[i],n=l.id,c=l.groupId,m=c===void 0?"":c,p=l.name,y=l.type,r=l.url;if(this.trackId=i,this.trackName=p,this.selectDefaultTrack=!1,this.hls.trigger(D.Events.AUDIO_TRACK_SWITCHING,{id:n,groupId:m,name:p,type:y,url:r}),!l.details||l.details.live){var a=this.switchParams(l.url,s==null?void 0:s.details);this.loadPlaylist(a)}}},e.selectInitialTrack=function(){var i=this.tracksInGroup;console.assert(i.length,"Initial audio track should be selected when tracks are known");var t=this.trackName,s=this.findTrackId(t)||this.findTrackId();s!==-1?this.setAudioTrack(s):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(D.Events.ERROR,{type:d.ErrorTypes.MEDIA_ERROR,details:d.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},e.findTrackId=function(i){for(var t=this.tracksInGroup,s=0;s<t.length;s++){var l=t[s];if((!this.selectDefaultTrack||l.default)&&(!i||i===l.name))return l.id}return-1},e.loadPlaylist=function(i){var t=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(t)){var s=t.id,l=t.groupId,n=t.url;if(i)try{n=i.addDirectives(n)}catch(c){this.warn("Could not construct new URL with HLS Delivery Directives: "+c)}this.log("loading audio-track playlist for id: "+s),this.clearTimer(),this.hls.trigger(D.Events.AUDIO_TRACK_LOADING,{url:n,id:s,groupId:l,deliveryDirectives:i||null})}},T=b,(u=[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(i){this.selectDefaultTrack=!1,this.setAudioTrack(i)}}])&&C(T.prototype,u),b}(L.default);x.default=o},"./src/controller/base-playlist-controller.ts":function(P,x,h){h.r(x),h.d(x,"default",function(){return R});var D=h("./src/polyfills/number.ts"),d=h("./src/types/level.ts"),L=h("./src/controller/level-helper.ts"),_=h("./src/utils/logger.ts"),C=h("./src/errors.ts"),R=function(){function o(f,v){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=_.logger.log.bind(_.logger,v+":"),this.warn=_.logger.warn.bind(_.logger,v+":"),this.hls=f}var E=o.prototype;return E.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},E.onError=function(f,v){v.fatal&&v.type===C.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},E.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},E.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},E.stopLoad=function(){this.canLoad=!1,this.clearTimer()},E.switchParams=function(f,v){var b=v==null?void 0:v.renditionReports;if(b)for(var T=0;T<b.length;T++){var u=b[T],e=""+u.URI;if(e===f.substr(-e.length)){var i=parseInt(u["LAST-MSN"]),t=parseInt(u["LAST-PART"]);if(v&&this.hls.config.lowLatencyMode){var s=Math.min(v.age-v.partTarget,v.targetduration);t!==void 0&&s>v.partTarget&&(t+=1)}if(Object(D.isFiniteNumber)(i))return new d.HlsUrlParameters(i,Object(D.isFiniteNumber)(t)?t:void 0,d.HlsSkip.No)}}},E.loadPlaylist=function(f){},E.shouldLoadTrack=function(f){return this.canLoad&&f&&!!f.url&&(!f.details||f.details.live)},E.playlistLoaded=function(f,v,b){var T=this,u=v.details,e=v.stats,i=e.loading.end?Math.max(0,self.performance.now()-e.loading.end):0;if(u.advancedDateTime=Date.now()-i,u.live||b!=null&&b.live){if(u.reloaded(b),b&&this.log("live playlist "+f+" "+(u.advanced?"REFRESHED "+u.lastPartSn+"-"+u.lastPartIndex:"MISSED")),b&&u.fragments.length>0&&Object(L.mergeDetails)(b,u),!this.canLoad||!u.live)return;var t,s=void 0,l=void 0;if(u.canBlockReload&&u.endSN&&u.advanced){var n=this.hls.config.lowLatencyMode,c=u.lastPartSn,m=u.endSN,p=u.lastPartIndex,y=c===m;p!==-1?(s=y?m+1:c,l=y?n?0:p:p+1):s=m+1;var r=u.age,a=r+u.ageHeader,g=Math.min(a-u.partTarget,1.5*u.targetduration);if(g>0){if(b&&g>b.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+b.tuneInGoal+" to: "+g+" with playlist age: "+u.age),g=0;else{var k=Math.floor(g/u.targetduration);s+=k,l!==void 0&&(l+=Math.round(g%u.targetduration/u.partTarget)),this.log("CDN Tune-in age: "+u.ageHeader+"s last advanced "+r.toFixed(2)+"s goal: "+g+" skip sn "+k+" to part "+l)}u.tuneInGoal=g}if(t=this.getDeliveryDirectives(u,v.deliveryDirectives,s,l),n||!y)return void this.loadPlaylist(t)}else t=this.getDeliveryDirectives(u,v.deliveryDirectives,s,l);var S=Object(L.computeReloadInterval)(u,e);s!==void 0&&u.canBlockReload&&(S-=u.partTarget||1),this.log("reload live playlist "+f+" in "+Math.round(S)+" ms"),this.timer=self.setTimeout(function(){return T.loadPlaylist(t)},S)}else this.clearTimer()},E.getDeliveryDirectives=function(f,v,b,T){var u=Object(d.getSkipValue)(f,b);return v!=null&&v.skip&&f.deltaUpdateFailed&&(b=v.msn,T=v.part,u=d.HlsSkip.No),new d.HlsUrlParameters(b,T,u)},E.retryLoadingOrFail=function(f){var v,b=this,T=this.hls.config,u=this.retryCount<T.levelLoadingMaxRetry;if(u)if(this.retryCount++,f.details.indexOf("LoadTimeOut")>-1&&(v=f.context)!==null&&v!==void 0&&v.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+f.details+'"'),this.loadPlaylist();else{var e=Math.min(Math.pow(2,this.retryCount)*T.levelLoadingRetryDelay,T.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return b.loadPlaylist()},e),this.warn("retry playlist loading #"+this.retryCount+" in "+e+' ms after "'+f.details+'"')}else this.warn('cannot recover from error "'+f.details+'"'),this.clearTimer(),f.fatal=!0;return u},o}()},"./src/controller/base-stream-controller.ts":function(P,x,h){h.r(x),h.d(x,"State",function(){return n}),h.d(x,"default",function(){return c});var D=h("./src/polyfills/number.ts"),d=h("./src/task-loop.ts"),L=h("./src/controller/fragment-tracker.ts"),_=h("./src/utils/buffer-helper.ts"),C=h("./src/utils/logger.ts"),R=h("./src/events.ts"),o=h("./src/errors.ts"),E=h("./src/types/transmuxer.ts"),f=h("./src/utils/mp4-tools.ts"),v=h("./src/utils/discontinuities.ts"),b=h("./src/controller/fragment-finders.ts"),T=h("./src/controller/level-helper.ts"),u=h("./src/loader/fragment-loader.ts"),e=h("./src/crypt/decrypter.ts"),i=h("./src/utils/time-ranges.ts"),t=h("./src/types/loader.ts");function s(m,p){for(var y=0;y<p.length;y++){var r=p[y];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(m,r.key,r)}}function l(m,p){return(l=Object.setPrototypeOf||function(y,r){return y.__proto__=r,y})(m,p)}var n={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BACKTRACKING:"BACKTRACKING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},c=function(m){var p,y;function r(S,A,I){var w;return(w=m.call(this)||this).hls=void 0,w.fragPrevious=null,w.fragCurrent=null,w.fragmentTracker=void 0,w.transmuxer=null,w._state=n.STOPPED,w.media=void 0,w.mediaBuffer=void 0,w.config=void 0,w.bitrateTest=!1,w.lastCurrentTime=0,w.nextLoadPosition=0,w.startPosition=0,w.loadedmetadata=!1,w.fragLoadError=0,w.retryDate=0,w.levels=null,w.fragmentLoader=void 0,w.levelLastLoaded=null,w.startFragRequested=!1,w.decrypter=void 0,w.initPTS=[],w.onvseeking=null,w.onvended=null,w.logPrefix="",w.log=void 0,w.warn=void 0,w.logPrefix=I,w.log=C.logger.log.bind(C.logger,I+":"),w.warn=C.logger.warn.bind(C.logger,I+":"),w.hls=S,w.fragmentLoader=new u.default(S.config),w.fragmentTracker=A,w.config=S.config,w.decrypter=new e.default(S,S.config),S.on(R.Events.KEY_LOADED,w.onKeyLoaded,function(O){if(O===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return O}(w)),w}y=m,(p=r).prototype=Object.create(y.prototype),p.prototype.constructor=p,l(p,y);var a,g,k=r.prototype;return k.doTick=function(){this.onTickEnd()},k.onTickEnd=function(){},k.startLoad=function(S){},k.stopLoad=function(){this.fragmentLoader.abort();var S=this.fragCurrent;S&&this.fragmentTracker.removeFragment(S),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=n.STOPPED},k._streamEnded=function(S,A){var I=this.fragCurrent,w=this.fragmentTracker;if(!A.live&&I&&I.sn===A.endSN&&!S.nextStart){var O=w.getState(I);return O===L.FragmentState.PARTIAL||O===L.FragmentState.OK}return!1},k.onMediaAttached=function(S,A){var I=this.media=this.mediaBuffer=A.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),I.addEventListener("seeking",this.onvseeking),I.addEventListener("ended",this.onvended);var w=this.config;this.levels&&w.autoStartLoad&&this.state===n.STOPPED&&this.startLoad(w.startPosition)},k.onMediaDetaching=function(){var S=this.media;S!=null&&S.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),S&&(S.removeEventListener("seeking",this.onvseeking),S.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},k.onMediaSeeking=function(){var S=this.config,A=this.fragCurrent,I=this.media,w=this.mediaBuffer,O=this.state,F=I?I.currentTime:0,M=_.BufferHelper.bufferInfo(w||I,F,S.maxBufferHole);if(this.log("media seeking to "+(Object(D.isFiniteNumber)(F)?F.toFixed(3):F)+", state: "+O),O===n.ENDED)this.resetLoadingState();else if(A&&!M.len){var N=S.maxFragLookUpTolerance,B=A.start-N,U=F>A.start+A.duration+N;(F<B||U)&&(U&&A.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),A.loader.abort()),this.resetLoadingState())}I&&(this.lastCurrentTime=F),this.loadedmetadata||M.len||(this.nextLoadPosition=this.startPosition=F),this.tickImmediate()},k.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},k.onKeyLoaded=function(S,A){if(this.state===n.KEY_LOADING&&A.frag===this.fragCurrent&&this.levels){this.state=n.IDLE;var I=this.levels[A.frag.level].details;I&&this.loadFragment(A.frag,I,A.frag.start)}},k.onHandlerDestroying=function(){this.stopLoad(),m.prototype.onHandlerDestroying.call(this)},k.onHandlerDestroyed=function(){this.state=n.STOPPED,this.hls.off(R.Events.KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,m.prototype.onHandlerDestroyed.call(this)},k.loadKey=function(S,A){this.log("Loading key for "+S.sn+" of ["+A.startSN+"-"+A.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+S.level),this.state=n.KEY_LOADING,this.fragCurrent=S,this.hls.trigger(R.Events.KEY_LOADING,{frag:S})},k.loadFragment=function(S,A,I){this._loadFragForPlayback(S,A,I)},k._loadFragForPlayback=function(S,A,I){var w=this;this._doFragLoad(S,A,I,function(O){if(w.fragContextChanged(S))return w.warn("Fragment "+S.sn+(O.part?" p: "+O.part.index:"")+" of level "+S.level+" was dropped during download."),void w.fragmentTracker.removeFragment(S);S.stats.chunkCount++,w._handleFragmentLoadProgress(O)}).then(function(O){if(O){w.fragLoadError=0;var F=w.state;if(!w.fragContextChanged(S))return"payload"in O&&(w.log("Loaded fragment "+S.sn+" of level "+S.level),w.hls.trigger(R.Events.FRAG_LOADED,O),w.state===n.BACKTRACKING)?(w.fragmentTracker.backtrack(S,O),void w.resetFragmentLoading(S)):void w._handleFragmentLoadComplete(O);(F===n.FRAG_LOADING||F===n.BACKTRACKING||!w.fragCurrent&&F===n.PARSING)&&(w.fragmentTracker.removeFragment(S),w.state=n.IDLE)}}).catch(function(O){w.warn(O),w.resetFragmentLoading(S)})},k.flushMainBuffer=function(S,A,I){if(I===void 0&&(I=null),S-A){var w={startOffset:S,endOffset:A,type:I};this.fragLoadError=0,this.hls.trigger(R.Events.BUFFER_FLUSHING,w)}},k._loadInitSegment=function(S){var A=this;this._doFragLoad(S).then(function(I){if(!I||A.fragContextChanged(S)||!A.levels)throw new Error("init load aborted");return I}).then(function(I){var w=A.hls,O=I.payload,F=S.decryptdata;if(O&&O.byteLength>0&&F&&F.key&&F.iv&&F.method==="AES-128"){var M=self.performance.now();return A.decrypter.webCryptoDecrypt(new Uint8Array(O),F.key.buffer,F.iv.buffer).then(function(N){var B=self.performance.now();return w.trigger(R.Events.FRAG_DECRYPTED,{frag:S,payload:N,stats:{tstart:M,tdecrypt:B}}),I.payload=N,I})}return I}).then(function(I){var w=A.fragCurrent,O=A.hls,F=A.levels;if(!F)throw new Error("init load aborted, missing levels");var M=F[S.level].details;console.assert(M,"Level details are defined when init segment is loaded");var N=S.stats;A.state=n.IDLE,A.fragLoadError=0,S.data=new Uint8Array(I.payload),N.parsing.start=N.buffering.start=self.performance.now(),N.parsing.end=N.buffering.end=self.performance.now(),I.frag===w&&O.trigger(R.Events.FRAG_BUFFERED,{stats:N,frag:w,part:null,id:S.type}),A.tick()}).catch(function(I){A.warn(I),A.resetFragmentLoading(S)})},k.fragContextChanged=function(S){var A=this.fragCurrent;return!S||!A||S.level!==A.level||S.sn!==A.sn||S.urlId!==A.urlId},k.fragBufferedComplete=function(S,A){var I=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+S.type+" sn: "+S.sn+(A?" part: "+A.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+S.level+" "+i.default.toString(_.BufferHelper.getBuffered(I))),this.state=n.IDLE,this.tick()},k._handleFragmentLoadComplete=function(S){var A=this.transmuxer;if(A){var I=S.frag,w=S.part,O=S.partsLoaded,F=!O||O.length===0||O.some(function(N){return!N}),M=new E.ChunkMetadata(I.level,I.sn,I.stats.chunkCount+1,0,w?w.index:-1,!F);A.flush(M)}},k._handleFragmentLoadProgress=function(S){},k._doFragLoad=function(S,A,I,w){var O=this;if(I===void 0&&(I=null),!this.levels)throw new Error("frag load aborted, missing levels");if(I=Math.max(S.start,I||0),this.config.lowLatencyMode&&A){var F=A.partList;if(F&&w){I>S.end&&A.fragmentHint&&(S=A.fragmentHint);var M=this.getNextPart(F,S,I);if(M>-1){var N=F[M];return this.log("Loading part sn: "+S.sn+" p: "+N.index+" cc: "+S.cc+" of playlist ["+A.startSN+"-"+A.endSN+"] parts [0-"+M+"-"+(F.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+S.level+", target: "+parseFloat(I.toFixed(3))),this.nextLoadPosition=N.start+N.duration,this.state=n.FRAG_LOADING,this.hls.trigger(R.Events.FRAG_LOADING,{frag:S,part:F[M],targetBufferTime:I}),this.doFragPartsLoad(S,F,M,w).catch(function(B){return O.handleFragLoadError(B)})}if(!S.url||this.loadedEndOfParts(F,I))return Promise.resolve(null)}}return this.log("Loading fragment "+S.sn+" cc: "+S.cc+" "+(A?"of ["+A.startSN+"-"+A.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+S.level+", target: "+parseFloat(I.toFixed(3))),Object(D.isFiniteNumber)(S.sn)&&!this.bitrateTest&&(this.nextLoadPosition=S.start+S.duration),this.state=n.FRAG_LOADING,this.hls.trigger(R.Events.FRAG_LOADING,{frag:S,targetBufferTime:I}),this.fragmentLoader.load(S,w).catch(function(B){return O.handleFragLoadError(B)})},k.doFragPartsLoad=function(S,A,I,w){var O=this;return new Promise(function(F,M){var N=[];(function B(U){var j=A[U];O.fragmentLoader.loadPart(S,j,w).then(function(W){N[j.index]=W;var $=W.part;O.hls.trigger(R.Events.FRAG_LOADED,W);var X=A[U+1];if(!X||X.fragment!==S)return F({frag:S,part:$,partsLoaded:N});B(U+1)}).catch(M)})(I)})},k.handleFragLoadError=function(S){var A=S.data;return A&&A.details===o.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(A.frag,A.part):this.hls.trigger(R.Events.ERROR,A),null},k._handleTransmuxerFlush=function(S){var A=this.getCurrentContext(S);if(A&&this.state===n.PARSING){var I=A.frag,w=A.part,O=A.level,F=self.performance.now();I.stats.parsing.end=F,w&&(w.stats.parsing.end=F),this.updateLevelTiming(I,w,O,S.partial)}else this.fragCurrent||(this.state=n.IDLE)},k.getCurrentContext=function(S){var A=this.levels,I=S.level,w=S.sn,O=S.part;if(!A||!A[I])return this.warn("Levels object was unset while buffering fragment "+w+" of level "+I+". The current chunk will not be buffered."),null;var F=A[I],M=O>-1?Object(T.getPartWith)(F,w,O):null,N=M?M.fragment:Object(T.getFragmentWithSN)(F,w,this.fragCurrent);return N?{frag:N,part:M,level:F}:null},k.bufferFragmentData=function(S,A,I,w){if(S&&this.state===n.PARSING){var O=S.data1,F=S.data2,M=O;if(O&&F&&(M=Object(f.appendUint8Array)(O,F)),M&&M.length){var N={type:S.type,frag:A,part:I,chunkMeta:w,parent:A.type,data:M};this.hls.trigger(R.Events.BUFFER_APPENDING,N),S.dropped&&S.independent&&!I&&this.flushBufferGap(A)}}},k.flushBufferGap=function(S){var A=this.media;if(A)if(_.BufferHelper.isBuffered(A,A.currentTime)){var I=A.currentTime,w=_.BufferHelper.bufferInfo(A,I,0),O=S.duration,F=Math.min(2*this.config.maxFragLookUpTolerance,.25*O),M=Math.max(Math.min(S.start-F,w.end-F),I+F);S.start-M>F&&this.flushMainBuffer(M,S.start)}else this.flushMainBuffer(0,S.start)},k.getFwdBufferInfo=function(S,A){var I=this.config,w=this.getLoadPosition();if(!Object(D.isFiniteNumber)(w))return null;var O=_.BufferHelper.bufferInfo(S,w,I.maxBufferHole);if(O.len===0&&O.nextStart!==void 0){var F=this.fragmentTracker.getBufferedFrag(w,A);if(F&&O.nextStart<F.end)return _.BufferHelper.bufferInfo(S,w,Math.max(O.nextStart,I.maxBufferHole))}return O},k.getMaxBufferLength=function(S){var A,I=this.config;return A=S?Math.max(8*I.maxBufferSize/S,I.maxBufferLength):I.maxBufferLength,Math.min(A,I.maxMaxBufferLength)},k.reduceMaxBufferLength=function(S){var A=this.config,I=S||A.maxBufferLength;return A.maxMaxBufferLength>=I&&(A.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+A.maxMaxBufferLength+"s"),!0)},k.getNextFragment=function(S,A){var I,w,O=A.fragments,F=O.length;if(!F)return null;var M,N=this.config,B=O[0].start;if(A.live){var U=N.initialLiveManifestSize;if(F<U)return this.warn("Not enough fragments to start playback (have: "+F+", need: "+U+")"),null;A.PTSKnown||this.startFragRequested||this.startPosition!==-1||(M=this.getInitialLiveFragment(A,O),this.startPosition=M?this.hls.liveSyncPosition||M.start:S)}else S<=B&&(M=O[0]);if(!M){var j=N.lowLatencyMode?A.partEnd:A.fragmentEnd;M=this.getFragmentAtPosition(S,j,A)}return(I=M)===null||I===void 0||!I.initSegment||(w=M)!==null&&w!==void 0&&w.initSegment.data||this.bitrateTest||(M=M.initSegment),M},k.getNextPart=function(S,A,I){for(var w=-1,O=!1,F=!0,M=0,N=S.length;M<N;M++){var B=S[M];if(F=F&&!B.independent,w>-1&&I<B.start)break;var U=B.loaded;!U&&(O||B.independent||F)&&B.fragment===A&&(w=M),O=U}return w},k.loadedEndOfParts=function(S,A){var I=S[S.length-1];return I&&A>I.start&&I.loaded},k.getInitialLiveFragment=function(S,A){var I=this.fragPrevious,w=null;if(I){if(S.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+I.programDateTime),w=Object(b.findFragmentByPDT)(A,I.endProgramDateTime,this.config.maxFragLookUpTolerance)),!w){var O=I.sn+1;if(O>=S.startSN&&O<=S.endSN){var F=A[O-S.startSN];I.cc===F.cc&&(w=F,this.log("Live playlist, switching playlist, load frag with next SN: "+w.sn))}w||(w=Object(b.findFragWithCC)(A,I.cc))&&this.log("Live playlist, switching playlist, load frag with same CC: "+w.sn)}}else{var M=this.hls.liveSyncPosition;M!==null&&(w=this.getFragmentAtPosition(M,this.bitrateTest?S.fragmentEnd:S.edge,S))}return w},k.getFragmentAtPosition=function(S,A,I){var w,O=this.config,F=this.fragPrevious,M=I.fragments,N=I.endSN,B=I.fragmentHint,U=O.maxFragLookUpTolerance,j=!!(O.lowLatencyMode&&I.partList&&B);if(j&&B&&!this.bitrateTest&&(M=M.concat(B),N=B.sn),S<A){var W=S>A-U?0:U;w=Object(b.findFragmentByPTS)(F,M,S,W)}else w=M[M.length-1];if(w){var $=w.sn-I.startSN,X=F&&w.level===F.level,Y=M[$+1];if(this.fragmentTracker.getState(w)===L.FragmentState.BACKTRACKED){w=null;for(var Z=$;M[Z]&&this.fragmentTracker.getState(M[Z])===L.FragmentState.BACKTRACKED;)w=F?M[Z--]:M[--Z];w||(w=Y)}else F&&w.sn===F.sn&&!j&&X&&(w.sn<N&&this.fragmentTracker.getState(Y)!==L.FragmentState.OK?(this.log("SN "+w.sn+" just loaded, load next one: "+Y.sn),w=Y):w=null)}return w},k.synchronizeToLiveEdge=function(S){var A=this.config,I=this.media;if(I){var w=this.hls.liveSyncPosition,O=I.currentTime,F=S.fragments[0].start,M=S.edge,N=O>=F-A.maxFragLookUpTolerance&&O<=M;if(w!==null&&I.duration>w&&(O<w||!N)){var B=A.liveMaxLatencyDuration!==void 0?A.liveMaxLatencyDuration:A.liveMaxLatencyDurationCount*S.targetduration;(!N&&I.readyState<4||O<M-B)&&(this.loadedmetadata||(this.nextLoadPosition=w),I.readyState&&(this.warn("Playback: "+O.toFixed(3)+" is located too far from the end of live sliding playlist: "+M+", reset currentTime to : "+w.toFixed(3)),I.currentTime=w))}}},k.alignPlaylists=function(S,A){var I=this.levels,w=this.levelLastLoaded,O=this.fragPrevious,F=w!==null?I[w]:null,M=S.fragments.length;if(!M)return this.warn("No fragments in live playlist"),0;var N=S.fragments[0].start,B=!A,U=S.alignedSliding&&Object(D.isFiniteNumber)(N);if(B||!U&&!N){Object(v.alignStream)(O,F,S);var j=S.fragments[0].start;return this.log("Live playlist sliding: "+j.toFixed(2)+" start-sn: "+(A?A.startSN:"na")+"->"+S.startSN+" prev-sn: "+(O?O.sn:"na")+" fragments: "+M),j}return N},k.waitForCdnTuneIn=function(S){return S.live&&S.canBlockReload&&S.tuneInGoal>Math.max(S.partHoldBack,3*S.partTarget)},k.setStartPosition=function(S,A){var I=this.startPosition;if(I<A&&(I=-1),I===-1||this.lastCurrentTime===-1){var w=S.startTimeOffset;Object(D.isFiniteNumber)(w)?(I=A+w,w<0&&(I+=S.totalduration),I=Math.min(Math.max(A,I),A+S.totalduration),this.log("Start time offset "+w+" found in playlist, adjust startPosition to "+I),this.startPosition=I):S.live?I=this.hls.liveSyncPosition||A:this.startPosition=I=0,this.lastCurrentTime=I}this.nextLoadPosition=I},k.getLoadPosition=function(){var S=this.media,A=0;return this.loadedmetadata&&S?A=S.currentTime:this.nextLoadPosition&&(A=this.nextLoadPosition),A},k.handleFragLoadAborted=function(S,A){this.transmuxer&&S.sn!=="initSegment"&&S.stats.aborted&&(this.warn("Fragment "+S.sn+(A?" part"+A.index:"")+" of level "+S.level+" was aborted"),this.resetFragmentLoading(S))},k.resetFragmentLoading=function(S){this.fragCurrent&&this.fragContextChanged(S)||(this.state=n.IDLE)},k.onFragmentOrKeyLoadError=function(S,A){if(!A.fatal){var I=A.frag;if(I&&I.type===S){var w=this.fragCurrent;console.assert(w&&I.sn===w.sn&&I.level===w.level&&I.urlId===w.urlId,"Frag load error must match current frag to retry");var O=this.config;if(this.fragLoadError+1<=O.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded(I.level))return;var F=Math.min(Math.pow(2,this.fragLoadError)*O.fragLoadingRetryDelay,O.fragLoadingMaxRetryTimeout);this.warn("Fragment "+I.sn+" of "+S+" "+I.level+" failed to load, retrying in "+F+"ms"),this.retryDate=self.performance.now()+F,this.fragLoadError++,this.state=n.FRAG_LOADING_WAITING_RETRY}else A.levelRetry?(S===t.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=n.IDLE):(C.logger.error(A.details+" reaches max retry, redispatch as fatal ..."),A.fatal=!0,this.hls.stopLoad(),this.state=n.ERROR)}}},k.afterBufferFlushed=function(S,A,I){if(S){var w=_.BufferHelper.getBuffered(S);this.fragmentTracker.detectEvictedFragments(A,w,I),this.state===n.ENDED&&this.resetLoadingState()}},k.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=n.IDLE},k.resetLiveStartWhenNotLoaded=function(S){if(!this.loadedmetadata){this.startFragRequested=!1;var A=this.levels?this.levels[S].details:null;if(A!=null&&A.live)return this.startPosition=-1,this.setStartPosition(A,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},k.updateLevelTiming=function(S,A,I,w){var O=this,F=I.details;console.assert(!!F,"level.details must be defined"),Object.keys(S.elementaryStreams).reduce(function(M,N){var B=S.elementaryStreams[N];if(B){var U=B.endPTS-B.startPTS;if(U<=0)return O.warn("Could not parse fragment "+S.sn+" "+N+" duration reliably ("+U+") resetting transmuxer to fallback to playlist timing"),O.resetTransmuxer(),M||!1;var j=w?0:Object(T.updateFragPTSDTS)(F,S,B.startPTS,B.endPTS,B.startDTS,B.endDTS);return O.hls.trigger(R.Events.LEVEL_PTS_UPDATED,{details:F,level:I,drift:j,type:N,frag:S,start:B.startPTS,end:B.endPTS}),!0}return M},!1)?(this.state=n.PARSED,this.hls.trigger(R.Events.FRAG_PARSED,{frag:S,part:A})):this.resetLoadingState()},k.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},a=r,(g=[{key:"state",get:function(){return this._state},set:function(S){var A=this._state;A!==S&&(this._state=S,this.log(A+"->"+S))}}])&&s(a.prototype,g),r}(d.default)},"./src/controller/buffer-controller.ts":function(P,x,h){h.r(x),h.d(x,"default",function(){return b});var D=h("./src/polyfills/number.ts"),d=h("./src/events.ts"),L=h("./src/utils/logger.ts"),_=h("./src/errors.ts"),C=h("./src/utils/buffer-helper.ts"),R=h("./src/utils/mediasource-helper.ts"),o=h("./src/loader/fragment.ts"),E=h("./src/controller/buffer-operation-queue.ts"),f=Object(R.getMediaSource)(),v=/([ha]vc.)(?:\.[^.,]+)+/,b=function(){function T(e){var i=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var t=i.hls,s=i.media,l=i.mediaSource;L.logger.log("[buffer-controller]: Media source opened"),s&&(i.updateMediaElementDuration(),t.trigger(d.Events.MEDIA_ATTACHED,{media:s})),l&&l.removeEventListener("sourceopen",i._onMediaSourceOpen),i.checkPendingTracks()},this._onMediaSourceClose=function(){L.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){L.logger.log("[buffer-controller]: Media source ended")},this.hls=e,this._initSourceBuffer(),this.registerListeners()}var u=T.prototype;return u.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},u.destroy=function(){this.unregisterListeners(),this.details=null},u.registerListeners=function(){var e=this.hls;e.on(d.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(d.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(d.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(d.Events.BUFFER_RESET,this.onBufferReset,this),e.on(d.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.on(d.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.on(d.Events.BUFFER_EOS,this.onBufferEos,this),e.on(d.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(d.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(d.Events.FRAG_PARSED,this.onFragParsed,this),e.on(d.Events.FRAG_CHANGED,this.onFragChanged,this)},u.unregisterListeners=function(){var e=this.hls;e.off(d.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(d.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(d.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(d.Events.BUFFER_RESET,this.onBufferReset,this),e.off(d.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.off(d.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.off(d.Events.BUFFER_EOS,this.onBufferEos,this),e.off(d.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(d.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(d.Events.FRAG_PARSED,this.onFragParsed,this),e.off(d.Events.FRAG_CHANGED,this.onFragChanged,this)},u._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new E.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},u.onManifestParsed=function(e,i){var t=2;(i.audio&&!i.video||!i.altAudio)&&(t=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=t,this.details=null,L.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},u.onMediaAttaching=function(e,i){var t=this.media=i.media;if(t&&f){var s=this.mediaSource=new f;s.addEventListener("sourceopen",this._onMediaSourceOpen),s.addEventListener("sourceended",this._onMediaSourceEnded),s.addEventListener("sourceclose",this._onMediaSourceClose),t.src=self.URL.createObjectURL(s),this._objectUrl=t.src}},u.onMediaDetaching=function(){var e=this.media,i=this.mediaSource,t=this._objectUrl;if(i){if(L.logger.log("[buffer-controller]: media source detaching"),i.readyState==="open")try{i.endOfStream()}catch(s){L.logger.warn("[buffer-controller]: onMediaDetaching: "+s.message+" while calling endOfStream")}this.onBufferReset(),i.removeEventListener("sourceopen",this._onMediaSourceOpen),i.removeEventListener("sourceended",this._onMediaSourceEnded),i.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(t&&self.URL.revokeObjectURL(t),e.src===t?(e.removeAttribute("src"),e.load()):L.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(d.Events.MEDIA_DETACHED,void 0)},u.onBufferReset=function(){var e=this;this.getSourceBufferTypes().forEach(function(i){var t=e.sourceBuffer[i];try{t&&(e.removeBufferListeners(i),e.mediaSource&&e.mediaSource.removeSourceBuffer(t),e.sourceBuffer[i]=void 0)}catch(s){L.logger.warn("[buffer-controller]: Failed to reset the "+i+" buffer",s)}}),this._initSourceBuffer()},u.onBufferCodecs=function(e,i){var t=this,s=this.getSourceBufferTypes().length;Object.keys(i).forEach(function(l){if(s){var n=t.tracks[l];if(n&&typeof n.buffer.changeType=="function"){var c=i[l],m=c.codec,p=c.levelCodec,y=c.container;if((n.levelCodec||n.codec).replace(v,"$1")!==(p||m).replace(v,"$1")){var r=y+";codecs="+(p||m);t.appendChangeType(l,r)}}}else t.pendingTracks[l]=i[l]}),s||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},u.appendChangeType=function(e,i){var t=this,s=this.operationQueue,l={execute:function(){var n=t.sourceBuffer[e];n&&(L.logger.log("[buffer-controller]: changing "+e+" sourceBuffer type to "+i),n.changeType(i)),s.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(n){L.logger.warn("[buffer-controller]: Failed to change "+e+" SourceBuffer type",n)}};s.append(l,e)},u.onBufferAppending=function(e,i){var t=this,s=this.hls,l=this.operationQueue,n=this.tracks,c=i.data,m=i.type,p=i.frag,y=i.part,r=i.chunkMeta,a=r.buffering[m],g=self.performance.now();a.start=g;var k=p.stats.buffering,S=y?y.stats.buffering:null;k.start===0&&(k.start=g),S&&S.start===0&&(S.start=g);var A=n.audio,I=m==="audio"&&r.id===1&&(A==null?void 0:A.container)==="audio/mpeg",w={execute:function(){if(a.executeStart=self.performance.now(),I){var O=t.sourceBuffer[m];if(O){var F=p.start-O.timestampOffset;Math.abs(F)>=.1&&(L.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+p.start+" (delta: "+F+") sn: "+p.sn+")"),O.timestampOffset=p.start)}}t.appendExecutor(c,m)},onStart:function(){},onComplete:function(){var O=self.performance.now();a.executeEnd=a.end=O,k.first===0&&(k.first=O),S&&S.first===0&&(S.first=O);var F=t.sourceBuffer,M={};for(var N in F)M[N]=C.BufferHelper.getBuffered(F[N]);t.appendError=0,t.hls.trigger(d.Events.BUFFER_APPENDED,{type:m,frag:p,part:y,chunkMeta:r,parent:p.type,timeRanges:M})},onError:function(O){L.logger.error("[buffer-controller]: Error encountered while trying to append to the "+m+" SourceBuffer",O);var F={type:_.ErrorTypes.MEDIA_ERROR,parent:p.type,details:_.ErrorDetails.BUFFER_APPEND_ERROR,err:O,fatal:!1};O.code===DOMException.QUOTA_EXCEEDED_ERR?F.details=_.ErrorDetails.BUFFER_FULL_ERROR:(t.appendError++,F.details=_.ErrorDetails.BUFFER_APPEND_ERROR,t.appendError>s.config.appendErrorMaxRetry&&(L.logger.error("[buffer-controller]: Failed "+s.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),F.fatal=!0)),s.trigger(d.Events.ERROR,F)}};l.append(w,m)},u.onBufferFlushing=function(e,i){var t=this,s=this.operationQueue,l=function(n){return{execute:t.removeExecutor.bind(t,n,i.startOffset,i.endOffset),onStart:function(){},onComplete:function(){t.hls.trigger(d.Events.BUFFER_FLUSHED,{type:n})},onError:function(c){L.logger.warn("[buffer-controller]: Failed to remove from "+n+" SourceBuffer",c)}}};i.type?s.append(l(i.type),i.type):this.getSourceBufferTypes().forEach(function(n){s.append(l(n),n)})},u.onFragParsed=function(e,i){var t=this,s=i.frag,l=i.part,n=[],c=l?l.elementaryStreams:s.elementaryStreams;c[o.ElementaryStreamTypes.AUDIOVIDEO]?n.push("audiovideo"):(c[o.ElementaryStreamTypes.AUDIO]&&n.push("audio"),c[o.ElementaryStreamTypes.VIDEO]&&n.push("video")),n.length===0&&L.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+s.type+" level: "+s.level+" sn: "+s.sn),this.blockBuffers(function(){var m=self.performance.now();s.stats.buffering.end=m,l&&(l.stats.buffering.end=m);var p=l?l.stats:s.stats;t.hls.trigger(d.Events.FRAG_BUFFERED,{frag:s,part:l,stats:p,id:s.type})},n)},u.onFragChanged=function(e,i){this.flushBackBuffer()},u.onBufferEos=function(e,i){var t=this;this.getSourceBufferTypes().reduce(function(s,l){var n=t.sourceBuffer[l];return i.type&&i.type!==l||n&&!n.ended&&(n.ended=!0,L.logger.log("[buffer-controller]: "+l+" sourceBuffer now EOS")),s&&!(n&&!n.ended)},!0)&&this.blockBuffers(function(){var s=t.mediaSource;s&&s.readyState==="open"&&s.endOfStream()})},u.onLevelUpdated=function(e,i){var t=i.details;t.fragments.length&&(this.details=t,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},u.flushBackBuffer=function(){var e=this.hls,i=this.details,t=this.media,s=this.sourceBuffer;if(t&&i!==null){var l=this.getSourceBufferTypes();if(l.length){var n=i.live&&e.config.liveBackBufferLength!==null?e.config.liveBackBufferLength:e.config.backBufferLength;if(Object(D.isFiniteNumber)(n)&&!(n<0)){var c=t.currentTime,m=i.levelTargetDuration,p=Math.max(n,m),y=Math.floor(c/m)*m-p;l.forEach(function(r){var a=s[r];if(a){var g=C.BufferHelper.getBuffered(a);g.length>0&&y>g.start(0)&&(e.trigger(d.Events.BACK_BUFFER_REACHED,{bufferEnd:y}),i.live&&e.trigger(d.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:y}),e.trigger(d.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:y,type:r}))}})}}}},u.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&this.mediaSource.readyState==="open"){var e=this.details,i=this.hls,t=this.media,s=this.mediaSource,l=e.fragments[0].start+e.totalduration,n=t.duration,c=Object(D.isFiniteNumber)(s.duration)?s.duration:0;e.live&&i.config.liveDurationInfinity?(L.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),s.duration=1/0,this.updateSeekableRange(e)):(l>c&&l>n||!Object(D.isFiniteNumber)(n))&&(L.logger.log("[buffer-controller]: Updating Media Source duration to "+l.toFixed(3)),s.duration=l)}},u.updateSeekableRange=function(e){var i=this.mediaSource,t=e.fragments;if(t.length&&e.live&&i!=null&&i.setLiveSeekableRange){var s=Math.max(0,t[0].start),l=Math.max(s,s+e.totalduration);i.setLiveSeekableRange(s,l)}},u.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,i=this.operationQueue,t=this.pendingTracks,s=Object.keys(t).length;if(s&&!e||s===2){this.createSourceBuffers(t),this.pendingTracks={};var l=this.getSourceBufferTypes();if(l.length===0)return void this.hls.trigger(d.Events.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});l.forEach(function(n){i.executeNext(n)})}},u.createSourceBuffers=function(e){var i=this.sourceBuffer,t=this.mediaSource;if(!t)throw Error("createSourceBuffers called when mediaSource was null");var s=0;for(var l in e)if(!i[l]){var n=e[l];if(!n)throw Error("source buffer exists for track "+l+", however track does not");var c=n.levelCodec||n.codec,m=n.container+";codecs="+c;L.logger.log("[buffer-controller]: creating sourceBuffer("+m+")");try{var p=i[l]=t.addSourceBuffer(m),y=l;this.addBufferListener(y,"updatestart",this._onSBUpdateStart),this.addBufferListener(y,"updateend",this._onSBUpdateEnd),this.addBufferListener(y,"error",this._onSBUpdateError),this.tracks[l]={buffer:p,codec:c,container:n.container,levelCodec:n.levelCodec,id:n.id},s++}catch(r){L.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+r.message),this.hls.trigger(d.Events.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:r,mimeType:m})}}s&&this.hls.trigger(d.Events.BUFFER_CREATED,{tracks:this.tracks})},u._onSBUpdateStart=function(e){this.operationQueue.current(e).onStart()},u._onSBUpdateEnd=function(e){var i=this.operationQueue;i.current(e).onComplete(),i.shiftAndExecuteNext(e)},u._onSBUpdateError=function(e,i){L.logger.error("[buffer-controller]: "+e+" SourceBuffer error",i),this.hls.trigger(d.Events.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var t=this.operationQueue.current(e);t&&t.onError(i)},u.removeExecutor=function(e,i,t){var s=this.media,l=this.mediaSource,n=this.operationQueue,c=this.sourceBuffer[e];if(!s||!l||!c)return L.logger.warn("[buffer-controller]: Attempting to remove from the "+e+" SourceBuffer, but it does not exist"),void n.shiftAndExecuteNext(e);var m=Object(D.isFiniteNumber)(s.duration)?s.duration:1/0,p=Object(D.isFiniteNumber)(l.duration)?l.duration:1/0,y=Math.max(0,i),r=Math.min(t,m,p);r>y?(L.logger.log("[buffer-controller]: Removing ["+y+","+r+"] from the "+e+" SourceBuffer"),console.assert(!c.updating,e+" sourceBuffer must not be updating"),c.remove(y,r)):n.shiftAndExecuteNext(e)},u.appendExecutor=function(e,i){var t=this.operationQueue,s=this.sourceBuffer[i];if(!s)return L.logger.warn("[buffer-controller]: Attempting to append to the "+i+" SourceBuffer, but it does not exist"),void t.shiftAndExecuteNext(i);s.ended=!1,console.assert(!s.updating,i+" sourceBuffer must not be updating"),s.appendBuffer(e)},u.blockBuffers=function(e,i){var t=this;if(i===void 0&&(i=this.getSourceBufferTypes()),!i.length)return L.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve(e);var s=this.operationQueue,l=i.map(function(n){return s.appendBlocker(n)});Promise.all(l).then(function(){e(),i.forEach(function(n){var c=t.sourceBuffer[n];c&&c.updating||s.shiftAndExecuteNext(n)})})},u.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},u.addBufferListener=function(e,i,t){var s=this.sourceBuffer[e];if(s){var l=t.bind(this,e);this.listeners[e].push({event:i,listener:l}),s.addEventListener(i,l)}},u.removeBufferListeners=function(e){var i=this.sourceBuffer[e];i&&this.listeners[e].forEach(function(t){i.removeEventListener(t.event,t.listener)})},T}()},"./src/controller/buffer-operation-queue.ts":function(P,x,h){h.r(x),h.d(x,"default",function(){return d});var D=h("./src/utils/logger.ts"),d=function(){function L(C){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=C}var _=L.prototype;return _.append=function(C,R){var o=this.queues[R];o.push(C),o.length===1&&this.buffers[R]&&this.executeNext(R)},_.insertAbort=function(C,R){this.queues[R].unshift(C),this.executeNext(R)},_.appendBlocker=function(C){var R,o=new Promise(function(f){R=f}),E={execute:R,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(E,C),o},_.executeNext=function(C){var R=this.buffers,o=this.queues,E=R[C],f=o[C];if(f.length){var v=f[0];try{v.execute()}catch(b){D.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),v.onError(b),E&&E.updating||(f.shift(),this.executeNext(C))}}},_.shiftAndExecuteNext=function(C){this.queues[C].shift(),this.executeNext(C)},_.current=function(C){return this.queues[C][0]},L}()},"./src/controller/cap-level-controller.ts":function(P,x,h){h.r(x);var D=h("./src/events.ts");function d(_,C){for(var R=0;R<C.length;R++){var o=C[R];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(_,o.key,o)}}var L=function(){function _(f){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=f,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var C,R,o,E=_.prototype;return E.setStreamController=function(f){this.streamController=f},E.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},E.registerListeners=function(){var f=this.hls;f.on(D.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),f.on(D.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),f.on(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),f.on(D.Events.BUFFER_CODECS,this.onBufferCodecs,this),f.on(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},E.unregisterListener=function(){var f=this.hls;f.off(D.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),f.off(D.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),f.off(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),f.off(D.Events.BUFFER_CODECS,this.onBufferCodecs,this),f.off(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},E.onFpsDropLevelCapping=function(f,v){_.isLevelAllowed(v.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(v.droppedLevel)},E.onMediaAttaching=function(f,v){this.media=v.media instanceof HTMLVideoElement?v.media:null},E.onManifestParsed=function(f,v){var b=this.hls;this.restrictedLevels=[],this.firstLevel=v.firstLevel,b.config.capLevelToPlayerSize&&v.video&&this.startCapping()},E.onBufferCodecs=function(f,v){this.hls.config.capLevelToPlayerSize&&v.video&&this.startCapping()},E.onMediaDetaching=function(){this.stopCapping()},E.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var f=this.hls.levels;if(f.length){var v=this.hls;v.autoLevelCapping=this.getMaxLevel(f.length-1),v.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=v.autoLevelCapping}}},E.getMaxLevel=function(f){var v=this,b=this.hls.levels;if(!b.length)return-1;var T=b.filter(function(u,e){return _.isLevelAllowed(e,v.restrictedLevels)&&e<=f});return this.clientRect=null,_.getMaxLevelByMediaSize(T,this.mediaWidth,this.mediaHeight)},E.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},E.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},E.getDimensions=function(){if(this.clientRect)return this.clientRect;var f=this.media,v={width:0,height:0};if(f){var b=f.getBoundingClientRect();v.width=b.width,v.height=b.height,v.width||v.height||(v.width=b.right-b.left||f.width||0,v.height=b.bottom-b.top||f.height||0)}return this.clientRect=v,v},_.isLevelAllowed=function(f,v){return v===void 0&&(v=[]),v.indexOf(f)===-1},_.getMaxLevelByMediaSize=function(f,v,b){if(!f||!f.length)return-1;for(var T,u,e=f.length-1,i=0;i<f.length;i+=1){var t=f[i];if((t.width>=v||t.height>=b)&&(T=t,!(u=f[i+1])||T.width!==u.width||T.height!==u.height)){e=i;break}}return e},C=_,o=[{key:"contentScaleFactor",get:function(){var f=1;try{f=self.devicePixelRatio}catch{}return f}}],(R=[{key:"mediaWidth",get:function(){return this.getDimensions().width*_.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*_.contentScaleFactor}}])&&d(C.prototype,R),o&&d(C,o),_}();x.default=L},"./src/controller/eme-controller.ts":function(P,x,h){h.r(x);var D=h("./src/events.ts"),d=h("./src/errors.ts"),L=h("./src/utils/logger.ts"),_=h("./src/utils/mediakeys-helper.ts");function C(o,E){for(var f=0;f<E.length;f++){var v=E[f];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(o,v.key,v)}}var R=function(){function o(b){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=b,this._config=b.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var E,f,v=o.prototype;return v.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},v._registerListeners=function(){this.hls.on(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(D.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(D.Events.MANIFEST_PARSED,this.onManifestParsed,this)},v._unregisterListeners=function(){this.hls.off(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(D.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(D.Events.MANIFEST_PARSED,this.onManifestParsed,this)},v.getLicenseServerUrl=function(b){switch(b){case _.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+b+'"')},v._attemptKeySystemAccess=function(b,T,u){var e=this,i=function(s,l,n,c){switch(s){case _.KeySystems.WIDEVINE:return function(m,p,y){var r={audioCapabilities:[],videoCapabilities:[]};return m.forEach(function(a){r.audioCapabilities.push({contentType:'audio/mp4; codecs="'+a+'"',robustness:y.audioRobustness||""})}),p.forEach(function(a){r.videoCapabilities.push({contentType:'video/mp4; codecs="'+a+'"',robustness:y.videoRobustness||""})}),[r]}(l,n,c);default:throw new Error("Unknown key-system: "+s)}}(b,T,u,this._drmSystemOptions);L.logger.log("Requesting encrypted media key-system access");var t=this.requestMediaKeySystemAccess(b,i);this.mediaKeysPromise=t.then(function(s){return e._onMediaKeySystemAccessObtained(b,s)}),t.catch(function(s){L.logger.error('Failed to obtain key-system "'+b+'" access:',s)})},v._onMediaKeySystemAccessObtained=function(b,T){var u=this;L.logger.log('Access for key-system "'+b+'" obtained');var e={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:T,mediaKeySystemDomain:b};this._mediaKeysList.push(e);var i=Promise.resolve().then(function(){return T.createMediaKeys()}).then(function(t){return e.mediaKeys=t,L.logger.log('Media-keys created for key-system "'+b+'"'),u._onMediaKeysCreated(),t});return i.catch(function(t){L.logger.error("Failed to create media-keys:",t)}),i},v._onMediaKeysCreated=function(){var b=this;this._mediaKeysList.forEach(function(T){T.mediaKeysSession||(T.mediaKeysSession=T.mediaKeys.createSession(),b._onNewMediaKeySession(T.mediaKeysSession))})},v._onNewMediaKeySession=function(b){var T=this;L.logger.log("New key-system session "+b.sessionId),b.addEventListener("message",function(u){T._onKeySessionMessage(b,u.message)},!1)},v._onKeySessionMessage=function(b,T){L.logger.log("Got EME message event, creating license request"),this._requestLicense(T,function(u){L.logger.log("Received license data (length: "+(u&&u.byteLength)+"), updating key-session"),b.update(u)})},v.onMediaEncrypted=function(b){var T=this;if(L.logger.log('Media is encrypted using "'+b.initDataType+'" init data type'),!this.mediaKeysPromise)return L.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),void this.hls.trigger(D.Events.ERROR,{type:d.ErrorTypes.KEY_SYSTEM_ERROR,details:d.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});var u=function(e){T._media&&(T._attemptSetMediaKeys(e),T._generateRequestWithPreferredKeySession(b.initDataType,b.initData))};this.mediaKeysPromise.then(u).catch(u)},v._attemptSetMediaKeys=function(b){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var T=this._mediaKeysList[0];if(!T||!T.mediaKeys)return L.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(D.Events.ERROR,{type:d.ErrorTypes.KEY_SYSTEM_ERROR,details:d.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});L.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(T.mediaKeys),this._hasSetMediaKeys=!0}},v._generateRequestWithPreferredKeySession=function(b,T){var u=this,e=this._mediaKeysList[0];if(!e)return L.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(D.Events.ERROR,{type:d.ErrorTypes.KEY_SYSTEM_ERROR,details:d.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(e.mediaKeysSessionInitialized)L.logger.warn("Key-Session already initialized but requested again");else{var i=e.mediaKeysSession;if(!i)return L.logger.error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(D.Events.ERROR,{type:d.ErrorTypes.KEY_SYSTEM_ERROR,details:d.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});if(!T)return L.logger.warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(D.Events.ERROR,{type:d.ErrorTypes.KEY_SYSTEM_ERROR,details:d.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});L.logger.log('Generating key-session request for "'+b+'" init data type'),e.mediaKeysSessionInitialized=!0,i.generateRequest(b,T).then(function(){L.logger.debug("Key-session generation succeeded")}).catch(function(t){L.logger.error("Error generating key-session request:",t),u.hls.trigger(D.Events.ERROR,{type:d.ErrorTypes.KEY_SYSTEM_ERROR,details:d.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})}},v._createLicenseXhr=function(b,T,u){var e=new XMLHttpRequest;e.responseType="arraybuffer",e.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,e,b,T,u);var i=this._licenseXhrSetup;if(i)try{i.call(this.hls,e,b),i=void 0}catch(t){L.logger.error(t)}try{e.readyState||e.open("POST",b,!0),i&&i.call(this.hls,e,b)}catch(t){throw new Error("issue setting up KeySystem license XHR "+t)}return e},v._onLicenseRequestReadyStageChange=function(b,T,u,e){switch(b.readyState){case 4:if(b.status===200){this._requestLicenseFailureCount=0,L.logger.log("License request succeeded");var i=b.response,t=this._licenseResponseCallback;if(t)try{i=t.call(this.hls,b,T)}catch(l){L.logger.error(l)}e(i)}else{if(L.logger.error("License Request XHR failed ("+T+"). Status: "+b.status+" ("+b.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>3)return void this.hls.trigger(D.Events.ERROR,{type:d.ErrorTypes.KEY_SYSTEM_ERROR,details:d.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});var s=3-this._requestLicenseFailureCount+1;L.logger.warn("Retrying license request, "+s+" attempts left"),this._requestLicense(u,e)}}},v._generateLicenseRequestChallenge=function(b,T){switch(b.mediaKeySystemDomain){case _.KeySystems.WIDEVINE:return T}throw new Error("unsupported key-system: "+b.mediaKeySystemDomain)},v._requestLicense=function(b,T){L.logger.log("Requesting content license for key-system");var u=this._mediaKeysList[0];if(!u)return L.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(D.Events.ERROR,{type:d.ErrorTypes.KEY_SYSTEM_ERROR,details:d.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});try{var e=this.getLicenseServerUrl(u.mediaKeySystemDomain),i=this._createLicenseXhr(e,b,T);L.logger.log("Sending license request to URL: "+e);var t=this._generateLicenseRequestChallenge(u,b);i.send(t)}catch(s){L.logger.error("Failure requesting DRM license: "+s),this.hls.trigger(D.Events.ERROR,{type:d.ErrorTypes.KEY_SYSTEM_ERROR,details:d.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},v.onMediaAttached=function(b,T){if(this._emeEnabled){var u=T.media;this._media=u,u.addEventListener("encrypted",this._onMediaEncrypted)}},v.onMediaDetached=function(){var b=this._media,T=this._mediaKeysList;b&&(b.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(T.map(function(u){if(u.mediaKeysSession)return u.mediaKeysSession.close().catch(function(){})})).then(function(){return b.setMediaKeys(null)}).catch(function(){}))},v.onManifestParsed=function(b,T){if(this._emeEnabled){var u=T.levels.map(function(i){return i.audioCodec}).filter(function(i){return!!i}),e=T.levels.map(function(i){return i.videoCodec}).filter(function(i){return!!i});this._attemptKeySystemAccess(_.KeySystems.WIDEVINE,u,e)}},E=o,(f=[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}])&&C(E.prototype,f),o}();x.default=R},"./src/controller/fps-controller.ts":function(P,x,h){h.r(x);var D=h("./src/events.ts"),d=h("./src/utils/logger.ts"),L=function(){function _(R){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=R,this.registerListeners()}var C=_.prototype;return C.setStreamController=function(R){this.streamController=R},C.registerListeners=function(){this.hls.on(D.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},C.unregisterListeners=function(){this.hls.off(D.Events.MEDIA_ATTACHING,this.onMediaAttaching)},C.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},C.onMediaAttaching=function(R,o){var E=this.hls.config;if(E.capLevelOnFPSDrop){var f=o.media instanceof self.HTMLVideoElement?o.media:null;this.media=f,f&&typeof f.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),E.fpsDroppedMonitoringPeriod)}},C.checkFPS=function(R,o,E){var f=performance.now();if(o){if(this.lastTime){var v=f-this.lastTime,b=E-this.lastDroppedFrames,T=o-this.lastDecodedFrames,u=1e3*b/v,e=this.hls;if(e.trigger(D.Events.FPS_DROP,{currentDropped:b,currentDecoded:T,totalDroppedFrames:E}),u>0&&b>e.config.fpsDroppedMonitoringThreshold*T){var i=e.currentLevel;d.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+i),i>0&&(e.autoLevelCapping===-1||e.autoLevelCapping>=i)&&(i-=1,e.trigger(D.Events.FPS_DROP_LEVEL_CAPPING,{level:i,droppedLevel:e.currentLevel}),e.autoLevelCapping=i,this.streamController.nextLevelSwitch())}}this.lastTime=f,this.lastDroppedFrames=E,this.lastDecodedFrames=o}},C.checkFPSInterval=function(){var R=this.media;if(R)if(this.isVideoPlaybackQualityAvailable){var o=R.getVideoPlaybackQuality();this.checkFPS(R,o.totalVideoFrames,o.droppedVideoFrames)}else this.checkFPS(R,R.webkitDecodedFrameCount,R.webkitDroppedFrameCount)},_}();x.default=L},"./src/controller/fragment-finders.ts":function(P,x,h){h.r(x),h.d(x,"findFragmentByPDT",function(){return L}),h.d(x,"findFragmentByPTS",function(){return _}),h.d(x,"fragmentWithinToleranceTest",function(){return C}),h.d(x,"pdtWithinToleranceTest",function(){return R}),h.d(x,"findFragWithCC",function(){return o});var D=h("./src/polyfills/number.ts"),d=h("./src/utils/binary-search.ts");function L(E,f,v){if(f===null||!Array.isArray(E)||!E.length||!Object(D.isFiniteNumber)(f)||f<(E[0].programDateTime||0)||f>=(E[E.length-1].endProgramDateTime||0))return null;v=v||0;for(var b=0;b<E.length;++b){var T=E[b];if(R(f,v,T))return T}return null}function _(E,f,v,b){v===void 0&&(v=0),b===void 0&&(b=0);var T=null;if(E?T=f[E.sn-f[0].sn+1]||null:v===0&&f[0].start===0&&(T=f[0]),T&&C(v,b,T)===0)return T;var u=d.default.search(f,C.bind(null,v,b));return u||T}function C(E,f,v){E===void 0&&(E=0),f===void 0&&(f=0);var b=Math.min(f,v.duration+(v.deltaPTS?v.deltaPTS:0));return v.start+v.duration-b<=E?1:v.start-b>E&&v.start?-1:0}function R(E,f,v){var b=1e3*Math.min(f,v.duration+(v.deltaPTS?v.deltaPTS:0));return(v.endProgramDateTime||0)-b>E}function o(E,f){return d.default.search(E,function(v){return v.cc<f?1:v.cc>f?-1:0})}},"./src/controller/fragment-tracker.ts":function(P,x,h){h.r(x),h.d(x,"FragmentState",function(){return D}),h.d(x,"FragmentTracker",function(){return C});var D,d,L=h("./src/events.ts"),_=h("./src/types/loader.ts");(d=D||(D={})).NOT_LOADED="NOT_LOADED",d.BACKTRACKED="BACKTRACKED",d.APPENDING="APPENDING",d.PARTIAL="PARTIAL",d.OK="OK";var C=function(){function E(v){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=v,this._registerListeners()}var f=E.prototype;return f._registerListeners=function(){var v=this.hls;v.on(L.Events.BUFFER_APPENDED,this.onBufferAppended,this),v.on(L.Events.FRAG_BUFFERED,this.onFragBuffered,this),v.on(L.Events.FRAG_LOADED,this.onFragLoaded,this)},f._unregisterListeners=function(){var v=this.hls;v.off(L.Events.BUFFER_APPENDED,this.onBufferAppended,this),v.off(L.Events.FRAG_BUFFERED,this.onFragBuffered,this),v.off(L.Events.FRAG_LOADED,this.onFragLoaded,this)},f.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},f.getAppendedFrag=function(v,b){if(b===_.PlaylistLevelType.MAIN){var T=this.activeFragment,u=this.activeParts;if(!T)return null;if(u)for(var e=u.length;e--;){var i=u[e],t=i?i.end:T.appendedPTS;if(i.start<=v&&t!==void 0&&v<=t)return e>9&&(this.activeParts=u.slice(e-9)),i}else if(T.start<=v&&T.appendedPTS!==void 0&&v<=T.appendedPTS)return T}return this.getBufferedFrag(v,b)},f.getBufferedFrag=function(v,b){for(var T=this.fragments,u=Object.keys(T),e=u.length;e--;){var i=T[u[e]];if((i==null?void 0:i.body.type)===b&&i.buffered){var t=i.body;if(t.start<=v&&v<=t.end)return t}}return null},f.detectEvictedFragments=function(v,b,T){var u=this;Object.keys(this.fragments).forEach(function(e){var i=u.fragments[e];if(i)if(i.buffered){var t=i.range[v];t&&t.time.some(function(s){var l=!u.isTimeBuffered(s.startPTS,s.endPTS,b);return l&&u.removeFragment(i.body),l})}else i.body.type===T&&u.removeFragment(i.body)})},f.detectPartialFragments=function(v){var b=this,T=this.timeRanges,u=v.frag,e=v.part;if(T&&u.sn!=="initSegment"){var i=o(u),t=this.fragments[i];t&&(Object.keys(T).forEach(function(s){var l=u.elementaryStreams[s];if(l){var n=T[s],c=e!==null||l.partial===!0;t.range[s]=b.getBufferedTimes(u,e,c,n)}}),t.backtrack=t.loaded=null,Object.keys(t.range).length?t.buffered=!0:this.removeFragment(t.body))}},f.fragBuffered=function(v){var b=o(v),T=this.fragments[b];T&&(T.backtrack=T.loaded=null,T.buffered=!0)},f.getBufferedTimes=function(v,b,T,u){for(var e={time:[],partial:T},i=b?b.start:v.start,t=b?b.end:v.end,s=v.minEndPTS||t,l=v.maxStartPTS||i,n=0;n<u.length;n++){var c=u.start(n)-this.bufferPadding,m=u.end(n)+this.bufferPadding;if(l>=c&&s<=m){e.time.push({startPTS:Math.max(i,u.start(n)),endPTS:Math.min(t,u.end(n))});break}if(i<m&&t>c)e.partial=!0,e.time.push({startPTS:Math.max(i,u.start(n)),endPTS:Math.min(t,u.end(n))});else if(t<=c)break}return e},f.getPartialFragment=function(v){var b,T,u,e=null,i=0,t=this.bufferPadding,s=this.fragments;return Object.keys(s).forEach(function(l){var n=s[l];n&&R(n)&&(T=n.body.start-t,u=n.body.end+t,v>=T&&v<=u&&(b=Math.min(v-T,u-v),i<=b&&(e=n.body,i=b)))}),e},f.getState=function(v){var b=o(v),T=this.fragments[b];return T?T.buffered?R(T)?D.PARTIAL:D.OK:T.backtrack?D.BACKTRACKED:D.APPENDING:D.NOT_LOADED},f.backtrack=function(v,b){var T=o(v),u=this.fragments[T];if(!u||u.backtrack)return null;var e=u.backtrack=b||u.loaded;return u.loaded=null,e},f.getBacktrackData=function(v){var b=o(v),T=this.fragments[b];if(T){var u,e=T.backtrack;if(e!=null&&(u=e.payload)!==null&&u!==void 0&&u.byteLength)return e;this.removeFragment(v)}return null},f.isTimeBuffered=function(v,b,T){for(var u,e,i=0;i<T.length;i++){if(u=T.start(i)-this.bufferPadding,e=T.end(i)+this.bufferPadding,v>=u&&b<=e)return!0;if(b<=u)return!1}return!1},f.onFragLoaded=function(v,b){var T=b.frag,u=b.part;if(T.sn!=="initSegment"&&!T.bitrateTest&&!u){var e=o(T);this.fragments[e]={body:T,loaded:b,backtrack:null,buffered:!1,range:Object.create(null)}}},f.onBufferAppended=function(v,b){var T=this,u=b.frag,e=b.part,i=b.timeRanges;if(u.type===_.PlaylistLevelType.MAIN)if(this.activeFragment=u,e){var t=this.activeParts;t||(this.activeParts=t=[]),t.push(e)}else this.activeParts=null;this.timeRanges=i,Object.keys(i).forEach(function(s){var l=i[s];if(T.detectEvictedFragments(s,l),!e)for(var n=0;n<l.length;n++)u.appendedPTS=Math.max(l.end(n),u.appendedPTS||0)})},f.onFragBuffered=function(v,b){this.detectPartialFragments(b)},f.hasFragment=function(v){var b=o(v);return!!this.fragments[b]},f.removeFragmentsInRange=function(v,b,T){var u=this;Object.keys(this.fragments).forEach(function(e){var i=u.fragments[e];if(i&&i.buffered){var t=i.body;t.type===T&&t.start<b&&t.end>v&&u.removeFragment(t)}})},f.removeFragment=function(v){var b=o(v);v.stats.loaded=0,v.clearElementaryStreamInfo(),delete this.fragments[b]},f.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},E}();function R(E){var f,v;return E.buffered&&(((f=E.range.video)===null||f===void 0?void 0:f.partial)||((v=E.range.audio)===null||v===void 0?void 0:v.partial))}function o(E){return E.type+"_"+E.level+"_"+E.urlId+"_"+E.sn}},"./src/controller/gap-controller.ts":function(P,x,h){h.r(x),h.d(x,"STALL_MINIMUM_DURATION_MS",function(){return C}),h.d(x,"MAX_START_GAP_JUMP",function(){return R}),h.d(x,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return o}),h.d(x,"SKIP_BUFFER_RANGE_START",function(){return E}),h.d(x,"default",function(){return f});var D=h("./src/utils/buffer-helper.ts"),d=h("./src/errors.ts"),L=h("./src/events.ts"),_=h("./src/utils/logger.ts"),C=250,R=2,o=.1,E=.05,f=function(){function v(T,u,e,i){this.config=void 0,this.media=void 0,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=T,this.media=u,this.fragmentTracker=e,this.hls=i}var b=v.prototype;return b.destroy=function(){this.hls=this.fragmentTracker=this.media=null},b.poll=function(T){var u=this.config,e=this.media,i=this.stalled,t=e.currentTime,s=e.seeking,l=this.seeking&&!s,n=!this.seeking&&s;if(this.seeking=s,t===T){if((n||l)&&(this.stalled=null),!e.paused&&!e.ended&&e.playbackRate!==0&&D.BufferHelper.getBuffered(e).length){var c=D.BufferHelper.bufferInfo(e,t,0),m=c.len>0,p=c.nextStart||0;if(m||p){if(s){var y=c.len>R,r=!p||p-t>R&&!this.fragmentTracker.getPartialFragment(t);if(y||r)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var a,g=Math.max(p,c.start||0)-t,k=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,S=!(k==null||(a=k.details)===null||a===void 0)&&a.live?2*k.details.targetduration:R;if(g>0&&g<=S)return void this._trySkipBufferHole(null)}var A=self.performance.now();if(i!==null){var I=A-i;!s&&I>=C&&this._reportStall(c.len);var w=D.BufferHelper.bufferInfo(e,t,u.maxBufferHole);this._tryFixBufferStall(w,I)}else this.stalled=A}}}else if(this.moved=!0,i!==null){if(this.stallReported){var O=self.performance.now()-i;_.logger.warn("playback not stuck anymore @"+t+", after "+Math.round(O)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}},b._tryFixBufferStall=function(T,u){var e=this.config,i=this.fragmentTracker,t=this.media.currentTime,s=i.getPartialFragment(t);s&&this._trySkipBufferHole(s)||T.len>e.maxBufferHole&&u>1e3*e.highBufferWatchdogPeriod&&(_.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},b._reportStall=function(T){var u=this.hls,e=this.media;this.stallReported||(this.stallReported=!0,_.logger.warn("Playback stalling at @"+e.currentTime+" due to low buffer (buffer="+T+")"),u.trigger(L.Events.ERROR,{type:d.ErrorTypes.MEDIA_ERROR,details:d.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:T}))},b._trySkipBufferHole=function(T){for(var u=this.config,e=this.hls,i=this.media,t=i.currentTime,s=0,l=D.BufferHelper.getBuffered(i),n=0;n<l.length;n++){var c=l.start(n);if(t+u.maxBufferHole>=s&&t<c){var m=Math.max(c+E,i.currentTime+o);return _.logger.warn("skipping hole, adjusting currentTime from "+t+" to "+m),this.moved=!0,this.stalled=null,i.currentTime=m,T&&e.trigger(L.Events.ERROR,{type:d.ErrorTypes.MEDIA_ERROR,details:d.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+t+" to "+m,frag:T}),m}s=l.end(n)}return 0},b._tryNudgeBuffer=function(){var T=this.config,u=this.hls,e=this.media,i=e.currentTime,t=(this.nudgeRetry||0)+1;if(this.nudgeRetry=t,t<T.nudgeMaxRetry){var s=i+t*T.nudgeOffset;_.logger.warn("Nudging 'currentTime' from "+i+" to "+s),e.currentTime=s,u.trigger(L.Events.ERROR,{type:d.ErrorTypes.MEDIA_ERROR,details:d.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else _.logger.error("Playhead still not moving while enough data buffered @"+i+" after "+T.nudgeMaxRetry+" nudges"),u.trigger(L.Events.ERROR,{type:d.ErrorTypes.MEDIA_ERROR,details:d.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},v}()},"./src/controller/id3-track-controller.ts":function(P,x,h){h.r(x);var D=h("./src/events.ts"),d=h("./src/utils/texttrack-utils.ts"),L=h("./src/demux/id3.ts"),_=function(){function C(o){this.hls=void 0,this.id3Track=null,this.media=null,this.hls=o,this._registerListeners()}var R=C.prototype;return R.destroy=function(){this._unregisterListeners()},R._registerListeners=function(){var o=this.hls;o.on(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),o.on(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.on(D.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),o.on(D.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},R._unregisterListeners=function(){var o=this.hls;o.off(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),o.off(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.off(D.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),o.off(D.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},R.onMediaAttached=function(o,E){this.media=E.media},R.onMediaDetaching=function(){this.id3Track&&(Object(d.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null)},R.getID3Track=function(o){if(this.media){for(var E=0;E<o.length;E++){var f=o[E];if(f.kind==="metadata"&&f.label==="id3")return Object(d.sendAddTrackEvent)(f,this.media),f}return this.media.addTextTrack("metadata","id3")}},R.onFragParsingMetadata=function(o,E){if(this.media){var f=E.frag,v=E.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var b=self.WebKitDataCue||self.VTTCue||self.TextTrackCue,T=0;T<v.length;T++){var u=L.getID3Frames(v[T].data);if(u){var e=v[T].pts,i=T<v.length-1?v[T+1].pts:f.end;i-e<=0&&(i=e+.25);for(var t=0;t<u.length;t++){var s=u[t];if(!L.isTimeStampFrame(s)){var l=new b(e,i,"");l.value=s,this.id3Track.addCue(l)}}}}}},R.onBufferFlushing=function(o,E){var f=E.startOffset,v=E.endOffset,b=E.type;if(!b||b==="audio"){var T=this.id3Track;T&&Object(d.removeCuesInRange)(T,f,v)}},C}();x.default=_},"./src/controller/latency-controller.ts":function(P,x,h){h.r(x),h.d(x,"default",function(){return C});var D=h("./src/errors.ts"),d=h("./src/events.ts"),L=h("./src/utils/logger.ts");function _(R,o){for(var E=0;E<o.length;E++){var f=o[E];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(R,f.key,f)}}var C=function(){function R(v){var b=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return b.timeupdate()},this.hls=v,this.config=v.config,this.registerListeners()}var o,E,f=R.prototype;return f.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},f.registerListeners=function(){this.hls.on(d.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(d.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(d.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(d.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(d.Events.ERROR,this.onError,this)},f.unregisterListeners=function(){this.hls.off(d.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(d.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(d.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(d.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(d.Events.ERROR,this.onError)},f.onMediaAttached=function(v,b){this.media=b.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},f.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},f.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},f.onLevelUpdated=function(v,b){var T=b.details;this.levelDetails=T,T.advanced&&this.timeupdate(),!T.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},f.onError=function(v,b){b.details===D.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,L.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},f.timeupdate=function(){var v=this.media,b=this.levelDetails;if(v&&b){this.currentTime=v.currentTime;var T=this.computeLatency();if(T!==null){this._latency=T;var u=this.config,e=u.lowLatencyMode,i=u.maxLiveSyncPlaybackRate;if(e&&i!==1){var t=this.targetLatency;if(t!==null){var s=T-t,l=s<Math.min(this.maxLatency,t+b.targetduration);if(b.live&&l&&s>.05&&this.forwardBufferLength>1){var n=Math.min(2,Math.max(1,i)),c=Math.round(2/(1+Math.exp(-.75*s-this.edgeStalled))*20)/20;v.playbackRate=Math.min(n,Math.max(1,c))}else v.playbackRate!==1&&v.playbackRate!==0&&(v.playbackRate=1)}}}}},f.estimateLiveEdge=function(){var v=this.levelDetails;return v===null?null:v.edge+v.age},f.computeLatency=function(){var v=this.estimateLiveEdge();return v===null?null:v-this.currentTime},o=R,(E=[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var v=this.config,b=this.levelDetails;return v.liveMaxLatencyDuration!==void 0?v.liveMaxLatencyDuration:b?v.liveMaxLatencyDurationCount*b.targetduration:0}},{key:"targetLatency",get:function(){var v=this.levelDetails;if(v===null)return null;var b=v.holdBack,T=v.partHoldBack,u=v.targetduration,e=this.config,i=e.liveSyncDuration,t=e.liveSyncDurationCount,s=e.lowLatencyMode,l=this.hls.userConfig,n=s&&T||b;(l.liveSyncDuration||l.liveSyncDurationCount||n===0)&&(n=i!==void 0?i:t*u);var c=u;return n+Math.min(1*this.stallCount,c)}},{key:"liveSyncPosition",get:function(){var v=this.estimateLiveEdge(),b=this.targetLatency,T=this.levelDetails;if(v===null||b===null||T===null)return null;var u=T.edge,e=v-b-this.edgeStalled,i=u-T.totalduration,t=u-(this.config.lowLatencyMode&&T.partTarget||T.targetduration);return Math.min(Math.max(i,e),t)}},{key:"drift",get:function(){var v=this.levelDetails;return v===null?1:v.drift}},{key:"edgeStalled",get:function(){var v=this.levelDetails;if(v===null)return 0;var b=3*(this.config.lowLatencyMode&&v.partTarget||v.targetduration);return Math.max(v.age-b,0)}},{key:"forwardBufferLength",get:function(){var v=this.media,b=this.levelDetails;if(!v||!b)return 0;var T=v.buffered.length;return T?v.buffered.end(T-1):b.edge-this.currentTime}}])&&_(o.prototype,E),R}()},"./src/controller/level-controller.ts":function(P,x,h){h.r(x),h.d(x,"default",function(){return T});var D=h("./src/types/level.ts"),d=h("./src/events.ts"),L=h("./src/errors.ts"),_=h("./src/utils/codecs.ts"),C=h("./src/controller/level-helper.ts"),R=h("./src/controller/base-playlist-controller.ts"),o=h("./src/types/loader.ts");function E(){return(E=Object.assign||function(u){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&(u[t]=i[t])}return u}).apply(this,arguments)}function f(u,e){for(var i=0;i<e.length;i++){var t=e[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(u,t.key,t)}}function v(u,e){return(v=Object.setPrototypeOf||function(i,t){return i.__proto__=t,i})(u,e)}var b=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),T=function(u){var e,i;function t(c){var m;return(m=u.call(this,c,"[level-controller]")||this)._levels=[],m._firstLevel=-1,m._startLevel=void 0,m.currentLevelIndex=-1,m.manualLevelIndex=-1,m.onParsedComplete=void 0,m._registerListeners(),m}i=u,(e=t).prototype=Object.create(i.prototype),e.prototype.constructor=e,v(e,i);var s,l,n=t.prototype;return n._registerListeners=function(){var c=this.hls;c.on(d.Events.MANIFEST_LOADED,this.onManifestLoaded,this),c.on(d.Events.LEVEL_LOADED,this.onLevelLoaded,this),c.on(d.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),c.on(d.Events.FRAG_LOADED,this.onFragLoaded,this),c.on(d.Events.ERROR,this.onError,this)},n._unregisterListeners=function(){var c=this.hls;c.off(d.Events.MANIFEST_LOADED,this.onManifestLoaded,this),c.off(d.Events.LEVEL_LOADED,this.onLevelLoaded,this),c.off(d.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),c.off(d.Events.FRAG_LOADED,this.onFragLoaded,this),c.off(d.Events.ERROR,this.onError,this)},n.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,u.prototype.destroy.call(this)},n.startLoad=function(){this._levels.forEach(function(c){c.loadError=0}),u.prototype.startLoad.call(this)},n.onManifestLoaded=function(c,m){var p,y,r=[],a=[],g=[],k={},S=!1,A=!1,I=!1;if(m.levels.forEach(function(M){var N=M.attrs;S=S||!(!M.width||!M.height),A=A||!!M.videoCodec,I=I||!!M.audioCodec,b&&M.audioCodec&&M.audioCodec.indexOf("mp4a.40.34")!==-1&&(M.audioCodec=void 0);var B=M.bitrate+"-"+M.attrs.RESOLUTION+"-"+M.attrs.CODECS;(y=k[B])?y.url.push(M.url):(y=new D.Level(M),k[B]=y,r.push(y)),N&&(N.AUDIO&&Object(C.addGroupId)(y,"audio",N.AUDIO),N.SUBTITLES&&Object(C.addGroupId)(y,"text",N.SUBTITLES))}),(S||A)&&I&&(r=r.filter(function(M){var N=M.videoCodec,B=M.width,U=M.height;return!!N||!(!B||!U)})),r=r.filter(function(M){var N=M.audioCodec,B=M.videoCodec;return(!N||Object(_.isCodecSupportedInMp4)(N,"audio"))&&(!B||Object(_.isCodecSupportedInMp4)(B,"video"))}),m.audioTracks&&(a=m.audioTracks.filter(function(M){return!M.audioCodec||Object(_.isCodecSupportedInMp4)(M.audioCodec,"audio")}),Object(C.assignTrackIdsByGroup)(a)),m.subtitles&&(g=m.subtitles,Object(C.assignTrackIdsByGroup)(g)),r.length>0){p=r[0].bitrate,r.sort(function(M,N){return M.bitrate-N.bitrate}),this._levels=r;for(var w=0;w<r.length;w++)if(r[w].bitrate===p){this._firstLevel=w,this.log("manifest loaded, "+r.length+" level(s) found, first bitrate: "+p);break}var O=I&&!A,F={levels:r,audioTracks:a,subtitleTracks:g,firstLevel:this._firstLevel,stats:m.stats,audio:I,video:A,altAudio:!O&&a.some(function(M){return!!M.url})};this.hls.trigger(d.Events.MANIFEST_PARSED,F),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(d.Events.ERROR,{type:L.ErrorTypes.MEDIA_ERROR,details:L.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:m.url,reason:"no level with compatible codecs found in manifest"})},n.onError=function(c,m){if(u.prototype.onError.call(this,c,m),!m.fatal){var p=m.context,y=this._levels[this.currentLevelIndex];if(p&&(p.type===o.PlaylistContextType.AUDIO_TRACK&&y.audioGroupIds&&p.groupId===y.audioGroupIds[y.urlId]||p.type===o.PlaylistContextType.SUBTITLE_TRACK&&y.textGroupIds&&p.groupId===y.textGroupIds[y.urlId]))this.redundantFailover(this.currentLevelIndex);else{var r,a=!1,g=!0;switch(m.details){case L.ErrorDetails.FRAG_LOAD_ERROR:case L.ErrorDetails.FRAG_LOAD_TIMEOUT:case L.ErrorDetails.KEY_LOAD_ERROR:case L.ErrorDetails.KEY_LOAD_TIMEOUT:if(m.frag){var k=this._levels[m.frag.level];k?(k.fragmentError++,k.fragmentError>this.hls.config.fragLoadingMaxRetry&&(r=m.frag.level)):r=m.frag.level}break;case L.ErrorDetails.LEVEL_LOAD_ERROR:case L.ErrorDetails.LEVEL_LOAD_TIMEOUT:p&&(p.deliveryDirectives&&(g=!1),r=p.level),a=!0;break;case L.ErrorDetails.REMUX_ALLOC_ERROR:r=m.level,a=!0}r!==void 0&&this.recoverLevel(m,r,a,g)}}},n.recoverLevel=function(c,m,p,y){var r=c.details,a=this._levels[m];if(a.loadError++,p){if(!this.retryLoadingOrFail(c))return void(this.currentLevelIndex=-1);c.levelRetry=!0}if(y){var g=a.url.length;if(g>1&&a.loadError<g)c.levelRetry=!0,this.redundantFailover(m);else if(this.manualLevelIndex===-1){var k=m===0?this._levels.length-1:m-1;this.currentLevelIndex!==k&&this._levels[k].loadError===0&&(this.warn(r+": switch to "+k),c.levelRetry=!0,this.hls.nextAutoLevel=k)}}},n.redundantFailover=function(c){var m=this._levels[c],p=m.url.length;if(p>1){var y=(m.urlId+1)%p;this.warn("Switching to redundant URL-id "+y),this._levels.forEach(function(r){r.urlId=y}),this.level=c}},n.onFragLoaded=function(c,m){var p=m.frag;if(p!==void 0&&p.type===o.PlaylistLevelType.MAIN){var y=this._levels[p.level];y!==void 0&&(y.fragmentError=0,y.loadError=0)}},n.onLevelLoaded=function(c,m){var p,y,r=m.level,a=m.details,g=this._levels[r];if(!g)return this.warn("Invalid level index "+r),void((y=m.deliveryDirectives)!==null&&y!==void 0&&y.skip&&(a.deltaUpdateFailed=!0));r===this.currentLevelIndex?(g.fragmentError===0&&(g.loadError=0,this.retryCount=0),this.playlistLoaded(r,m,g.details)):(p=m.deliveryDirectives)!==null&&p!==void 0&&p.skip&&(a.deltaUpdateFailed=!0)},n.onAudioTrackSwitched=function(c,m){var p=this.hls.levels[this.currentLevelIndex];if(p&&p.audioGroupIds){for(var y=-1,r=this.hls.audioTracks[m.id].groupId,a=0;a<p.audioGroupIds.length;a++)if(p.audioGroupIds[a]===r){y=a;break}y!==p.urlId&&(p.urlId=y,this.startLoad())}},n.loadPlaylist=function(c){var m=this.currentLevelIndex,p=this._levels[m];if(this.canLoad&&p&&p.url.length>0){var y=p.urlId,r=p.url[y];if(c)try{r=c.addDirectives(r)}catch(a){this.warn("Could not construct new URL with HLS Delivery Directives: "+a)}this.log("Attempt loading level index "+m+(c?" at sn "+c.msn+" part "+c.part:"")+" with URL-id "+y+" "+r),this.clearTimer(),this.hls.trigger(d.Events.LEVEL_LOADING,{url:r,level:m,id:y,deliveryDirectives:c||null})}},n.removeLevel=function(c,m){var p=function(r,a){return a!==m},y=this._levels.filter(function(r,a){return a!==c||r.url.length>1&&m!==void 0&&(r.url=r.url.filter(p),r.audioGroupIds&&(r.audioGroupIds=r.audioGroupIds.filter(p)),r.textGroupIds&&(r.textGroupIds=r.textGroupIds.filter(p)),r.urlId=0,!0)}).map(function(r,a){var g=r.details;return g!=null&&g.fragments&&g.fragments.forEach(function(k){k.level=a}),r});this._levels=y,this.hls.trigger(d.Events.LEVELS_UPDATED,{levels:y})},s=t,(l=[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(c){var m,p=this._levels;if(p.length!==0&&(this.currentLevelIndex!==c||(m=p[c])===null||m===void 0||!m.details)){if(c<0||c>=p.length){var y=c<0;if(this.hls.trigger(d.Events.ERROR,{type:L.ErrorTypes.OTHER_ERROR,details:L.ErrorDetails.LEVEL_SWITCH_ERROR,level:c,fatal:y,reason:"invalid level idx"}),y)return;c=Math.min(c,p.length-1)}this.clearTimer();var r=this.currentLevelIndex,a=p[r],g=p[c];this.log("switching to level "+c+" from "+r),this.currentLevelIndex=c;var k=E({},g,{level:c,maxBitrate:g.maxBitrate,uri:g.uri,urlId:g.urlId});delete k._urlId,this.hls.trigger(d.Events.LEVEL_SWITCHING,k);var S=g.details;if(!S||S.live){var A=this.switchParams(g.uri,a==null?void 0:a.details);this.loadPlaylist(A)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(c){this.manualLevelIndex=c,this._startLevel===void 0&&(this._startLevel=c),c!==-1&&(this.level=c)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(c){this._firstLevel=c}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var c=this.hls.config.startLevel;return c!==void 0?c:this._firstLevel}return this._startLevel},set:function(c){this._startLevel=c}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(c){this.level=c,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=c)}}])&&f(s.prototype,l),t}(R.default)},"./src/controller/level-helper.ts":function(P,x,h){h.r(x),h.d(x,"addGroupId",function(){return L}),h.d(x,"assignTrackIdsByGroup",function(){return _}),h.d(x,"updatePTS",function(){return C}),h.d(x,"updateFragPTSDTS",function(){return o}),h.d(x,"mergeDetails",function(){return E}),h.d(x,"mapPartIntersection",function(){return f}),h.d(x,"mapFragmentIntersection",function(){return v}),h.d(x,"adjustSliding",function(){return b}),h.d(x,"addSliding",function(){return T}),h.d(x,"computeReloadInterval",function(){return u}),h.d(x,"getFragmentWithSN",function(){return e}),h.d(x,"getPartWith",function(){return i});var D=h("./src/polyfills/number.ts"),d=h("./src/utils/logger.ts");function L(t,s,l){switch(s){case"audio":t.audioGroupIds||(t.audioGroupIds=[]),t.audioGroupIds.push(l);break;case"text":t.textGroupIds||(t.textGroupIds=[]),t.textGroupIds.push(l)}}function _(t){var s={};t.forEach(function(l){var n=l.groupId||"";l.id=s[n]=s[n]||0,s[n]++})}function C(t,s,l){R(t[s],t[l])}function R(t,s){var l=s.startPTS;if(Object(D.isFiniteNumber)(l)){var n,c=0;s.sn>t.sn?(c=l-t.start,n=t):(c=t.start-l,n=s),n.duration!==c&&(n.duration=c)}else s.sn>t.sn?t.cc===s.cc&&t.minEndPTS?s.start=t.start+(t.minEndPTS-t.start):s.start=t.start+t.duration:s.start=Math.max(t.start-s.duration,0)}function o(t,s,l,n,c,m){n-l<=0&&(d.logger.warn("Fragment should have a positive duration",s),n=l+s.duration,m=c+s.duration);var p=l,y=n,r=s.startPTS,a=s.endPTS;if(Object(D.isFiniteNumber)(r)){var g=Math.abs(r-l);Object(D.isFiniteNumber)(s.deltaPTS)?s.deltaPTS=Math.max(g,s.deltaPTS):s.deltaPTS=g,p=Math.max(l,r),l=Math.min(l,r),c=Math.min(c,s.startDTS),y=Math.min(n,a),n=Math.max(n,a),m=Math.max(m,s.endDTS)}s.duration=n-l;var k=l-s.start;s.appendedPTS=n,s.start=s.startPTS=l,s.maxStartPTS=p,s.startDTS=c,s.endPTS=n,s.minEndPTS=y,s.endDTS=m;var S,A=s.sn;if(!t||A<t.startSN||A>t.endSN)return 0;var I=A-t.startSN,w=t.fragments;for(w[I]=s,S=I;S>0;S--)R(w[S],w[S-1]);for(S=I;S<w.length-1;S++)R(w[S],w[S+1]);return t.fragmentHint&&R(w[w.length-1],t.fragmentHint),t.PTSKnown=t.alignedSliding=!0,k}function E(t,s){for(var l=null,n=t.fragments,c=n.length-1;c>=0;c--){var m=n[c].initSegment;if(m){l=m;break}}t.fragmentHint&&delete t.fragmentHint.endPTS;var p,y=0;if(v(t,s,function(A,I){var w;A.relurl&&(y=A.cc-I.cc),Object(D.isFiniteNumber)(A.startPTS)&&Object(D.isFiniteNumber)(A.endPTS)&&(I.start=I.startPTS=A.startPTS,I.startDTS=A.startDTS,I.appendedPTS=A.appendedPTS,I.maxStartPTS=A.maxStartPTS,I.endPTS=A.endPTS,I.endDTS=A.endDTS,I.minEndPTS=A.minEndPTS,I.duration=A.endPTS-A.startPTS,I.duration&&(p=I),s.PTSKnown=s.alignedSliding=!0),I.elementaryStreams=A.elementaryStreams,I.loader=A.loader,I.stats=A.stats,I.urlId=A.urlId,A.initSegment?(I.initSegment=A.initSegment,l=A.initSegment):I.initSegment&&I.initSegment.relurl!=((w=l)===null||w===void 0?void 0:w.relurl)||(I.initSegment=l)}),s.skippedSegments&&(s.deltaUpdateFailed=s.fragments.some(function(A){return!A}),s.deltaUpdateFailed)){d.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var r=s.skippedSegments;r--;)s.fragments.shift();s.startSN=s.fragments[0].sn,s.startCC=s.fragments[0].cc}var a=s.fragments;if(y){d.logger.warn("discontinuity sliding from playlist, take drift into account");for(var g=0;g<a.length;g++)a[g].cc+=y}s.skippedSegments&&(s.startCC=s.fragments[0].cc),f(t.partList,s.partList,function(A,I){I.elementaryStreams=A.elementaryStreams,I.stats=A.stats}),p?o(s,p,p.startPTS,p.endPTS,p.startDTS,p.endDTS):b(t,s),a.length&&(s.totalduration=s.edge-a[0].start),s.driftStartTime=t.driftStartTime,s.driftStart=t.driftStart;var k=s.advancedDateTime;if(s.advanced&&k){var S=s.edge;s.driftStart||(s.driftStartTime=k,s.driftStart=S),s.driftEndTime=k,s.driftEnd=S}else s.driftEndTime=t.driftEndTime,s.driftEnd=t.driftEnd,s.advancedDateTime=t.advancedDateTime}function f(t,s,l){if(t&&s)for(var n=0,c=0,m=t.length;c<=m;c++){var p=t[c],y=s[c+n];p&&y&&p.index===y.index&&p.fragment.sn===y.fragment.sn?l(p,y):n--}}function v(t,s,l){for(var n=s.skippedSegments,c=Math.max(t.startSN,s.startSN)-s.startSN,m=(t.fragmentHint?1:0)+(n?s.endSN:Math.min(t.endSN,s.endSN))-s.startSN,p=s.startSN-t.startSN,y=s.fragmentHint?s.fragments.concat(s.fragmentHint):s.fragments,r=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,a=c;a<=m;a++){var g=r[p+a],k=y[a];n&&!k&&a<n&&(k=s.fragments[a]=g),g&&k&&l(g,k)}}function b(t,s){var l=s.startSN+s.skippedSegments-t.startSN,n=t.fragments;l<0||l>=n.length||T(s,n[l].start)}function T(t,s){if(s){for(var l=t.fragments,n=t.skippedSegments;n<l.length;n++)l[n].start+=s;t.fragmentHint&&(t.fragmentHint.start+=s)}}function u(t,s){var l,n=1e3*t.levelTargetDuration,c=n/2,m=t.age,p=m>0&&m<3*n,y=s.loading.end-s.loading.start,r=t.availabilityDelay;if(t.updated===!1)if(p){var a=333*t.misses;l=Math.max(Math.min(c,2*y),a),t.availabilityDelay=(t.availabilityDelay||0)+l}else l=c;else p?(r=Math.min(r||n/2,m),t.availabilityDelay=r,l=r+n-m):l=n-y;return Math.round(l)}function e(t,s,l){if(!t||!t.details)return null;var n=t.details,c=n.fragments[s-n.startSN];return c||((c=n.fragmentHint)&&c.sn===s?c:s<n.startSN&&l&&l.sn===s?l:null)}function i(t,s,l){if(!t||!t.details)return null;var n=t.details.partList;if(n)for(var c=n.length;c--;){var m=n[c];if(m.index===l&&m.fragment.sn===s)return m}return null}},"./src/controller/stream-controller.ts":function(P,x,h){h.r(x),h.d(x,"default",function(){return t});var D=h("./src/polyfills/number.ts"),d=h("./src/controller/base-stream-controller.ts"),L=h("./src/is-supported.ts"),_=h("./src/events.ts"),C=h("./src/utils/buffer-helper.ts"),R=h("./src/controller/fragment-tracker.ts"),o=h("./src/types/loader.ts"),E=h("./src/loader/fragment.ts"),f=h("./src/demux/transmuxer-interface.ts"),v=h("./src/types/transmuxer.ts"),b=h("./src/controller/gap-controller.ts"),T=h("./src/errors.ts"),u=h("./src/utils/logger.ts");function e(s,l){for(var n=0;n<l.length;n++){var c=l[n];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(s,c.key,c)}}function i(s,l){return(i=Object.setPrototypeOf||function(n,c){return n.__proto__=c,n})(s,l)}var t=function(s){var l,n;function c(r,a){var g;return(g=s.call(this,r,a,"[stream-controller]")||this).audioCodecSwap=!1,g.gapController=null,g.level=-1,g._forceStartLoad=!1,g.altAudio=!1,g.audioOnly=!1,g.fragPlaying=null,g.onvplaying=null,g.onvseeked=null,g.fragLastKbps=0,g.stalled=!1,g.couldBacktrack=!1,g.audioCodecSwitch=!1,g.videoBuffer=null,g._registerListeners(),g}n=s,(l=c).prototype=Object.create(n.prototype),l.prototype.constructor=l,i(l,n);var m,p,y=c.prototype;return y._registerListeners=function(){var r=this.hls;r.on(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(_.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.on(_.Events.LEVEL_LOADING,this.onLevelLoading,this),r.on(_.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.on(_.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),r.on(_.Events.ERROR,this.onError,this),r.on(_.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.on(_.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),r.on(_.Events.BUFFER_CREATED,this.onBufferCreated,this),r.on(_.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.on(_.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),r.on(_.Events.FRAG_BUFFERED,this.onFragBuffered,this)},y._unregisterListeners=function(){var r=this.hls;r.off(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(_.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.off(_.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.off(_.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),r.off(_.Events.ERROR,this.onError,this),r.off(_.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.off(_.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),r.off(_.Events.BUFFER_CREATED,this.onBufferCreated,this),r.off(_.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.off(_.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),r.off(_.Events.FRAG_BUFFERED,this.onFragBuffered,this)},y.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},y.startLoad=function(r){if(this.levels){var a=this.lastCurrentTime,g=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var k=g.startLevel;k===-1&&(g.config.testBandwidth?(k=0,this.bitrateTest=!0):k=g.nextAutoLevel),this.level=g.nextLoadLevel=k,this.loadedmetadata=!1}a>0&&r===-1&&(this.log("Override startPosition with lastCurrentTime @"+a.toFixed(3)),r=a),this.state=d.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=r,this.tick()}else this._forceStartLoad=!0,this.state=d.State.STOPPED},y.stopLoad=function(){this._forceStartLoad=!1,s.prototype.stopLoad.call(this)},y.doTick=function(){switch(this.state){case d.State.IDLE:this.doTickIdle();break;case d.State.WAITING_LEVEL:var r,a=this.levels,g=this.level,k=a==null||(r=a[g])===null||r===void 0?void 0:r.details;if(k&&(!k.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(k))break;this.state=d.State.IDLE;break}break;case d.State.FRAG_LOADING_WAITING_RETRY:var S,A=self.performance.now(),I=this.retryDate;(!I||A>=I||(S=this.media)!==null&&S!==void 0&&S.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=d.State.IDLE)}this.onTickEnd()},y.onTickEnd=function(){s.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},y.doTickIdle=function(){var r,a,g=this.hls,k=this.levelLastLoaded,S=this.levels,A=this.media,I=g.config,w=g.nextLoadLevel;if(k!==null&&(A||!this.startFragRequested&&I.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&S&&S[w]){var O=S[w];this.level=g.nextLoadLevel=w;var F=O.details;if(!F||this.state===d.State.WAITING_LEVEL||F.live&&this.levelLastLoaded!==w)this.state=d.State.WAITING_LEVEL;else{var M=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:A,o.PlaylistLevelType.MAIN);if(M!==null&&!(M.len>=this.getMaxBufferLength(O.maxBitrate))){if(this._streamEnded(M,F)){var N={};return this.altAudio&&(N.type="video"),this.hls.trigger(_.Events.BUFFER_EOS,N),void(this.state=d.State.ENDED)}var B=M.end,U=this.getNextFragment(B,F);if(this.couldBacktrack&&!this.fragPrevious&&U&&U.sn!=="initSegment"){var j=U.sn-F.startSN;j>1&&(U=F.fragments[j-1],this.fragmentTracker.removeFragment(U))}if(U&&this.fragmentTracker.getState(U)===R.FragmentState.OK&&this.nextLoadPosition>B){var W=this.audioOnly&&!this.altAudio?E.ElementaryStreamTypes.AUDIO:E.ElementaryStreamTypes.VIDEO;this.afterBufferFlushed(A,W,o.PlaylistLevelType.MAIN),U=this.getNextFragment(this.nextLoadPosition,F)}U&&(!U.initSegment||U.initSegment.data||this.bitrateTest||(U=U.initSegment),((r=U.decryptdata)===null||r===void 0?void 0:r.keyFormat)!=="identity"||(a=U.decryptdata)!==null&&a!==void 0&&a.key?this.loadFragment(U,F,B):this.loadKey(U,F))}}}},y.loadFragment=function(r,a,g){var k,S=this.fragmentTracker.getState(r);if(this.fragCurrent=r,S===R.FragmentState.BACKTRACKED){var A=this.fragmentTracker.getBacktrackData(r);if(A)return this._handleFragmentLoadProgress(A),void this._handleFragmentLoadComplete(A);S=R.FragmentState.NOT_LOADED}S===R.FragmentState.NOT_LOADED||S===R.FragmentState.PARTIAL?r.sn==="initSegment"?this._loadInitSegment(r):this.bitrateTest?(r.bitrateTest=!0,this.log("Fragment "+r.sn+" of level "+r.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(r)):(this.startFragRequested=!0,s.prototype.loadFragment.call(this,r,a,g)):S===R.FragmentState.APPENDING?this.reduceMaxBufferLength(r.duration)&&this.fragmentTracker.removeFragment(r):((k=this.media)===null||k===void 0?void 0:k.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},y.getAppendedFrag=function(r){var a=this.fragmentTracker.getAppendedFrag(r,o.PlaylistLevelType.MAIN);return a&&"fragment"in a?a.fragment:a},y.getBufferedFrag=function(r){return this.fragmentTracker.getBufferedFrag(r,o.PlaylistLevelType.MAIN)},y.followingBufferedFrag=function(r){return r?this.getBufferedFrag(r.end+.5):null},y.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},y.nextLevelSwitch=function(){var r=this.levels,a=this.media;if(a!=null&&a.readyState){var g,k=this.getAppendedFrag(a.currentTime);if(k&&k.start>1&&this.flushMainBuffer(0,k.start-1),!a.paused&&r){var S=r[this.hls.nextLoadLevel],A=this.fragLastKbps;g=A&&this.fragCurrent?this.fragCurrent.duration*S.maxBitrate/(1e3*A)+1:0}else g=0;var I=this.getBufferedFrag(a.currentTime+g);if(I){var w=this.followingBufferedFrag(I);if(w){this.abortCurrentFrag();var O=w.maxStartPTS?w.maxStartPTS:w.start,F=w.duration,M=Math.max(I.end,O+Math.min(Math.max(F-this.config.maxFragLookUpTolerance,.5*F),.75*F));this.flushMainBuffer(M,Number.POSITIVE_INFINITY)}}}},y.abortCurrentFrag=function(){var r=this.fragCurrent;this.fragCurrent=null,r!=null&&r.loader&&r.loader.abort(),this.state===d.State.KEY_LOADING&&(this.state=d.State.IDLE),this.nextLoadPosition=this.getLoadPosition()},y.flushMainBuffer=function(r,a){s.prototype.flushMainBuffer.call(this,r,a,this.altAudio?"video":null)},y.onMediaAttached=function(r,a){s.prototype.onMediaAttached.call(this,r,a);var g=a.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),g.addEventListener("playing",this.onvplaying),g.addEventListener("seeked",this.onvseeked),this.gapController=new b.default(this.config,g,this.fragmentTracker,this.hls)},y.onMediaDetaching=function(){var r=this.media;r&&(r.removeEventListener("playing",this.onvplaying),r.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),s.prototype.onMediaDetaching.call(this)},y.onMediaPlaying=function(){this.tick()},y.onMediaSeeked=function(){var r=this.media,a=r?r.currentTime:null;Object(D.isFiniteNumber)(a)&&this.log("Media seeked to "+a.toFixed(3)),this.tick()},y.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(_.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=this.stalled=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null},y.onManifestParsed=function(r,a){var g,k=!1,S=!1;a.levels.forEach(function(A){(g=A.audioCodec)&&(g.indexOf("mp4a.40.2")!==-1&&(k=!0),g.indexOf("mp4a.40.5")!==-1&&(S=!0))}),this.audioCodecSwitch=k&&S&&!Object(L.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=a.levels,this.startFragRequested=!1},y.onLevelLoading=function(r,a){var g=this.levels;if(g&&this.state===d.State.IDLE){var k=g[a.level];(!k.details||k.details.live&&this.levelLastLoaded!==a.level||this.waitForCdnTuneIn(k.details))&&(this.state=d.State.WAITING_LEVEL)}},y.onLevelLoaded=function(r,a){var g,k=this.levels,S=a.level,A=a.details,I=A.totalduration;if(k){this.log("Level "+S+" loaded ["+A.startSN+","+A.endSN+"], cc ["+A.startCC+", "+A.endCC+"] duration:"+I);var w=this.fragCurrent;!w||this.state!==d.State.FRAG_LOADING&&this.state!==d.State.FRAG_LOADING_WAITING_RETRY||w.level!==a.level&&w.loader&&(this.state=d.State.IDLE,w.loader.abort());var O=k[S],F=0;if(A.live||(g=O.details)!==null&&g!==void 0&&g.live){if(A.fragments[0]||(A.deltaUpdateFailed=!0),A.deltaUpdateFailed)return;F=this.alignPlaylists(A,O.details)}if(O.details=A,this.levelLastLoaded=S,this.hls.trigger(_.Events.LEVEL_UPDATED,{details:A,level:S}),this.state===d.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(A))return;this.state=d.State.IDLE}this.startFragRequested?A.live&&this.synchronizeToLiveEdge(A):this.setStartPosition(A,F),this.tick()}else this.warn("Levels were reset while loading level "+S)},y._handleFragmentLoadProgress=function(r){var a,g=r.frag,k=r.part,S=r.payload,A=this.levels;if(A){var I=A[g.level],w=I.details;if(w){var O=I.videoCodec,F=w.PTSKnown||!w.live,M=(a=g.initSegment)===null||a===void 0?void 0:a.data,N=this._getAudioCodec(I),B=this.transmuxer=this.transmuxer||new f.default(this.hls,o.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),U=k?k.index:-1,j=U!==-1,W=new v.ChunkMetadata(g.level,g.sn,g.stats.chunkCount,S.byteLength,U,j),$=this.initPTS[g.cc];B.push(S,M,N,O,g,k,w.totalduration,F,W,$)}else this.warn("Dropping fragment "+g.sn+" of level "+g.level+" after level details were reset")}else this.warn("Levels were reset while fragment load was in progress. Fragment "+g.sn+" of level "+g.level+" will not be buffered")},y.onAudioTrackSwitching=function(r,a){var g=this.altAudio,k=!!a.url,S=a.id;if(!k){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var A=this.fragCurrent;A!=null&&A.loader&&(this.log("Switching to main audio track, cancel main fragment load"),A.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var I=this.hls;g&&I.trigger(_.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),I.trigger(_.Events.AUDIO_TRACK_SWITCHED,{id:S})}},y.onAudioTrackSwitched=function(r,a){var g=a.id,k=!!this.hls.audioTracks[g].url;if(k){var S=this.videoBuffer;S&&this.mediaBuffer!==S&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=S)}this.altAudio=k,this.tick()},y.onBufferCreated=function(r,a){var g,k,S=a.tracks,A=!1;for(var I in S){var w=S[I];if(w.id==="main"){if(k=I,g=w,I==="video"){var O=S[I];O&&(this.videoBuffer=O.buffer)}}else A=!0}A&&g?(this.log("Alternate track found, use "+k+".buffered to schedule main fragment loading"),this.mediaBuffer=g.buffer):this.mediaBuffer=this.media},y.onFragBuffered=function(r,a){var g=a.frag,k=a.part;if(!g||g.type===o.PlaylistLevelType.MAIN){if(this.fragContextChanged(g))return this.warn("Fragment "+g.sn+(k?" p: "+k.index:"")+" of level "+g.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===d.State.PARSED&&(this.state=d.State.IDLE));var S=k?k.stats:g.stats;this.fragLastKbps=Math.round(8*S.total/(S.buffering.end-S.loading.first)),g.sn!=="initSegment"&&(this.fragPrevious=g),this.fragBufferedComplete(g,k)}},y.onError=function(r,a){switch(a.details){case T.ErrorDetails.FRAG_LOAD_ERROR:case T.ErrorDetails.FRAG_LOAD_TIMEOUT:case T.ErrorDetails.KEY_LOAD_ERROR:case T.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(o.PlaylistLevelType.MAIN,a);break;case T.ErrorDetails.LEVEL_LOAD_ERROR:case T.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==d.State.ERROR&&(a.fatal?(this.warn(""+a.details),this.state=d.State.ERROR):a.levelRetry||this.state!==d.State.WAITING_LEVEL||(this.state=d.State.IDLE));break;case T.ErrorDetails.BUFFER_FULL_ERROR:if(a.parent==="main"&&(this.state===d.State.PARSING||this.state===d.State.PARSED)){var g=!0,k=this.getFwdBufferInfo(this.media,o.PlaylistLevelType.MAIN);k&&k.len>.5&&(g=!this.reduceMaxBufferLength(k.len)),g&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}}},y.checkBuffer=function(){var r=this.media,a=this.gapController;if(r&&a&&r.readyState){var g=C.BufferHelper.getBuffered(r);!this.loadedmetadata&&g.length?(this.loadedmetadata=!0,this.seekToStartPos()):a.poll(this.lastCurrentTime),this.lastCurrentTime=r.currentTime}},y.onFragLoadEmergencyAborted=function(){this.state=d.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},y.onBufferFlushed=function(r,a){var g=a.type;if(g!==E.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var k=(g===E.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(k,g,o.PlaylistLevelType.MAIN)}},y.onLevelsUpdated=function(r,a){this.levels=a.levels},y.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},y.seekToStartPos=function(){var r=this.media,a=r.currentTime,g=this.startPosition;if(g>=0&&a<g){if(r.seeking)return void u.logger.log("could not seek to "+g+", already seeking at "+a);var k=C.BufferHelper.getBuffered(r),S=(k.length?k.start(0):0)-g;S>0&&S<this.config.maxBufferHole&&(u.logger.log("adjusting start position by "+S+" to match buffer start"),g+=S,this.startPosition=g),this.log("seek to target start position "+g+" from current time "+a),r.currentTime=g}},y._getAudioCodec=function(r){var a=this.config.defaultAudioCodec||r.audioCodec;return this.audioCodecSwap&&a&&(this.log("Swapping audio codec"),a=a.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),a},y._loadBitrateTestFrag=function(r){var a=this;this._doFragLoad(r).then(function(g){var k=a.hls;if(g&&!k.nextLoadLevel&&!a.fragContextChanged(r)){a.fragLoadError=0,a.state=d.State.IDLE,a.startFragRequested=!1,a.bitrateTest=!1;var S=r.stats;S.parsing.start=S.parsing.end=S.buffering.start=S.buffering.end=self.performance.now(),k.trigger(_.Events.FRAG_LOADED,g)}})},y._handleTransmuxComplete=function(r){var a,g="main",k=this.hls,S=r.remuxResult,A=r.chunkMeta,I=this.getCurrentContext(A);if(!I)return this.warn("The loading context changed while buffering fragment "+A.sn+" of level "+A.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(A.level);var w=I.frag,O=I.part,F=I.level,M=S.video,N=S.text,B=S.id3,U=S.initSegment,j=this.altAudio?void 0:S.audio;if(!this.fragContextChanged(w)){if(this.state=d.State.PARSING,U){U.tracks&&(this._bufferInitSegment(F,U.tracks,w,A),k.trigger(_.Events.FRAG_PARSING_INIT_SEGMENT,{frag:w,id:g,tracks:U.tracks}));var W=U.initPTS,$=U.timescale;Object(D.isFiniteNumber)(W)&&(this.initPTS[w.cc]=W,k.trigger(_.Events.INIT_PTS_FOUND,{frag:w,id:g,initPTS:W,timescale:$}))}if(M&&S.independent!==!1){if(F.details){var X=M.startPTS,Y=M.endPTS,Z=M.startDTS,ue=M.endDTS;if(O)O.elementaryStreams[M.type]={startPTS:X,endPTS:Y,startDTS:Z,endDTS:ue};else if(M.firstKeyFrame&&M.independent&&(this.couldBacktrack=!0),M.dropped&&M.independent){if(this.getLoadPosition()+this.config.maxBufferHole<X)return void this.backtrack(w);w.setElementaryStreamInfo(M.type,w.start,Y,w.start,ue,!0)}w.setElementaryStreamInfo(M.type,X,Y,Z,ue),this.bufferFragmentData(M,w,O,A)}}else if(S.independent===!1)return void this.backtrack(w);if(j){var ce=j.startPTS,ge=j.endPTS,ie=j.startDTS,he=j.endDTS;O&&(O.elementaryStreams[E.ElementaryStreamTypes.AUDIO]={startPTS:ce,endPTS:ge,startDTS:ie,endDTS:he}),w.setElementaryStreamInfo(E.ElementaryStreamTypes.AUDIO,ce,ge,ie,he),this.bufferFragmentData(j,w,O,A)}if(B!=null&&(a=B.samples)!==null&&a!==void 0&&a.length){var se={frag:w,id:g,samples:B.samples};k.trigger(_.Events.FRAG_PARSING_METADATA,se)}if(N){var oe={frag:w,id:g,samples:N.samples};k.trigger(_.Events.FRAG_PARSING_USERDATA,oe)}}},y._bufferInitSegment=function(r,a,g,k){var S=this;if(this.state===d.State.PARSING){this.audioOnly=!!a.audio&&!a.video,this.altAudio&&!this.audioOnly&&delete a.audio;var A=a.audio,I=a.video,w=a.audiovideo;if(A){var O=r.audioCodec,F=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(O&&(O=O.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),A.metadata.channelCount!==1&&F.indexOf("firefox")===-1&&(O="mp4a.40.5")),F.indexOf("android")!==-1&&A.container!=="audio/mpeg"&&(O="mp4a.40.2",this.log("Android: force audio codec to "+O)),r.audioCodec&&r.audioCodec!==O&&this.log('Swapping manifest audio codec "'+r.audioCodec+'" for "'+O+'"'),A.levelCodec=O,A.id="main",this.log("Init audio buffer, container:"+A.container+", codecs[selected/level/parsed]=["+(O||"")+"/"+(r.audioCodec||"")+"/"+A.codec+"]")}I&&(I.levelCodec=r.videoCodec,I.id="main",this.log("Init video buffer, container:"+I.container+", codecs[level/parsed]=["+(r.videoCodec||"")+"/"+I.codec+"]")),w&&this.log("Init audiovideo buffer, container:"+w.container+", codecs[level/parsed]=["+(r.attrs.CODECS||"")+"/"+w.codec+"]"),this.hls.trigger(_.Events.BUFFER_CODECS,a),Object.keys(a).forEach(function(M){var N=a[M].initSegment;N!=null&&N.byteLength&&S.hls.trigger(_.Events.BUFFER_APPENDING,{type:M,data:N,frag:g,part:null,chunkMeta:k,parent:g.type})}),this.tick()}},y.backtrack=function(r){this.couldBacktrack=!0,this.resetTransmuxer(),this.flushBufferGap(r);var a=this.fragmentTracker.backtrack(r);this.fragPrevious=null,this.nextLoadPosition=r.start,a?this.resetFragmentLoading(r):this.state=d.State.BACKTRACKING},y.checkFragmentChanged=function(){var r=this.media,a=null;if(r&&r.readyState>1&&r.seeking===!1){var g=r.currentTime;if(C.BufferHelper.isBuffered(r,g)?a=this.getAppendedFrag(g):C.BufferHelper.isBuffered(r,g+.1)&&(a=this.getAppendedFrag(g+.1)),a){var k=this.fragPlaying,S=a.level;k&&a.sn===k.sn&&k.level===S&&a.urlId===k.urlId||(this.hls.trigger(_.Events.FRAG_CHANGED,{frag:a}),k&&k.level===S||this.hls.trigger(_.Events.LEVEL_SWITCHED,{level:S}),this.fragPlaying=a)}}},m=c,(p=[{key:"nextLevel",get:function(){var r=this.nextBufferedFrag;return r?r.level:-1}},{key:"currentLevel",get:function(){var r=this.media;if(r){var a=this.getAppendedFrag(r.currentTime);if(a)return a.level}return-1}},{key:"nextBufferedFrag",get:function(){var r=this.media;if(r){var a=this.getAppendedFrag(r.currentTime);return this.followingBufferedFrag(a)}return null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}])&&e(m.prototype,p),c}(d.default)},"./src/controller/subtitle-stream-controller.ts":function(P,x,h){h.r(x),h.d(x,"SubtitleStreamController",function(){return u});var D=h("./src/events.ts"),d=h("./src/utils/logger.ts"),L=h("./src/utils/buffer-helper.ts"),_=h("./src/controller/fragment-finders.ts"),C=h("./src/utils/discontinuities.ts"),R=h("./src/controller/level-helper.ts"),o=h("./src/controller/fragment-tracker.ts"),E=h("./src/controller/base-stream-controller.ts"),f=h("./src/types/loader.ts"),v=h("./src/types/level.ts");function b(e,i){for(var t=0;t<i.length;t++){var s=i[t];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function T(e,i){return(T=Object.setPrototypeOf||function(t,s){return t.__proto__=s,t})(e,i)}var u=function(e){var i,t;function s(m,p){var y;return(y=e.call(this,m,p,"[subtitle-stream-controller]")||this).levels=[],y.currentTrackId=-1,y.tracksBuffered=[],y.mainDetails=null,y._registerListeners(),y}t=e,(i=s).prototype=Object.create(t.prototype),i.prototype.constructor=i,T(i,t);var l,n,c=s.prototype;return c.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},c._registerListeners=function(){var m=this.hls;m.on(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),m.on(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),m.on(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),m.on(D.Events.LEVEL_LOADED,this.onLevelLoaded,this),m.on(D.Events.ERROR,this.onError,this),m.on(D.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),m.on(D.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),m.on(D.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),m.on(D.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),m.on(D.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},c._unregisterListeners=function(){var m=this.hls;m.off(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),m.off(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),m.off(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),m.off(D.Events.LEVEL_LOADED,this.onLevelLoaded,this),m.off(D.Events.ERROR,this.onError,this),m.off(D.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),m.off(D.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),m.off(D.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),m.off(D.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),m.off(D.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},c.startLoad=function(){this.stopLoad(),this.state=E.State.IDLE,this.setInterval(500),this.tick()},c.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},c.onLevelLoaded=function(m,p){this.mainDetails=p.details},c.onSubtitleFragProcessed=function(m,p){var y=p.frag,r=p.success;if(this.fragPrevious=y,this.state=E.State.IDLE,r){var a=this.tracksBuffered[this.currentTrackId];if(a){for(var g,k=y.start,S=0;S<a.length;S++)if(k>=a[S].start&&k<=a[S].end){g=a[S];break}var A=y.start+y.duration;g?g.end=A:(g={start:k,end:A},a.push(g)),this.fragmentTracker.fragBuffered(y)}}},c.onBufferFlushing=function(m,p){var y=p.startOffset,r=p.endOffset;if(y===0&&r!==Number.POSITIVE_INFINITY){var a=this.currentTrackId,g=this.levels;if(!g.length||!g[a]||!g[a].details)return;var k=r-g[a].details.targetduration;if(k<=0)return;p.endOffsetSubtitles=Math.max(0,k),this.tracksBuffered.forEach(function(S){for(var A=0;A<S.length;)if(S[A].end<=k)S.shift();else{if(!(S[A].start<k))break;S[A].start=k,A++}}),this.fragmentTracker.removeFragmentsInRange(y,k,f.PlaylistLevelType.SUBTITLE)}},c.onError=function(m,p){var y,r=p.frag;r&&r.type===f.PlaylistLevelType.SUBTITLE&&((y=this.fragCurrent)!==null&&y!==void 0&&y.loader&&this.fragCurrent.loader.abort(),this.state=E.State.IDLE)},c.onSubtitleTracksUpdated=function(m,p){var y=this,r=p.subtitleTracks;this.tracksBuffered=[],this.levels=r.map(function(a){return new v.Level(a)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(a){y.tracksBuffered[a.id]=[]}),this.mediaBuffer=null},c.onSubtitleTrackSwitch=function(m,p){if(this.currentTrackId=p.id,this.levels.length&&this.currentTrackId!==-1){var y=this.levels[this.currentTrackId];y!=null&&y.details?(this.mediaBuffer=this.mediaBufferTimeRanges,this.setInterval(500)):this.mediaBuffer=null}else this.clearInterval()},c.onSubtitleTrackLoaded=function(m,p){var y,r=p.details,a=p.id,g=this.currentTrackId,k=this.levels;if(k.length){var S=k[g];if(!(a>=k.length||a!==g)&&S){if(this.mediaBuffer=this.mediaBufferTimeRanges,r.live||(y=S.details)!==null&&y!==void 0&&y.live){var A=this.mainDetails;if(r.deltaUpdateFailed||!A)return;var I=A.fragments[0];S.details?this.alignPlaylists(r,S.details)===0&&I&&Object(R.addSliding)(r,I.start):r.hasProgramDateTime&&A.hasProgramDateTime?Object(C.alignPDT)(r,A):I&&Object(R.addSliding)(r,I.start)}S.details=r,this.levelLastLoaded=a,this.tick(),r.live&&!this.fragCurrent&&this.media&&this.state===E.State.IDLE&&(Object(_.findFragmentByPTS)(null,r.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),S.details=void 0))}}},c._handleFragmentLoadComplete=function(m){var p=m.frag,y=m.payload,r=p.decryptdata,a=this.hls;if(!this.fragContextChanged(p)&&y&&y.byteLength>0&&r&&r.key&&r.iv&&r.method==="AES-128"){var g=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(y),r.key.buffer,r.iv.buffer).then(function(k){var S=performance.now();a.trigger(D.Events.FRAG_DECRYPTED,{frag:p,payload:k,stats:{tstart:g,tdecrypt:S}})})}},c.doTick=function(){if(this.media){if(this.state===E.State.IDLE){var m,p=this.currentTrackId,y=this.levels;if(!y.length||!y[p]||!y[p].details)return;var r=y[p].details,a=r.targetduration,g=this.config,k=this.media,S=L.BufferHelper.bufferedInfo(this.mediaBufferTimeRanges,k.currentTime-a,g.maxBufferHole),A=S.end;if(S.len>this.getMaxBufferLength()+a)return;console.assert(r,"Subtitle track details are defined on idle subtitle stream controller tick");var I,w=r.fragments,O=w.length,F=r.edge,M=this.fragPrevious;if(A<F){var N=g.maxFragLookUpTolerance;M&&r.hasProgramDateTime&&(I=Object(_.findFragmentByPDT)(w,M.endProgramDateTime,N)),I||!(I=Object(_.findFragmentByPTS)(M,w,A,N))&&M&&M.start<w[0].start&&(I=w[0])}else I=w[O-1];(m=I)!==null&&m!==void 0&&m.encrypted?(d.logger.log("Loading key for "+I.sn),this.state=E.State.KEY_LOADING,this.hls.trigger(D.Events.KEY_LOADING,{frag:I})):I&&this.fragmentTracker.getState(I)===o.FragmentState.NOT_LOADED&&this.loadFragment(I,r,A)}}else this.state=E.State.IDLE},c.loadFragment=function(m,p,y){this.fragCurrent=m,e.prototype.loadFragment.call(this,m,p,y)},l=s,(n=[{key:"mediaBufferTimeRanges",get:function(){return this.tracksBuffered[this.currentTrackId]||[]}}])&&b(l.prototype,n),s}(E.default)},"./src/controller/subtitle-track-controller.ts":function(P,x,h){h.r(x);var D=h("./src/events.ts"),d=h("./src/utils/texttrack-utils.ts"),L=h("./src/controller/base-playlist-controller.ts"),_=h("./src/types/loader.ts");function C(f,v){for(var b=0;b<v.length;b++){var T=v[b];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(f,T.key,T)}}function R(f,v){return(R=Object.setPrototypeOf||function(b,T){return b.__proto__=T,b})(f,v)}var o=function(f){var v,b;function T(t){var s;return(s=f.call(this,t,"[subtitle-track-controller]")||this).media=null,s.tracks=[],s.groupId=null,s.tracksInGroup=[],s.trackId=-1,s.selectDefaultTrack=!0,s.queuedDefaultTrack=-1,s.trackChangeListener=function(){return s.onTextTracksChanged()},s.asyncPollTrackChange=function(){return s.pollTrackChange(0)},s.useTextTrackPolling=!1,s.subtitlePollingInterval=-1,s.subtitleDisplay=!0,s.registerListeners(),s}b=f,(v=T).prototype=Object.create(b.prototype),v.prototype.constructor=v,R(v,b);var u,e,i=T.prototype;return i.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,f.prototype.destroy.call(this)},i.registerListeners=function(){var t=this.hls;t.on(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(D.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(D.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(D.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(D.Events.ERROR,this.onError,this)},i.unregisterListeners=function(){var t=this.hls;t.off(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(D.Events.LEVEL_LOADING,this.onLevelLoading,this),t.off(D.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(D.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(D.Events.ERROR,this.onError,this)},i.onMediaAttached=function(t,s){this.media=s.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},i.pollTrackChange=function(t){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,t)},i.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),E(this.media.textTracks).forEach(function(t){Object(d.clearCurrentCues)(t)}),this.subtitleTrack=-1,this.media=null)},i.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},i.onManifestParsed=function(t,s){this.tracks=s.subtitleTracks},i.onSubtitleTrackLoaded=function(t,s){var l=s.id,n=s.details,c=this.trackId,m=this.tracksInGroup[c];if(m){var p=m.details;m.details=s.details,this.log("subtitle track "+l+" loaded ["+n.startSN+"-"+n.endSN+"]"),l===this.trackId&&(this.retryCount=0,this.playlistLoaded(l,s,p))}else this.warn("Invalid subtitle track id "+l)},i.onLevelLoading=function(t,s){this.switchLevel(s.level)},i.onLevelSwitching=function(t,s){this.switchLevel(s.level)},i.switchLevel=function(t){var s=this.hls.levels[t];if(s!=null&&s.textGroupIds){var l=s.textGroupIds[s.urlId];if(this.groupId!==l){var n=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,c=this.tracks.filter(function(y){return!l||y.groupId===l});this.tracksInGroup=c;var m=this.findTrackId(n==null?void 0:n.name)||this.findTrackId();this.groupId=l;var p={subtitleTracks:c};this.log("Updating subtitle tracks, "+c.length+' track(s) found in "'+l+'" group-id'),this.hls.trigger(D.Events.SUBTITLE_TRACKS_UPDATED,p),m!==-1&&this.setSubtitleTrack(m,n)}}},i.findTrackId=function(t){for(var s=this.tracksInGroup,l=0;l<s.length;l++){var n=s[l];if((!this.selectDefaultTrack||n.default)&&(!t||t===n.name))return n.id}return-1},i.onError=function(t,s){f.prototype.onError.call(this,t,s),!s.fatal&&s.context&&s.context.type===_.PlaylistContextType.SUBTITLE_TRACK&&s.context.id===this.trackId&&s.context.groupId===this.groupId&&this.retryLoadingOrFail(s)},i.loadPlaylist=function(t){var s=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(s)){var l=s.id,n=s.groupId,c=s.url;if(t)try{c=t.addDirectives(c)}catch(m){this.warn("Could not construct new URL with HLS Delivery Directives: "+m)}this.log("Loading subtitle playlist for id "+l),this.hls.trigger(D.Events.SUBTITLE_TRACK_LOADING,{url:c,id:l,groupId:n,deliveryDirectives:t||null})}},i.toggleTrackModes=function(t){var s=this,l=this.media,n=this.subtitleDisplay,c=this.trackId;if(l){var m=E(l.textTracks),p=m.filter(function(a){return a.groupId===s.groupId});if(t===-1)[].slice.call(m).forEach(function(a){a.mode="disabled"});else{var y=p[c];y&&(y.mode="disabled")}var r=p[t];r&&(r.mode=n?"showing":"hidden")}},i.setSubtitleTrack=function(t,s){var l,n=this.tracksInGroup;if(this.media){if(this.trackId!==t&&this.toggleTrackModes(t),!(this.trackId===t&&(t===-1||(l=n[t])!==null&&l!==void 0&&l.details)||t<-1||t>=n.length)){this.clearTimer();var c=n[t];if(this.log("Switching to subtitle track "+t),this.trackId=t,c){var m=c.id,p=c.groupId,y=p===void 0?"":p,r=c.name,a=c.type,g=c.url;this.hls.trigger(D.Events.SUBTITLE_TRACK_SWITCH,{id:m,groupId:y,name:r,type:a,url:g});var k=this.switchParams(c.url,s==null?void 0:s.details);this.loadPlaylist(k)}else this.hls.trigger(D.Events.SUBTITLE_TRACK_SWITCH,{id:t})}}else this.queuedDefaultTrack=t},i.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var t=-1,s=E(this.media.textTracks),l=0;l<s.length;l++)if(s[l].mode==="hidden")t=l;else if(s[l].mode==="showing"){t=l;break}this.subtitleTrack!==t&&(this.subtitleTrack=t)}},u=T,(e=[{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(t){this.selectDefaultTrack=!1;var s=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(t,s)}}])&&C(u.prototype,e),T}(L.default);function E(f){for(var v=[],b=0;b<f.length;b++){var T=f[b];T.kind==="subtitles"&&T.label&&v.push(f[b])}return v}x.default=o},"./src/controller/timeline-controller.ts":function(P,x,h){h.r(x),h.d(x,"TimelineController",function(){return v});var D=h("./src/polyfills/number.ts"),d=h("./src/events.ts"),L=h("./src/utils/cea-608-parser.ts"),_=h("./src/utils/output-filter.ts"),C=h("./src/utils/webvtt-parser.ts"),R=h("./src/utils/texttrack-utils.ts"),o=h("./src/utils/imsc1-ttml-parser.ts"),E=h("./src/types/loader.ts"),f=h("./src/utils/logger.ts"),v=function(){function T(e){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var i=new _.default(this,"textTrack1"),t=new _.default(this,"textTrack2"),s=new _.default(this,"textTrack3"),l=new _.default(this,"textTrack4");this.cea608Parser1=new L.default(1,i,t),this.cea608Parser2=new L.default(3,s,l)}e.on(d.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(d.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(d.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(d.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(d.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(d.Events.FRAG_LOADING,this.onFragLoading,this),e.on(d.Events.FRAG_LOADED,this.onFragLoaded,this),e.on(d.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(d.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(d.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(d.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(d.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var u=T.prototype;return u.destroy=function(){var e=this.hls;e.off(d.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(d.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(d.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(d.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(d.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(d.Events.FRAG_LOADING,this.onFragLoading,this),e.off(d.Events.FRAG_LOADED,this.onFragLoaded,this),e.off(d.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(d.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(d.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(d.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(d.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},u.addCues=function(e,i,t,s,l){for(var n,c,m,p,y=!1,r=l.length;r--;){var a=l[r],g=(n=a[0],c=a[1],m=i,p=t,Math.min(c,p)-Math.max(n,m));if(g>=0&&(a[0]=Math.min(a[0],i),a[1]=Math.max(a[1],t),y=!0,g/(t-i)>.5))return}if(y||l.push([i,t]),this.config.renderTextTracksNatively){var k=this.captionsTracks[e];this.Cues.newCue(k,i,t,s)}else{var S=this.Cues.newCue(null,i,t,s);this.hls.trigger(d.Events.CUES_PARSED,{type:"captions",cues:S,track:e})}},u.onInitPtsFound=function(e,i){var t=this,s=i.frag,l=i.id,n=i.initPTS,c=i.timescale,m=this.unparsedVttFrags;l==="main"&&(this.initPTS[s.cc]=n,this.timescale[s.cc]=c),m.length&&(this.unparsedVttFrags=[],m.forEach(function(p){t.onFragLoaded(d.Events.FRAG_LOADED,p)}))},u.getExistingTrack=function(e){var i=this.media;if(i)for(var t=0;t<i.textTracks.length;t++){var s=i.textTracks[t];if(s[e])return s}return null},u.createCaptionsTrack=function(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)},u.createNativeTrack=function(e){if(!this.captionsTracks[e]){var i=this.captionsProperties,t=this.captionsTracks,s=this.media,l=i[e],n=l.label,c=l.languageCode,m=this.getExistingTrack(e);if(m)t[e]=m,Object(R.clearCurrentCues)(t[e]),Object(R.sendAddTrackEvent)(t[e],s);else{var p=this.createTextTrack("captions",n,c);p&&(p[e]=!0,t[e]=p)}}},u.createNonNativeTrack=function(e){if(!this.nonNativeCaptionsTracks[e]){var i=this.captionsProperties[e];if(i){var t={_id:e,label:i.label,kind:"captions",default:!!i.media&&!!i.media.default,closedCaptions:i.media};this.nonNativeCaptionsTracks[e]=t,this.hls.trigger(d.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[t]})}}},u.createTextTrack=function(e,i,t){var s=this.media;if(s)return s.addTextTrack(e,i,t)},u.onMediaAttaching=function(e,i){this.media=i.media,this._cleanTracks()},u.onMediaDetaching=function(){var e=this.captionsTracks;Object.keys(e).forEach(function(i){Object(R.clearCurrentCues)(e[i]),delete e[i]}),this.nonNativeCaptionsTracks={}},u.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},u._cleanTracks=function(){var e=this.media;if(e){var i=e.textTracks;if(i)for(var t=0;t<i.length;t++)Object(R.clearCurrentCues)(i[t])}},u.onSubtitleTracksUpdated=function(e,i){var t=this;this.textTracks=[];var s=i.subtitleTracks||[],l=s.some(function(p){return p.textCodec===o.IMSC1_CODEC});if(this.config.enableWebVTT||l&&this.config.enableIMSC1){var n=this.tracks&&s&&this.tracks.length===s.length;if(this.tracks=s||[],this.config.renderTextTracksNatively){var c=this.media?this.media.textTracks:[];this.tracks.forEach(function(p,y){var r;if(y<c.length){for(var a=null,g=0;g<c.length;g++)if(b(c[g],p)){a=c[g];break}a&&(r=a)}r?Object(R.clearCurrentCues)(r):(r=t.createTextTrack("subtitles",p.name,p.lang))&&(r.mode="disabled"),r&&(r.groupId=p.groupId,t.textTracks.push(r))})}else if(!n&&this.tracks&&this.tracks.length){var m=this.tracks.map(function(p){return{label:p.name,kind:p.type.toLowerCase(),default:p.default,subtitleTrack:p}});this.hls.trigger(d.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:m})}}},u.onManifestLoaded=function(e,i){var t=this;this.config.enableCEA708Captions&&i.captions&&i.captions.forEach(function(s){var l=/(?:CC|SERVICE)([1-4])/.exec(s.instreamId);if(l){var n="textTrack"+l[1],c=t.captionsProperties[n];c&&(c.label=s.name,s.lang&&(c.languageCode=s.lang),c.media=s)}})},u.onFragLoading=function(e,i){var t=this.cea608Parser1,s=this.cea608Parser2,l=this.lastSn;if(this.enabled&&t&&s&&i.frag.type===E.PlaylistLevelType.MAIN){var n=i.frag.sn;n!==l+1&&(t.reset(),s.reset()),this.lastSn=n}},u.onFragLoaded=function(e,i){var t=i.frag,s=i.payload,l=this.initPTS,n=this.unparsedVttFrags;if(t.type===E.PlaylistLevelType.SUBTITLE)if(s.byteLength){if(!Object(D.isFiniteNumber)(l[t.cc]))return n.push(i),void(l.length&&this.hls.trigger(d.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:new Error("Missing initial subtitle PTS")}));var c=t.decryptdata;if(c==null||c.key==null||c.method!=="AES-128"){var m=this.tracks[t.level],p=this.vttCCs;p[t.cc]||(p[t.cc]={start:t.start,prevCC:this.prevCC,new:!0},this.prevCC=t.cc),m&&m.textCodec===o.IMSC1_CODEC?this._parseIMSC1(t,s):this._parseVTTs(t,s,p)}}else this.hls.trigger(d.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:new Error("Empty subtitle payload")})},u._parseIMSC1=function(e,i){var t=this,s=this.hls;Object(o.parseIMSC1)(i,this.initPTS[e.cc],this.timescale[e.cc],function(l){t._appendCues(l,e.level),s.trigger(d.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(l){f.logger.log("Failed to parse IMSC1: "+l),s.trigger(d.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:l})})},u._parseVTTs=function(e,i,t){var s=this,l=this.hls;Object(C.parseWebVTT)(i,this.initPTS[e.cc],this.timescale[e.cc],t,e.cc,e.start,function(n){s._appendCues(n,e.level),l.trigger(d.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(n){s._fallbackToIMSC1(e,i),f.logger.log("Failed to parse VTT cue: "+n),l.trigger(d.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:n})})},u._fallbackToIMSC1=function(e,i){var t=this,s=this.tracks[e.level];s.textCodec||Object(o.parseIMSC1)(i,this.initPTS[e.cc],this.timescale[e.cc],function(){s.textCodec=o.IMSC1_CODEC,t._parseIMSC1(e,i)},function(){s.textCodec="wvtt"})},u._appendCues=function(e,i){var t=this.hls;if(this.config.renderTextTracksNatively){var s=this.textTracks[i];if(s.mode==="disabled")return;e.forEach(function(n){return Object(R.addCueToTrack)(s,n)})}else{var l=this.tracks[i].default?"default":"subtitles"+i;t.trigger(d.Events.CUES_PARSED,{type:"subtitles",cues:e,track:l})}},u.onFragDecrypted=function(e,i){var t=i.frag;if(t.type===E.PlaylistLevelType.SUBTITLE){if(!Object(D.isFiniteNumber)(this.initPTS[t.cc]))return void this.unparsedVttFrags.push(i);this.onFragLoaded(d.Events.FRAG_LOADED,i)}},u.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},u.onFragParsingUserdata=function(e,i){var t=this.cea608Parser1,s=this.cea608Parser2;if(this.enabled&&t&&s)for(var l=0;l<i.samples.length;l++){var n=i.samples[l].bytes;if(n){var c=this.extractCea608Data(n);t.addData(i.samples[l].pts,c[0]),s.addData(i.samples[l].pts,c[1])}}},u.onBufferFlushing=function(e,i){var t=i.startOffset,s=i.endOffset,l=i.endOffsetSubtitles,n=i.type,c=this.media;if(c&&!(c.currentTime<s)){if(!n||n==="video"){var m=this.captionsTracks;Object.keys(m).forEach(function(y){return Object(R.removeCuesInRange)(m[y],t,s)})}if(this.config.renderTextTracksNatively&&t===0&&l!==void 0){var p=this.textTracks;Object.keys(p).forEach(function(y){return Object(R.removeCuesInRange)(p[y],t,l)})}}},u.extractCea608Data=function(e){for(var i=31&e[0],t=2,s=[[],[]],l=0;l<i;l++){var n=e[t++],c=127&e[t++],m=127&e[t++],p=3&n;c===0&&m===0||(4&n)!=0&&(p!==0&&p!==1||(s[p].push(c),s[p].push(m)))}return s},T}();function b(T,u){return T&&T.label===u.name&&!(T.textTrack1||T.textTrack2)}},"./src/crypt/aes-crypto.ts":function(P,x,h){h.r(x),h.d(x,"default",function(){return D});var D=function(){function d(L,_){this.subtle=void 0,this.aesIV=void 0,this.subtle=L,this.aesIV=_}return d.prototype.decrypt=function(L,_){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},_,L)},d}()},"./src/crypt/aes-decryptor.ts":function(P,x,h){h.r(x),h.d(x,"removePadding",function(){return d}),h.d(x,"default",function(){return L});var D=h("./src/utils/typed-array.ts");function d(_){var C=_.byteLength,R=C&&new DataView(_.buffer).getUint8(C-1);return R?Object(D.sliceUint8)(_,0,C-R):_}var L=function(){function _(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var C=_.prototype;return C.uint8ArrayToUint32Array_=function(R){for(var o=new DataView(R),E=new Uint32Array(4),f=0;f<4;f++)E[f]=o.getUint32(4*f);return E},C.initTable=function(){var R=this.sBox,o=this.invSBox,E=this.subMix,f=E[0],v=E[1],b=E[2],T=E[3],u=this.invSubMix,e=u[0],i=u[1],t=u[2],s=u[3],l=new Uint32Array(256),n=0,c=0,m=0;for(m=0;m<256;m++)l[m]=m<128?m<<1:m<<1^283;for(m=0;m<256;m++){var p=c^c<<1^c<<2^c<<3^c<<4;p=p>>>8^255&p^99,R[n]=p,o[p]=n;var y=l[n],r=l[y],a=l[r],g=257*l[p]^16843008*p;f[n]=g<<24|g>>>8,v[n]=g<<16|g>>>16,b[n]=g<<8|g>>>24,T[n]=g,g=16843009*a^65537*r^257*y^16843008*n,e[p]=g<<24|g>>>8,i[p]=g<<16|g>>>16,t[p]=g<<8|g>>>24,s[p]=g,n?(n=y^l[l[l[a^y]]],c^=l[l[c]]):n=c=1}},C.expandKey=function(R){for(var o=this.uint8ArrayToUint32Array_(R),E=!0,f=0;f<o.length&&E;)E=o[f]===this.key[f],f++;if(!E){this.key=o;var v=this.keySize=o.length;if(v!==4&&v!==6&&v!==8)throw new Error("Invalid aes key size="+v);var b,T,u,e,i=this.ksRows=4*(v+6+1),t=this.keySchedule=new Uint32Array(i),s=this.invKeySchedule=new Uint32Array(i),l=this.sBox,n=this.rcon,c=this.invSubMix,m=c[0],p=c[1],y=c[2],r=c[3];for(b=0;b<i;b++)b<v?u=t[b]=o[b]:(e=u,b%v==0?(e=l[(e=e<<8|e>>>24)>>>24]<<24|l[e>>>16&255]<<16|l[e>>>8&255]<<8|l[255&e],e^=n[b/v|0]<<24):v>6&&b%v==4&&(e=l[e>>>24]<<24|l[e>>>16&255]<<16|l[e>>>8&255]<<8|l[255&e]),t[b]=u=(t[b-v]^e)>>>0);for(T=0;T<i;T++)b=i-T,e=3&T?t[b]:t[b-4],s[T]=T<4||b<=4?e:m[l[e>>>24]]^p[l[e>>>16&255]]^y[l[e>>>8&255]]^r[l[255&e]],s[T]=s[T]>>>0}},C.networkToHostOrderSwap=function(R){return R<<24|(65280&R)<<8|(16711680&R)>>8|R>>>24},C.decrypt=function(R,o,E){for(var f,v,b,T,u,e,i,t,s,l,n,c,m,p,y=this.keySize+6,r=this.invKeySchedule,a=this.invSBox,g=this.invSubMix,k=g[0],S=g[1],A=g[2],I=g[3],w=this.uint8ArrayToUint32Array_(E),O=w[0],F=w[1],M=w[2],N=w[3],B=new Int32Array(R),U=new Int32Array(B.length),j=this.networkToHostOrderSwap;o<B.length;){for(s=j(B[o]),l=j(B[o+1]),n=j(B[o+2]),c=j(B[o+3]),u=s^r[0],e=c^r[1],i=n^r[2],t=l^r[3],m=4,p=1;p<y;p++)f=k[u>>>24]^S[e>>16&255]^A[i>>8&255]^I[255&t]^r[m],v=k[e>>>24]^S[i>>16&255]^A[t>>8&255]^I[255&u]^r[m+1],b=k[i>>>24]^S[t>>16&255]^A[u>>8&255]^I[255&e]^r[m+2],T=k[t>>>24]^S[u>>16&255]^A[e>>8&255]^I[255&i]^r[m+3],u=f,e=v,i=b,t=T,m+=4;f=a[u>>>24]<<24^a[e>>16&255]<<16^a[i>>8&255]<<8^a[255&t]^r[m],v=a[e>>>24]<<24^a[i>>16&255]<<16^a[t>>8&255]<<8^a[255&u]^r[m+1],b=a[i>>>24]<<24^a[t>>16&255]<<16^a[u>>8&255]<<8^a[255&e]^r[m+2],T=a[t>>>24]<<24^a[u>>16&255]<<16^a[e>>8&255]<<8^a[255&i]^r[m+3],U[o]=j(f^O),U[o+1]=j(T^F),U[o+2]=j(b^M),U[o+3]=j(v^N),O=s,F=l,M=n,N=c,o+=4}return U.buffer},_}()},"./src/crypt/decrypter.ts":function(P,x,h){h.r(x),h.d(x,"default",function(){return o});var D=h("./src/crypt/aes-crypto.ts"),d=h("./src/crypt/fast-aes-key.ts"),L=h("./src/crypt/aes-decryptor.ts"),_=h("./src/utils/logger.ts"),C=h("./src/utils/mp4-tools.ts"),R=h("./src/utils/typed-array.ts"),o=function(){function E(v,b,T){var u=(T===void 0?{}:T).removePKCS7Padding,e=u===void 0||u;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=v,this.config=b,this.removePKCS7Padding=e,e)try{var i=self.crypto;i&&(this.subtle=i.subtle||i.webkitSubtle)}catch{}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var f=E.prototype;return f.destroy=function(){this.observer=null},f.isSync=function(){return this.config.enableSoftwareAES},f.flush=function(){var v=this.currentResult;if(v){var b=new Uint8Array(v);return this.reset(),this.removePKCS7Padding?Object(L.removePadding)(b):b}this.reset()},f.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},f.decrypt=function(v,b,T,u){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(v),b,T);var e=this.flush();e&&u(e.buffer)}else this.webCryptoDecrypt(new Uint8Array(v),b,T).then(u)},f.softwareDecrypt=function(v,b,T){var u=this.currentIV,e=this.currentResult,i=this.remainderData;this.logOnce("JS AES decrypt"),i&&(v=Object(C.appendUint8Array)(i,v),this.remainderData=null);var t=this.getValidChunk(v);if(!t.length)return null;u&&(T=u);var s=this.softwareDecrypter;s||(s=this.softwareDecrypter=new L.default),s.expandKey(b);var l=e;return this.currentResult=s.decrypt(t.buffer,0,T),this.currentIV=Object(R.sliceUint8)(t,-16).buffer,l||null},f.webCryptoDecrypt=function(v,b,T){var u=this,e=this.subtle;return this.key===b&&this.fastAesKey||(this.key=b,this.fastAesKey=new d.default(e,b)),this.fastAesKey.expandKey().then(function(i){return e?new D.default(e,T).decrypt(v.buffer,i):Promise.reject(new Error("web crypto not initialized"))}).catch(function(i){return u.onWebCryptoError(i,v,b,T)})},f.onWebCryptoError=function(v,b,T,u){return _.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",v),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(b,T,u)},f.getValidChunk=function(v){var b=v,T=v.length-v.length%16;return T!==v.length&&(b=Object(R.sliceUint8)(v,0,T),this.remainderData=Object(R.sliceUint8)(v,T)),b},f.logOnce=function(v){this.logEnabled&&(_.logger.log("[decrypter.ts]: "+v),this.logEnabled=!1)},E}()},"./src/crypt/fast-aes-key.ts":function(P,x,h){h.r(x),h.d(x,"default",function(){return D});var D=function(){function d(L,_){this.subtle=void 0,this.key=void 0,this.subtle=L,this.key=_}return d.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},d}()},"./src/demux/aacdemuxer.ts":function(P,x,h){h.r(x);var D=h("./src/demux/base-audio-demuxer.ts"),d=h("./src/demux/adts.ts"),L=h("./src/utils/logger.ts"),_=h("./src/demux/id3.ts");function C(o,E){return(C=Object.setPrototypeOf||function(f,v){return f.__proto__=v,f})(o,E)}var R=function(o){var E,f;function v(T,u){var e;return(e=o.call(this)||this).observer=void 0,e.config=void 0,e.observer=T,e.config=u,e}f=o,(E=v).prototype=Object.create(f.prototype),E.prototype.constructor=E,C(E,f);var b=v.prototype;return b.resetInitSegment=function(T,u,e){o.prototype.resetInitSegment.call(this,T,u,e),this._audioTrack={container:"audio/adts",type:"audio",id:0,pid:-1,sequenceNumber:0,isAAC:!0,samples:[],manifestCodec:T,duration:e,inputTimeScale:9e4,dropped:0}},v.probe=function(T){if(!T)return!1;for(var u=(_.getID3Data(T,0)||[]).length,e=T.length;u<e;u++)if(d.probe(T,u))return L.logger.log("ADTS sync word found !"),!0;return!1},b.canParse=function(T,u){return d.canParse(T,u)},b.appendFrame=function(T,u,e){d.initTrackConfig(T,this.observer,u,e,T.manifestCodec);var i=d.appendFrame(T,u,e,this.initPTS,this.frameIndex);if(i&&i.missing===0)return i},v}(D.default);R.minProbeByteLength=9,x.default=R},"./src/demux/adts.ts":function(P,x,h){h.r(x),h.d(x,"getAudioConfig",function(){return _}),h.d(x,"isHeaderPattern",function(){return C}),h.d(x,"getHeaderLength",function(){return R}),h.d(x,"getFullFrameLength",function(){return o}),h.d(x,"canGetFrameLength",function(){return E}),h.d(x,"isHeader",function(){return f}),h.d(x,"canParse",function(){return v}),h.d(x,"probe",function(){return b}),h.d(x,"initTrackConfig",function(){return T}),h.d(x,"getFrameDuration",function(){return u}),h.d(x,"parseFrameHeader",function(){return e}),h.d(x,"appendFrame",function(){return i});var D=h("./src/utils/logger.ts"),d=h("./src/errors.ts"),L=h("./src/events.ts");function _(t,s,l,n){var c,m,p,y,r=navigator.userAgent.toLowerCase(),a=n,g=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];c=1+((192&s[l+2])>>>6);var k=(60&s[l+2])>>>2;if(!(k>g.length-1))return p=(1&s[l+2])<<2,p|=(192&s[l+3])>>>6,D.logger.log("manifest codec:"+n+", ADTS type:"+c+", samplingIndex:"+k),/firefox/i.test(r)?k>=6?(c=5,y=new Array(4),m=k-3):(c=2,y=new Array(2),m=k):r.indexOf("android")!==-1?(c=2,y=new Array(2),m=k):(c=5,y=new Array(4),n&&(n.indexOf("mp4a.40.29")!==-1||n.indexOf("mp4a.40.5")!==-1)||!n&&k>=6?m=k-3:((n&&n.indexOf("mp4a.40.2")!==-1&&(k>=6&&p===1||/vivaldi/i.test(r))||!n&&p===1)&&(c=2,y=new Array(2)),m=k)),y[0]=c<<3,y[0]|=(14&k)>>1,y[1]|=(1&k)<<7,y[1]|=p<<3,c===5&&(y[1]|=(14&m)>>1,y[2]=(1&m)<<7,y[2]|=8,y[3]=0),{config:y,samplerate:g[k],channelCount:p,codec:"mp4a.40."+c,manifestCodec:a};t.trigger(L.Events.ERROR,{type:d.ErrorTypes.MEDIA_ERROR,details:d.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+k})}function C(t,s){return t[s]===255&&(246&t[s+1])==240}function R(t,s){return 1&t[s+1]?7:9}function o(t,s){return(3&t[s+3])<<11|t[s+4]<<3|(224&t[s+5])>>>5}function E(t,s){return s+5<t.length}function f(t,s){return s+1<t.length&&C(t,s)}function v(t,s){return E(t,s)&&C(t,s)&&o(t,s)<=t.length-s}function b(t,s){if(f(t,s)){var l=R(t,s);if(s+l>=t.length)return!1;var n=o(t,s);if(n<=l)return!1;var c=s+n;return c===t.length||f(t,c)}return!1}function T(t,s,l,n,c){if(!t.samplerate){var m=_(s,l,n,c);if(!m)return;t.config=m.config,t.samplerate=m.samplerate,t.channelCount=m.channelCount,t.codec=m.codec,t.manifestCodec=m.manifestCodec,D.logger.log("parsed codec:"+t.codec+", rate:"+m.samplerate+", channels:"+m.channelCount)}}function u(t){return 9216e4/t}function e(t,s,l,n,c){var m=R(t,s),p=o(t,s);if((p-=m)>0)return{headerLength:m,frameLength:p,stamp:l+n*c}}function i(t,s,l,n,c){var m=e(s,l,n,c,u(t.samplerate));if(m){var p,y=m.frameLength,r=m.headerLength,a=m.stamp,g=r+y,k=Math.max(0,l+g-s.length);k?(p=new Uint8Array(g-r)).set(s.subarray(l+r,s.length),0):p=s.subarray(l+r,l+g);var S={unit:p,pts:a};return k||t.samples.push(S),{sample:S,length:g,missing:k}}}},"./src/demux/base-audio-demuxer.ts":function(P,x,h){h.r(x),h.d(x,"initPTSFn",function(){return o});var D=h("./src/polyfills/number.ts"),d=h("./src/demux/id3.ts"),L=h("./src/demux/dummy-demuxed-track.ts"),_=h("./src/utils/mp4-tools.ts"),C=h("./src/utils/typed-array.ts"),R=function(){function E(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.initPTS=null}var f=E.prototype;return f.resetInitSegment=function(v,b,T){this._id3Track={type:"id3",id:0,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},f.resetTimeStamp=function(){},f.resetContiguity=function(){},f.canParse=function(v,b){return!1},f.appendFrame=function(v,b,T){},f.demux=function(v,b){this.cachedData&&(v=Object(_.appendUint8Array)(this.cachedData,v),this.cachedData=null);var T,u,e=d.getID3Data(v,0),i=e?e.length:0,t=this._audioTrack,s=this._id3Track,l=e?d.getTimeStamp(e):void 0,n=v.length;for(this.frameIndex!==0&&this.initPTS!==null||(this.initPTS=o(l,b)),e&&e.length>0&&s.samples.push({pts:this.initPTS,dts:this.initPTS,data:e}),u=this.initPTS;i<n;){if(this.canParse(v,i)){var c=this.appendFrame(t,v,i);c?(this.frameIndex++,u=c.sample.pts,T=i+=c.length):i=n}else d.canParse(v,i)?(e=d.getID3Data(v,i),s.samples.push({pts:u,dts:u,data:e}),T=i+=e.length):i++;if(i===n&&T!==n){var m=Object(C.sliceUint8)(v,T);this.cachedData?this.cachedData=Object(_.appendUint8Array)(this.cachedData,m):this.cachedData=m}}return{audioTrack:t,avcTrack:Object(L.dummyTrack)(),id3Track:s,textTrack:Object(L.dummyTrack)()}},f.demuxSampleAes=function(v,b,T){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},f.flush=function(v){var b=this.cachedData;return b&&(this.cachedData=null,this.demux(b,0)),this.frameIndex=0,{audioTrack:this._audioTrack,avcTrack:Object(L.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(L.dummyTrack)()}},f.destroy=function(){},E}(),o=function(E,f){return Object(D.isFiniteNumber)(E)?90*E:9e4*f};x.default=R},"./src/demux/chunk-cache.ts":function(P,x,h){h.r(x),h.d(x,"default",function(){return D});var D=function(){function d(){this.chunks=[],this.dataLength=0}var L=d.prototype;return L.push=function(_){this.chunks.push(_),this.dataLength+=_.length},L.flush=function(){var _,C=this.chunks,R=this.dataLength;return C.length?(_=C.length===1?C[0]:function(o,E){for(var f=new Uint8Array(E),v=0,b=0;b<o.length;b++){var T=o[b];f.set(T,v),v+=T.length}return f}(C,R),this.reset(),_):new Uint8Array(0)},L.reset=function(){this.chunks.length=0,this.dataLength=0},d}()},"./src/demux/dummy-demuxed-track.ts":function(P,x,h){function D(){return{type:"",id:-1,pid:-1,inputTimeScale:9e4,sequenceNumber:-1,samples:[],dropped:0}}h.r(x),h.d(x,"dummyTrack",function(){return D})},"./src/demux/exp-golomb.ts":function(P,x,h){h.r(x);var D=h("./src/utils/logger.ts"),d=function(){function L(C){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=C,this.bytesAvailable=C.byteLength,this.word=0,this.bitsAvailable=0}var _=L.prototype;return _.loadWord=function(){var C=this.data,R=this.bytesAvailable,o=C.byteLength-R,E=new Uint8Array(4),f=Math.min(4,R);if(f===0)throw new Error("no bytes available");E.set(C.subarray(o,o+f)),this.word=new DataView(E.buffer).getUint32(0),this.bitsAvailable=8*f,this.bytesAvailable-=f},_.skipBits=function(C){var R;this.bitsAvailable>C?(this.word<<=C,this.bitsAvailable-=C):(C-=this.bitsAvailable,C-=(R=C>>3)>>3,this.bytesAvailable-=R,this.loadWord(),this.word<<=C,this.bitsAvailable-=C)},_.readBits=function(C){var R=Math.min(this.bitsAvailable,C),o=this.word>>>32-R;return C>32&&D.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=R,this.bitsAvailable>0?this.word<<=R:this.bytesAvailable>0&&this.loadWord(),(R=C-R)>0&&this.bitsAvailable?o<<R|this.readBits(R):o},_.skipLZ=function(){var C;for(C=0;C<this.bitsAvailable;++C)if((this.word&2147483648>>>C)!=0)return this.word<<=C,this.bitsAvailable-=C,C;return this.loadWord(),C+this.skipLZ()},_.skipUEG=function(){this.skipBits(1+this.skipLZ())},_.skipEG=function(){this.skipBits(1+this.skipLZ())},_.readUEG=function(){var C=this.skipLZ();return this.readBits(C+1)-1},_.readEG=function(){var C=this.readUEG();return 1&C?1+C>>>1:-1*(C>>>1)},_.readBoolean=function(){return this.readBits(1)===1},_.readUByte=function(){return this.readBits(8)},_.readUShort=function(){return this.readBits(16)},_.readUInt=function(){return this.readBits(32)},_.skipScalingList=function(C){for(var R=8,o=8,E=0;E<C;E++)o!==0&&(o=(R+this.readEG()+256)%256),R=o===0?R:o},_.readSPS=function(){var C,R,o,E=0,f=0,v=0,b=0,T=this.readUByte.bind(this),u=this.readBits.bind(this),e=this.readUEG.bind(this),i=this.readBoolean.bind(this),t=this.skipBits.bind(this),s=this.skipEG.bind(this),l=this.skipUEG.bind(this),n=this.skipScalingList.bind(this);T();var c=T();if(u(5),t(3),T(),l(),c===100||c===110||c===122||c===244||c===44||c===83||c===86||c===118||c===128){var m=e();if(m===3&&t(1),l(),l(),t(1),i())for(R=m!==3?8:12,o=0;o<R;o++)i()&&n(o<6?16:64)}l();var p=e();if(p===0)e();else if(p===1)for(t(1),s(),s(),C=e(),o=0;o<C;o++)s();l(),t(1);var y=e(),r=e(),a=u(1);a===0&&t(1),t(1),i()&&(E=e(),f=e(),v=e(),b=e());var g=[1,1];if(i()&&i())switch(T()){case 1:g=[1,1];break;case 2:g=[12,11];break;case 3:g=[10,11];break;case 4:g=[16,11];break;case 5:g=[40,33];break;case 6:g=[24,11];break;case 7:g=[20,11];break;case 8:g=[32,11];break;case 9:g=[80,33];break;case 10:g=[18,11];break;case 11:g=[15,11];break;case 12:g=[64,33];break;case 13:g=[160,99];break;case 14:g=[4,3];break;case 15:g=[3,2];break;case 16:g=[2,1];break;case 255:g=[T()<<8|T(),T()<<8|T()]}return{width:Math.ceil(16*(y+1)-2*E-2*f),height:(2-a)*(r+1)*16-(a?2:4)*(v+b),pixelRatio:g}},_.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},L}();x.default=d},"./src/demux/id3.ts":function(P,x,h){h.r(x),h.d(x,"isHeader",function(){return d}),h.d(x,"isFooter",function(){return L}),h.d(x,"getID3Data",function(){return _}),h.d(x,"canParse",function(){return R}),h.d(x,"getTimeStamp",function(){return o}),h.d(x,"isTimeStampFrame",function(){return E}),h.d(x,"getID3Frames",function(){return v}),h.d(x,"decodeFrame",function(){return b}),h.d(x,"utf8ArrayToStr",function(){return t}),h.d(x,"testables",function(){return s});var D,d=function(l,n){return n+10<=l.length&&l[n]===73&&l[n+1]===68&&l[n+2]===51&&l[n+3]<255&&l[n+4]<255&&l[n+6]<128&&l[n+7]<128&&l[n+8]<128&&l[n+9]<128},L=function(l,n){return n+10<=l.length&&l[n]===51&&l[n+1]===68&&l[n+2]===73&&l[n+3]<255&&l[n+4]<255&&l[n+6]<128&&l[n+7]<128&&l[n+8]<128&&l[n+9]<128},_=function(l,n){for(var c=n,m=0;d(l,n);)m+=10,m+=C(l,n+6),L(l,n+10)&&(m+=10),n+=m;if(m>0)return l.subarray(c,c+m)},C=function(l,n){var c=0;return c=(127&l[n])<<21,c|=(127&l[n+1])<<14,c|=(127&l[n+2])<<7,c|=127&l[n+3]},R=function(l,n){return d(l,n)&&C(l,n+6)+10<=l.length-n},o=function(l){for(var n=v(l),c=0;c<n.length;c++){var m=n[c];if(E(m))return i(m)}},E=function(l){return l&&l.key==="PRIV"&&l.info==="com.apple.streaming.transportStreamTimestamp"},f=function(l){var n=String.fromCharCode(l[0],l[1],l[2],l[3]),c=C(l,4);return{type:n,size:c,data:l.subarray(10,10+c)}},v=function(l){for(var n=0,c=[];d(l,n);){for(var m=C(l,n+6),p=(n+=10)+m;n+8<p;){var y=f(l.subarray(n)),r=b(y);r&&c.push(r),n+=y.size+10}L(l,n)&&(n+=10)}return c},b=function(l){return l.type==="PRIV"?T(l):l.type[0]==="W"?e(l):u(l)},T=function(l){if(!(l.size<2)){var n=t(l.data,!0),c=new Uint8Array(l.data.subarray(n.length+1));return{key:l.type,info:n,data:c.buffer}}},u=function(l){if(!(l.size<2)){if(l.type==="TXXX"){var n=1,c=t(l.data.subarray(n),!0);n+=c.length+1;var m=t(l.data.subarray(n));return{key:l.type,info:c,data:m}}var p=t(l.data.subarray(1));return{key:l.type,data:p}}},e=function(l){if(l.type==="WXXX"){if(l.size<2)return;var n=1,c=t(l.data.subarray(n),!0);n+=c.length+1;var m=t(l.data.subarray(n));return{key:l.type,info:c,data:m}}var p=t(l.data);return{key:l.type,data:p}},i=function(l){if(l.data.byteLength===8){var n=new Uint8Array(l.data),c=1&n[3],m=(n[4]<<23)+(n[5]<<15)+(n[6]<<7)+n[7];return m/=45,c&&(m+=4772185884e-2),Math.round(m)}},t=function(l,n){n===void 0&&(n=!1);var c=(D||self.TextDecoder===void 0||(D=new self.TextDecoder("utf-8")),D);if(c){var m=c.decode(l);if(n){var p=m.indexOf("\0");return p!==-1?m.substring(0,p):m}return m.replace(/\0/g,"")}for(var y,r,a,g=l.length,k="",S=0;S<g;){if((y=l[S++])===0&&n)return k;if(y!==0&&y!==3)switch(y>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:k+=String.fromCharCode(y);break;case 12:case 13:r=l[S++],k+=String.fromCharCode((31&y)<<6|63&r);break;case 14:r=l[S++],a=l[S++],k+=String.fromCharCode((15&y)<<12|(63&r)<<6|(63&a)<<0)}}return k},s={decodeTextFrame:u}},"./src/demux/mp3demuxer.ts":function(P,x,h){h.r(x);var D=h("./src/demux/base-audio-demuxer.ts"),d=h("./src/demux/id3.ts"),L=h("./src/utils/logger.ts"),_=h("./src/demux/mpegaudio.ts");function C(o,E){return(C=Object.setPrototypeOf||function(f,v){return f.__proto__=v,f})(o,E)}var R=function(o){var E,f;function v(){return o.apply(this,arguments)||this}f=o,(E=v).prototype=Object.create(f.prototype),E.prototype.constructor=E,C(E,f);var b=v.prototype;return b.resetInitSegment=function(T,u,e){o.prototype.resetInitSegment.call(this,T,u,e),this._audioTrack={container:"audio/mpeg",type:"audio",id:0,pid:-1,sequenceNumber:0,isAAC:!1,samples:[],manifestCodec:T,duration:e,inputTimeScale:9e4,dropped:0}},v.probe=function(T){if(!T)return!1;for(var u=(d.getID3Data(T,0)||[]).length,e=T.length;u<e;u++)if(_.probe(T,u))return L.logger.log("MPEG Audio sync word found !"),!0;return!1},b.canParse=function(T,u){return _.canParse(T,u)},b.appendFrame=function(T,u,e){if(this.initPTS!==null)return _.appendFrame(T,u,e,this.initPTS,this.frameIndex)},v}(D.default);R.minProbeByteLength=4,x.default=R},"./src/demux/mp4demuxer.ts":function(P,x,h){h.r(x);var D=h("./src/utils/mp4-tools.ts"),d=h("./src/demux/dummy-demuxed-track.ts"),L=function(){function _(R,o){this.remainderData=null,this.config=void 0,this.config=o}var C=_.prototype;return C.resetTimeStamp=function(){},C.resetInitSegment=function(){},C.resetContiguity=function(){},_.probe=function(R){return Object(D.findBox)({data:R,start:0,end:Math.min(R.length,16384)},["moof"]).length>0},C.demux=function(R){var o=R,E=Object(d.dummyTrack)();if(this.config.progressive){this.remainderData&&(o=Object(D.appendUint8Array)(this.remainderData,R));var f=Object(D.segmentValidRange)(o);this.remainderData=f.remainder,E.samples=f.valid||new Uint8Array}else E.samples=o;return{audioTrack:Object(d.dummyTrack)(),avcTrack:E,id3Track:Object(d.dummyTrack)(),textTrack:Object(d.dummyTrack)()}},C.flush=function(){var R=Object(d.dummyTrack)();return R.samples=this.remainderData||new Uint8Array,this.remainderData=null,{audioTrack:Object(d.dummyTrack)(),avcTrack:R,id3Track:Object(d.dummyTrack)(),textTrack:Object(d.dummyTrack)()}},C.demuxSampleAes=function(R,o,E){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},C.destroy=function(){},_}();L.minProbeByteLength=1024,x.default=L},"./src/demux/mpegaudio.ts":function(P,x,h){h.r(x),h.d(x,"appendFrame",function(){return R}),h.d(x,"parseHeader",function(){return o}),h.d(x,"isHeaderPattern",function(){return E}),h.d(x,"isHeader",function(){return f}),h.d(x,"canParse",function(){return v}),h.d(x,"probe",function(){return b});var D=null,d=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],L=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],_=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],C=[0,1,1,4];function R(T,u,e,i,t){if(!(e+24>u.length)){var s=o(u,e);if(s&&e+s.frameLength<=u.length){var l=i+t*(9e4*s.samplesPerFrame/s.sampleRate),n={unit:u.subarray(e,e+s.frameLength),pts:l,dts:l};return T.config=[],T.channelCount=s.channelCount,T.samplerate=s.sampleRate,T.samples.push(n),{sample:n,length:s.frameLength,missing:0}}}}function o(T,u){var e=T[u+1]>>3&3,i=T[u+1]>>1&3,t=T[u+2]>>4&15,s=T[u+2]>>2&3;if(e!==1&&t!==0&&t!==15&&s!==3){var l=T[u+2]>>1&1,n=T[u+3]>>6,c=1e3*d[14*(e===3?3-i:i===3?3:4)+t-1],m=L[3*(e===3?0:e===2?1:2)+s],p=n===3?1:2,y=_[e][i],r=C[i],a=8*y*r,g=Math.floor(y*c/m+l)*r;if(D===null){var k=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);D=k?parseInt(k[1]):0}return!!D&&D<=87&&i===2&&c>=224e3&&n===0&&(T[u+3]=128|T[u+3]),{sampleRate:m,channelCount:p,frameLength:g,samplesPerFrame:a}}}function E(T,u){return T[u]===255&&(224&T[u+1])==224&&(6&T[u+1])!=0}function f(T,u){return u+1<T.length&&E(T,u)}function v(T,u){return E(T,u)&&4<=T.length-u}function b(T,u){if(u+1<T.length&&E(T,u)){var e=o(T,u),i=4;e!=null&&e.frameLength&&(i=e.frameLength);var t=u+i;return t===T.length||f(T,t)}return!1}},"./src/demux/sample-aes.ts":function(P,x,h){h.r(x);var D=h("./src/crypt/decrypter.ts"),d=h("./src/demux/tsdemuxer.ts"),L=function(){function _(R,o,E){this.keyData=void 0,this.decrypter=void 0,this.keyData=E,this.decrypter=new D.default(R,o,{removePKCS7Padding:!1})}var C=_.prototype;return C.decryptBuffer=function(R,o){this.decrypter.decrypt(R,this.keyData.key.buffer,this.keyData.iv.buffer,o)},C.decryptAacSample=function(R,o,E,f){var v=R[o].unit,b=v.subarray(16,v.length-v.length%16),T=b.buffer.slice(b.byteOffset,b.byteOffset+b.length),u=this;this.decryptBuffer(T,function(e){var i=new Uint8Array(e);v.set(i,16),f||u.decryptAacSamples(R,o+1,E)})},C.decryptAacSamples=function(R,o,E){for(;;o++){if(o>=R.length)return void E();if(!(R[o].unit.length<32)){var f=this.decrypter.isSync();if(this.decryptAacSample(R,o,E,f),!f)return}}},C.getAvcEncryptedData=function(R){for(var o=16*Math.floor((R.length-48)/160)+16,E=new Int8Array(o),f=0,v=32;v<=R.length-16;v+=160,f+=16)E.set(R.subarray(v,v+16),f);return E},C.getAvcDecryptedUnit=function(R,o){for(var E=new Uint8Array(o),f=0,v=32;v<=R.length-16;v+=160,f+=16)R.set(E.subarray(f,f+16),v);return R},C.decryptAvcSample=function(R,o,E,f,v,b){var T=Object(d.discardEPB)(v.data),u=this.getAvcEncryptedData(T),e=this;this.decryptBuffer(u.buffer,function(i){v.data=e.getAvcDecryptedUnit(T,i),b||e.decryptAvcSamples(R,o,E+1,f)})},C.decryptAvcSamples=function(R,o,E,f){if(R instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;o++,E=0){if(o>=R.length)return void f();for(var v=R[o].units;!(E>=v.length);E++){var b=v[E];if(!(b.data.length<=48||b.type!==1&&b.type!==5)){var T=this.decrypter.isSync();if(this.decryptAvcSample(R,o,E,f,b,T),!T)return}}}},_}();x.default=L},"./src/demux/transmuxer-interface.ts":function(P,x,h){h.r(x),h.d(x,"default",function(){return f});var D=h("./node_modules/webworkify-webpack/index.js"),d=h("./src/events.ts"),L=h("./src/demux/transmuxer.ts"),_=h("./src/utils/logger.ts"),C=h("./src/errors.ts"),R=h("./src/utils/mediasource-helper.ts"),o=h("./node_modules/eventemitter3/index.js"),E=Object(R.getMediaSource)()||{isTypeSupported:function(){return!1}},f=function(){function v(T,u,e,i){var t=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=T,this.id=u,this.onTransmuxComplete=e,this.onFlush=i;var s=T.config,l=function(p,y){(y=y||{}).frag=t.frag,y.id=t.id,T.trigger(p,y)};this.observer=new o.EventEmitter,this.observer.on(d.Events.FRAG_DECRYPTED,l),this.observer.on(d.Events.ERROR,l);var n={mp4:E.isTypeSupported("video/mp4"),mpeg:E.isTypeSupported("audio/mpeg"),mp3:E.isTypeSupported('audio/mp4; codecs="mp3"')},c=navigator.vendor;if(s.enableWorker&&typeof Worker!="undefined"){var m;_.logger.log("demuxing in webworker");try{m=this.worker=D("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),m.addEventListener("message",this.onwmsg),m.onerror=function(p){T.trigger(d.Events.ERROR,{type:C.ErrorTypes.OTHER_ERROR,details:C.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(p.message+"  ("+p.filename+":"+p.lineno+")")})},m.postMessage({cmd:"init",typeSupported:n,vendor:c,id:u,config:JSON.stringify(s)})}catch(p){_.logger.warn("Error in worker:",p),_.logger.error("Error while initializing DemuxerWorker, fallback to inline"),m&&self.URL.revokeObjectURL(m.objectURL),this.transmuxer=new L.default(this.observer,n,s,c,u),this.worker=null}}else this.transmuxer=new L.default(this.observer,n,s,c,u)}var b=v.prototype;return b.destroy=function(){var T=this.worker;if(T)T.removeEventListener("message",this.onwmsg),T.terminate(),this.worker=null;else{var u=this.transmuxer;u&&(u.destroy(),this.transmuxer=null)}var e=this.observer;e&&e.removeAllListeners(),this.observer=null},b.push=function(T,u,e,i,t,s,l,n,c,m){var p=this;c.transmuxing.start=self.performance.now();var y=this.transmuxer,r=this.worker,a=s?s.start:t.start,g=t.decryptdata,k=this.frag,S=!(k&&t.cc===k.cc),A=!(k&&c.level===k.level),I=k?c.sn-k.sn:-1,w=this.part?c.part-this.part.index:1,O=!A&&(I===1||I===0&&w===1),F=self.performance.now();(A||I||t.stats.parsing.start===0)&&(t.stats.parsing.start=F),!s||!w&&O||(s.stats.parsing.start=F);var M=new L.TransmuxState(S,O,n,A,a);if(!O||S){_.logger.log("[transmuxer-interface, "+t.type+"]: Starting new transmux session for sn: "+c.sn+" p: "+c.part+" level: "+c.level+" id: "+c.id+`
        discontinuity: `+S+`
        trackSwitch: `+A+`
        contiguous: `+O+`
        accurateTimeOffset: `+n+`
        timeOffset: `+a);var N=new L.TransmuxConfig(e,i,u,l,m);this.configureTransmuxer(N)}if(this.frag=t,this.part=s,r)r.postMessage({cmd:"demux",data:T,decryptdata:g,chunkMeta:c,state:M},T instanceof ArrayBuffer?[T]:[]);else if(y){var B=y.push(T,g,c,M);Object(L.isPromise)(B)?B.then(function(U){p.handleTransmuxComplete(U)}):this.handleTransmuxComplete(B)}},b.flush=function(T){var u=this;T.transmuxing.start=self.performance.now();var e=this.transmuxer,i=this.worker;if(i)i.postMessage({cmd:"flush",chunkMeta:T});else if(e){var t=e.flush(T);Object(L.isPromise)(t)?t.then(function(s){u.handleFlushResult(s,T)}):this.handleFlushResult(t,T)}},b.handleFlushResult=function(T,u){var e=this;T.forEach(function(i){e.handleTransmuxComplete(i)}),this.onFlush(u)},b.onWorkerMessage=function(T){var u=T.data,e=this.hls;switch(u.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(u.data);break;case"flush":this.onFlush(u.data);break;default:u.data=u.data||{},u.data.frag=this.frag,u.data.id=this.id,e.trigger(u.event,u.data)}},b.configureTransmuxer=function(T){var u=this.worker,e=this.transmuxer;u?u.postMessage({cmd:"configure",config:T}):e&&e.configure(T)},b.handleTransmuxComplete=function(T){T.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(T)},v}()},"./src/demux/transmuxer-worker.ts":function(P,x,h){h.r(x),h.d(x,"default",function(){return C});var D=h("./src/demux/transmuxer.ts"),d=h("./src/events.ts"),L=h("./src/utils/logger.ts"),_=h("./node_modules/eventemitter3/index.js");function C(f){var v=new _.EventEmitter,b=function(T,u){f.postMessage({event:T,data:u})};v.on(d.Events.FRAG_DECRYPTED,b),v.on(d.Events.ERROR,b),f.addEventListener("message",function(T){var u=T.data;switch(u.cmd){case"init":var e=JSON.parse(u.config);f.transmuxer=new D.default(v,u.typeSupported,e,u.vendor,u.id),Object(L.enableLogs)(e.debug),b("init",null);break;case"configure":f.transmuxer.configure(u.config);break;case"demux":var i=f.transmuxer.push(u.data,u.decryptdata,u.chunkMeta,u.state);Object(D.isPromise)(i)?i.then(function(l){R(f,l)}):R(f,i);break;case"flush":var t=u.chunkMeta,s=f.transmuxer.flush(t);Object(D.isPromise)(s)?s.then(function(l){E(f,l,t)}):E(f,s,t)}})}function R(f,v){if((b=v.remuxResult).audio||b.video||b.text||b.id3||b.initSegment){var b,T=[],u=v.remuxResult,e=u.audio,i=u.video;e&&o(T,e),i&&o(T,i),f.postMessage({event:"transmuxComplete",data:v},T)}}function o(f,v){v.data1&&f.push(v.data1.buffer),v.data2&&f.push(v.data2.buffer)}function E(f,v,b){v.forEach(function(T){R(f,T)}),f.postMessage({event:"flush",data:b})}},"./src/demux/transmuxer.ts":function(P,x,h){h.r(x),h.d(x,"default",function(){return t}),h.d(x,"isPromise",function(){return l}),h.d(x,"TransmuxConfig",function(){return n}),h.d(x,"TransmuxState",function(){return c});var D,d=h("./src/events.ts"),L=h("./src/errors.ts"),_=h("./src/crypt/decrypter.ts"),C=h("./src/demux/aacdemuxer.ts"),R=h("./src/demux/mp4demuxer.ts"),o=h("./src/demux/tsdemuxer.ts"),E=h("./src/demux/mp3demuxer.ts"),f=h("./src/remux/mp4-remuxer.ts"),v=h("./src/remux/passthrough-remuxer.ts"),b=h("./src/demux/chunk-cache.ts"),T=h("./src/utils/mp4-tools.ts"),u=h("./src/utils/logger.ts");try{D=self.performance.now.bind(self.performance)}catch{u.logger.debug("Unable to use Performance API on this environment"),D=self.Date.now}var e=[{demux:o.default,remux:f.default},{demux:R.default,remux:v.default},{demux:C.default,remux:f.default},{demux:E.default,remux:f.default}],i=1024;e.forEach(function(m){var p=m.demux;i=Math.max(i,p.minProbeByteLength)});var t=function(){function m(y,r,a,g,k){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new b.default,this.observer=y,this.typeSupported=r,this.config=a,this.vendor=g,this.id=k}var p=m.prototype;return p.configure=function(y){this.transmuxConfig=y,this.decrypter&&this.decrypter.reset()},p.push=function(y,r,a,g){var k=this,S=a.transmuxing;S.executeStart=D();var A=new Uint8Array(y),I=this.cache,w=this.config,O=this.currentTransmuxState,F=this.transmuxConfig;g&&(this.currentTransmuxState=g);var M=function(me,pe){var Se=null;return me.byteLength>0&&pe!=null&&pe.key!=null&&pe.iv!==null&&pe.method!=null&&(Se=pe),Se}(A,r);if(M&&M.method==="AES-128"){var N=this.getDecrypter();if(!w.enableSoftwareAES)return this.decryptionPromise=N.webCryptoDecrypt(A,M.key.buffer,M.iv.buffer).then(function(me){var pe=k.push(me,null,a);return k.decryptionPromise=null,pe}),this.decryptionPromise;var B=N.softwareDecrypt(A,M.key.buffer,M.iv.buffer);if(!B)return S.executeEnd=D(),s(a);A=new Uint8Array(B)}var U=g||O,j=U.contiguous,W=U.discontinuity,$=U.trackSwitch,X=U.accurateTimeOffset,Y=U.timeOffset,Z=F.audioCodec,ue=F.videoCodec,ce=F.defaultInitPts,ge=F.duration,ie=F.initSegmentData;if((W||$)&&this.resetInitSegment(ie,Z,ue,ge),W&&this.resetInitialTimestamp(ce),j||this.resetContiguity(),this.needsProbing(A,W,$)){if(I.dataLength){var he=I.flush();A=Object(T.appendUint8Array)(he,A)}this.configureTransmuxer(A,F)}var se=this.transmux(A,M,Y,X,a),oe=this.currentTransmuxState;return oe.contiguous=!0,oe.discontinuity=!1,oe.trackSwitch=!1,S.executeEnd=D(),se},p.flush=function(y){var r=this,a=y.transmuxing;a.executeStart=D();var g=this.decrypter,k=this.cache,S=this.currentTransmuxState,A=this.decryptionPromise;if(A)return A.then(function(){return r.flush(y)});var I=[],w=S.timeOffset;if(g){var O=g.flush();O&&I.push(this.push(O,null,y))}var F=k.dataLength;k.reset();var M=this.demuxer,N=this.remuxer;if(!M||!N)return F>=i&&this.observer.emit(d.Events.ERROR,d.Events.ERROR,{type:L.ErrorTypes.MEDIA_ERROR,details:L.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),a.executeEnd=D(),[s(y)];var B=M.flush(w);return l(B)?B.then(function(U){return r.flushRemux(I,U,y),I}):(this.flushRemux(I,B,y),I)},p.flushRemux=function(y,r,a){var g=r.audioTrack,k=r.avcTrack,S=r.id3Track,A=r.textTrack,I=this.currentTransmuxState,w=I.accurateTimeOffset,O=I.timeOffset;u.logger.log("[transmuxer.ts]: Flushed fragment "+a.sn+(a.part>-1?" p: "+a.part:"")+" of level "+a.level);var F=this.remuxer.remux(g,k,S,A,O,w,!0,this.id);y.push({remuxResult:F,chunkMeta:a}),a.transmuxing.executeEnd=D()},p.resetInitialTimestamp=function(y){var r=this.demuxer,a=this.remuxer;r&&a&&(r.resetTimeStamp(y),a.resetTimeStamp(y))},p.resetContiguity=function(){var y=this.demuxer,r=this.remuxer;y&&r&&(y.resetContiguity(),r.resetNextTimestamp())},p.resetInitSegment=function(y,r,a,g){var k=this.demuxer,S=this.remuxer;k&&S&&(k.resetInitSegment(r,a,g),S.resetInitSegment(y,r,a))},p.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},p.transmux=function(y,r,a,g,k){return r&&r.method==="SAMPLE-AES"?this.transmuxSampleAes(y,r,a,g,k):this.transmuxUnencrypted(y,a,g,k)},p.transmuxUnencrypted=function(y,r,a,g){var k=this.demuxer.demux(y,r,!1,!this.config.progressive),S=k.audioTrack,A=k.avcTrack,I=k.id3Track,w=k.textTrack;return{remuxResult:this.remuxer.remux(S,A,I,w,r,a,!1,this.id),chunkMeta:g}},p.transmuxSampleAes=function(y,r,a,g,k){var S=this;return this.demuxer.demuxSampleAes(y,r,a).then(function(A){return{remuxResult:S.remuxer.remux(A.audioTrack,A.avcTrack,A.id3Track,A.textTrack,a,g,!1,S.id),chunkMeta:k}})},p.configureTransmuxer=function(y,r){for(var a,g=this.config,k=this.observer,S=this.typeSupported,A=this.vendor,I=r.audioCodec,w=r.defaultInitPts,O=r.duration,F=r.initSegmentData,M=r.videoCodec,N=0,B=e.length;N<B;N++)if(e[N].demux.probe(y)){a=e[N];break}a||(u.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),a={demux:R.default,remux:v.default});var U=this.demuxer,j=this.remuxer,W=a.remux,$=a.demux;j&&j instanceof W||(this.remuxer=new W(k,g,S,A)),U&&U instanceof $||(this.demuxer=new $(k,g,S),this.probe=$.probe),this.resetInitSegment(F,I,M,O),this.resetInitialTimestamp(w)},p.needsProbing=function(y,r,a){return!this.demuxer||!this.remuxer||r||a},p.getDecrypter=function(){var y=this.decrypter;return y||(y=this.decrypter=new _.default(this.observer,this.config)),y},m}(),s=function(m){return{remuxResult:{},chunkMeta:m}};function l(m){return"then"in m&&m.then instanceof Function}var n=function(m,p,y,r,a){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=m,this.videoCodec=p,this.initSegmentData=y,this.duration=r,this.defaultInitPts=a},c=function(m,p,y,r,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.discontinuity=m,this.contiguous=p,this.accurateTimeOffset=y,this.trackSwitch=r,this.timeOffset=a}},"./src/demux/tsdemuxer.ts":function(P,x,h){h.r(x),h.d(x,"discardEPB",function(){return l});var D=h("./src/demux/adts.ts"),d=h("./src/demux/mpegaudio.ts"),L=h("./src/demux/exp-golomb.ts"),_=h("./src/demux/id3.ts"),C=h("./src/demux/sample-aes.ts"),R=h("./src/events.ts"),o=h("./src/utils/mp4-tools.ts"),E=h("./src/utils/logger.ts"),f=h("./src/errors.ts"),v={video:1,audio:2,id3:3,text:4},b=function(){function n(m,p,y){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this.aacLastPTS=null,this._initPTS=null,this._initDTS=null,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=m,this.config=p,this.typeSupported=y}n.probe=function(m){var p=n.syncOffset(m);return!(p<0||(p&&E.logger.warn("MPEG2-TS detected but first sync word found @ offset "+p+", junk ahead ?"),0))},n.syncOffset=function(m){for(var p=Math.min(1e3,m.length-564),y=0;y<p;){if(m[y]===71&&m[y+188]===71&&m[y+376]===71)return y;y++}return-1},n.createTrack=function(m,p){return{container:m==="video"||m==="audio"?"video/mp2t":void 0,type:m,id:v[m],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:m==="audio"?p:void 0}};var c=n.prototype;return c.resetInitSegment=function(m,p,y){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=n.createTrack("video",y),this._audioTrack=n.createTrack("audio",y),this._id3Track=n.createTrack("id3",y),this._txtTrack=n.createTrack("text",y),this._audioTrack.isAAC=!0,this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=m,this.videoCodec=p,this._duration=y},c.resetTimeStamp=function(){},c.resetContiguity=function(){var m=this._audioTrack,p=this._avcTrack,y=this._id3Track;m&&(m.pesData=null),p&&(p.pesData=null),y&&(y.pesData=null),this.aacOverFlow=null,this.aacLastPTS=null},c.demux=function(m,p,y,r){var a;y===void 0&&(y=!1),r===void 0&&(r=!1),y||(this.sampleAes=null);var g=this._avcTrack,k=this._audioTrack,S=this._id3Track,A=g.pid,I=g.pesData,w=k.pid,O=S.pid,F=k.pesData,M=S.pesData,N=!1,B=this.pmtParsed,U=this._pmtId,j=m.length;if(this.remainderData&&(j=(m=Object(o.appendUint8Array)(this.remainderData,m)).length,this.remainderData=null),j<188&&!r)return this.remainderData=m,{audioTrack:k,avcTrack:g,id3Track:S,textTrack:this._txtTrack};var W=Math.max(0,n.syncOffset(m));(j-=(j+W)%188)<m.byteLength&&!r&&(this.remainderData=new Uint8Array(m.buffer,j,m.buffer.byteLength-j));for(var $=W;$<j;$+=188)if(m[$]===71){var X=!!(64&m[$+1]),Y=((31&m[$+1])<<8)+m[$+2],Z=void 0;if((48&m[$+3])>>4>1){if((Z=$+5+m[$+4])===$+188)continue}else Z=$+4;switch(Y){case A:X&&(I&&(a=i(I))&&this.parseAVCPES(a,!1),I={data:[],size:0}),I&&(I.data.push(m.subarray(Z,$+188)),I.size+=$+188-Z);break;case w:X&&(F&&(a=i(F))&&(k.isAAC?this.parseAACPES(a):this.parseMPEGPES(a)),F={data:[],size:0}),F&&(F.data.push(m.subarray(Z,$+188)),F.size+=$+188-Z);break;case O:X&&(M&&(a=i(M))&&this.parseID3PES(a),M={data:[],size:0}),M&&(M.data.push(m.subarray(Z,$+188)),M.size+=$+188-Z);break;case 0:X&&(Z+=m[Z]+1),U=this._pmtId=u(m,Z);break;case U:X&&(Z+=m[Z]+1);var ue=e(m,Z,this.typeSupported.mpeg===!0||this.typeSupported.mp3===!0,y);(A=ue.avc)>0&&(g.pid=A),(w=ue.audio)>0&&(k.pid=w,k.isAAC=ue.isAAC),(O=ue.id3)>0&&(S.pid=O),N&&!B&&(E.logger.log("reparse from beginning"),N=!1,$=W-188),B=this.pmtParsed=!0;break;case 17:case 8191:break;default:N=!0}}else this.observer.emit(R.Events.ERROR,R.Events.ERROR,{type:f.ErrorTypes.MEDIA_ERROR,details:f.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});g.pesData=I,k.pesData=F,S.pesData=M;var ce={audioTrack:k,avcTrack:g,id3Track:S,textTrack:this._txtTrack};return r&&this.extractRemainingSamples(ce),ce},c.flush=function(){var m,p=this.remainderData;return this.remainderData=null,m=p?this.demux(p,-1,!1,!0):{audioTrack:this._audioTrack,avcTrack:this._avcTrack,textTrack:this._txtTrack,id3Track:this._id3Track},this.extractRemainingSamples(m),this.sampleAes?this.decrypt(m,this.sampleAes):m},c.extractRemainingSamples=function(m){var p,y=m.audioTrack,r=m.avcTrack,a=m.id3Track,g=r.pesData,k=y.pesData,S=a.pesData;g&&(p=i(g))?(this.parseAVCPES(p,!0),r.pesData=null):r.pesData=g,k&&(p=i(k))?(y.isAAC?this.parseAACPES(p):this.parseMPEGPES(p),y.pesData=null):(k!=null&&k.size&&E.logger.log("last AAC PES packet truncated,might overlap between fragments"),y.pesData=k),S&&(p=i(S))?(this.parseID3PES(p),a.pesData=null):a.pesData=S},c.demuxSampleAes=function(m,p,y){var r=this.demux(m,y,!0,!this.config.progressive),a=this.sampleAes=new C.default(this.observer,this.config,p);return this.decrypt(r,a)},c.decrypt=function(m,p){return new Promise(function(y){var r=m.audioTrack,a=m.avcTrack;r.samples&&r.isAAC?p.decryptAacSamples(r.samples,0,function(){a.samples?p.decryptAvcSamples(a.samples,0,0,function(){y(m)}):y(m)}):a.samples&&p.decryptAvcSamples(a.samples,0,0,function(){y(m)})})},c.destroy=function(){this._initPTS=this._initDTS=null,this._duration=0},c.parseAVCPES=function(m,p){var y,r=this,a=this._avcTrack,g=this.parseAVCNALu(m.data),k=this.avcSample,S=!1;m.data=null,k&&g.length&&!a.audFound&&(t(k,a),k=this.avcSample=T(!1,m.pts,m.dts,"")),g.forEach(function(A){switch(A.type){case 1:y=!0,k||(k=r.avcSample=T(!0,m.pts,m.dts,"")),k.frame=!0;var I=A.data;if(S&&I.length>4){var w=new L.default(I).readSliceType();w!==2&&w!==4&&w!==7&&w!==9||(k.key=!0)}break;case 5:y=!0,k||(k=r.avcSample=T(!0,m.pts,m.dts,"")),k.key=!0,k.frame=!0;break;case 6:y=!0;var O=new L.default(l(A.data));O.readUByte();for(var F=0,M=0,N=!1,B=0;!N&&O.bytesAvailable>1;){F=0;do F+=B=O.readUByte();while(B===255);M=0;do M+=B=O.readUByte();while(B===255);if(F===4&&O.bytesAvailable!==0){if(N=!0,O.readUByte()===181&&O.readUShort()===49&&O.readUInt()===1195456820&&O.readUByte()===3){for(var U=O.readUByte(),j=31&U,W=[U,O.readUByte()],$=0;$<j;$++)W.push(O.readUByte()),W.push(O.readUByte()),W.push(O.readUByte());s(r._txtTrack.samples,{type:3,pts:m.pts,bytes:W})}}else if(F===5&&O.bytesAvailable!==0){if(N=!0,M>16){for(var X=[],Y=0;Y<16;Y++)X.push(O.readUByte().toString(16)),Y!==3&&Y!==5&&Y!==7&&Y!==9||X.push("-");for(var Z=M-16,ue=new Uint8Array(Z),ce=0;ce<Z;ce++)ue[ce]=O.readUByte();s(r._txtTrack.samples,{pts:m.pts,payloadType:F,uuid:X.join(""),userData:Object(_.utf8ArrayToStr)(ue),userDataBytes:ue})}}else if(M<O.bytesAvailable)for(var ge=0;ge<M;ge++)O.readUByte()}break;case 7:if(y=!0,S=!0,!a.sps){var ie=new L.default(A.data).readSPS();a.width=ie.width,a.height=ie.height,a.pixelRatio=ie.pixelRatio,a.sps=[A.data],a.duration=r._duration;for(var he=A.data.subarray(1,4),se="avc1.",oe=0;oe<3;oe++){var me=he[oe].toString(16);me.length<2&&(me="0"+me),se+=me}a.codec=se}break;case 8:y=!0,a.pps||(a.pps=[A.data]);break;case 9:y=!1,a.audFound=!0,k&&t(k,a),k=r.avcSample=T(!1,m.pts,m.dts,"");break;case 12:y=!1;break;default:y=!1,k&&(k.debug+="unknown NAL "+A.type+" ")}k&&y&&k.units.push(A)}),p&&k&&(t(k,a),this.avcSample=null)},c.getLastNalUnit=function(){var m,p,y=this.avcSample;if(!y||y.units.length===0){var r=this._avcTrack.samples;y=r[r.length-1]}if((m=y)!==null&&m!==void 0&&m.units){var a=y.units;p=a[a.length-1]}return p},c.parseAVCNALu=function(m){var p,y,r=m.byteLength,a=this._avcTrack,g=a.naluState||0,k=g,S=[],A=0,I=-1,w=0;for(g===-1&&(I=0,w=31&m[0],g=0,A=1);A<r;)if(p=m[A++],g)if(g!==1)if(p)if(p===1){if(I>=0){var O={data:m.subarray(I,A-g-1),type:w};S.push(O)}else{var F=this.getLastNalUnit();if(F&&(k&&A<=4-k&&F.state&&(F.data=F.data.subarray(0,F.data.byteLength-k)),(y=A-g-1)>0)){var M=new Uint8Array(F.data.byteLength+y);M.set(F.data,0),M.set(m.subarray(0,y),F.data.byteLength),F.data=M}}A<r?(I=A,w=31&m[A],g=0):g=-1}else g=0;else g=3;else g=p?0:2;else g=p?0:1;if(I>=0&&g>=0){var N={data:m.subarray(I,r),type:w,state:g};S.push(N)}if(S.length===0){var B=this.getLastNalUnit();if(B){var U=new Uint8Array(B.data.byteLength+m.byteLength);U.set(B.data,0),U.set(m,B.data.byteLength),B.data=U}}return a.naluState=g,S},c.parseAACPES=function(m){var p,y,r,a,g,k=0,S=this._audioTrack,A=this.aacOverFlow,I=m.data;if(A){this.aacOverFlow=null;var w=A.sample.unit.byteLength,O=Math.min(A.missing,w),F=w-O;A.sample.unit.set(I.subarray(0,O),F),S.samples.push(A.sample),k=A.missing}for(p=k,y=I.length;p<y-1&&!D.isHeader(I,p);p++);if(p===k||(p<y-1?(r="AAC PES did not start with ADTS header,offset:"+p,a=!1):(r="no ADTS header found in AAC PES",a=!0),E.logger.warn("parsing error:"+r),this.observer.emit(R.Events.ERROR,R.Events.ERROR,{type:f.ErrorTypes.MEDIA_ERROR,details:f.ErrorDetails.FRAG_PARSING_ERROR,fatal:a,reason:r}),!a)){if(D.initTrackConfig(S,this.observer,I,p,this.audioCodec),m.pts!==void 0)g=m.pts;else{if(!A)return void E.logger.warn("[tsdemuxer]: AAC PES unknown PTS");var M=D.getFrameDuration(S.samplerate);g=A.sample.pts+M}for(var N=0;p<y;){if(D.isHeader(I,p)){if(p+5<y){var B=D.appendFrame(S,I,p,g,N);if(B){if(!B.missing){p+=B.length,N++;continue}this.aacOverFlow=B}}break}p++}}},c.parseMPEGPES=function(m){var p=m.data,y=p.length,r=0,a=0,g=m.pts;if(g!==void 0)for(;a<y;)if(d.isHeader(p,a)){var k=d.appendFrame(this._audioTrack,p,a,g,r);if(!k)break;a+=k.length,r++}else a++;else E.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")},c.parseID3PES=function(m){m.pts!==void 0?this._id3Track.samples.push(m):E.logger.warn("[tsdemuxer]: ID3 PES unknown PTS")},n}();function T(n,c,m,p){return{key:n,frame:!1,pts:c,dts:m,units:[],debug:p,length:0}}function u(n,c){return(31&n[c+10])<<8|n[c+11]}function e(n,c,m,p){var y={audio:-1,avc:-1,id3:-1,isAAC:!0},r=c+3+((15&n[c+1])<<8|n[c+2])-4;for(c+=12+((15&n[c+10])<<8|n[c+11]);c<r;){var a=(31&n[c+1])<<8|n[c+2];switch(n[c]){case 207:if(!p){E.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:y.audio===-1&&(y.audio=a);break;case 21:y.id3===-1&&(y.id3=a);break;case 219:if(!p){E.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:y.avc===-1&&(y.avc=a);break;case 3:case 4:m?y.audio===-1&&(y.audio=a,y.isAAC=!1):E.logger.log("MPEG audio found, not supported in this browser");break;case 36:E.logger.warn("Unsupported HEVC stream type found")}c+=5+((15&n[c+3])<<8|n[c+4])}return y}function i(n){var c,m,p,y,r,a=0,g=n.data;if(!n||n.size===0)return null;for(;g[0].length<19&&g.length>1;){var k=new Uint8Array(g[0].length+g[1].length);k.set(g[0]),k.set(g[1],g[0].length),g[0]=k,g.splice(1,1)}if(((c=g[0])[0]<<16)+(c[1]<<8)+c[2]===1){if((m=(c[4]<<8)+c[5])&&m>n.size-6)return null;var S=c[7];192&S&&(y=536870912*(14&c[9])+4194304*(255&c[10])+16384*(254&c[11])+128*(255&c[12])+(254&c[13])/2,64&S?y-(r=536870912*(14&c[14])+4194304*(255&c[15])+16384*(254&c[16])+128*(255&c[17])+(254&c[18])/2)>54e5&&(E.logger.warn(Math.round((y-r)/9e4)+"s delta between PTS and DTS, align them"),y=r):r=y);var A=(p=c[8])+9;if(n.size<=A)return null;n.size-=A;for(var I=new Uint8Array(n.size),w=0,O=g.length;w<O;w++){var F=(c=g[w]).byteLength;if(A){if(A>F){A-=F;continue}c=c.subarray(A),F-=A,A=0}I.set(c,a),a+=F}return m&&(m-=p+3),{data:I,pts:y,dts:r,len:m}}return null}function t(n,c){if(n.units.length&&n.frame){if(n.pts===void 0){var m=c.samples,p=m.length;if(!p)return void c.dropped++;var y=m[p-1];n.pts=y.pts,n.dts=y.dts}c.samples.push(n)}n.debug.length&&E.logger.log(n.pts+"/"+n.dts+":"+n.debug)}function s(n,c){var m=n.length;if(m>0){if(c.pts>=n[m-1].pts)n.push(c);else for(var p=m-1;p>=0;p--)if(c.pts<n[p].pts){n.splice(p,0,c);break}}else n.push(c)}function l(n){for(var c=n.byteLength,m=[],p=1;p<c-2;)n[p]===0&&n[p+1]===0&&n[p+2]===3?(m.push(p+2),p+=2):p++;if(m.length===0)return n;var y=c-m.length,r=new Uint8Array(y),a=0;for(p=0;p<y;a++,p++)a===m[0]&&(a++,m.shift()),r[p]=n[a];return r}b.minProbeByteLength=188,x.default=b},"./src/errors.ts":function(P,x,h){var D,d,L,_;h.r(x),h.d(x,"ErrorTypes",function(){return D}),h.d(x,"ErrorDetails",function(){return L}),(d=D||(D={})).NETWORK_ERROR="networkError",d.MEDIA_ERROR="mediaError",d.KEY_SYSTEM_ERROR="keySystemError",d.MUX_ERROR="muxError",d.OTHER_ERROR="otherError",(_=L||(L={})).KEY_SYSTEM_NO_KEYS="keySystemNoKeys",_.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",_.KEY_SYSTEM_NO_SESSION="keySystemNoSession",_.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",_.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",_.MANIFEST_LOAD_ERROR="manifestLoadError",_.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",_.MANIFEST_PARSING_ERROR="manifestParsingError",_.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",_.LEVEL_EMPTY_ERROR="levelEmptyError",_.LEVEL_LOAD_ERROR="levelLoadError",_.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",_.LEVEL_SWITCH_ERROR="levelSwitchError",_.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",_.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",_.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",_.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",_.FRAG_LOAD_ERROR="fragLoadError",_.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",_.FRAG_DECRYPT_ERROR="fragDecryptError",_.FRAG_PARSING_ERROR="fragParsingError",_.REMUX_ALLOC_ERROR="remuxAllocError",_.KEY_LOAD_ERROR="keyLoadError",_.KEY_LOAD_TIMEOUT="keyLoadTimeOut",_.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",_.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",_.BUFFER_APPEND_ERROR="bufferAppendError",_.BUFFER_APPENDING_ERROR="bufferAppendingError",_.BUFFER_STALLED_ERROR="bufferStalledError",_.BUFFER_FULL_ERROR="bufferFullError",_.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",_.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",_.INTERNAL_EXCEPTION="internalException",_.INTERNAL_ABORTED="aborted",_.UNKNOWN="unknown"},"./src/events.ts":function(P,x,h){var D,d;h.r(x),h.d(x,"Events",function(){return D}),(d=D||(D={})).MEDIA_ATTACHING="hlsMediaAttaching",d.MEDIA_ATTACHED="hlsMediaAttached",d.MEDIA_DETACHING="hlsMediaDetaching",d.MEDIA_DETACHED="hlsMediaDetached",d.BUFFER_RESET="hlsBufferReset",d.BUFFER_CODECS="hlsBufferCodecs",d.BUFFER_CREATED="hlsBufferCreated",d.BUFFER_APPENDING="hlsBufferAppending",d.BUFFER_APPENDED="hlsBufferAppended",d.BUFFER_EOS="hlsBufferEos",d.BUFFER_FLUSHING="hlsBufferFlushing",d.BUFFER_FLUSHED="hlsBufferFlushed",d.MANIFEST_LOADING="hlsManifestLoading",d.MANIFEST_LOADED="hlsManifestLoaded",d.MANIFEST_PARSED="hlsManifestParsed",d.LEVEL_SWITCHING="hlsLevelSwitching",d.LEVEL_SWITCHED="hlsLevelSwitched",d.LEVEL_LOADING="hlsLevelLoading",d.LEVEL_LOADED="hlsLevelLoaded",d.LEVEL_UPDATED="hlsLevelUpdated",d.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",d.LEVELS_UPDATED="hlsLevelsUpdated",d.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",d.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",d.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",d.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",d.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",d.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",d.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",d.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",d.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",d.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",d.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",d.CUES_PARSED="hlsCuesParsed",d.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",d.INIT_PTS_FOUND="hlsInitPtsFound",d.FRAG_LOADING="hlsFragLoading",d.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",d.FRAG_LOADED="hlsFragLoaded",d.FRAG_DECRYPTED="hlsFragDecrypted",d.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",d.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",d.FRAG_PARSING_METADATA="hlsFragParsingMetadata",d.FRAG_PARSED="hlsFragParsed",d.FRAG_BUFFERED="hlsFragBuffered",d.FRAG_CHANGED="hlsFragChanged",d.FPS_DROP="hlsFpsDrop",d.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",d.ERROR="hlsError",d.DESTROYING="hlsDestroying",d.KEY_LOADING="hlsKeyLoading",d.KEY_LOADED="hlsKeyLoaded",d.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",d.BACK_BUFFER_REACHED="hlsBackBufferReached"},"./src/hls.ts":function(P,x,h){h.r(x),h.d(x,"default",function(){return t});var D=h("./node_modules/url-toolkit/src/url-toolkit.js"),d=h("./src/loader/playlist-loader.ts"),L=h("./src/loader/key-loader.ts"),_=h("./src/controller/id3-track-controller.ts"),C=h("./src/controller/latency-controller.ts"),R=h("./src/controller/level-controller.ts"),o=h("./src/controller/fragment-tracker.ts"),E=h("./src/controller/stream-controller.ts"),f=h("./src/is-supported.ts"),v=h("./src/utils/logger.ts"),b=h("./src/config.ts"),T=h("./node_modules/eventemitter3/index.js"),u=h("./src/events.ts"),e=h("./src/errors.ts");function i(s,l){for(var n=0;n<l.length;n++){var c=l[n];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(s,c.key,c)}}var t=function(){function s(p){p===void 0&&(p={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new T.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this._media=null,this.url=null;var y=this.config=Object(b.mergeConfig)(s.DefaultConfig,p);this.userConfig=p,Object(v.enableLogs)(y.debug),this._autoLevelCapping=-1,y.progressive&&Object(b.enableStreamingMode)(y);var r=y.abrController,a=y.bufferController,g=y.capLevelController,k=y.fpsController,S=this.abrController=new r(this),A=this.bufferController=new a(this),I=this.capLevelController=new g(this),w=new k(this),O=new d.default(this),F=new L.default(this),M=new _.default(this),N=this.levelController=new R.default(this),B=new o.FragmentTracker(this),U=this.streamController=new E.default(this,B);I.setStreamController(U),w.setStreamController(U);var j=[N,U];this.networkControllers=j;var W=[O,F,S,A,I,w,M,B];this.audioTrackController=this.createController(y.audioTrackController,null,j),this.createController(y.audioStreamController,B,j),this.subtitleTrackController=this.createController(y.subtitleTrackController,null,j),this.createController(y.subtitleStreamController,B,j),this.createController(y.timelineController,null,W),this.emeController=this.createController(y.emeController,null,W),this.latencyController=this.createController(C.default,null,W),this.coreComponents=W}s.isSupported=function(){return Object(f.isSupported)()};var l,n,c,m=s.prototype;return m.createController=function(p,y,r){if(p){var a=y?new p(this,y):new p(this);return r&&r.push(a),a}return null},m.on=function(p,y,r){r===void 0&&(r=this),this._emitter.on(p,y,r)},m.once=function(p,y,r){r===void 0&&(r=this),this._emitter.once(p,y,r)},m.removeAllListeners=function(p){this._emitter.removeAllListeners(p)},m.off=function(p,y,r,a){r===void 0&&(r=this),this._emitter.off(p,y,r,a)},m.listeners=function(p){return this._emitter.listeners(p)},m.emit=function(p,y,r){return this._emitter.emit(p,y,r)},m.trigger=function(p,y){if(this.config.debug)return this.emit(p,p,y);try{return this.emit(p,p,y)}catch(r){v.logger.error("An internal error happened while handling event "+p+'. Error message: "'+r.message+'". Here is a stacktrace:',r),this.trigger(u.Events.ERROR,{type:e.ErrorTypes.OTHER_ERROR,details:e.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:p,error:r})}return!1},m.listenerCount=function(p){return this._emitter.listenerCount(p)},m.destroy=function(){v.logger.log("destroy"),this.trigger(u.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(p){return p.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(p){return p.destroy()}),this.coreComponents.length=0},m.attachMedia=function(p){v.logger.log("attachMedia"),this._media=p,this.trigger(u.Events.MEDIA_ATTACHING,{media:p})},m.detachMedia=function(){v.logger.log("detachMedia"),this.trigger(u.Events.MEDIA_DETACHING,void 0),this._media=null},m.loadSource=function(p){this.stopLoad();var y=this.media,r=this.url,a=this.url=D.buildAbsoluteURL(self.location.href,p,{alwaysNormalize:!0});v.logger.log("loadSource:"+a),y&&r&&r!==a&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(y)),this.trigger(u.Events.MANIFEST_LOADING,{url:p})},m.startLoad=function(p){p===void 0&&(p=-1),v.logger.log("startLoad("+p+")"),this.networkControllers.forEach(function(y){y.startLoad(p)})},m.stopLoad=function(){v.logger.log("stopLoad"),this.networkControllers.forEach(function(p){p.stopLoad()})},m.swapAudioCodec=function(){v.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},m.recoverMediaError=function(){v.logger.log("recoverMediaError");var p=this._media;this.detachMedia(),p&&this.attachMedia(p)},m.removeLevel=function(p,y){y===void 0&&(y=0),this.levelController.removeLevel(p,y)},l=s,c=[{key:"version",get:function(){return"1.0.10"}},{key:"Events",get:function(){return u.Events}},{key:"ErrorTypes",get:function(){return e.ErrorTypes}},{key:"ErrorDetails",get:function(){return e.ErrorDetails}},{key:"DefaultConfig",get:function(){return s.defaultConfig?s.defaultConfig:b.hlsDefaultConfig},set:function(p){s.defaultConfig=p}}],(n=[{key:"levels",get:function(){var p=this.levelController.levels;return p||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(p){v.logger.log("set currentLevel:"+p),this.loadLevel=p,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(p){v.logger.log("set nextLevel:"+p),this.levelController.manualLevel=p,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(p){v.logger.log("set loadLevel:"+p),this.levelController.manualLevel=p}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(p){this.levelController.nextLoadLevel=p}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(p){v.logger.log("set firstLevel:"+p),this.levelController.firstLevel=p}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(p){v.logger.log("set startLevel:"+p),p!==-1&&(p=Math.max(p,this.minAutoLevel)),this.levelController.startLevel=p}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(p){var y=!!p;y!==this.config.capLevelToPlayerSize&&(y?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=y)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(p){this._autoLevelCapping!==p&&(v.logger.log("set autoLevelCapping:"+p),this._autoLevelCapping=p)}},{key:"bandwidthEstimate",get:function(){var p=this.abrController.bwEstimator;return p?p.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var p=this.levels,y=this.config.minAutoBitrate;if(!p)return 0;for(var r=p.length,a=0;a<r;a++)if(p[a].maxBitrate>y)return a;return 0}},{key:"maxAutoLevel",get:function(){var p=this.levels,y=this.autoLevelCapping;return y===-1&&p&&p.length?p.length-1:y}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(p){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,p)}},{key:"audioTracks",get:function(){var p=this.audioTrackController;return p?p.audioTracks:[]}},{key:"audioTrack",get:function(){var p=this.audioTrackController;return p?p.audioTrack:-1},set:function(p){var y=this.audioTrackController;y&&(y.audioTrack=p)}},{key:"subtitleTracks",get:function(){var p=this.subtitleTrackController;return p?p.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var p=this.subtitleTrackController;return p?p.subtitleTrack:-1},set:function(p){var y=this.subtitleTrackController;y&&(y.subtitleTrack=p)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var p=this.subtitleTrackController;return!!p&&p.subtitleDisplay},set:function(p){var y=this.subtitleTrackController;y&&(y.subtitleDisplay=p)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(p){this.config.lowLatencyMode=p}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}])&&i(l.prototype,n),c&&i(l,c),s}();t.defaultConfig=void 0},"./src/is-supported.ts":function(P,x,h){h.r(x),h.d(x,"isSupported",function(){return L}),h.d(x,"changeTypeSupported",function(){return _});var D=h("./src/utils/mediasource-helper.ts");function d(){return self.SourceBuffer||self.WebKitSourceBuffer}function L(){var C=Object(D.getMediaSource)();if(!C)return!1;var R=d(),o=C&&typeof C.isTypeSupported=="function"&&C.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),E=!R||R.prototype&&typeof R.prototype.appendBuffer=="function"&&typeof R.prototype.remove=="function";return!!o&&!!E}function _(){var C,R=d();return typeof(R==null||(C=R.prototype)===null||C===void 0?void 0:C.changeType)=="function"}},"./src/loader/fragment-loader.ts":function(P,x,h){h.r(x),h.d(x,"default",function(){return f}),h.d(x,"LoadError",function(){return b});var D=h("./src/polyfills/number.ts"),d=h("./src/errors.ts");function L(T){var u=typeof Map=="function"?new Map:void 0;return(L=function(e){if(e===null||(i=e,Function.toString.call(i).indexOf("[native code]")===-1))return e;var i;if(typeof e!="function")throw new TypeError("Super expression must either be null or a function");if(u!==void 0){if(u.has(e))return u.get(e);u.set(e,t)}function t(){return _(e,arguments,o(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),R(t,e)})(T)}function _(T,u,e){return(_=C()?Reflect.construct:function(i,t,s){var l=[null];l.push.apply(l,t);var n=new(Function.bind.apply(i,l));return s&&R(n,s.prototype),n}).apply(null,arguments)}function C(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function R(T,u){return(R=Object.setPrototypeOf||function(e,i){return e.__proto__=i,e})(T,u)}function o(T){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(u){return u.__proto__||Object.getPrototypeOf(u)})(T)}var E=Math.pow(2,17),f=function(){function T(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}var u=T.prototype;return u.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},u.abort=function(){this.loader&&this.loader.abort()},u.load=function(e,i){var t=this,s=e.url;if(!s)return Promise.reject(new b({type:d.ErrorTypes.NETWORK_ERROR,details:d.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,networkDetails:null},"Fragment does not have a "+(s?"part list":"url")));this.abort();var l=this.config,n=l.fLoader,c=l.loader;return new Promise(function(m,p){t.loader&&t.loader.destroy();var y=t.loader=e.loader=n?new n(l):new c(l),r=v(e),a={timeout:l.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:l.fragLoadingMaxRetryTimeout,highWaterMark:E};e.stats=y.stats,y.load(r,a,{onSuccess:function(g,k,S,A){t.resetLoader(e,y),m({frag:e,part:null,payload:g.data,networkDetails:A})},onError:function(g,k,S){t.resetLoader(e,y),p(new b({type:d.ErrorTypes.NETWORK_ERROR,details:d.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:g,networkDetails:S}))},onAbort:function(g,k,S){t.resetLoader(e,y),p(new b({type:d.ErrorTypes.NETWORK_ERROR,details:d.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:e,networkDetails:S}))},onTimeout:function(g,k,S){t.resetLoader(e,y),p(new b({type:d.ErrorTypes.NETWORK_ERROR,details:d.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,networkDetails:S}))},onProgress:function(g,k,S,A){i&&i({frag:e,part:null,payload:S,networkDetails:A})}})})},u.loadPart=function(e,i,t){var s=this;this.abort();var l=this.config,n=l.fLoader,c=l.loader;return new Promise(function(m,p){s.loader&&s.loader.destroy();var y=s.loader=e.loader=n?new n(l):new c(l),r=v(e,i),a={timeout:l.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:l.fragLoadingMaxRetryTimeout,highWaterMark:E};i.stats=y.stats,y.load(r,a,{onSuccess:function(g,k,S,A){s.resetLoader(e,y),s.updateStatsFromPart(e,i);var I={frag:e,part:i,payload:g.data,networkDetails:A};t(I),m(I)},onError:function(g,k,S){s.resetLoader(e,y),p(new b({type:d.ErrorTypes.NETWORK_ERROR,details:d.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:i,response:g,networkDetails:S}))},onAbort:function(g,k,S){e.stats.aborted=i.stats.aborted,s.resetLoader(e,y),p(new b({type:d.ErrorTypes.NETWORK_ERROR,details:d.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:e,part:i,networkDetails:S}))},onTimeout:function(g,k,S){s.resetLoader(e,y),p(new b({type:d.ErrorTypes.NETWORK_ERROR,details:d.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:i,networkDetails:S}))}})})},u.updateStatsFromPart=function(e,i){var t=e.stats,s=i.stats,l=s.total;if(t.loaded+=s.loaded,l){var n=Math.round(e.duration/i.duration),c=Math.min(Math.round(t.loaded/l),n),m=(n-c)*Math.round(t.loaded/c);t.total=t.loaded+m}else t.total=Math.max(t.loaded,t.total);var p=t.loading,y=s.loading;p.start?p.first+=y.first-y.start:(p.start=y.start,p.first=y.first),p.end=y.end},u.resetLoader=function(e,i){e.loader=null,this.loader===i&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),i.destroy()},T}();function v(T,u){u===void 0&&(u=null);var e=u||T,i={frag:T,part:u,responseType:"arraybuffer",url:e.url,rangeStart:0,rangeEnd:0},t=e.byteRangeStartOffset,s=e.byteRangeEndOffset;return Object(D.isFiniteNumber)(t)&&Object(D.isFiniteNumber)(s)&&(i.rangeStart=t,i.rangeEnd=s),i}var b=function(T){var u,e;function i(t){for(var s,l=arguments.length,n=new Array(l>1?l-1:0),c=1;c<l;c++)n[c-1]=arguments[c];return(s=T.call.apply(T,[this].concat(n))||this).data=void 0,s.data=t,s}return e=T,(u=i).prototype=Object.create(e.prototype),u.prototype.constructor=u,R(u,e),i}(L(Error))},"./src/loader/fragment.ts":function(P,x,h){h.r(x),h.d(x,"ElementaryStreamTypes",function(){return D}),h.d(x,"BaseSegment",function(){return T}),h.d(x,"Fragment",function(){return u}),h.d(x,"Part",function(){return e});var D,d,L=h("./src/polyfills/number.ts"),_=h("./node_modules/url-toolkit/src/url-toolkit.js"),C=h("./src/utils/logger.ts"),R=h("./src/loader/level-key.ts"),o=h("./src/loader/load-stats.ts");function E(i,t){i.prototype=Object.create(t.prototype),i.prototype.constructor=i,f(i,t)}function f(i,t){return(f=Object.setPrototypeOf||function(s,l){return s.__proto__=l,s})(i,t)}function v(i,t){for(var s=0;s<t.length;s++){var l=t[s];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(i,l.key,l)}}function b(i,t,s){return t&&v(i.prototype,t),s&&v(i,s),i}(d=D||(D={})).AUDIO="audio",d.VIDEO="video",d.AUDIOVIDEO="audiovideo";var T=function(){function i(t){var s;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((s={})[D.AUDIO]=null,s[D.VIDEO]=null,s[D.AUDIOVIDEO]=null,s),this.baseurl=t}return i.prototype.setByteRange=function(t,s){var l=t.split("@",2),n=[];l.length===1?n[0]=s?s.byteRangeEndOffset:0:n[0]=parseInt(l[1]),n[1]=parseInt(l[0])+n[0],this._byteRange=n},b(i,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(_.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(t){this._url=t}}]),i}(),u=function(i){function t(l,n){var c;return(c=i.call(this,n)||this)._decryptdata=null,c.rawProgramDateTime=null,c.programDateTime=null,c.tagList=[],c.duration=0,c.sn=0,c.levelkey=void 0,c.type=void 0,c.loader=null,c.level=-1,c.cc=0,c.startPTS=void 0,c.endPTS=void 0,c.appendedPTS=void 0,c.startDTS=void 0,c.endDTS=void 0,c.start=0,c.deltaPTS=void 0,c.maxStartPTS=void 0,c.minEndPTS=void 0,c.stats=new o.LoadStats,c.urlId=0,c.data=void 0,c.bitrateTest=!1,c.title=null,c.initSegment=null,c.type=l,c}E(t,i);var s=t.prototype;return s.createInitializationVector=function(l){for(var n=new Uint8Array(16),c=12;c<16;c++)n[c]=l>>8*(15-c)&255;return n},s.setDecryptDataFromLevelKey=function(l,n){var c=l;return(l==null?void 0:l.method)==="AES-128"&&l.uri&&!l.iv&&((c=R.LevelKey.fromURI(l.uri)).method=l.method,c.iv=this.createInitializationVector(n),c.keyFormat="identity"),c},s.setElementaryStreamInfo=function(l,n,c,m,p,y){y===void 0&&(y=!1);var r=this.elementaryStreams,a=r[l];a?(a.startPTS=Math.min(a.startPTS,n),a.endPTS=Math.max(a.endPTS,c),a.startDTS=Math.min(a.startDTS,m),a.endDTS=Math.max(a.endDTS,p)):r[l]={startPTS:n,endPTS:c,startDTS:m,endDTS:p,partial:y}},s.clearElementaryStreamInfo=function(){var l=this.elementaryStreams;l[D.AUDIO]=null,l[D.VIDEO]=null,l[D.AUDIOVIDEO]=null},b(t,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var l=this.sn;typeof l!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&C.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),l=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,l)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!Object(L.isFiniteNumber)(this.programDateTime))return null;var l=Object(L.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*l}},{key:"encrypted",get:function(){var l;return!((l=this.decryptdata)===null||l===void 0||!l.keyFormat||!this.decryptdata.uri)}}]),t}(T),e=function(i){function t(s,l,n,c,m){var p;(p=i.call(this,n)||this).fragOffset=0,p.duration=0,p.gap=!1,p.independent=!1,p.relurl=void 0,p.fragment=void 0,p.index=void 0,p.stats=new o.LoadStats,p.duration=s.decimalFloatingPoint("DURATION"),p.gap=s.bool("GAP"),p.independent=s.bool("INDEPENDENT"),p.relurl=s.enumeratedString("URI"),p.fragment=l,p.index=c;var y=s.enumeratedString("BYTERANGE");return y&&p.setByteRange(y,m),m&&(p.fragOffset=m.fragOffset+m.duration),p}return E(t,i),b(t,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var s=this.elementaryStreams;return!!(s.audio||s.video||s.audiovideo)}}]),t}(T)},"./src/loader/key-loader.ts":function(P,x,h){h.r(x),h.d(x,"default",function(){return _});var D=h("./src/events.ts"),d=h("./src/errors.ts"),L=h("./src/utils/logger.ts"),_=function(){function C(o){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=o,this._registerListeners()}var R=C.prototype;return R._registerListeners=function(){this.hls.on(D.Events.KEY_LOADING,this.onKeyLoading,this)},R._unregisterListeners=function(){this.hls.off(D.Events.KEY_LOADING,this.onKeyLoading)},R.destroy=function(){for(var o in this._unregisterListeners(),this.loaders){var E=this.loaders[o];E&&E.destroy()}this.loaders={}},R.onKeyLoading=function(o,E){var f=E.frag,v=f.type,b=this.loaders[v];if(f.decryptdata){var T=f.decryptdata.uri;if(T!==this.decrypturl||this.decryptkey===null){var u=this.hls.config;if(b&&(L.logger.warn("abort previous key loader for type:"+v),b.abort()),!T)return void L.logger.warn("key uri is falsy");var e=u.loader,i=f.loader=this.loaders[v]=new e(u);this.decrypturl=T,this.decryptkey=null;var t={url:T,frag:f,responseType:"arraybuffer"},s={timeout:u.fragLoadingTimeOut,maxRetry:0,retryDelay:u.fragLoadingRetryDelay,maxRetryDelay:u.fragLoadingMaxRetryTimeout,highWaterMark:0},l={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};i.load(t,s,l)}else this.decryptkey&&(f.decryptdata.key=this.decryptkey,this.hls.trigger(D.Events.KEY_LOADED,{frag:f}))}else L.logger.warn("Missing decryption data on fragment in onKeyLoading")},R.loadsuccess=function(o,E,f){var v=f.frag;v.decryptdata?(this.decryptkey=v.decryptdata.key=new Uint8Array(o.data),v.loader=null,delete this.loaders[v.type],this.hls.trigger(D.Events.KEY_LOADED,{frag:v})):L.logger.error("after key load, decryptdata unset")},R.loaderror=function(o,E){var f=E.frag,v=f.loader;v&&v.abort(),delete this.loaders[f.type],this.hls.trigger(D.Events.ERROR,{type:d.ErrorTypes.NETWORK_ERROR,details:d.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:f,response:o})},R.loadtimeout=function(o,E){var f=E.frag,v=f.loader;v&&v.abort(),delete this.loaders[f.type],this.hls.trigger(D.Events.ERROR,{type:d.ErrorTypes.NETWORK_ERROR,details:d.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:f})},C}()},"./src/loader/level-details.ts":function(P,x,h){h.r(x),h.d(x,"LevelDetails",function(){return L});var D=h("./src/polyfills/number.ts");function d(_,C){for(var R=0;R<C.length;R++){var o=C[R];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(_,o.key,o)}}var L=function(){function _(o){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.url=o}var C,R;return _.prototype.reloaded=function(o){if(!o)return this.advanced=!0,void(this.updated=!0);var E=this.lastPartSn-o.lastPartSn,f=this.lastPartIndex-o.lastPartIndex;this.updated=this.endSN!==o.endSN||!!f||!!E,this.advanced=this.endSN>o.endSN||E>0||E===0&&f>0,this.updated||this.advanced?this.misses=Math.floor(.6*o.misses):this.misses=o.misses+1,this.availabilityDelay=o.availabilityDelay},C=_,(R=[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&Object(D.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var o=this.driftEndTime-this.driftStartTime;return o>0?1e3*(this.driftEnd-this.driftStart)/o:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var o;return(o=this.partList)!==null&&o!==void 0&&o.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var o;return(o=this.fragments)!==null&&o!==void 0&&o.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var o;return(o=this.partList)!==null&&o!==void 0&&o.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var o;return(o=this.partList)!==null&&o!==void 0&&o.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}])&&d(C.prototype,R),_}()},"./src/loader/level-key.ts":function(P,x,h){h.r(x),h.d(x,"LevelKey",function(){return L});var D=h("./node_modules/url-toolkit/src/url-toolkit.js");function d(_,C){for(var R=0;R<C.length;R++){var o=C[R];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(_,o.key,o)}}var L=function(){function _(o,E){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,this._uri=E?Object(D.buildAbsoluteURL)(o,E,{alwaysNormalize:!0}):o}var C,R;return _.fromURL=function(o,E){return new _(o,E)},_.fromURI=function(o){return new _(o)},C=_,(R=[{key:"uri",get:function(){return this._uri}}])&&d(C.prototype,R),_}()},"./src/loader/load-stats.ts":function(P,x,h){h.r(x),h.d(x,"LoadStats",function(){return D});var D=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(P,x,h){h.r(x),h.d(x,"default",function(){return e});var D=h("./src/polyfills/number.ts"),d=h("./node_modules/url-toolkit/src/url-toolkit.js"),L=h("./src/loader/fragment.ts"),_=h("./src/loader/level-details.ts"),C=h("./src/loader/level-key.ts"),R=h("./src/utils/attr-list.ts"),o=h("./src/utils/logger.ts"),E=h("./src/utils/codecs.ts"),f=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,v=/#EXT-X-MEDIA:(.*)/g,b=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),T=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(PLAYLIST-TYPE):(.+)/.source,/#EXT-X-(MEDIA-SEQUENCE): *(\d+)/.source,/#EXT-X-(SKIP):(.+)/.source,/#EXT-X-(TARGETDURATION): *(\d+)/.source,/#EXT-X-(KEY):(.+)/.source,/#EXT-X-(START):(.+)/.source,/#EXT-X-(ENDLIST)/.source,/#EXT-X-(DISCONTINUITY-SEQ)UENCE: *(\d+)/.source,/#EXT-X-(DIS)CONTINUITY/.source,/#EXT-X-(VERSION):(\d+)/.source,/#EXT-X-(MAP):(.+)/.source,/#EXT-X-(SERVER-CONTROL):(.+)/.source,/#EXT-X-(PART-INF):(.+)/.source,/#EXT-X-(GAP)/.source,/#EXT-X-(BITRATE):\s*(\d+)/.source,/#EXT-X-(PART):(.+)/.source,/#EXT-X-(PRELOAD-HINT):(.+)/.source,/#EXT-X-(RENDITION-REPORT):(.+)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),u=/\.(mp4|m4s|m4v|m4a)$/i,e=function(){function l(){}return l.findGroup=function(n,c){for(var m=0;m<n.length;m++){var p=n[m];if(p.id===c)return p}},l.convertAVC1ToAVCOTI=function(n){var c=n.split(".");if(c.length>2){var m=c.shift()+".";return m+=parseInt(c.shift()).toString(16),m+=("000"+parseInt(c.shift()).toString(16)).substr(-4)}return n},l.resolve=function(n,c){return d.buildAbsoluteURL(c,n,{alwaysNormalize:!0})},l.parseMasterPlaylist=function(n,c){var m,p=[],y={},r=!1;for(f.lastIndex=0;(m=f.exec(n))!=null;)if(m[1]){var a=new R.AttrList(m[1]),g={attrs:a,bitrate:a.decimalInteger("AVERAGE-BANDWIDTH")||a.decimalInteger("BANDWIDTH"),name:a.NAME,url:l.resolve(m[2],c)},k=a.decimalResolution("RESOLUTION");k&&(g.width=k.width,g.height=k.height),i((a.CODECS||"").split(/[ ,]+/).filter(function(A){return A}),g),g.videoCodec&&g.videoCodec.indexOf("avc1")!==-1&&(g.videoCodec=l.convertAVC1ToAVCOTI(g.videoCodec)),p.push(g)}else if(m[3]){var S=new R.AttrList(m[3]);S["DATA-ID"]&&(r=!0,y[S["DATA-ID"]]=S)}return{levels:p,sessionData:r?y:null}},l.parseMasterPlaylistMedia=function(n,c,m,p){var y;p===void 0&&(p=[]);var r=[],a=0;for(v.lastIndex=0;(y=v.exec(n))!==null;){var g=new R.AttrList(y[1]);if(g.TYPE===m){var k={attrs:g,bitrate:0,id:a++,groupId:g["GROUP-ID"],instreamId:g["INSTREAM-ID"],name:g.NAME||g.LANGUAGE||"",type:m,default:g.bool("DEFAULT"),autoselect:g.bool("AUTOSELECT"),forced:g.bool("FORCED"),lang:g.LANGUAGE,url:g.URI?l.resolve(g.URI,c):""};if(p.length){var S=l.findGroup(p,k.groupId)||p[0];t(k,S,"audioCodec"),t(k,S,"textCodec")}r.push(k)}}return r},l.parseLevelPlaylist=function(n,c,m,p,y){var r,a,g,k=new _.LevelDetails(c),S=k.fragments,A=null,I=0,w=0,O=0,F=0,M=null,N=new L.Fragment(p,c),B=-1,U=!1;for(b.lastIndex=0,k.m3u8=n;(r=b.exec(n))!==null;){U&&(U=!1,(N=new L.Fragment(p,c)).start=O,N.sn=I,N.cc=F,N.level=m,A&&(N.initSegment=A,N.rawProgramDateTime=A.rawProgramDateTime));var j=r[1];if(j){N.duration=parseFloat(j);var W=(" "+r[2]).slice(1);N.title=W||null,N.tagList.push(W?["INF",j,W]:["INF",j])}else if(r[3])Object(D.isFiniteNumber)(N.duration)&&(N.start=O,g&&(N.levelkey=g),N.sn=I,N.level=m,N.cc=F,N.urlId=y,S.push(N),N.relurl=(" "+r[3]).slice(1),s(N,M),M=N,O+=N.duration,I++,w=0,U=!0);else if(r[4]){var $=(" "+r[4]).slice(1);M?N.setByteRange($,M):N.setByteRange($)}else if(r[5])N.rawProgramDateTime=(" "+r[5]).slice(1),N.tagList.push(["PROGRAM-DATE-TIME",N.rawProgramDateTime]),B===-1&&(B=S.length);else{if(!(r=r[0].match(T))){o.logger.warn("No matches on slow regex match for level playlist!");continue}for(a=1;a<r.length&&r[a]===void 0;a++);var X=(" "+r[a]).slice(1),Y=(" "+r[a+1]).slice(1),Z=r[a+2]?(" "+r[a+2]).slice(1):"";switch(X){case"PLAYLIST-TYPE":k.type=Y.toUpperCase();break;case"MEDIA-SEQUENCE":I=k.startSN=parseInt(Y);break;case"SKIP":var ue=new R.AttrList(Y),ce=ue.decimalInteger("SKIPPED-SEGMENTS");if(Object(D.isFiniteNumber)(ce)){k.skippedSegments=ce;for(var ge=ce;ge--;)S.unshift(null);I+=ce}var ie=ue.enumeratedString("RECENTLY-REMOVED-DATERANGES");ie&&(k.recentlyRemovedDateranges=ie.split("	"));break;case"TARGETDURATION":k.targetduration=parseFloat(Y);break;case"VERSION":k.version=parseInt(Y);break;case"EXTM3U":break;case"ENDLIST":k.live=!1;break;case"#":(Y||Z)&&N.tagList.push(Z?[Y,Z]:[Y]);break;case"DIS":F++;case"GAP":N.tagList.push([X]);break;case"BITRATE":N.tagList.push([X,Y]);break;case"DISCONTINUITY-SEQ":F=parseInt(Y);break;case"KEY":var he,se=new R.AttrList(Y),oe=se.enumeratedString("METHOD"),me=se.URI,pe=se.hexadecimalInteger("IV"),Se=se.enumeratedString("KEYFORMATVERSIONS"),Te=se.enumeratedString("KEYID"),_e=(he=se.enumeratedString("KEYFORMAT"))!=null?he:"identity";if(["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"].indexOf(_e)>-1){o.logger.warn("Keyformat "+_e+" is not supported from the manifest");continue}if(_e!=="identity")continue;oe&&(g=C.LevelKey.fromURL(c,me),me&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(oe)>=0&&(g.method=oe,g.keyFormat=_e,Te&&(g.keyID=Te),Se&&(g.keyFormatVersions=Se),g.iv=pe));break;case"START":var Re=new R.AttrList(Y).decimalFloatingPoint("TIME-OFFSET");Object(D.isFiniteNumber)(Re)&&(k.startTimeOffset=Re);break;case"MAP":var H=new R.AttrList(Y);N.relurl=H.URI,H.BYTERANGE&&N.setByteRange(H.BYTERANGE),N.level=m,N.sn="initSegment",g&&(N.levelkey=g),N.initSegment=null,A=N,U=!0;break;case"SERVER-CONTROL":var ee=new R.AttrList(Y);k.canBlockReload=ee.bool("CAN-BLOCK-RELOAD"),k.canSkipUntil=ee.optionalFloat("CAN-SKIP-UNTIL",0),k.canSkipDateRanges=k.canSkipUntil>0&&ee.bool("CAN-SKIP-DATERANGES"),k.partHoldBack=ee.optionalFloat("PART-HOLD-BACK",0),k.holdBack=ee.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var Ee=new R.AttrList(Y);k.partTarget=Ee.decimalFloatingPoint("PART-TARGET");break;case"PART":var ke=k.partList;ke||(ke=k.partList=[]);var Ne=w>0?ke[ke.length-1]:void 0,ze=w++,qe=new L.Part(new R.AttrList(Y),N,c,ze,Ne);ke.push(qe),N.duration+=qe.duration;break;case"PRELOAD-HINT":var je=new R.AttrList(Y);k.preloadHint=je;break;case"RENDITION-REPORT":var Xe=new R.AttrList(Y);k.renditionReports=k.renditionReports||[],k.renditionReports.push(Xe);break;default:o.logger.warn("line parsed but not handled: "+r)}}}M&&!M.relurl?(S.pop(),O-=M.duration,k.partList&&(k.fragmentHint=M)):k.partList&&(s(N,M),N.cc=F,k.fragmentHint=N);var We=S.length,V=S[0],ne=S[We-1];if((O+=k.skippedSegments*k.targetduration)>0&&We&&ne){k.averagetargetduration=O/We;var de=ne.sn;k.endSN=de!=="initSegment"?de:0,V&&(k.startCC=V.cc,V.initSegment||k.fragments.every(function(ve){return ve.relurl&&(ye=ve.relurl,u.test((Ce=(Pe=d.parseURL(ye))===null||Pe===void 0?void 0:Pe.path)!=null?Ce:""));var ye,Ce,Pe})&&(o.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(N=new L.Fragment(p,c)).relurl=ne.relurl,N.level=m,N.sn="initSegment",V.initSegment=N,k.needSidxRanges=!0))}else k.endSN=0,k.startCC=0;return k.fragmentHint&&(O+=k.fragmentHint.duration),k.totalduration=O,k.endCC=F,B>0&&function(ve,ye){for(var Ce=ve[ye],Pe=ye;Pe--;){var Ve=ve[Pe];if(!Ve)return;Ve.programDateTime=Ce.programDateTime-1e3*Ve.duration,Ce=Ve}}(S,B),k},l}();function i(l,n){["video","audio","text"].forEach(function(c){var m=l.filter(function(y){return Object(E.isCodecType)(y,c)});if(m.length){var p=m.filter(function(y){return y.lastIndexOf("avc1",0)===0||y.lastIndexOf("mp4a",0)===0});n[c+"Codec"]=p.length>0?p[0]:m[0],l=l.filter(function(y){return m.indexOf(y)===-1})}}),n.unknownCodecs=l}function t(l,n,c){var m=n[c];m&&(l[c]=m)}function s(l,n){l.rawProgramDateTime?l.programDateTime=Date.parse(l.rawProgramDateTime):n!=null&&n.programDateTime&&(l.programDateTime=n.endProgramDateTime),Object(D.isFiniteNumber)(l.programDateTime)||(l.programDateTime=null,l.rawProgramDateTime=null)}},"./src/loader/playlist-loader.ts":function(P,x,h){h.r(x);var D=h("./src/polyfills/number.ts"),d=h("./src/events.ts"),L=h("./src/errors.ts"),_=h("./src/utils/logger.ts"),C=h("./src/utils/mp4-tools.ts"),R=h("./src/loader/m3u8-parser.ts"),o=h("./src/types/loader.ts"),E=h("./src/utils/attr-list.ts");function f(b,T){var u=b.url;return u!==void 0&&u.indexOf("data:")!==0||(u=T.url),u}var v=function(){function b(u){this.hls=void 0,this.loaders=Object.create(null),this.hls=u,this.registerListeners()}var T=b.prototype;return T.registerListeners=function(){var u=this.hls;u.on(d.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.on(d.Events.LEVEL_LOADING,this.onLevelLoading,this),u.on(d.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),u.on(d.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},T.unregisterListeners=function(){var u=this.hls;u.off(d.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.off(d.Events.LEVEL_LOADING,this.onLevelLoading,this),u.off(d.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),u.off(d.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},T.createInternalLoader=function(u){var e=this.hls.config,i=e.pLoader,t=e.loader,s=new(i||t)(e);return u.loader=s,this.loaders[u.type]=s,s},T.getInternalLoader=function(u){return this.loaders[u.type]},T.resetInternalLoader=function(u){this.loaders[u]&&delete this.loaders[u]},T.destroyInternalLoaders=function(){for(var u in this.loaders){var e=this.loaders[u];e&&e.destroy(),this.resetInternalLoader(u)}},T.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},T.onManifestLoading=function(u,e){var i=e.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:o.PlaylistContextType.MANIFEST,url:i,deliveryDirectives:null})},T.onLevelLoading=function(u,e){var i=e.id,t=e.level,s=e.url,l=e.deliveryDirectives;this.load({id:i,groupId:null,level:t,responseType:"text",type:o.PlaylistContextType.LEVEL,url:s,deliveryDirectives:l})},T.onAudioTrackLoading=function(u,e){var i=e.id,t=e.groupId,s=e.url,l=e.deliveryDirectives;this.load({id:i,groupId:t,level:null,responseType:"text",type:o.PlaylistContextType.AUDIO_TRACK,url:s,deliveryDirectives:l})},T.onSubtitleTrackLoading=function(u,e){var i=e.id,t=e.groupId,s=e.url,l=e.deliveryDirectives;this.load({id:i,groupId:t,level:null,responseType:"text",type:o.PlaylistContextType.SUBTITLE_TRACK,url:s,deliveryDirectives:l})},T.load=function(u){var e,i,t,s,l,n,c=this.hls.config,m=this.getInternalLoader(u);if(m){var p=m.context;if(p&&p.url===u.url)return void _.logger.trace("[playlist-loader]: playlist request ongoing");_.logger.log("[playlist-loader]: aborting previous loader for type: "+u.type),m.abort()}switch(u.type){case o.PlaylistContextType.MANIFEST:i=c.manifestLoadingMaxRetry,t=c.manifestLoadingTimeOut,s=c.manifestLoadingRetryDelay,l=c.manifestLoadingMaxRetryTimeout;break;case o.PlaylistContextType.LEVEL:case o.PlaylistContextType.AUDIO_TRACK:case o.PlaylistContextType.SUBTITLE_TRACK:i=0,t=c.levelLoadingTimeOut;break;default:i=c.levelLoadingMaxRetry,t=c.levelLoadingTimeOut,s=c.levelLoadingRetryDelay,l=c.levelLoadingMaxRetryTimeout}if(m=this.createInternalLoader(u),(e=u.deliveryDirectives)!==null&&e!==void 0&&e.part&&(u.type===o.PlaylistContextType.LEVEL&&u.level!==null?n=this.hls.levels[u.level].details:u.type===o.PlaylistContextType.AUDIO_TRACK&&u.id!==null?n=this.hls.audioTracks[u.id].details:u.type===o.PlaylistContextType.SUBTITLE_TRACK&&u.id!==null&&(n=this.hls.subtitleTracks[u.id].details),n)){var y=n.partTarget,r=n.targetduration;y&&r&&(t=Math.min(1e3*Math.max(3*y,.8*r),t))}var a={timeout:t,maxRetry:i,retryDelay:s,maxRetryDelay:l,highWaterMark:0},g={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};m.load(u,a,g)},T.loadsuccess=function(u,e,i,t){if(t===void 0&&(t=null),i.isSidxRequest)return this.handleSidxRequest(u,i),void this.handlePlaylistLoaded(u,e,i,t);this.resetInternalLoader(i.type);var s=u.data;s.indexOf("#EXTM3U")===0?(e.parsing.start=performance.now(),s.indexOf("#EXTINF:")>0||s.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(u,e,i,t):this.handleMasterPlaylist(u,e,i,t)):this.handleManifestParsingError(u,i,"no EXTM3U delimiter",t)},T.loaderror=function(u,e,i){i===void 0&&(i=null),this.handleNetworkError(e,i,!1,u)},T.loadtimeout=function(u,e,i){i===void 0&&(i=null),this.handleNetworkError(e,i,!0)},T.handleMasterPlaylist=function(u,e,i,t){var s=this.hls,l=u.data,n=f(u,i),c=R.default.parseMasterPlaylist(l,n),m=c.levels,p=c.sessionData;if(m.length){var y=m.map(function(S){return{id:S.attrs.AUDIO,audioCodec:S.audioCodec}}),r=m.map(function(S){return{id:S.attrs.SUBTITLES,textCodec:S.textCodec}}),a=R.default.parseMasterPlaylistMedia(l,n,"AUDIO",y),g=R.default.parseMasterPlaylistMedia(l,n,"SUBTITLES",r),k=R.default.parseMasterPlaylistMedia(l,n,"CLOSED-CAPTIONS");a.length&&(a.some(function(S){return!S.url})||!m[0].audioCodec||m[0].attrs.AUDIO||(_.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),a.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new E.AttrList({}),bitrate:0,url:""}))),s.trigger(d.Events.MANIFEST_LOADED,{levels:m,audioTracks:a,subtitles:g,captions:k,url:n,stats:e,networkDetails:t,sessionData:p})}else this.handleManifestParsingError(u,i,"no level found in manifest",t)},T.handleTrackOrLevelPlaylist=function(u,e,i,t){var s=this.hls,l=i.id,n=i.level,c=i.type,m=f(u,i),p=Object(D.isFiniteNumber)(l)?l:0,y=Object(D.isFiniteNumber)(n)?n:p,r=function(A){switch(A.type){case o.PlaylistContextType.AUDIO_TRACK:return o.PlaylistLevelType.AUDIO;case o.PlaylistContextType.SUBTITLE_TRACK:return o.PlaylistLevelType.SUBTITLE;default:return o.PlaylistLevelType.MAIN}}(i),a=R.default.parseLevelPlaylist(u.data,m,y,r,p);if(a.fragments.length){if(c===o.PlaylistContextType.MANIFEST){var g={attrs:new E.AttrList({}),bitrate:0,details:a,name:"",url:m};s.trigger(d.Events.MANIFEST_LOADED,{levels:[g],audioTracks:[],url:m,stats:e,networkDetails:t,sessionData:null})}if(e.parsing.end=performance.now(),a.needSidxRanges){var k,S=(k=a.fragments[0].initSegment)===null||k===void 0?void 0:k.url;this.load({url:S,isSidxRequest:!0,type:c,level:n,levelDetails:a,id:l,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null})}else i.levelDetails=a,this.handlePlaylistLoaded(u,e,i,t)}else s.trigger(d.Events.ERROR,{type:L.ErrorTypes.NETWORK_ERROR,details:L.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:m,reason:"no fragments found in level",level:typeof i.level=="number"?i.level:void 0})},T.handleSidxRequest=function(u,e){var i=Object(C.parseSegmentIndex)(new Uint8Array(u.data));if(i){var t=i.references,s=e.levelDetails;t.forEach(function(l,n){var c=l.info,m=s.fragments[n];m.byteRange.length===0&&m.setByteRange(String(1+c.end-c.start)+"@"+String(c.start)),m.initSegment&&m.initSegment.setByteRange(String(i.moovEndOffset)+"@0")})}},T.handleManifestParsingError=function(u,e,i,t){this.hls.trigger(d.Events.ERROR,{type:L.ErrorTypes.NETWORK_ERROR,details:L.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:e.type===o.PlaylistContextType.MANIFEST,url:u.url,reason:i,response:u,context:e,networkDetails:t})},T.handleNetworkError=function(u,e,i,t){i===void 0&&(i=!1),_.logger.warn("[playlist-loader]: A network "+(i?"timeout":"error")+" occurred while loading "+u.type+" level: "+u.level+" id: "+u.id+' group-id: "'+u.groupId+'"');var s=L.ErrorDetails.UNKNOWN,l=!1,n=this.getInternalLoader(u);switch(u.type){case o.PlaylistContextType.MANIFEST:s=i?L.ErrorDetails.MANIFEST_LOAD_TIMEOUT:L.ErrorDetails.MANIFEST_LOAD_ERROR,l=!0;break;case o.PlaylistContextType.LEVEL:s=i?L.ErrorDetails.LEVEL_LOAD_TIMEOUT:L.ErrorDetails.LEVEL_LOAD_ERROR,l=!1;break;case o.PlaylistContextType.AUDIO_TRACK:s=i?L.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:L.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,l=!1;break;case o.PlaylistContextType.SUBTITLE_TRACK:s=i?L.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:L.ErrorDetails.SUBTITLE_LOAD_ERROR,l=!1}n&&this.resetInternalLoader(u.type);var c={type:L.ErrorTypes.NETWORK_ERROR,details:s,fatal:l,url:u.url,loader:n,context:u,networkDetails:e};t&&(c.response=t),this.hls.trigger(d.Events.ERROR,c)},T.handlePlaylistLoaded=function(u,e,i,t){var s=i.type,l=i.level,n=i.id,c=i.groupId,m=i.loader,p=i.levelDetails,y=i.deliveryDirectives;if(p!=null&&p.targetduration){if(m)switch(p.live&&(m.getCacheAge&&(p.ageHeader=m.getCacheAge()||0),m.getCacheAge&&!isNaN(p.ageHeader)||(p.ageHeader=0)),s){case o.PlaylistContextType.MANIFEST:case o.PlaylistContextType.LEVEL:this.hls.trigger(d.Events.LEVEL_LOADED,{details:p,level:l||0,id:n||0,stats:e,networkDetails:t,deliveryDirectives:y});break;case o.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(d.Events.AUDIO_TRACK_LOADED,{details:p,id:n||0,groupId:c||"",stats:e,networkDetails:t,deliveryDirectives:y});break;case o.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(d.Events.SUBTITLE_TRACK_LOADED,{details:p,id:n||0,groupId:c||"",stats:e,networkDetails:t,deliveryDirectives:y})}}else this.handleManifestParsingError(u,i,"invalid target duration",t)},b}();x.default=v},"./src/polyfills/number.ts":function(P,x,h){h.r(x),h.d(x,"isFiniteNumber",function(){return D}),h.d(x,"MAX_SAFE_INTEGER",function(){return d});var D=Number.isFinite||function(L){return typeof L=="number"&&isFinite(L)},d=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(P,x,h){h.r(x);var D=function(){function d(){}return d.getSilentFrame=function(L,_){switch(L){case"mp4a.40.2":if(_===1)return new Uint8Array([0,200,0,128,35,128]);if(_===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(_===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(_===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(_===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(_===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(_===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(_===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(_===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},d}();x.default=D},"./src/remux/mp4-generator.ts":function(P,x,h){h.r(x);var D=Math.pow(2,32)-1,d=function(){function L(){}return L.init=function(){var _;for(_ in L.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},L.types)L.types.hasOwnProperty(_)&&(L.types[_]=[_.charCodeAt(0),_.charCodeAt(1),_.charCodeAt(2),_.charCodeAt(3)]);var C=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),R=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);L.HDLR_TYPES={video:C,audio:R};var o=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),E=new Uint8Array([0,0,0,0,0,0,0,0]);L.STTS=L.STSC=L.STCO=E,L.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),L.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),L.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),L.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var f=new Uint8Array([105,115,111,109]),v=new Uint8Array([97,118,99,49]),b=new Uint8Array([0,0,0,1]);L.FTYP=L.box(L.types.ftyp,f,b,f,v),L.DINF=L.box(L.types.dinf,L.box(L.types.dref,o))},L.box=function(_){for(var C=8,R=arguments.length,o=new Array(R>1?R-1:0),E=1;E<R;E++)o[E-1]=arguments[E];for(var f=o.length,v=f;f--;)C+=o[f].byteLength;var b=new Uint8Array(C);for(b[0]=C>>24&255,b[1]=C>>16&255,b[2]=C>>8&255,b[3]=255&C,b.set(_,4),f=0,C=8;f<v;f++)b.set(o[f],C),C+=o[f].byteLength;return b},L.hdlr=function(_){return L.box(L.types.hdlr,L.HDLR_TYPES[_])},L.mdat=function(_){return L.box(L.types.mdat,_)},L.mdhd=function(_,C){C*=_;var R=Math.floor(C/(D+1)),o=Math.floor(C%(D+1));return L.box(L.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,_>>24&255,_>>16&255,_>>8&255,255&_,R>>24,R>>16&255,R>>8&255,255&R,o>>24,o>>16&255,o>>8&255,255&o,85,196,0,0]))},L.mdia=function(_){return L.box(L.types.mdia,L.mdhd(_.timescale,_.duration),L.hdlr(_.type),L.minf(_))},L.mfhd=function(_){return L.box(L.types.mfhd,new Uint8Array([0,0,0,0,_>>24,_>>16&255,_>>8&255,255&_]))},L.minf=function(_){return _.type==="audio"?L.box(L.types.minf,L.box(L.types.smhd,L.SMHD),L.DINF,L.stbl(_)):L.box(L.types.minf,L.box(L.types.vmhd,L.VMHD),L.DINF,L.stbl(_))},L.moof=function(_,C,R){return L.box(L.types.moof,L.mfhd(_),L.traf(R,C))},L.moov=function(_){for(var C=_.length,R=[];C--;)R[C]=L.trak(_[C]);return L.box.apply(null,[L.types.moov,L.mvhd(_[0].timescale,_[0].duration)].concat(R).concat(L.mvex(_)))},L.mvex=function(_){for(var C=_.length,R=[];C--;)R[C]=L.trex(_[C]);return L.box.apply(null,[L.types.mvex].concat(R))},L.mvhd=function(_,C){C*=_;var R=Math.floor(C/(D+1)),o=Math.floor(C%(D+1)),E=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,_>>24&255,_>>16&255,_>>8&255,255&_,R>>24,R>>16&255,R>>8&255,255&R,o>>24,o>>16&255,o>>8&255,255&o,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return L.box(L.types.mvhd,E)},L.sdtp=function(_){var C,R,o=_.samples||[],E=new Uint8Array(4+o.length);for(C=0;C<o.length;C++)R=o[C].flags,E[C+4]=R.dependsOn<<4|R.isDependedOn<<2|R.hasRedundancy;return L.box(L.types.sdtp,E)},L.stbl=function(_){return L.box(L.types.stbl,L.stsd(_),L.box(L.types.stts,L.STTS),L.box(L.types.stsc,L.STSC),L.box(L.types.stsz,L.STSZ),L.box(L.types.stco,L.STCO))},L.avc1=function(_){var C,R,o,E=[],f=[];for(C=0;C<_.sps.length;C++)o=(R=_.sps[C]).byteLength,E.push(o>>>8&255),E.push(255&o),E=E.concat(Array.prototype.slice.call(R));for(C=0;C<_.pps.length;C++)o=(R=_.pps[C]).byteLength,f.push(o>>>8&255),f.push(255&o),f=f.concat(Array.prototype.slice.call(R));var v=L.box(L.types.avcC,new Uint8Array([1,E[3],E[4],E[5],255,224|_.sps.length].concat(E).concat([_.pps.length]).concat(f))),b=_.width,T=_.height,u=_.pixelRatio[0],e=_.pixelRatio[1];return L.box(L.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,b>>8&255,255&b,T>>8&255,255&T,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),v,L.box(L.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),L.box(L.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,255&u,e>>24,e>>16&255,e>>8&255,255&e])))},L.esds=function(_){var C=_.config.length;return new Uint8Array([0,0,0,0,3,23+C,0,1,0,4,15+C,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([C]).concat(_.config).concat([6,1,2]))},L.mp4a=function(_){var C=_.samplerate;return L.box(L.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,_.channelCount,0,16,0,0,0,0,C>>8&255,255&C,0,0]),L.box(L.types.esds,L.esds(_)))},L.mp3=function(_){var C=_.samplerate;return L.box(L.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,_.channelCount,0,16,0,0,0,0,C>>8&255,255&C,0,0]))},L.stsd=function(_){return _.type==="audio"?_.isAAC||_.codec!=="mp3"?L.box(L.types.stsd,L.STSD,L.mp4a(_)):L.box(L.types.stsd,L.STSD,L.mp3(_)):L.box(L.types.stsd,L.STSD,L.avc1(_))},L.tkhd=function(_){var C=_.id,R=_.duration*_.timescale,o=_.width,E=_.height,f=Math.floor(R/(D+1)),v=Math.floor(R%(D+1));return L.box(L.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,C>>24&255,C>>16&255,C>>8&255,255&C,0,0,0,0,f>>24,f>>16&255,f>>8&255,255&f,v>>24,v>>16&255,v>>8&255,255&v,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,o>>8&255,255&o,0,0,E>>8&255,255&E,0,0]))},L.traf=function(_,C){var R=L.sdtp(_),o=_.id,E=Math.floor(C/(D+1)),f=Math.floor(C%(D+1));return L.box(L.types.traf,L.box(L.types.tfhd,new Uint8Array([0,0,0,0,o>>24,o>>16&255,o>>8&255,255&o])),L.box(L.types.tfdt,new Uint8Array([1,0,0,0,E>>24,E>>16&255,E>>8&255,255&E,f>>24,f>>16&255,f>>8&255,255&f])),L.trun(_,R.length+16+20+8+16+8+8),R)},L.trak=function(_){return _.duration=_.duration||4294967295,L.box(L.types.trak,L.tkhd(_),L.mdia(_))},L.trex=function(_){var C=_.id;return L.box(L.types.trex,new Uint8Array([0,0,0,0,C>>24,C>>16&255,C>>8&255,255&C,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},L.trun=function(_,C){var R,o,E,f,v,b,T=_.samples||[],u=T.length,e=12+16*u,i=new Uint8Array(e);for(C+=8+e,i.set([0,0,15,1,u>>>24&255,u>>>16&255,u>>>8&255,255&u,C>>>24&255,C>>>16&255,C>>>8&255,255&C],0),R=0;R<u;R++)E=(o=T[R]).duration,f=o.size,v=o.flags,b=o.cts,i.set([E>>>24&255,E>>>16&255,E>>>8&255,255&E,f>>>24&255,f>>>16&255,f>>>8&255,255&f,v.isLeading<<2|v.dependsOn,v.isDependedOn<<6|v.hasRedundancy<<4|v.paddingValue<<1|v.isNonSync,61440&v.degradPrio,15&v.degradPrio,b>>>24&255,b>>>16&255,b>>>8&255,255&b],12+16*R);return L.box(L.types.trun,i)},L.initSegment=function(_){L.types||L.init();var C=L.moov(_),R=new Uint8Array(L.FTYP.byteLength+C.byteLength);return R.set(L.FTYP),R.set(C,L.FTYP.byteLength),R},L}();d.types=void 0,d.HDLR_TYPES=void 0,d.STTS=void 0,d.STSC=void 0,d.STCO=void 0,d.STSZ=void 0,d.VMHD=void 0,d.SMHD=void 0,d.STSD=void 0,d.FTYP=void 0,d.DINF=void 0,x.default=d},"./src/remux/mp4-remuxer.ts":function(P,x,h){h.r(x),h.d(x,"default",function(){return u}),h.d(x,"normalizePts",function(){return e});var D=h("./src/polyfills/number.ts"),d=h("./src/remux/aac-helper.ts"),L=h("./src/remux/mp4-generator.ts"),_=h("./src/events.ts"),C=h("./src/errors.ts"),R=h("./src/utils/logger.ts"),o=h("./src/types/loader.ts"),E=h("./src/utils/timescale-conversion.ts");function f(){return(f=Object.assign||function(s){for(var l=1;l<arguments.length;l++){var n=arguments[l];for(var c in n)Object.prototype.hasOwnProperty.call(n,c)&&(s[c]=n[c])}return s}).apply(this,arguments)}var v=null,b=null,T=!1,u=function(){function s(n,c,m,p){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=n,this.config=c,this.typeSupported=m,this.ISGenerated=!1,v===null){var y=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);v=y?parseInt(y[1]):0}if(b===null){var r=navigator.userAgent.match(/Safari\/(\d+)/i);b=r?parseInt(r[1]):0}T=!!v&&v<75||!!b&&b<600}var l=s.prototype;return l.destroy=function(){},l.resetTimeStamp=function(n){R.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=n},l.resetNextTimestamp=function(){R.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},l.resetInitSegment=function(){R.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},l.getVideoStartPts=function(n){var c=!1,m=n.reduce(function(p,y){var r=y.pts-p;return r<-4294967296?(c=!0,e(p,y.pts)):r>0?p:y.pts},n[0].pts);return c&&R.logger.debug("PTS rollover detected"),m},l.remux=function(n,c,m,p,y,r,a,g){var k,S,A,I,w,O,F=y,M=y,N=n.pid>-1,B=c.pid>-1,U=c.samples.length,j=n.samples.length>0,W=U>1;if((!N||j)&&(!B||W)||this.ISGenerated||a){this.ISGenerated||(A=this.generateIS(n,c,y));var $=this.isVideoContiguous,X=-1;if(W&&(X=function(ge){for(var ie=0;ie<ge.length;ie++)if(ge[ie].key)return ie;return-1}(c.samples),!$&&this.config.forceKeyFrameOnDiscontinuity))if(O=!0,X>0){R.logger.warn("[mp4-remuxer]: Dropped "+X+" out of "+U+" video samples due to a missing keyframe");var Y=this.getVideoStartPts(c.samples);c.samples=c.samples.slice(X),c.dropped+=X,M+=(c.samples[0].pts-Y)/(c.timescale||9e4)}else X===-1&&(R.logger.warn("[mp4-remuxer]: No keyframe found out of "+U+" video samples"),O=!1);if(this.ISGenerated){if(j&&W){var Z=this.getVideoStartPts(c.samples),ue=(e(n.samples[0].pts,Z)-Z)/c.inputTimeScale;F+=Math.max(0,ue),M+=Math.max(0,-ue)}if(j){if(n.samplerate||(R.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),A=this.generateIS(n,c,y)),S=this.remuxAudio(n,F,this.isAudioContiguous,r,B||W||g===o.PlaylistLevelType.AUDIO?M:void 0),W){var ce=S?S.endPTS-S.startPTS:0;c.inputTimeScale||(R.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),A=this.generateIS(n,c,y)),k=this.remuxVideo(c,M,$,ce)}}else W&&(k=this.remuxVideo(c,M,$,0));k&&(k.firstKeyFrame=X,k.independent=X!==-1)}}return this.ISGenerated&&(m.samples.length&&(w=this.remuxID3(m,y)),p.samples.length&&(I=this.remuxText(p,y))),{audio:S,video:k,initSegment:A,independent:O,text:I,id3:w}},l.generateIS=function(n,c,m){var p,y,r,a=n.samples,g=c.samples,k=this.typeSupported,S={},A=!Object(D.isFiniteNumber)(this._initPTS),I="audio/mp4";if(A&&(p=y=1/0),n.config&&a.length&&(n.timescale=n.samplerate,n.isAAC||(k.mpeg?(I="audio/mpeg",n.codec=""):k.mp3&&(n.codec="mp3")),S.audio={id:"audio",container:I,codec:n.codec,initSegment:!n.isAAC&&k.mpeg?new Uint8Array(0):L.default.initSegment([n]),metadata:{channelCount:n.channelCount}},A&&(r=n.inputTimeScale,p=y=a[0].pts-Math.round(r*m))),c.sps&&c.pps&&g.length&&(c.timescale=c.inputTimeScale,S.video={id:"main",container:"video/mp4",codec:c.codec,initSegment:L.default.initSegment([c]),metadata:{width:c.width,height:c.height}},A)){r=c.inputTimeScale;var w=this.getVideoStartPts(g),O=Math.round(r*m);y=Math.min(y,e(g[0].dts,w)-O),p=Math.min(p,w-O)}if(Object.keys(S).length)return this.ISGenerated=!0,A&&(this._initPTS=p,this._initDTS=y),{tracks:S,initPTS:p,timescale:r}},l.remuxVideo=function(n,c,m,p){var y,r,a,g=n.inputTimeScale,k=n.samples,S=[],A=k.length,I=this._initPTS,w=this.nextAvcDts,O=8,F=Number.POSITIVE_INFINITY,M=Number.NEGATIVE_INFINITY,N=0,B=!1;m&&w!==null||(w=c*g-(k[0].pts-e(k[0].dts,k[0].pts)));for(var U=0;U<A;U++){var j=k[U];j.pts=e(j.pts-I,w),j.dts=e(j.dts-I,w),j.dts>j.pts&&(N=Math.max(Math.min(N,j.pts-j.dts),-18e3)),j.dts<k[U>0?U-1:U].dts&&(B=!0)}B&&k.sort(function(Pe,Ve){var Er=Pe.dts-Ve.dts,br=Pe.pts-Ve.pts;return Er||br}),r=k[0].dts,a=k[k.length-1].dts;var W=Math.round((a-r)/(A-1));if(N<0){if(N<-2*W){R.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(E.toMsFromMpegTsClock)(-W,!0)+" ms");for(var $=N,X=0;X<A;X++)k[X].dts=$=Math.max($,k[X].pts-W),k[X].pts=Math.max($,k[X].pts)}else{R.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(E.toMsFromMpegTsClock)(N,!0)+" ms to overcome this issue");for(var Y=0;Y<A;Y++)k[Y].dts=k[Y].dts+N}r=k[0].dts}if(m){var Z=r-w,ue=Z>W;if(ue||Z<-1){ue?R.logger.warn("AVC: "+Object(E.toMsFromMpegTsClock)(Z,!0)+" ms ("+Z+"dts) hole between fragments detected, filling it"):R.logger.warn("AVC: "+Object(E.toMsFromMpegTsClock)(-Z,!0)+" ms ("+Z+"dts) overlapping between fragments detected"),r=w;var ce=k[0].pts-Z;k[0].dts=r,k[0].pts=ce,R.logger.log("Video: First PTS/DTS adjusted: "+Object(E.toMsFromMpegTsClock)(ce,!0)+"/"+Object(E.toMsFromMpegTsClock)(r,!0)+", delta: "+Object(E.toMsFromMpegTsClock)(Z,!0)+" ms")}}T&&(r=Math.max(0,r));for(var ge=0,ie=0,he=0;he<A;he++){for(var se=k[he],oe=se.units,me=oe.length,pe=0,Se=0;Se<me;Se++)pe+=oe[Se].data.length;ie+=pe,ge+=me,se.length=pe,se.dts=Math.max(se.dts,r),se.pts=Math.max(se.pts,se.dts,0),F=Math.min(se.pts,F),M=Math.max(se.pts,M)}a=k[A-1].dts;var Te,_e=ie+4*ge+8;try{Te=new Uint8Array(_e)}catch{return void this.observer.emit(_.Events.ERROR,_.Events.ERROR,{type:C.ErrorTypes.MUX_ERROR,details:C.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:_e,reason:"fail allocating video mdat "+_e})}var Re=new DataView(Te.buffer);Re.setUint32(0,_e),Te.set(L.default.types.mdat,4);for(var H=0;H<A;H++){for(var ee=k[H],Ee=ee.units,ke=0,Ne=0,ze=Ee.length;Ne<ze;Ne++){var qe=Ee[Ne],je=qe.data,Xe=qe.data.byteLength;Re.setUint32(O,Xe),O+=4,Te.set(je,O),O+=Xe,ke+=4+Xe}if(H<A-1)y=k[H+1].dts-ee.dts;else{var We=this.config,V=ee.dts-k[H>0?H-1:H].dts;if(We.stretchShortVideoTrack&&this.nextAudioPts!==null){var ne=Math.floor(We.maxBufferHole*g),de=(p?F+p*g:this.nextAudioPts)-ee.pts;de>ne?((y=de-V)<0&&(y=V),R.logger.log("[mp4-remuxer]: It is approximately "+de/90+" ms to the next segment; using duration "+y/90+" ms for the last video frame.")):y=V}else y=V}var ve=Math.round(ee.pts-ee.dts);S.push(new i(ee.key,y,ke,ve))}if(S.length&&v&&v<70){var ye=S[0].flags;ye.dependsOn=2,ye.isNonSync=0}console.assert(y!==void 0,"mp4SampleDuration must be computed"),this.nextAvcDts=w=a+y,this.isVideoContiguous=!0;var Ce={data1:L.default.moof(n.sequenceNumber++,r,f({},n,{samples:S})),data2:Te,startPTS:F/g,endPTS:(M+y)/g,startDTS:r/g,endDTS:w/g,type:"video",hasAudio:!1,hasVideo:!0,nb:S.length,dropped:n.dropped};return n.samples=[],n.dropped=0,console.assert(Te.length,"MDAT length must not be zero"),Ce},l.remuxAudio=function(n,c,m,p,y){var r=n.inputTimeScale,a=r/(n.samplerate?n.samplerate:r),g=n.isAAC?1024:1152,k=g*a,S=this._initPTS,A=!n.isAAC&&this.typeSupported.mpeg,I=[],w=n.samples,O=A?0:8,F=this.nextAudioPts||-1,M=c*r;if(this.isAudioContiguous=m=m||w.length&&F>0&&(p&&Math.abs(M-F)<9e3||Math.abs(e(w[0].pts-S,M)-F)<20*k),w.forEach(function(je){je.pts=e(je.pts-S,M)}),!m||F<0){if(!(w=w.filter(function(je){return je.pts>=0})).length)return;F=y===0?0:p?Math.max(0,M):w[0].pts}if(n.isAAC)for(var N=y!==void 0,B=this.config.maxAudioFramesDrift,U=0,j=F;U<w.length;U++){var W=w[U],$=W.pts,X=$-j,Y=Math.abs(1e3*X/r);if(X<=-B*k&&N)U===0&&(R.logger.warn("Audio frame @ "+($/r).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*X/r)+" ms."),this.nextAudioPts=F=j=$);else if(X>=B*k&&Y<1e4&&N){var Z=Math.round(X/k);(j=$-Z*k)<0&&(Z--,j+=k),U===0&&(this.nextAudioPts=F=j),R.logger.warn("[mp4-remuxer]: Injecting "+Z+" audio frame @ "+(j/r).toFixed(3)+"s due to "+Math.round(1e3*X/r)+" ms gap.");for(var ue=0;ue<Z;ue++){var ce=Math.max(j,0),ge=d.default.getSilentFrame(n.manifestCodec||n.codec,n.channelCount);ge||(R.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),ge=W.unit.subarray()),w.splice(U,0,{unit:ge,pts:ce}),j+=k,U++}}W.pts=j,j+=k}for(var ie,he=null,se=null,oe=0,me=w.length;me--;)oe+=w[me].unit.byteLength;for(var pe=0,Se=w.length;pe<Se;pe++){var Te=w[pe],_e=Te.unit,Re=Te.pts;if(se!==null)I[pe-1].duration=Math.round((Re-se)/a);else{if(m&&n.isAAC&&(Re=F),he=Re,!(oe>0))return;oe+=O;try{ie=new Uint8Array(oe)}catch{return void this.observer.emit(_.Events.ERROR,_.Events.ERROR,{type:C.ErrorTypes.MUX_ERROR,details:C.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:oe,reason:"fail allocating audio mdat "+oe})}A||(new DataView(ie.buffer).setUint32(0,oe),ie.set(L.default.types.mdat,4))}ie.set(_e,O);var H=_e.byteLength;O+=H,I.push(new i(!0,g,H,0)),se=Re}var ee=I.length;if(ee){var Ee=I[I.length-1];this.nextAudioPts=F=se+a*Ee.duration;var ke=A?new Uint8Array(0):L.default.moof(n.sequenceNumber++,he/a,f({},n,{samples:I}));n.samples=[];var Ne=he/r,ze=F/r,qe={data1:ke,data2:ie,startPTS:Ne,endPTS:ze,startDTS:Ne,endDTS:ze,type:"audio",hasAudio:!0,hasVideo:!1,nb:ee};return this.isAudioContiguous=!0,console.assert(ie.length,"MDAT length must not be zero"),qe}},l.remuxEmptyAudio=function(n,c,m,p){var y=n.inputTimeScale,r=y/(n.samplerate?n.samplerate:y),a=this.nextAudioPts,g=(a!==null?a:p.startDTS*y)+this._initDTS,k=p.endDTS*y+this._initDTS,S=1024*r,A=Math.ceil((k-g)/S),I=d.default.getSilentFrame(n.manifestCodec||n.codec,n.channelCount);if(R.logger.warn("[mp4-remuxer]: remux empty Audio"),I){for(var w=[],O=0;O<A;O++){var F=g+O*S;w.push({unit:I,pts:F,dts:F})}return n.samples=w,this.remuxAudio(n,c,m,!1)}R.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},l.remuxID3=function(n,c){var m=n.samples.length;if(m){for(var p=n.inputTimeScale,y=this._initPTS,r=this._initDTS,a=0;a<m;a++){var g=n.samples[a];g.pts=e(g.pts-y,c*p)/p,g.dts=e(g.dts-r,c*p)/p}var k=n.samples;return n.samples=[],{samples:k}}},l.remuxText=function(n,c){var m=n.samples.length;if(m){for(var p=n.inputTimeScale,y=this._initPTS,r=0;r<m;r++){var a=n.samples[r];a.pts=e(a.pts-y,c*p)/p}n.samples.sort(function(k,S){return k.pts-S.pts});var g=n.samples;return n.samples=[],{samples:g}}},s}();function e(s,l){var n;if(l===null)return s;for(n=l<s?-8589934592:8589934592;Math.abs(s-l)>4294967296;)s+=n;return s}var i=function(s,l,n,c){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=l,this.size=n,this.cts=c,this.flags=new t(s)},t=function(s){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=s?2:1,this.isNonSync=s?0:1}},"./src/remux/passthrough-remuxer.ts":function(P,x,h){h.r(x);var D=h("./src/polyfills/number.ts"),d=h("./src/utils/mp4-tools.ts"),L=h("./src/loader/fragment.ts"),_=h("./src/utils/logger.ts"),C=function(){function E(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var f=E.prototype;return f.destroy=function(){},f.resetTimeStamp=function(v){this.initPTS=v,this.lastEndDTS=null},f.resetNextTimestamp=function(){this.lastEndDTS=null},f.resetInitSegment=function(v,b,T){this.audioCodec=b,this.videoCodec=T,this.generateInitSegment(v),this.emitInitSegment=!0},f.generateInitSegment=function(v){var b=this.audioCodec,T=this.videoCodec;if(!v||!v.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var u=this.initData=Object(d.parseInitSegment)(v);b||(b=o(u.audio,L.ElementaryStreamTypes.AUDIO)),T||(T=o(u.video,L.ElementaryStreamTypes.VIDEO));var e={};u.audio&&u.video?e.audiovideo={container:"video/mp4",codec:b+","+T,initSegment:v,id:"main"}:u.audio?e.audio={container:"audio/mp4",codec:b,initSegment:v,id:"audio"}:u.video?e.video={container:"video/mp4",codec:T,initSegment:v,id:"main"}:_.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=e},f.remux=function(v,b,T,u,e){var i=this.initPTS,t=this.lastEndDTS,s={audio:void 0,video:void 0,text:u,id3:T,initSegment:void 0};Object(D.isFiniteNumber)(t)||(t=this.lastEndDTS=e||0);var l=b.samples;if(!l||!l.length)return s;var n={initPTS:void 0,timescale:1},c=this.initData;if(c&&c.length||(this.generateInitSegment(l),c=this.initData),!c||!c.length)return _.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),s;this.emitInitSegment&&(n.tracks=this.initTracks,this.emitInitSegment=!1),Object(D.isFiniteNumber)(i)||(this.initPTS=n.initPTS=i=R(c,l,t));var m=Object(d.getDuration)(l,c),p=t,y=m+p;Object(d.offsetStartDTS)(c,l,i),m>0?this.lastEndDTS=y:(_.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var r=!!c.audio,a=!!c.video,g="";r&&(g+="audio"),a&&(g+="video");var k={data1:l,startPTS:p,startDTS:p,endPTS:y,endDTS:y,type:g,hasAudio:r,hasVideo:a,nb:1,dropped:0};return s.audio=k.type==="audio"?k:void 0,s.video=k.type!=="audio"?k:void 0,s.text=u,s.id3=T,s.initSegment=n,s},E}(),R=function(E,f,v){return Object(d.getStartDTS)(E,f)-v};function o(E,f){var v=E==null?void 0:E.codec;return v&&v.length>4?v:v==="hvc1"?"hvc1.1.c.L120.90":v==="av01"?"av01.0.04M.08":v==="avc1"||f===L.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}x.default=C},"./src/task-loop.ts":function(P,x,h){h.r(x),h.d(x,"default",function(){return D});var D=function(){function d(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var L=d.prototype;return L.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},L.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},L.onHandlerDestroyed=function(){},L.hasInterval=function(){return!!this._tickInterval},L.hasNextTick=function(){return!!this._tickTimer},L.setInterval=function(_){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,_),!0)},L.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},L.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},L.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},L.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},L.doTick=function(){},d}()},"./src/types/level.ts":function(P,x,h){function D(o,E){for(var f=0;f<E.length;f++){var v=E[f];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(o,v.key,v)}}var d,L;function _(o,E){var f=o.canSkipUntil,v=o.canSkipDateRanges,b=o.endSN;return f&&(E!==void 0?E-b:0)<f?v?d.v2:d.Yes:d.No}h.r(x),h.d(x,"HlsSkip",function(){return d}),h.d(x,"getSkipValue",function(){return _}),h.d(x,"HlsUrlParameters",function(){return C}),h.d(x,"Level",function(){return R}),(L=d||(d={})).No="",L.Yes="YES",L.v2="v2";var C=function(){function o(E,f,v){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=E,this.part=f,this.skip=v}return o.prototype.addDirectives=function(E){var f=new self.URL(E);return this.msn!==void 0&&f.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&f.searchParams.set("_HLS_part",this.part.toString()),this.skip&&f.searchParams.set("_HLS_skip",this.skip),f.toString()},o}(),R=function(){function o(v){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[v.url],this.attrs=v.attrs,this.bitrate=v.bitrate,v.details&&(this.details=v.details),this.id=v.id||0,this.name=v.name,this.width=v.width||0,this.height=v.height||0,this.audioCodec=v.audioCodec,this.videoCodec=v.videoCodec,this.unknownCodecs=v.unknownCodecs,this.codecSet=[v.videoCodec,v.audioCodec].filter(function(b){return b}).join(",").replace(/\.[^.,]+/g,"")}var E,f;return E=o,(f=[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(v){var b=v%this.url.length;this._urlId!==b&&(this.details=void 0,this._urlId=b)}}])&&D(E.prototype,f),o}()},"./src/types/loader.ts":function(P,x,h){var D,d,L,_;h.r(x),h.d(x,"PlaylistContextType",function(){return D}),h.d(x,"PlaylistLevelType",function(){return L}),(d=D||(D={})).MANIFEST="manifest",d.LEVEL="level",d.AUDIO_TRACK="audioTrack",d.SUBTITLE_TRACK="subtitleTrack",(_=L||(L={})).MAIN="main",_.AUDIO="audio",_.SUBTITLE="subtitle"},"./src/types/transmuxer.ts":function(P,x,h){h.r(x),h.d(x,"ChunkMetadata",function(){return D});var D=function(d,L,_,C,R,o){C===void 0&&(C=0),R===void 0&&(R=-1),o===void 0&&(o=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=d,this.sn=L,this.id=_,this.size=C,this.part=R,this.partial=o}},"./src/utils/attr-list.ts":function(P,x,h){h.r(x),h.d(x,"AttrList",function(){return L});var D=/^(\d+)x(\d+)$/,d=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,L=function(){function _(R){for(var o in typeof R=="string"&&(R=_.parseAttrList(R)),R)R.hasOwnProperty(o)&&(this[o]=R[o])}var C=_.prototype;return C.decimalInteger=function(R){var o=parseInt(this[R],10);return o>Number.MAX_SAFE_INTEGER?1/0:o},C.hexadecimalInteger=function(R){if(this[R]){var o=(this[R]||"0x").slice(2);o=(1&o.length?"0":"")+o;for(var E=new Uint8Array(o.length/2),f=0;f<o.length/2;f++)E[f]=parseInt(o.slice(2*f,2*f+2),16);return E}return null},C.hexadecimalIntegerAsNumber=function(R){var o=parseInt(this[R],16);return o>Number.MAX_SAFE_INTEGER?1/0:o},C.decimalFloatingPoint=function(R){return parseFloat(this[R])},C.optionalFloat=function(R,o){var E=this[R];return E?parseFloat(E):o},C.enumeratedString=function(R){return this[R]},C.bool=function(R){return this[R]==="YES"},C.decimalResolution=function(R){var o=D.exec(this[R]);if(o!==null)return{width:parseInt(o[1],10),height:parseInt(o[2],10)}},_.parseAttrList=function(R){var o,E={};for(d.lastIndex=0;(o=d.exec(R))!==null;){var f=o[2];f.indexOf('"')===0&&f.lastIndexOf('"')===f.length-1&&(f=f.slice(1,-1)),E[o[1]]=f}return E},_}()},"./src/utils/binary-search.ts":function(P,x,h){h.r(x),x.default={search:function(D,d){for(var L=0,_=D.length-1,C=null,R=null;L<=_;){var o=d(R=D[C=(L+_)/2|0]);if(o>0)L=C+1;else{if(!(o<0))return R;_=C-1}}return null}}},"./src/utils/buffer-helper.ts":function(P,x,h){h.r(x),h.d(x,"BufferHelper",function(){return L});var D=h("./src/utils/logger.ts"),d={length:0,start:function(){return 0},end:function(){return 0}},L=function(){function _(){}return _.isBuffered=function(C,R){try{if(C){for(var o=_.getBuffered(C),E=0;E<o.length;E++)if(R>=o.start(E)&&R<=o.end(E))return!0}}catch{}return!1},_.bufferInfo=function(C,R,o){try{if(C){var E,f=_.getBuffered(C),v=[];for(E=0;E<f.length;E++)v.push({start:f.start(E),end:f.end(E)});return this.bufferedInfo(v,R,o)}}catch{}return{len:0,start:R,end:R,nextStart:void 0}},_.bufferedInfo=function(C,R,o){R=Math.max(0,R),C.sort(function(n,c){var m=n.start-c.start;return m||c.end-n.end});var E=[];if(o)for(var f=0;f<C.length;f++){var v=E.length;if(v){var b=E[v-1].end;C[f].start-b<o?C[f].end>b&&(E[v-1].end=C[f].end):E.push(C[f])}else E.push(C[f])}else E=C;for(var T,u=0,e=R,i=R,t=0;t<E.length;t++){var s=E[t].start,l=E[t].end;if(R+o>=s&&R<l)e=s,u=(i=l)-R;else if(R+o<s){T=s;break}}return{len:u,start:e||0,end:i||0,nextStart:T}},_.getBuffered=function(C){try{return C.buffered}catch(R){return D.logger.log("failed to get media.buffered",R),d}},_}()},"./src/utils/cea-608-parser.ts":function(P,x,h){h.r(x),h.d(x,"Row",function(){return s}),h.d(x,"CaptionScreen",function(){return l});var D,d,L=h("./src/utils/logger.ts"),_={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},C=function(y){var r=y;return _.hasOwnProperty(y)&&(r=_[y]),String.fromCharCode(r)},R=15,o=100,E={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},f={17:2,18:4,21:6,22:8,23:10,19:13,20:15},v={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},b={25:2,26:4,29:6,30:8,31:10,27:13,28:15},T=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];(d=D||(D={}))[d.ERROR=0]="ERROR",d[d.TEXT=1]="TEXT",d[d.WARNING=2]="WARNING",d[d.INFO=2]="INFO",d[d.DEBUG=3]="DEBUG",d[d.DATA=3]="DATA";var u=function(){function y(){this.time=null,this.verboseLevel=D.ERROR}return y.prototype.log=function(r,a){this.verboseLevel>=r&&L.logger.log(this.time+" ["+r+"] "+a)},y}(),e=function(y){for(var r=[],a=0;a<y.length;a++)r.push(y[a].toString(16));return r},i=function(){function y(a,g,k,S,A){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=a||"white",this.underline=g||!1,this.italics=k||!1,this.background=S||"black",this.flash=A||!1}var r=y.prototype;return r.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},r.setStyles=function(a){for(var g=["foreground","underline","italics","background","flash"],k=0;k<g.length;k++){var S=g[k];a.hasOwnProperty(S)&&(this[S]=a[S])}},r.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},r.equals=function(a){return this.foreground===a.foreground&&this.underline===a.underline&&this.italics===a.italics&&this.background===a.background&&this.flash===a.flash},r.copy=function(a){this.foreground=a.foreground,this.underline=a.underline,this.italics=a.italics,this.background=a.background,this.flash=a.flash},r.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},y}(),t=function(){function y(a,g,k,S,A,I){this.uchar=void 0,this.penState=void 0,this.uchar=a||" ",this.penState=new i(g,k,S,A,I)}var r=y.prototype;return r.reset=function(){this.uchar=" ",this.penState.reset()},r.setChar=function(a,g){this.uchar=a,this.penState.copy(g)},r.setPenState=function(a){this.penState.copy(a)},r.equals=function(a){return this.uchar===a.uchar&&this.penState.equals(a.penState)},r.copy=function(a){this.uchar=a.uchar,this.penState.copy(a.penState)},r.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},y}(),s=function(){function y(a){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var g=0;g<o;g++)this.chars.push(new t);this.logger=a,this.pos=0,this.currPenState=new i}var r=y.prototype;return r.equals=function(a){for(var g=!0,k=0;k<o;k++)if(!this.chars[k].equals(a.chars[k])){g=!1;break}return g},r.copy=function(a){for(var g=0;g<o;g++)this.chars[g].copy(a.chars[g])},r.isEmpty=function(){for(var a=!0,g=0;g<o;g++)if(!this.chars[g].isEmpty()){a=!1;break}return a},r.setCursor=function(a){this.pos!==a&&(this.pos=a),this.pos<0?(this.logger.log(D.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>o&&(this.logger.log(D.DEBUG,"Too large cursor position "+this.pos),this.pos=o)},r.moveCursor=function(a){var g=this.pos+a;if(a>1)for(var k=this.pos+1;k<g+1;k++)this.chars[k].setPenState(this.currPenState);this.setCursor(g)},r.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},r.insertChar=function(a){a>=144&&this.backSpace();var g=C(a);this.pos>=o?this.logger.log(D.ERROR,"Cannot insert "+a.toString(16)+" ("+g+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(g,this.currPenState),this.moveCursor(1))},r.clearFromPos=function(a){var g;for(g=a;g<o;g++)this.chars[g].reset()},r.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},r.clearToEndOfRow=function(){this.clearFromPos(this.pos)},r.getTextString=function(){for(var a=[],g=!0,k=0;k<o;k++){var S=this.chars[k].uchar;S!==" "&&(g=!1),a.push(S)}return g?"":a.join("")},r.setPenStyles=function(a){this.currPenState.setStyles(a),this.chars[this.pos].setPenState(this.currPenState)},y}(),l=function(){function y(a){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var g=0;g<R;g++)this.rows.push(new s(a));this.logger=a,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var r=y.prototype;return r.reset=function(){for(var a=0;a<R;a++)this.rows[a].clear();this.currRow=14},r.equals=function(a){for(var g=!0,k=0;k<R;k++)if(!this.rows[k].equals(a.rows[k])){g=!1;break}return g},r.copy=function(a){for(var g=0;g<R;g++)this.rows[g].copy(a.rows[g])},r.isEmpty=function(){for(var a=!0,g=0;g<R;g++)if(!this.rows[g].isEmpty()){a=!1;break}return a},r.backSpace=function(){this.rows[this.currRow].backSpace()},r.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},r.insertChar=function(a){this.rows[this.currRow].insertChar(a)},r.setPen=function(a){this.rows[this.currRow].setPenStyles(a)},r.moveCursor=function(a){this.rows[this.currRow].moveCursor(a)},r.setCursor=function(a){this.logger.log(D.INFO,"setCursor: "+a),this.rows[this.currRow].setCursor(a)},r.setPAC=function(a){this.logger.log(D.INFO,"pacData = "+JSON.stringify(a));var g=a.row-1;if(this.nrRollUpRows&&g<this.nrRollUpRows-1&&(g=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==g){for(var k=0;k<R;k++)this.rows[k].clear();var S=this.currRow+1-this.nrRollUpRows,A=this.lastOutputScreen;if(A){var I=A.rows[S].cueStartTime,w=this.logger.time;if(I&&w!==null&&I<w)for(var O=0;O<this.nrRollUpRows;O++)this.rows[g-this.nrRollUpRows+O+1].copy(A.rows[S+O])}}this.currRow=g;var F=this.rows[this.currRow];if(a.indent!==null){var M=a.indent,N=Math.max(M-1,0);F.setCursor(a.indent),a.color=F.chars[N].penState.foreground}var B={foreground:a.color,underline:a.underline,italics:a.italics,background:"black",flash:!1};this.setPen(B)},r.setBkgData=function(a){this.logger.log(D.INFO,"bkgData = "+JSON.stringify(a)),this.backSpace(),this.setPen(a),this.insertChar(32)},r.setRollUpRows=function(a){this.nrRollUpRows=a},r.rollUp=function(){if(this.nrRollUpRows!==null){this.logger.log(D.TEXT,this.getDisplayText());var a=this.currRow+1-this.nrRollUpRows,g=this.rows.splice(a,1)[0];g.clear(),this.rows.splice(this.currRow,0,g),this.logger.log(D.INFO,"Rolling up")}else this.logger.log(D.DEBUG,"roll_up but nrRollUpRows not set yet")},r.getDisplayText=function(a){a=a||!1;for(var g=[],k="",S=-1,A=0;A<R;A++){var I=this.rows[A].getTextString();I&&(S=A+1,a?g.push("Row "+S+": '"+I+"'"):g.push(I.trim()))}return g.length>0&&(k=a?"["+g.join(" | ")+"]":g.join(`
`)),k},r.getTextAndFormat=function(){return this.rows},y}(),n=function(){function y(a,g,k){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=a,this.outputFilter=g,this.mode=null,this.verbose=0,this.displayedMemory=new l(k),this.nonDisplayedMemory=new l(k),this.lastOutputScreen=new l(k),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=k}var r=y.prototype;return r.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},r.getHandler=function(){return this.outputFilter},r.setHandler=function(a){this.outputFilter=a},r.setPAC=function(a){this.writeScreen.setPAC(a)},r.setBkgData=function(a){this.writeScreen.setBkgData(a)},r.setMode=function(a){a!==this.mode&&(this.mode=a,this.logger.log(D.INFO,"MODE="+a),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=a)},r.insertChars=function(a){for(var g=0;g<a.length;g++)this.writeScreen.insertChar(a[g]);var k=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(D.INFO,k+": "+this.writeScreen.getDisplayText(!0)),this.mode!=="MODE_PAINT-ON"&&this.mode!=="MODE_ROLL-UP"||(this.logger.log(D.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},r.ccRCL=function(){this.logger.log(D.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},r.ccBS=function(){this.logger.log(D.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},r.ccAOF=function(){},r.ccAON=function(){},r.ccDER=function(){this.logger.log(D.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},r.ccRU=function(a){this.logger.log(D.INFO,"RU("+a+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(a)},r.ccFON=function(){this.logger.log(D.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},r.ccRDC=function(){this.logger.log(D.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},r.ccTR=function(){this.logger.log(D.INFO,"TR"),this.setMode("MODE_TEXT")},r.ccRTD=function(){this.logger.log(D.INFO,"RTD"),this.setMode("MODE_TEXT")},r.ccEDM=function(){this.logger.log(D.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},r.ccCR=function(){this.logger.log(D.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},r.ccENM=function(){this.logger.log(D.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},r.ccEOC=function(){if(this.logger.log(D.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var a=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=a,this.writeScreen=this.nonDisplayedMemory,this.logger.log(D.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},r.ccTO=function(a){this.logger.log(D.INFO,"TO("+a+") - Tab Offset"),this.writeScreen.moveCursor(a)},r.ccMIDROW=function(a){var g={flash:!1};if(g.underline=a%2==1,g.italics=a>=46,g.italics)g.foreground="white";else{var k=Math.floor(a/2)-16;g.foreground=["white","green","blue","cyan","red","yellow","magenta"][k]}this.logger.log(D.INFO,"MIDROW: "+JSON.stringify(g)),this.writeScreen.setPen(g)},r.outputDataUpdate=function(a){a===void 0&&(a=!1);var g=this.logger.time;g!==null&&this.outputFilter&&(this.cueStartTime!==null||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,g,this.lastOutputScreen),a&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:g):this.cueStartTime=g,this.lastOutputScreen.copy(this.displayedMemory))},r.cueSplitAtTime=function(a){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,a,this.displayedMemory),this.cueStartTime=a))},y}(),c=function(){function y(a,g,k){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var S=new u;this.channels=[null,new n(a,g,S),new n(a+1,k,S)],this.cmdHistory={a:null,b:null},this.logger=S}var r=y.prototype;return r.getHandler=function(a){return this.channels[a].getHandler()},r.setHandler=function(a,g){this.channels[a].setHandler(g)},r.addData=function(a,g){var k,S,A,I=!1;this.logger.time=a;for(var w=0;w<g.length;w+=2)if(S=127&g[w],A=127&g[w+1],S!==0||A!==0){if(this.logger.log(D.DATA,"["+e([g[w],g[w+1]])+"] -> ("+e([S,A])+")"),(k=this.parseCmd(S,A))||(k=this.parseMidrow(S,A)),k||(k=this.parsePAC(S,A)),k||(k=this.parseBackgroundAttributes(S,A)),!k&&(I=this.parseChars(S,A))){var O=this.currentChannel;O&&O>0?this.channels[O].insertChars(I):this.logger.log(D.WARNING,"No channel found yet. TEXT-MODE?")}k||I||this.logger.log(D.WARNING,"Couldn't parse cleaned data "+e([S,A])+" orig: "+e([g[w],g[w+1]]))}},r.parseCmd=function(a,g){var k=this.cmdHistory;if(!((a===20||a===28||a===21||a===29)&&g>=32&&g<=47||(a===23||a===31)&&g>=33&&g<=35))return!1;if(p(a,g,k))return m(null,null,k),this.logger.log(D.DEBUG,"Repeated command ("+e([a,g])+") is dropped"),!0;var S=a===20||a===21||a===23?1:2,A=this.channels[S];return a===20||a===21||a===28||a===29?g===32?A.ccRCL():g===33?A.ccBS():g===34?A.ccAOF():g===35?A.ccAON():g===36?A.ccDER():g===37?A.ccRU(2):g===38?A.ccRU(3):g===39?A.ccRU(4):g===40?A.ccFON():g===41?A.ccRDC():g===42?A.ccTR():g===43?A.ccRTD():g===44?A.ccEDM():g===45?A.ccCR():g===46?A.ccENM():g===47&&A.ccEOC():A.ccTO(g-32),m(a,g,k),this.currentChannel=S,!0},r.parseMidrow=function(a,g){var k=0;if((a===17||a===25)&&g>=32&&g<=47){if((k=a===17?1:2)!==this.currentChannel)return this.logger.log(D.ERROR,"Mismatch channel in midrow parsing"),!1;var S=this.channels[k];return!!S&&(S.ccMIDROW(g),this.logger.log(D.DEBUG,"MIDROW ("+e([a,g])+")"),!0)}return!1},r.parsePAC=function(a,g){var k,S=this.cmdHistory;if(!((a>=17&&a<=23||a>=25&&a<=31)&&g>=64&&g<=127||(a===16||a===24)&&g>=64&&g<=95))return!1;if(p(a,g,S))return m(null,null,S),!0;var A=a<=23?1:2;k=g>=64&&g<=95?A===1?E[a]:v[a]:A===1?f[a]:b[a];var I=this.channels[A];return!!I&&(I.setPAC(this.interpretPAC(k,g)),m(a,g,S),this.currentChannel=A,!0)},r.interpretPAC=function(a,g){var k,S={color:null,italics:!1,indent:null,underline:!1,row:a};return k=g>95?g-96:g-64,S.underline=(1&k)==1,k<=13?S.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(k/2)]:k<=15?(S.italics=!0,S.color="white"):S.indent=4*Math.floor((k-16)/2),S},r.parseChars=function(a,g){var k,S,A=null,I=null;if(a>=25?(k=2,I=a-8):(k=1,I=a),I>=17&&I<=19?(S=I===17?g+80:I===18?g+112:g+144,this.logger.log(D.INFO,"Special char '"+C(S)+"' in channel "+k),A=[S]):a>=32&&a<=127&&(A=g===0?[a]:[a,g]),A){var w=e(A);this.logger.log(D.DEBUG,"Char codes =  "+w.join(",")),m(a,g,this.cmdHistory)}return A},r.parseBackgroundAttributes=function(a,g){var k;if(!((a===16||a===24)&&g>=32&&g<=47||(a===23||a===31)&&g>=45&&g<=47))return!1;var S={};a===16||a===24?(k=Math.floor((g-32)/2),S.background=T[k],g%2==1&&(S.background=S.background+"_semi")):g===45?S.background="transparent":(S.foreground="black",g===47&&(S.underline=!0));var A=a<=23?1:2;return this.channels[A].setBkgData(S),m(a,g,this.cmdHistory),!0},r.reset=function(){for(var a=0;a<Object.keys(this.channels).length;a++){var g=this.channels[a];g&&g.reset()}this.cmdHistory={a:null,b:null}},r.cueSplitAtTime=function(a){for(var g=0;g<this.channels.length;g++){var k=this.channels[g];k&&k.cueSplitAtTime(a)}},y}();function m(y,r,a){a.a=y,a.b=r}function p(y,r,a){return a.a===y&&a.b===r}x.default=c},"./src/utils/codecs.ts":function(P,x,h){h.r(x),h.d(x,"isCodecType",function(){return d}),h.d(x,"isCodecSupportedInMp4",function(){return L});var D={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function d(_,C){var R=D[C];return!!R&&R[_.slice(0,4)]===!0}function L(_,C){return MediaSource.isTypeSupported((C||"video")+'/mp4;codecs="'+_+'"')}},"./src/utils/cues.ts":function(P,x,h){h.r(x);var D=h("./src/utils/vttparser.ts"),d=h("./src/utils/webvtt-parser.ts"),L=h("./src/utils/texttrack-utils.ts"),_=/\s/,C={newCue:function(R,o,E,f){for(var v,b,T,u,e,i=[],t=self.VTTCue||self.TextTrackCue,s=0;s<f.rows.length;s++)if(T=!0,u=0,e="",!(v=f.rows[s]).isEmpty()){for(var l=0;l<v.chars.length;l++)_.test(v.chars[l].uchar)&&T?u++:(e+=v.chars[l].uchar,T=!1);v.cueStartTime=o,o===E&&(E+=1e-4),u>=16?u--:u++;var n=Object(D.fixLineBreaks)(e.trim()),c=Object(d.generateCueId)(o,E,n);R&&R.cues&&R.cues.getCueById(c)||((b=new t(o,E,n)).id=c,b.line=s+1,b.align="left",b.position=10+Math.min(80,10*Math.floor(8*u/32)),i.push(b))}return R&&i.length&&(i.sort(function(m,p){return m.line==="auto"||p.line==="auto"?0:m.line>8&&p.line>8?p.line-m.line:m.line-p.line}),i.forEach(function(m){return Object(L.addCueToTrack)(R,m)})),i}};x.default=C},"./src/utils/discontinuities.ts":function(P,x,h){h.r(x),h.d(x,"findFirstFragWithCC",function(){return _}),h.d(x,"shouldAlignOnDiscontinuities",function(){return C}),h.d(x,"findDiscontinuousReferenceFrag",function(){return R}),h.d(x,"adjustSlidingStart",function(){return E}),h.d(x,"alignStream",function(){return f}),h.d(x,"alignPDT",function(){return v});var D=h("./src/polyfills/number.ts"),d=h("./src/utils/logger.ts"),L=h("./src/controller/level-helper.ts");function _(b,T){for(var u=null,e=0,i=b.length;e<i;e++){var t=b[e];if(t&&t.cc===T){u=t;break}}return u}function C(b,T,u){return!(!T.details||!(u.endCC>u.startCC||b&&b.cc<u.startCC))}function R(b,T){var u=b.fragments,e=T.fragments;if(e.length&&u.length){var i=_(u,e[0].cc);if(i&&(!i||i.startPTS))return i;d.logger.log("No frag in previous level to align on")}else d.logger.log("No fragments to align")}function o(b,T){if(b){var u=b.start+T;b.start=b.startPTS=u,b.endPTS=u+b.duration}}function E(b,T){for(var u=T.fragments,e=0,i=u.length;e<i;e++)o(u[e],b);T.fragmentHint&&o(T.fragmentHint,b),T.alignedSliding=!0}function f(b,T,u){T&&(function(e,i,t){if(C(e,t,i)){var s=R(t.details,i);s&&Object(D.isFiniteNumber)(s.start)&&(d.logger.log("Adjusting PTS using last level due to CC increase within current level "+i.url),E(s.start,i))}}(b,u,T),!u.alignedSliding&&T.details&&v(u,T.details),u.alignedSliding||!T.details||u.skippedSegments||Object(L.adjustSliding)(T.details,u))}function v(b,T){if(T.fragments.length&&b.hasProgramDateTime&&T.hasProgramDateTime){var u=T.fragments[0].programDateTime,e=b.fragments[0].programDateTime,i=(e-u)/1e3+T.fragments[0].start;i&&Object(D.isFiniteNumber)(i)&&(d.logger.log("Adjusting PTS using programDateTime delta "+(e-u)+"ms, sliding:"+i.toFixed(3)+" "+b.url+" "),E(i,b))}}},"./src/utils/ewma-bandwidth-estimator.ts":function(P,x,h){h.r(x);var D=h("./src/utils/ewma.ts"),d=function(){function L(C,R,o){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=o,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new D.default(C),this.fast_=new D.default(R)}var _=L.prototype;return _.update=function(C,R){var o=this.slow_,E=this.fast_;this.slow_.halfLife!==C&&(this.slow_=new D.default(C,o.getEstimate(),o.getTotalWeight())),this.fast_.halfLife!==R&&(this.fast_=new D.default(R,E.getEstimate(),E.getTotalWeight()))},_.sample=function(C,R){var o=(C=Math.max(C,this.minDelayMs_))/1e3,E=8*R/o;this.fast_.sample(o,E),this.slow_.sample(o,E)},_.canEstimate=function(){var C=this.fast_;return C&&C.getTotalWeight()>=this.minWeight_},_.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},_.destroy=function(){},L}();x.default=d},"./src/utils/ewma.ts":function(P,x,h){h.r(x);var D=function(){function d(_,C,R){C===void 0&&(C=0),R===void 0&&(R=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=_,this.alpha_=_?Math.exp(Math.log(.5)/_):0,this.estimate_=C,this.totalWeight_=R}var L=d.prototype;return L.sample=function(_,C){var R=Math.pow(this.alpha_,_);this.estimate_=C*(1-R)+R*this.estimate_,this.totalWeight_+=_},L.getTotalWeight=function(){return this.totalWeight_},L.getEstimate=function(){if(this.alpha_){var _=1-Math.pow(this.alpha_,this.totalWeight_);if(_)return this.estimate_/_}return this.estimate_},d}();x.default=D},"./src/utils/fetch-loader.ts":function(P,x,h){h.r(x),h.d(x,"fetchSupported",function(){return f});var D=h("./src/polyfills/number.ts"),d=h("./src/loader/load-stats.ts"),L=h("./src/demux/chunk-cache.ts");function _(u){var e=typeof Map=="function"?new Map:void 0;return(_=function(i){if(i===null||(t=i,Function.toString.call(t).indexOf("[native code]")===-1))return i;var t;if(typeof i!="function")throw new TypeError("Super expression must either be null or a function");if(e!==void 0){if(e.has(i))return e.get(i);e.set(i,s)}function s(){return C(i,arguments,E(this).constructor)}return s.prototype=Object.create(i.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),o(s,i)})(u)}function C(u,e,i){return(C=R()?Reflect.construct:function(t,s,l){var n=[null];n.push.apply(n,s);var c=new(Function.bind.apply(t,n));return l&&o(c,l.prototype),c}).apply(null,arguments)}function R(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function o(u,e){return(o=Object.setPrototypeOf||function(i,t){return i.__proto__=t,i})(u,e)}function E(u){return(E=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(u)}function f(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var v=function(){function u(i){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=i.fetchSetup||b,this.controller=new self.AbortController,this.stats=new d.LoadStats}var e=u.prototype;return e.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},e.abortInternal=function(){var i=this.response;i&&i.ok||(this.stats.aborted=!0,this.controller.abort())},e.abort=function(){var i;this.abortInternal(),(i=this.callbacks)!==null&&i!==void 0&&i.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},e.load=function(i,t,s){var l=this,n=this.stats;if(n.loading.start)throw new Error("Loader can only be used once.");n.loading.start=self.performance.now();var c=function(r,a){var g={method:"GET",mode:"cors",credentials:"same-origin",signal:a};return r.rangeEnd&&(g.headers=new self.Headers({Range:"bytes="+r.rangeStart+"-"+String(r.rangeEnd-1)})),g}(i,this.controller.signal),m=s.onProgress,p=i.responseType==="arraybuffer",y=p?"byteLength":"length";this.context=i,this.config=t,this.callbacks=s,this.request=this.fetchSetup(i,c),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){l.abortInternal(),s.onTimeout(n,i,l.response)},t.timeout),self.fetch(this.request).then(function(r){if(l.response=l.loader=r,!r.ok){var a=r.status,g=r.statusText;throw new T(g||"fetch, bad network response",a,r)}return n.loading.first=Math.max(self.performance.now(),n.loading.start),n.total=parseInt(r.headers.get("Content-Length")||"0"),m&&Object(D.isFiniteNumber)(t.highWaterMark)?l.loadProgressively(r,n,i,t.highWaterMark,m):p?r.arrayBuffer():r.text()}).then(function(r){var a=l.response;self.clearTimeout(l.requestTimeout),n.loading.end=Math.max(self.performance.now(),n.loading.first),n.loaded=n.total=r[y];var g={url:a.url,data:r};m&&!Object(D.isFiniteNumber)(t.highWaterMark)&&m(n,i,r,a),s.onSuccess(g,n,i,a)}).catch(function(r){if(self.clearTimeout(l.requestTimeout),!n.aborted){var a=r.code||0;s.onError({code:a,text:r.message},i,r.details)}})},e.getCacheAge=function(){var i=null;if(this.response){var t=this.response.headers.get("age");i=t?parseFloat(t):null}return i},e.loadProgressively=function(i,t,s,l,n){l===void 0&&(l=0);var c=new L.default,m=i.body.getReader();return function p(){return m.read().then(function(y){if(y.done)return c.dataLength&&n(t,s,c.flush(),i),Promise.resolve(new ArrayBuffer(0));var r=y.value,a=r.length;return t.loaded+=a,a<l||c.dataLength?(c.push(r),c.dataLength>=l&&n(t,s,c.flush(),i)):n(t,s,r,i),p()}).catch(function(){return Promise.reject()})}()},u}();function b(u,e){return new self.Request(u.url,e)}var T=function(u){var e,i;function t(s,l,n){var c;return(c=u.call(this,s)||this).code=void 0,c.details=void 0,c.code=l,c.details=n,c}return i=u,(e=t).prototype=Object.create(i.prototype),e.prototype.constructor=e,o(e,i),t}(_(Error));x.default=v},"./src/utils/imsc1-ttml-parser.ts":function(P,x,h){h.r(x),h.d(x,"IMSC1_CODEC",function(){return E}),h.d(x,"parseIMSC1",function(){return T});var D=h("./src/utils/mp4-tools.ts"),d=h("./src/utils/vttparser.ts"),L=h("./src/utils/vttcue.ts"),_=h("./src/demux/id3.ts"),C=h("./src/utils/timescale-conversion.ts"),R=h("./src/utils/webvtt-parser.ts");function o(){return(o=Object.assign||function(n){for(var c=1;c<arguments.length;c++){var m=arguments[c];for(var p in m)Object.prototype.hasOwnProperty.call(m,p)&&(n[p]=m[p])}return n}).apply(this,arguments)}var E="stpp.ttml.im1t",f=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,v=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,b={left:"start",center:"center",right:"end",start:"start",end:"end"};function T(n,c,m,p,y){var r=Object(D.findBox)(new Uint8Array(n),["mdat"]);if(r.length!==0){var a=r[0],g=Object(_.utf8ArrayToStr)(new Uint8Array(n,a.start,a.end-a.start)),k=Object(C.toTimescaleFromScale)(c,1,m);try{p(function(S,A){var I=new DOMParser().parseFromString(S,"text/xml").getElementsByTagName("tt")[0];if(!I)throw new Error("Invalid ttml");var w={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},O=Object.keys(w).reduce(function(U,j){return U[j]=I.getAttribute("ttp:"+j)||w[j],U},{}),F=I.getAttribute("xml:space")!=="preserve",M=e(u(I,"styling","style")),N=e(u(I,"layout","region")),B=u(I,"body","[begin]");return[].map.call(B,function(U){var j=i(U,F);if(!j||!U.hasAttribute("begin"))return null;var W=l(U.getAttribute("begin"),O),$=l(U.getAttribute("dur"),O),X=l(U.getAttribute("end"),O);if(W===null)throw s(U);if(X===null){if($===null)throw s(U);X=W+$}var Y=new L.default(W-A,X-A,j);Y.id=Object(R.generateCueId)(Y.startTime,Y.endTime,Y.text);var Z=N[U.getAttribute("region")],ue=M[U.getAttribute("style")];Y.position=10,Y.size=80;var ce=function(he,se){var oe="http://www.w3.org/ns/ttml#styling";return["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce(function(me,pe){var Se=t(se,oe,pe)||t(he,oe,pe);return Se&&(me[pe]=Se),me},{})}(Z,ue),ge=ce.textAlign;if(ge){var ie=b[ge];ie&&(Y.lineAlign=ie),Y.align=ge}return o(Y,ce),Y}).filter(function(U){return U!==null})}(g,k))}catch(S){y(S)}}else y(new Error("Could not parse IMSC1 mdat"))}function u(n,c,m){var p=n.getElementsByTagName(c)[0];return p?[].slice.call(p.querySelectorAll(m)):[]}function e(n){return n.reduce(function(c,m){var p=m.getAttribute("xml:id");return p&&(c[p]=m),c},{})}function i(n,c){return[].slice.call(n.childNodes).reduce(function(m,p,y){var r;return p.nodeName==="br"&&y?m+`
`:(r=p.childNodes)!==null&&r!==void 0&&r.length?i(p,c):c?m+p.textContent.trim().replace(/\s+/g," "):m+p.textContent},"")}function t(n,c,m){return n.hasAttributeNS(c,m)?n.getAttributeNS(c,m):null}function s(n){return new Error("Could not parse ttml timestamp "+n)}function l(n,c){if(!n)return null;var m=Object(d.parseTimeStamp)(n);return m===null&&(f.test(n)?m=function(p,y){var r=f.exec(p),a=(0|r[4])+(0|r[5])/y.subFrameRate;return 3600*(0|r[1])+60*(0|r[2])+(0|r[3])+a/y.frameRate}(n,c):v.test(n)&&(m=function(p,y){var r=v.exec(p),a=Number(r[1]);switch(r[2]){case"h":return 3600*a;case"m":return 60*a;case"ms":return 1e3*a;case"f":return a/y.frameRate;case"t":return a/y.tickRate}return a}(n,c))),m}},"./src/utils/logger.ts":function(P,x,h){h.r(x),h.d(x,"enableLogs",function(){return C}),h.d(x,"logger",function(){return R});var D=function(){},d={trace:D,debug:D,log:D,warn:D,info:D,error:D},L=d;function _(o){var E=self.console[o];return E?E.bind(self.console,"["+o+"] >"):D}function C(o){if(self.console&&o===!0||typeof o=="object"){(function(E){for(var f=arguments.length,v=new Array(f>1?f-1:0),b=1;b<f;b++)v[b-1]=arguments[b];v.forEach(function(T){L[T]=E[T]?E[T].bind(E):_(T)})})(o,"debug","log","info","warn","error");try{L.log()}catch{L=d}}else L=d}var R=d},"./src/utils/mediakeys-helper.ts":function(P,x,h){var D,d;h.r(x),h.d(x,"KeySystems",function(){return D}),h.d(x,"requestMediaKeySystemAccess",function(){return L}),(d=D||(D={})).WIDEVINE="com.widevine.alpha",d.PLAYREADY="com.microsoft.playready";var L=typeof self!="undefined"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null},"./src/utils/mediasource-helper.ts":function(P,x,h){function D(){return self.MediaSource||self.WebKitMediaSource}h.r(x),h.d(x,"getMediaSource",function(){return D})},"./src/utils/mp4-tools.ts":function(P,x,h){h.r(x),h.d(x,"bin2str",function(){return C}),h.d(x,"readUint16",function(){return R}),h.d(x,"readUint32",function(){return o}),h.d(x,"writeUint32",function(){return E}),h.d(x,"findBox",function(){return f}),h.d(x,"parseSegmentIndex",function(){return v}),h.d(x,"parseInitSegment",function(){return b}),h.d(x,"getStartDTS",function(){return T}),h.d(x,"getDuration",function(){return u}),h.d(x,"computeRawDurationFromSamples",function(){return e}),h.d(x,"offsetStartDTS",function(){return i}),h.d(x,"segmentValidRange",function(){return t}),h.d(x,"appendUint8Array",function(){return s});var D=h("./src/utils/typed-array.ts"),d=h("./src/loader/fragment.ts"),L=Math.pow(2,32)-1,_=[].push;function C(l){return String.fromCharCode.apply(null,l)}function R(l,n){"data"in l&&(n+=l.start,l=l.data);var c=l[n]<<8|l[n+1];return c<0?65536+c:c}function o(l,n){"data"in l&&(n+=l.start,l=l.data);var c=l[n]<<24|l[n+1]<<16|l[n+2]<<8|l[n+3];return c<0?4294967296+c:c}function E(l,n,c){"data"in l&&(n+=l.start,l=l.data),l[n]=c>>24,l[n+1]=c>>16&255,l[n+2]=c>>8&255,l[n+3]=255&c}function f(l,n){var c,m,p,y=[];if(!n.length)return y;"data"in l?(c=l.data,m=l.start,p=l.end):(m=0,p=(c=l).byteLength);for(var r=m;r<p;){var a=o(c,r),g=a>1?r+a:p;if(C(c.subarray(r+4,r+8))===n[0])if(n.length===1)y.push({data:c,start:r+8,end:g});else{var k=f({data:c,start:r+8,end:g},n.slice(1));k.length&&_.apply(y,k)}r=g}return y}function v(l){var n=f(l,["moov"])[0],c=n?n.end:null,m=f(l,["sidx"]);if(!m||!m[0])return null;var p=[],y=m[0],r=y.data[0],a=r===0?8:16,g=o(y,a);a+=4,a+=r===0?8:16,a+=2;var k=y.end+0,S=R(y,a);a+=2;for(var A=0;A<S;A++){var I=a,w=o(y,I);I+=4;var O=2147483647&w;if((2147483648&w)>>>31==1)return console.warn("SIDX has hierarchical references (not supported)"),null;var F=o(y,I);I+=4,p.push({referenceSize:O,subsegmentDuration:F,info:{duration:F/g,start:k,end:k+O-1}}),k+=O,a=I+=4}return{earliestPresentationTime:0,timescale:g,version:r,referencesCount:S,references:p,moovEndOffset:c}}function b(l){for(var n=[],c=f(l,["moov","trak"]),m=0;m<c.length;m++){var p=c[m],y=f(p,["tkhd"])[0];if(y){var r=y.data[y.start],a=r===0?12:20,g=o(y,a),k=f(p,["mdia","mdhd"])[0];if(k){var S=o(k,a=(r=k.data[k.start])===0?12:20),A=f(p,["mdia","hdlr"])[0];if(A){var I=C(A.data.subarray(A.start+8,A.start+12)),w={soun:d.ElementaryStreamTypes.AUDIO,vide:d.ElementaryStreamTypes.VIDEO}[I];if(w){var O=f(p,["mdia","minf","stbl","stsd"])[0],F=void 0;O&&(F=C(O.data.subarray(O.start+12,O.start+16))),n[g]={timescale:S,type:w},n[w]={timescale:S,id:g,codec:F}}}}}}return f(l,["moov","mvex","trex"]).forEach(function(M){var N=o(M,4),B=n[N];B&&(B.default={duration:o(M,12),flags:o(M,20)})}),n}function T(l,n){return f(n,["moof","traf"]).reduce(function(c,m){var p=f(m,["tfdt"])[0],y=p.data[p.start],r=f(m,["tfhd"]).reduce(function(a,g){var k=o(g,4),S=l[k];if(S){var A=o(p,4);y===1&&(A*=Math.pow(2,32),A+=o(p,8));var I=A/(S.timescale||9e4);if(isFinite(I)&&(a===null||I<a))return I}return a},null);return r!==null&&isFinite(r)&&(c===null||r<c)?r:c},null)||0}function u(l,n){for(var c=0,m=0,p=0,y=f(l,["moof","traf"]),r=0;r<y.length;r++){var a=y[r],g=f(a,["tfhd"])[0],k=n[o(g,4)];if(k){var S=k.default,A=o(g,0)|(S==null?void 0:S.flags),I=S==null?void 0:S.duration;8&A&&(I=o(g,2&A?12:8));for(var w=k.timescale||9e4,O=f(a,["trun"]),F=0;F<O.length;F++)c=I?I*o(O[F],4):e(O[F]),k.type===d.ElementaryStreamTypes.VIDEO?m+=c/w:k.type===d.ElementaryStreamTypes.AUDIO&&(p+=c/w)}}if(m===0&&p===0){var M=v(l);if(M!=null&&M.references)return M.references.reduce(function(N,B){return N+B.info.duration||0},0)}return m||p}function e(l){var n=o(l,0),c=8;1&n&&(c+=4),4&n&&(c+=4);for(var m=0,p=o(l,4),y=0;y<p;y++)256&n&&(m+=o(l,c),c+=4),512&n&&(c+=4),1024&n&&(c+=4),2048&n&&(c+=4);return m}function i(l,n,c){f(n,["moof","traf"]).forEach(function(m){f(m,["tfhd"]).forEach(function(p){var y=o(p,4),r=l[y];if(r){var a=r.timescale||9e4;f(m,["tfdt"]).forEach(function(g){var k=g.data[g.start],S=o(g,4);if(k===0)E(g,4,S-c*a);else{S*=Math.pow(2,32),S+=o(g,8),S-=c*a,S=Math.max(S,0);var A=Math.floor(S/(L+1)),I=Math.floor(S%(L+1));E(g,4,A),E(g,8,I)}})}})})}function t(l){var n={valid:null,remainder:null},c=f(l,["moof"]);if(!c)return n;if(c.length<2)return n.remainder=l,n;var m=c[c.length-1];return n.valid=Object(D.sliceUint8)(l,0,m.start-8),n.remainder=Object(D.sliceUint8)(l,m.start-8),n}function s(l,n){var c=new Uint8Array(l.length+n.length);return c.set(l),c.set(n,l.length),c}},"./src/utils/output-filter.ts":function(P,x,h){h.r(x),h.d(x,"default",function(){return D});var D=function(){function d(_,C){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=_,this.trackName=C}var L=d.prototype;return L.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},L.newCue=function(_,C,R){(this.startTime===null||this.startTime>_)&&(this.startTime=_),this.endTime=C,this.screen=R,this.timelineController.createCaptionsTrack(this.trackName)},L.reset=function(){this.cueRanges=[]},d}()},"./src/utils/texttrack-utils.ts":function(P,x,h){h.r(x),h.d(x,"sendAddTrackEvent",function(){return d}),h.d(x,"addCueToTrack",function(){return L}),h.d(x,"clearCurrentCues",function(){return _}),h.d(x,"removeCuesInRange",function(){return C}),h.d(x,"getCuesInRange",function(){return R});var D=h("./src/utils/logger.ts");function d(o,E){var f;try{f=new Event("addtrack")}catch{(f=document.createEvent("Event")).initEvent("addtrack",!1,!1)}f.track=o,E.dispatchEvent(f)}function L(o,E){var f=o.mode;if(f==="disabled"&&(o.mode="hidden"),o.cues&&!o.cues.getCueById(E.id))try{if(o.addCue(E),!o.cues.getCueById(E.id))throw new Error("addCue is failed for: "+E)}catch(b){D.logger.debug("[texttrack-utils]: "+b);var v=new self.TextTrackCue(E.startTime,E.endTime,E.text);v.id=E.id,o.addCue(v)}f==="disabled"&&(o.mode=f)}function _(o){var E=o.mode;if(E==="disabled"&&(o.mode="hidden"),o.cues)for(var f=o.cues.length;f--;)o.removeCue(o.cues[f]);E==="disabled"&&(o.mode=E)}function C(o,E,f){var v=o.mode;if(v==="disabled"&&(o.mode="hidden"),o.cues&&o.cues.length>0)for(var b=R(o.cues,E,f),T=0;T<b.length;T++)o.removeCue(b[T]);v==="disabled"&&(o.mode=v)}function R(o,E,f){var v=[],b=function(i,t){if(t<i[0].startTime)return 0;var s=i.length-1;if(t>i[s].endTime)return-1;for(var l=0,n=s;l<=n;){var c=Math.floor((n+l)/2);if(t<i[c].startTime)n=c-1;else{if(!(t>i[c].startTime&&l<s))return c;l=c+1}}return i[l].startTime-t<t-i[n].startTime?l:n}(o,E);if(b>-1)for(var T=b,u=o.length;T<u;T++){var e=o[T];if(e.startTime>=E&&e.endTime<=f)v.push(e);else if(e.startTime>f)return v}return v}},"./src/utils/time-ranges.ts":function(P,x,h){h.r(x),x.default={toString:function(D){for(var d="",L=D.length,_=0;_<L;_++)d+="["+D.start(_).toFixed(3)+","+D.end(_).toFixed(3)+"]";return d}}},"./src/utils/timescale-conversion.ts":function(P,x,h){function D(C,R,o,E){o===void 0&&(o=1),E===void 0&&(E=!1);var f=C*R*o;return E?Math.round(f):f}function d(C,R,o,E){return o===void 0&&(o=1),E===void 0&&(E=!1),D(C,R,1/o,E)}function L(C,R){return R===void 0&&(R=!1),D(C,1e3,1/9e4,R)}function _(C,R){return R===void 0&&(R=1),D(C,9e4,1/R)}h.r(x),h.d(x,"toTimescaleFromBase",function(){return D}),h.d(x,"toTimescaleFromScale",function(){return d}),h.d(x,"toMsFromMpegTsClock",function(){return L}),h.d(x,"toMpegTsClockFromTimescale",function(){return _})},"./src/utils/typed-array.ts":function(P,x,h){function D(d,L,_){return Uint8Array.prototype.slice?d.slice(L,_):new Uint8Array(Array.prototype.slice.call(d,L,_))}h.r(x),h.d(x,"sliceUint8",function(){return D})},"./src/utils/vttcue.ts":function(P,x,h){h.r(x),x.default=function(){if(typeof self!="undefined"&&self.VTTCue)return self.VTTCue;var D=["","lr","rl"],d=["start","middle","end","left","right"];function L(o,E){if(typeof E!="string"||!Array.isArray(o))return!1;var f=E.toLowerCase();return!!~o.indexOf(f)&&f}function _(o){return L(d,o)}function C(o){for(var E=arguments.length,f=new Array(E>1?E-1:0),v=1;v<E;v++)f[v-1]=arguments[v];for(var b=1;b<arguments.length;b++){var T=arguments[b];for(var u in T)o[u]=T[u]}return o}function R(o,E,f){var v=this,b={enumerable:!0};v.hasBeenReset=!1;var T="",u=!1,e=o,i=E,t=f,s=null,l="",n=!0,c="auto",m="start",p=50,y="middle",r=50,a="middle";Object.defineProperty(v,"id",C({},b,{get:function(){return T},set:function(g){T=""+g}})),Object.defineProperty(v,"pauseOnExit",C({},b,{get:function(){return u},set:function(g){u=!!g}})),Object.defineProperty(v,"startTime",C({},b,{get:function(){return e},set:function(g){if(typeof g!="number")throw new TypeError("Start time must be set to a number.");e=g,this.hasBeenReset=!0}})),Object.defineProperty(v,"endTime",C({},b,{get:function(){return i},set:function(g){if(typeof g!="number")throw new TypeError("End time must be set to a number.");i=g,this.hasBeenReset=!0}})),Object.defineProperty(v,"text",C({},b,{get:function(){return t},set:function(g){t=""+g,this.hasBeenReset=!0}})),Object.defineProperty(v,"region",C({},b,{get:function(){return s},set:function(g){s=g,this.hasBeenReset=!0}})),Object.defineProperty(v,"vertical",C({},b,{get:function(){return l},set:function(g){var k=function(S){return L(D,S)}(g);if(k===!1)throw new SyntaxError("An invalid or illegal string was specified.");l=k,this.hasBeenReset=!0}})),Object.defineProperty(v,"snapToLines",C({},b,{get:function(){return n},set:function(g){n=!!g,this.hasBeenReset=!0}})),Object.defineProperty(v,"line",C({},b,{get:function(){return c},set:function(g){if(typeof g!="number"&&g!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");c=g,this.hasBeenReset=!0}})),Object.defineProperty(v,"lineAlign",C({},b,{get:function(){return m},set:function(g){var k=_(g);if(!k)throw new SyntaxError("An invalid or illegal string was specified.");m=k,this.hasBeenReset=!0}})),Object.defineProperty(v,"position",C({},b,{get:function(){return p},set:function(g){if(g<0||g>100)throw new Error("Position must be between 0 and 100.");p=g,this.hasBeenReset=!0}})),Object.defineProperty(v,"positionAlign",C({},b,{get:function(){return y},set:function(g){var k=_(g);if(!k)throw new SyntaxError("An invalid or illegal string was specified.");y=k,this.hasBeenReset=!0}})),Object.defineProperty(v,"size",C({},b,{get:function(){return r},set:function(g){if(g<0||g>100)throw new Error("Size must be between 0 and 100.");r=g,this.hasBeenReset=!0}})),Object.defineProperty(v,"align",C({},b,{get:function(){return a},set:function(g){var k=_(g);if(!k)throw new SyntaxError("An invalid or illegal string was specified.");a=k,this.hasBeenReset=!0}})),v.displayState=void 0}return R.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},R}()},"./src/utils/vttparser.ts":function(P,x,h){h.r(x),h.d(x,"parseTimeStamp",function(){return L}),h.d(x,"fixLineBreaks",function(){return f}),h.d(x,"VTTParser",function(){return v});var D=h("./src/utils/vttcue.ts"),d=function(){function b(){}return b.prototype.decode=function(T,u){if(!T)return"";if(typeof T!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(T))},b}();function L(b){function T(e,i,t,s){return 3600*(0|e)+60*(0|i)+(0|t)+parseFloat(s||0)}var u=b.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return u?parseFloat(u[2])>59?T(u[2],u[3],0,u[4]):T(u[1],u[2],u[3],u[4]):null}var _=function(){function b(){this.values=Object.create(null)}var T=b.prototype;return T.set=function(u,e){this.get(u)||e===""||(this.values[u]=e)},T.get=function(u,e,i){return i?this.has(u)?this.values[u]:e[i]:this.has(u)?this.values[u]:e},T.has=function(u){return u in this.values},T.alt=function(u,e,i){for(var t=0;t<i.length;++t)if(e===i[t]){this.set(u,e);break}},T.integer=function(u,e){/^-?\d+$/.test(e)&&this.set(u,parseInt(e,10))},T.percent=function(u,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){var i=parseFloat(e);if(i>=0&&i<=100)return this.set(u,i),!0}return!1},b}();function C(b,T,u,e){var i=e?b.split(e):[b];for(var t in i)if(typeof i[t]=="string"){var s=i[t].split(u);s.length===2&&T(s[0],s[1])}}var R=new D.default(0,0,""),o=R.align==="middle"?"middle":"center";function E(b,T,u){var e=b;function i(){var s=L(b);if(s===null)throw new Error("Malformed timestamp: "+e);return b=b.replace(/^[^\sa-zA-Z-]+/,""),s}function t(){b=b.replace(/^\s+/,"")}if(t(),T.startTime=i(),t(),b.substr(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+e);b=b.substr(3),t(),T.endTime=i(),t(),function(s,l){var n=new _;C(s,function(p,y){var r;switch(p){case"region":for(var a=u.length-1;a>=0;a--)if(u[a].id===y){n.set(p,u[a].region);break}break;case"vertical":n.alt(p,y,["rl","lr"]);break;case"line":r=y.split(","),n.integer(p,r[0]),n.percent(p,r[0])&&n.set("snapToLines",!1),n.alt(p,r[0],["auto"]),r.length===2&&n.alt("lineAlign",r[1],["start",o,"end"]);break;case"position":r=y.split(","),n.percent(p,r[0]),r.length===2&&n.alt("positionAlign",r[1],["start",o,"end","line-left","line-right","auto"]);break;case"size":n.percent(p,y);break;case"align":n.alt(p,y,["start",o,"end","left","right"])}},/:/,/\s/),l.region=n.get("region",null),l.vertical=n.get("vertical","");var c=n.get("line","auto");c==="auto"&&R.line===-1&&(c=-1),l.line=c,l.lineAlign=n.get("lineAlign","start"),l.snapToLines=n.get("snapToLines",!0),l.size=n.get("size",100),l.align=n.get("align",o);var m=n.get("position","auto");m==="auto"&&R.position===50&&(m=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=m}(b,T)}function f(b){return b.replace(/<br(?: \/)?>/gi,`
`)}var v=function(){function b(){this.state="INITIAL",this.buffer="",this.decoder=new d,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var T=b.prototype;return T.parse=function(u){var e=this;function i(){var c=e.buffer,m=0;for(c=f(c);m<c.length&&c[m]!=="\r"&&c[m]!==`
`;)++m;var p=c.substr(0,m);return c[m]==="\r"&&++m,c[m]===`
`&&++m,e.buffer=c.substr(m),p}u&&(e.buffer+=e.decoder.decode(u,{stream:!0}));try{var t="";if(e.state==="INITIAL"){if(!/\r\n|\n/.test(e.buffer))return this;var s=(t=i()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!s||!s[0])throw new Error("Malformed WebVTT signature.");e.state="HEADER"}for(var l=!1;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(l?l=!1:t=i(),e.state){case"HEADER":/:/.test(t)?C(t,function(c,m){},/:/):t||(e.state="ID");continue;case"NOTE":t||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(t)){e.state="NOTE";break}if(!t)continue;if(e.cue=new D.default(0,0,""),e.state="CUE",t.indexOf("-->")===-1){e.cue.id=t;continue}case"CUE":if(!e.cue){e.state="BADCUE";continue}try{E(t,e.cue,e.regionList)}catch{e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":var n=t.indexOf("-->")!==-1;if(!t||n&&(l=!0)){e.oncue&&e.cue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}if(e.cue===null)continue;e.cue.text&&(e.cue.text+=`
`),e.cue.text+=t;continue;case"BADCUE":t||(e.state="ID")}}}catch{e.state==="CUETEXT"&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state=e.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},T.flush=function(){var u=this;try{if((u.cue||u.state==="HEADER")&&(u.buffer+=`

`,u.parse()),u.state==="INITIAL"||u.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(e){u.onparsingerror&&u.onparsingerror(e)}return u.onflush&&u.onflush(),this},b}()},"./src/utils/webvtt-parser.ts":function(P,x,h){h.r(x),h.d(x,"generateCueId",function(){return f}),h.d(x,"parseWebVTT",function(){return v});var D=h("./src/polyfills/number.ts"),d=h("./src/utils/vttparser.ts"),L=h("./src/demux/id3.ts"),_=h("./src/utils/timescale-conversion.ts"),C=h("./src/remux/mp4-remuxer.ts"),R=/\r\n|\n\r|\n|\r/g,o=function(b,T,u){return u===void 0&&(u=0),b.substr(u,T.length)===T},E=function(b){for(var T=5381,u=b.length;u;)T=33*T^b.charCodeAt(--u);return(T>>>0).toString()};function f(b,T,u){return E(b.toString())+E(T.toString())+E(u)}function v(b,T,u,e,i,t,s,l){var n,c=new d.VTTParser,m=Object(L.utf8ArrayToStr)(new Uint8Array(b)).trim().replace(R,`
`).split(`
`),p=[],y=Object(_.toMpegTsClockFromTimescale)(T,u),r="00:00.000",a=0,g=0,k=!0,S=!1;c.oncue=function(A){var I=e[i],w=e.ccOffset,O=(a-y)/9e4;if(I!=null&&I.new&&(g!==void 0?w=e.ccOffset=I.start:function(B,U,j){var W=B[U],$=B[W.prevCC];if(!$||!$.new&&W.new)return B.ccOffset=B.presentationOffset=W.start,void(W.new=!1);for(;(X=$)!==null&&X!==void 0&&X.new;){var X;B.ccOffset+=W.start-$.start,W.new=!1,$=B[(W=$).prevCC]}B.presentationOffset=j}(e,i,O)),O&&(w=O-e.presentationOffset),S){var F=A.endTime-A.startTime,M=Object(C.normalizePts)(9e4*(A.startTime+w-g),9e4*t)/9e4;A.startTime=M,A.endTime=M+F}var N=A.text.trim();A.text=decodeURIComponent(encodeURIComponent(N)),A.id||(A.id=f(A.startTime,A.endTime,N)),A.endTime>0&&p.push(A)},c.onparsingerror=function(A){n=A},c.onflush=function(){n?l(n):s(p)},m.forEach(function(A){if(k){if(o(A,"X-TIMESTAMP-MAP=")){k=!1,S=!0,A.substr(16).split(",").forEach(function(I){o(I,"LOCAL:")?r=I.substr(6):o(I,"MPEGTS:")&&(a=parseInt(I.substr(7)))});try{g=function(I){var w=parseInt(I.substr(-3)),O=parseInt(I.substr(-6,2)),F=parseInt(I.substr(-9,2)),M=I.length>9?parseInt(I.substr(0,I.indexOf(":"))):0;if(!(Object(D.isFiniteNumber)(w)&&Object(D.isFiniteNumber)(O)&&Object(D.isFiniteNumber)(F)&&Object(D.isFiniteNumber)(M)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+I);return w+=1e3*O,(w+=6e4*F)+36e5*M}(r)/1e3}catch(I){S=!1,n=I}return}A===""&&(k=!1)}c.parse(A+`
`)}),c.flush()}},"./src/utils/xhr-loader.ts":function(P,x,h){h.r(x);var D=h("./src/utils/logger.ts"),d=h("./src/loader/load-stats.ts"),L=/^age:\s*[\d.]+\s*$/m,_=function(){function C(o){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=o?o.xhrSetup:null,this.stats=new d.LoadStats,this.retryDelay=0}var R=C.prototype;return R.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},R.abortInternal=function(){var o=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),o&&(o.onreadystatechange=null,o.onprogress=null,o.readyState!==4&&(this.stats.aborted=!0,o.abort()))},R.abort=function(){var o;this.abortInternal(),(o=this.callbacks)!==null&&o!==void 0&&o.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},R.load=function(o,E,f){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=o,this.config=E,this.callbacks=f,this.retryDelay=E.retryDelay,this.loadInternal()},R.loadInternal=function(){var o=this.config,E=this.context;if(o){var f=this.loader=new self.XMLHttpRequest,v=this.stats;v.loading.first=0,v.loaded=0;var b=this.xhrSetup;try{if(b)try{b(f,E.url)}catch{f.open("GET",E.url,!0),b(f,E.url)}f.readyState||f.open("GET",E.url,!0)}catch(T){return void this.callbacks.onError({code:f.status,text:T.message},E,f)}E.rangeEnd&&f.setRequestHeader("Range","bytes="+E.rangeStart+"-"+(E.rangeEnd-1)),f.onreadystatechange=this.readystatechange.bind(this),f.onprogress=this.loadprogress.bind(this),f.responseType=E.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),o.timeout),f.send()}},R.readystatechange=function(){var o=this.context,E=this.loader,f=this.stats;if(o&&E){var v=E.readyState,b=this.config;if(!f.aborted&&v>=2)if(self.clearTimeout(this.requestTimeout),f.loading.first===0&&(f.loading.first=Math.max(self.performance.now(),f.loading.start)),v===4){E.onreadystatechange=null,E.onprogress=null;var T=E.status;if(T>=200&&T<300){var u,e;if(f.loading.end=Math.max(self.performance.now(),f.loading.first),e=o.responseType==="arraybuffer"?(u=E.response).byteLength:(u=E.responseText).length,f.loaded=f.total=e,!this.callbacks)return;var i=this.callbacks.onProgress;if(i&&i(f,o,u,E),!this.callbacks)return;var t={url:E.responseURL,data:u};this.callbacks.onSuccess(t,f,o,E)}else f.retry>=b.maxRetry||T>=400&&T<499?(D.logger.error(T+" while loading "+o.url),this.callbacks.onError({code:T,text:E.statusText},o,E)):(D.logger.warn(T+" while loading "+o.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,b.maxRetryDelay),f.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),b.timeout)}},R.loadtimeout=function(){D.logger.warn("timeout while loading "+this.context.url);var o=this.callbacks;o&&(this.abortInternal(),o.onTimeout(this.stats,this.context,this.loader))},R.loadprogress=function(o){var E=this.stats;E.loaded=o.loaded,o.lengthComputable&&(E.total=o.total)},R.getCacheAge=function(){var o=null;if(this.loader&&L.test(this.loader.getAllResponseHeaders())){var E=this.loader.getResponseHeader("age");o=E?parseFloat(E):null}return o},C}();x.default=_}}).default);var At=Di(pr.exports);const _i={name:"d-icon"},Ke=Object.assign(_i,{props:{icon:String,size:[Number,String]},setup:function(P){const x=P,h=G(()=>({fontSize:/^\d+$/.test(x.size)?x.size+"px":x.size}));return(D,d)=>(J(),ae("i",{class:Ze(["d-icon iconfont",P.icon]),style:Je(q(h))},null,6))}});Ke.__scopeId="data-v-0c690e66";tt("data-v-4cb76d59");const Ri={class:"d-player-top"},Ci={class:"top-title"},wi={class:"top-title"};rt();const Ii={props:{title:{default:""}},setup(P){Date.prototype.format=function(D){let d={"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds()};for(var L in d)new RegExp("("+L+")").test(D)&&(D=D.replace(RegExp.$1,RegExp.$1.length==1?d[L]:("00"+d[L]).substr((""+d[L]).length)));return D};let x=re("00:00:00");x.value=new Date().format("hh:mm:ss");let h=null;return h=setInterval(()=>{x.value=new Date().format("hh:mm:ss")},1e3),xt(()=>{clearInterval(h)}),(D,d)=>(J(),ae("div",Ri,[K("p",Ci,le(P.title||""),1),K("p",wi,le(q(x)),1)]))},__scopeId:"data-v-4cb76d59"};tt("data-v-ac2469ec");const xi={class:"d-status"},Oi={class:"d-flex-center"},Pi={class:"d-flex-center"},Fi=De("5X\u901F\u64AD\u653E\u4E2D ");rt();var mr=ot({props:["state"],setup:P=>(x,h)=>Le((J(),ae("div",xi,[Le(K("li",Oi,[z(Ke,{size:"18",class:"d-status-icon",icon:"icon-volume-"+(P.state.volume==0?"mute":P.state.volume>.5?"up":"down")},null,8,["icon"]),De(" "+le(~~(100*P.state.volume))+"% ",1)],512),[[Oe,P.state.handleType=="volume"]]),Le(K("li",Pi,[z(Ke,{size:"12",icon:"icon-play"}),z(Ke,{size:"12",icon:"icon-play",style:{"margin-right":"5px"}}),Fi],512),[[Oe,P.state.handleType=="playbackRate"||P.state.isMultiplesPlay]])],512)),[[Oe,P.state.handleType||P.state.isMultiplesPlay]])});mr.__scopeId="data-v-ac2469ec",tt("data-v-385f7870");const Mi=["checked","true-value","false-value"],Ni=K("span",{class:"d-switch_action"},null,-1);rt();var mt=ot({props:{modelValue:{type:[Number,String,Boolean]},width:{type:String,default:"40px"},trueValue:{type:[Number,String,Boolean],default:!0},falseValue:{type:[Number,String,Boolean],default:!0},activeColor:{type:[String],default:"#409EFF"}},emits:["update:modelValue","change"],setup(P,{emit:x}){const h=P;Ot(_=>({"014e5dc0":P.width,e4e32852:P.activeColor}));const D=re(null),d=G(()=>h.modelValue===h.trueValue),L=()=>{yt(()=>{const _=D.value.checked;x("update:modelValue",_),x("change",_)})};return(_,C)=>(J(),ae("div",{class:Ze(["d-switch",{"is-checked":q(d)}])},[K("input",{class:"d-switch__input",ref:D,type:"checkbox",checked:q(d),onChange:L,"true-value":P.trueValue,"false-value":P.falseValue},null,40,Mi),Ni],2))}});mt.__scopeId="data-v-385f7870",tt("data-v-b2384226");const Bi={key:0},Ui=K("i",{class:"rotating iconfont icon-loading f50"},null,-1),Gi=[K("i",{class:"rotating iconfont icon-loading f50"},null,-1),K("p",null,"\u6B63\u5728\u7F13\u51B2...",-1)],ji=[K("i",{class:"iconfont icon-replay f24 mr5"},null,-1),De("\u91CD\u65B0\u64AD\u653E ")],Vi=[K("i",{class:"iconfont icon-replay f24 mr5"},null,-1),De("\u8BF7\u6C42\u9519\u8BEF ")];rt();var yr=ot({props:{loadType:String,text:{type:String,default:""}},setup(P){const x=P,{proxy:h}=Me(),D=["loadstart","waiting","ended","error","stalled"],d=()=>{h.$parent.play()},L=G(()=>{let _="background: rgba(0, 0, 0, .1);z-index:1";return x.loadType=="loadstart"&&(_="background: rgba(0, 0, 0, 1);;z-index:3"),_});return(_,C)=>Le((J(),ae("div",{class:"d-loading",style:Je(q(L))},[K("div",null,[P.loadType=="loadstart"?(J(),ae("span",Bi,[Ui,K("p",null,le(P.text),1)])):be("",!0),Le(K("span",null,Gi,512),[[Oe,P.loadType=="waiting"]]),Le(K("span",null,[K("p",{onClick:d,class:"d-flex-x d-pointer"},ji)],512),[[Oe,P.loadType=="ended"]]),Le(K("span",null,[K("p",{onClick:d,class:"d-flex-x d-pointer"},Vi)],512),[[Oe,P.loadType=="error"||P.loadType=="stalled"]])])],4)),[[Oe,D.includes(P.loadType)]])}});yr.__scopeId="data-v-b2384226";const et=function(P,x,h,D=!1){P&&x&&h&&P.addEventListener(x,h,D)},Ue=function(P,x,h,D=!1){P&&x&&h&&P.removeEventListener(x,h,D)};tt("data-v-5a794390");const Ki=["onMousedown"];rt();var nt=ot(It(wt({},{name:"DSlider"}),{props:{modelValue:{required:!0,type:Number,default:0},disabled:{type:Boolean,default:!1},vertical:{type:Boolean,default:!1},hover:{type:Boolean,default:!0},hoverText:{type:String,default:""},preload:{type:Number,default:0},size:{type:String,default:"10px"}},emits:["update:modelValue","change","onMousemove"],setup:function(P,{emit:x}){const h=P;Ot(e=>({"5242b67b":P.size}));const D=re(null),d=re(null),L=He({dragging:!1,hoverPosition:0,hoverTipsLeft:"50%"}),_=G(()=>{let e=h.modelValue<0?0:h.modelValue>1?1:h.modelValue;return h.vertical?`height:${100*e}%`:`width:${100*e}%`}),C=G(()=>{let e=h.preload<0?0:h.preload>1?1:h.preload;return h.vertical?`height:${100*e}%`:`width:${100*e}%`}),R=G(()=>{let e=L.hoverPosition<0?0:L.hoverPosition>1?1:L.hoverPosition;return h.vertical?`bottom:${100*e}%`:`left:${100*e}%`}),o=e=>{e.preventDefault()},E=e=>{h.disabled||(e.preventDefault(),L.dragging=!0,v(e),et(window,"mousemove",T),et(window,"touchmove",T),et(window,"mouseup",u),et(window,"touchend",u))},f=e=>{if(!h.hover)return;let i=b(e);if(x("onMousemove",e,i),L.hoverPosition=i,h.vertical)return;let t=D.value,s=d.value.clientWidth/2,l=e.clientX-t.getBoundingClientRect().left;l<s?L.hoverTipsLeft=s-l+"px":t.clientWidth-l<s?L.hoverTipsLeft=t.clientWidth-l-s+"px":L.hoverTipsLeft="50%"},v=e=>{let i=b(e);x("update:modelValue",i),x("change",e,i)},b=e=>{let i=D.value,t=0;if(h.vertical){let s=i.clientHeight;t=(i.getBoundingClientRect().bottom-e.clientY)/s}else t=(e.clientX-i.getBoundingClientRect().left)/i.clientWidth;return t<0?0:t>1?1:t},T=e=>{v(e)},u=e=>{L.dragging&&(Ue(window,"mousemove",T),Ue(window,"touchmove",T),Ue(window,"mouseup",u),Ue(window,"touchend",u),Ue(window,"contextmenu",u),setTimeout(()=>{L.dragging=!1},0))};return(e,i)=>(J(),ae("div",{ref:D,class:Ze(["d-slider",{"is-vertical":h.vertical}]),onMousedown:Qe(E,["stop"]),onContextmenu:o},[K("div",{class:"d-slider__runway",onMousemove:f},[Le(K("div",{class:"d-slider__cursor",style:Je(q(R))},[Le(K("div",{class:"d-slider__tips",ref:d,style:Je({left:q(L).hoverTipsLeft})},le(h.hoverText),5),[[Oe,h.hoverText]])],4),[[Oe,h.hover]]),K("div",{class:"d-slider__preload",style:Je(q(C))},null,4),K("div",{class:"d-slider__bar",style:Je(q(_))},null,4)],32)],42,Ki))}}));nt.__scopeId="data-v-5a794390";tt("data-v-570fa0d1");const Hi={key:0,class:"d-player-dialog"},qi={class:"d-player-dialog-body"},zi={class:"d-player-dialog-title"},Wi={class:"d-player-hotkey-panel"},$i={class:"d-player-filter-panel"},Yi={class:"d-player-filter-panel-item"},Xi=K("span",null,"\u9971\u548C\u5EA6",-1),Qi={class:"d-player-filter-panel-item"},Zi=K("span",null,"\u4EAE\u5EA6",-1),Ji={class:"d-player-filter-panel-item"},en=K("span",null,"\u5BF9\u6BD4\u5EA6",-1),tn={key:0,class:"d-player-contextmenu"},rn=["dplayerKeyCode"],nn=K("input",{class:"d-player-copyText"},null,-1);rt();var Tr=ot({setup(P){const x=He({show:!1,dialogType:"",dialogTitle:"",version:"1.3.1-beta.6",mouseX:0,mouseY:0}),h=[{label:"\u89C6\u9891\u8272\u5F69\u8C03\u6574",key:"filter"},{label:"\u5FEB\u6377\u952E\u8BF4\u660E",key:"hotkey"},{label:"\u590D\u5236\u89C6\u9891\u7F51\u5740",key:"copy"},{label:"\u7248\u672C\uFF1A1.3.1-beta.6",key:"version"}],D=[{key:"Space",label:"\u64AD\u653E/\u6682\u505C"},{key:"\u2192",label:"\u5355\u6B21\u5FEB\u8FDB10s\uFF0C\u957F\u63095\u500D\u901F\u64AD\u653E"},{key:"\u2190",label:"\u5FEB\u90005s"},{key:"\u2191",label:"\u97F3\u91CF\u589E\u52A010%"},{key:"\u2193",label:"\u97F3\u91CF\u589E\u52A0\u964D\u4F4E10%"},{key:"Esc",label:"\u9000\u51FA\u5168\u5C4F/\u9000\u51FA\u7F51\u9875\u5168\u5C4F"},{key:"F",label:"\u5168\u5C4F/\u9000\u51FA\u5168\u5C4F"}],d=He({saturate:.392,brightness:.392,contrast:.392}),L=G(()=>({left:x.mouseX+"px",top:x.mouseY+"px"}));fe(d,E=>{let f=document.querySelector("#dPlayerVideo"),v=(2.55*E.saturate).toFixed(2),b=(2.55*E.brightness).toFixed(2),T=(2.55*E.contrast).toFixed(2);f.style.filter=`saturate(${v}) brightness(${b}) contrast(${T})`});const _=()=>{d.saturate=.392,d.brightness=.392,d.contrast=.392},C=E=>{E.key=="Escape"&&o(0)},R=E=>{E.preventDefault(),et(window,"keydown",C),et(window,"click",o);let f=document.querySelector("#refPlayerWrap"),v=f.clientWidth;f.clientHeight,x.mouseX=E.clientX-f.getBoundingClientRect().left,v-x.mouseX<130&&(x.mouseX=x.mouseX+(v-x.mouseX-130)),x.mouseY=E.clientY-f.getBoundingClientRect().top,x.show=!0},o=E=>{let f=E.path[0].tagName=="LI",v=E.path[0].attributes.dplayerKeyCode&&E.path[0].attributes.dplayerKeyCode.value,b=h.map(T=>T.key);if(f&&b.includes(v))if(x.dialogTitle=E.path[0].innerText,x.dialogType=v,v=="copy"){let T=document.querySelector(".d-player-copyText");T.value=window.location.href,T.select(),document.execCommand("copy"),x.dialogType=""}else v=="version"&&(x.dialogType="");x.show=!1,Ue(window,"keydown",C),Ue(window,"click",o)};return Et(()=>{let E=document.querySelector("#refPlayerWrap");Ue(window,"keydown",C),Ue(window,"click",o),Ue(E,"contextmenu",R),et(E,"contextmenu",R)}),xt(()=>{let E=document.querySelector("#refPlayerWrap");Ue(window,"keydown",C),Ue(window,"click",o),Ue(E,"contextmenu",R)}),(E,f)=>(J(),ae("div",null,[z(Tt,{name:"d-fade-in"},{default:Q(()=>[q(x).dialogType?(J(),ae("div",Hi,[K("div",qi,[K("h5",zi,[De(le(q(x).dialogTitle)+" ",1),K("i",{onClick:f[0]||(f[0]=v=>q(x).dialogType=!1),class:"icon icon-close"},"X")]),Le(K("ul",Wi,[(J(),ae(Be,null,Ge(D,v=>K("li",{class:"d-player-hotkey-panel-item",key:v.key},[K("span",null,le(v.key),1),K("span",null,le(v.label),1)])),64))],512),[[Oe,q(x).dialogType=="hotkey"]]),Le(K("ul",$i,[K("li",Yi,[Xi,z(nt,{class:"filter-panel-slider",size:"5px",modelValue:q(d).saturate,"onUpdate:modelValue":f[1]||(f[1]=v=>q(d).saturate=v)},null,8,["modelValue"]),K("span",null,le(Math.round(255*q(d).saturate)),1)]),K("li",Qi,[Zi,z(nt,{class:"filter-panel-slider",size:"5px",modelValue:q(d).brightness,"onUpdate:modelValue":f[2]||(f[2]=v=>q(d).brightness=v)},null,8,["modelValue"]),K("span",null,le(Math.round(255*q(d).brightness)),1)]),K("li",Ji,[en,z(nt,{class:"filter-panel-slider",size:"5px",modelValue:q(d).contrast,"onUpdate:modelValue":f[3]||(f[3]=v=>q(d).contrast=v)},null,8,["modelValue"]),K("span",null,le(Math.round(255*q(d).contrast)),1)]),K("span",{onClick:_,title:"\u91CD\u7F6E","aria-label":"\u91CD\u7F6E",class:"d-player-filter-reset"},"\u91CD\u7F6E")],512),[[Oe,q(x).dialogType=="filter"]])])])):be("",!0)]),_:1}),q(x).show?(J(),ae("div",tn,[K("ul",{class:"d-player-contextmenu-body",style:Je(q(L))},[(J(),ae(Be,null,Ge(h,v=>K("li",{dplayerKeyCode:v.key,key:v.key},le(v.label),9,rn)),64))],4),nn])):be("",!0)]))}});Tr.__scopeId="data-v-570fa0d1";const Dt=P=>{let x=~~(P/3600),h=~~(P%3600/60),D=~~(P%60);return x=x<10?"0"+x:x,h=h<10?"0"+h:h,D=D<10?"0"+D:D,`${x}:${h}:${D}`},ut="ontouchstart"in window,ur=["loadstart","play","pause","playing","seeking","seeked","waiting","durationchange","progress","canplay","timeupdate","ended","error","stalled"],an={width:{type:String,default:"800px"},height:{type:String,default:"450px"},color:{type:String,default:"#409eff"},src:{required:!0,type:String,default:""},title:{type:String,default:""},type:{type:String,default:"video/mp4"},poster:{type:String,default:""},webFullScreen:{type:Boolean,default:!1},speed:{type:Boolean,default:!0},currentTime:{type:Number,default:0},playsinline:{type:Boolean,default:!1},muted:{type:Boolean,default:!1},speedRate:{type:Array,default:()=>["2.0","1.5","1.25","1.0","0.75","0.5"]},autoPlay:{type:Boolean,default:!1},loop:{type:Boolean,default:!1},mirror:{type:Boolean,default:!1},ligthOff:{type:Boolean,default:!1},volume:{type:[String,Number],default:.3},control:{type:Boolean,default:!0},controlBtns:{type:Array,default:["audioTrack","quality","speedRate","volume","setting","pip","pageFullScreen","fullScreen"]},preload:{type:String,default:"auto"}};tt("data-v-01791e9e");const sn={class:"d-player-video",id:"dPlayerVideo"},on=["controls","webkit-playsinline","playsinline","volume","muted","loop","preload","src","poster"],ln={class:"d-player-lightoff"},un={key:1,class:"d-player-state"},cn={class:"d-play-btn"},dn=["onKeyup","onKeydown"],fn={class:"d-control-progress"},hn={class:"d-tool-bar"},vn={key:0,class:"d-tool-item d-tool-time audioTrack-btn"},gn=K("span",{style:{margin:"0 3px"}},"/",-1),pn={class:"total-time"},mn={class:"d-tool-bar"},yn={key:0,class:"d-tool-item quality-btn"},Tn={class:"d-tool-item-main"},En={class:"speed-main",style:{"text-align":"center"}},bn=["onClick"],Sn={key:1,class:"d-tool-item speedRate-btn"},Ln={class:"d-tool-item-main"},kn={class:"speed-main"},An=["onClick"],Dn={key:2,class:"d-tool-item volume-btn"},_n={class:"d-tool-item-main volume-box",style:{width:"52px"}},Rn={class:"volume-text-size"},Cn={key:3,class:"d-tool-item setting-btn"},wn={class:"d-tool-item-main"},In={class:"speed-main"},xn=De(" \u955C\u50CF\u753B\u9762 "),On=De(" \u5FAA\u73AF\u64AD\u653E "),Pn=De(" \u5173\u706F\u6A21\u5F0F "),Fn=K("div",{class:"d-tool-item-main"},"\u753B\u4E2D\u753B",-1),Mn=K("div",{class:"d-tool-item-main"},"\u7F51\u9875\u5168\u5C4F",-1),Nn=K("div",{class:"d-tool-item-main"},"\u5168\u5C4F",-1);rt();var at=ot(It(wt({},{name:"vue3VideoPlay",inheritAttrs:!1}),{props:an,emits:[...ur,"mirrorChange","loopChange","lightOffChange"],setup:function(P,{expose:x,emit:h}){const D=P;Ot(w=>({"51d4439c":q(b),"77e758a6":w.width,b8a1afc0:w.height}));const d=new At({fragLoadingTimeOut:2e3}),L=re(null),_=re(null),C=re(null),R=re(null),o=He(It(wt({dVideo:null},D),{muted:D.muted,playBtnState:D.autoPlay?"pause":"play",loadStateType:"loadstart",fullScreen:!1,handleType:"",currentTime:"00:00:00",preloadBar:0,totalTime:"00:00:00",isVideoHovering:!0,speedActive:"1.0",playProgress:0,isMultiplesPlay:!1,longPressTimeout:null,progressCursorTime:"00:00:00",qualityLevels:[],currentLevel:0})),E=(...w)=>O=>w.reverse().reduce((F,M)=>M(F),O),f=ur.reduce((w,O)=>{var F;return w[`on${F=O,F.charAt(0).toUpperCase()+F.slice(1)}`]=M=>{o.loadStateType=O,h(O,M)},w},{});f.onCanplay=E(f.onCanplay,()=>{o.playBtnState!="play"&&o.dVideo.play(),o.autoPlay&&(o.dVideo.play(),o.playBtnState="pause")}),f.onEnded=E(f.onEnded,()=>{o.playBtnState="replay"}),f.onDurationchange=w=>{h("durationchange",w),D.currentTime!=0&&(o.dVideo.currentTime=D.currentTime),f.onTimeupdate(w)},f.onProgress=w=>{console.log("\u7F13\u51B2\u4E2D..."),h("progress",w);let O=w.target.duration,F=w.target.buffered,M=w.target.buffered.length&&w.target.buffered.end(F-1);o.preloadBar=M/O},f.onTimeupdate=w=>{h("timeupdate",w);let O=w.duration||w.target.duration||0,F=w.currentTime||w.target.currentTime;o.playProgress=F/O,o.currentTime=Dt(F),o.totalTime=Dt(O)},f.onError=E(f.onError,()=>{o.playBtnState="replay"});let v=qr();for(let w in v)f[w]=v[w];const b=(T=o.color,`${parseInt("0x"+T.slice(1,3))},${parseInt("0x"+T.slice(3,5))},${parseInt("0x"+T.slice(5,7))}`);var T;const u=lr(500,()=>{o.handleType=""}),e=w=>{w.preventDefault(),w.code=="ArrowUp"?o.volume=o.volume+.1>1?1:o.volume+.1:o.volume=o.volume-.1<0?0:o.volume-.1,o.muted=!1,o.handleType="volume",u()},i=w=>{D.speed&&(o.dVideo.currentTime=o.dVideo.currentTime<10?.1:o.dVideo.currentTime-10,f.onTimeupdate(o.dVideo),l())},t=w=>{w.preventDefault();let O=w.type;if(w.key=="ArrowRight"){if(l(),O=="keyup"){if(clearTimeout(o.longPressTimeout),!D.speed&&!o.longPressTimeout)return;o.isMultiplesPlay?(o.dVideo.playbackRate=o.speedActive,o.isMultiplesPlay=!1):(o.dVideo.currentTime=o.dVideo.currentTime+10,f.onTimeupdate(o.dVideo))}else if(O=="keydown"){if(!D.speed)return;o.isMultiplesPlay&&clearTimeout(o.longPressTimeout),o.longPressTimeout=setTimeout(()=>{o.isMultiplesPlay=!0,o.dVideo.playbackRate=5,o.handleType="playbackRate",u()},500)}}},s=()=>{ut||R.value.focus()},l=()=>{o.loadStateType="play",o.dVideo.play().catch(()=>{setTimeout(()=>{o.playBtnState="replay",o.loadStateType="error"},500)}),o.playBtnState="pause"},n=()=>{o.dVideo.pause(),o.playBtnState="play"},c=w=>{w&&w.preventDefault(),o.playBtnState=="play"||o.playBtnState=="replay"?l():o.playBtnState=="pause"&&n()},m=()=>{o.muted=!o.muted,o.volume==0&&(o.volume=.05)},p=(w,O)=>{let F=o.dVideo.duration||o.dVideo.target.duration;o.dVideo.currentTime=F*O,o.playBtnState=="play"&&(o.dVideo.play(),o.playBtnState="pause")},y=(w,O)=>{o.progressCursorTime=Dt(o.dVideo.duration*O)},r=lr(2500,()=>{o.isVideoHovering=!1}),a=w=>{o.isVideoHovering=!0,r()},g=w=>{h("mirrorChange",w,o.dVideo)},k=w=>{h("loopChange",w,o.dVideo)},S=w=>{h("lightOffChange",w,o.dVideo)},A=()=>{var w;w=o.dVideo,document.pictureInPictureElement?document.exitPictureInPicture().catch(O=>{console.log(O,"Video failed to leave Picture-in-Picture mode.")}):w.requestPictureInPicture().catch(O=>{console.log(O,"Video failed to enter Picture-in-Picture mode.")})},I=()=>{o.fullScreen=(w=>{let O=document,F=O.webkitIsFullScreen||O.fullscreen;return F?(document.exitFullscreen||O.webkitExitFullScreen).call(O):(w.requestFullscreen||w.webkitRequestFullScreen).call(w),!F})(L.value)};return fe(()=>D.src,()=>{yt(()=>{o.dVideo.canPlayType(D.type)||o.dVideo.canPlayType("application/vnd.apple.mpegurl")?o.muted=D.autoPlay:At.isSupported()&&(d.detachMedia(),d.attachMedia(o.dVideo),d.on(At.Events.MEDIA_ATTACHED,()=>{d.loadSource(D.src),d.on("hlsManifestParsed",(w,O)=>{console.log(O),o.currentLevel=O.level,o.qualityLevels=O.levels||[]})}),d.on("hlsLevelSwitching",(w,O)=>{console.log(O),console.log("LEVEL_SWITCHING")}),d.on("hlsLevelSwitched",(w,O)=>{o.currentLevel=O.level,console.log("LEVEL_SWITCHED")}))})},{immediate:!0}),Et(()=>{o.dVideo=_,s()}),x({play:l,pause:n,togglePlay:c}),(w,O)=>(J(),ae("div",{ref:L,id:"refPlayerWrap",class:Ze(["d-player-wrap",{"web-full-screen":q(o).webFullScreen,"is-lightoff":q(o).lightOff,"d-player-wrap-hover":q(o).playBtnState=="play"||q(o).isVideoHovering}]),onMousemove:a},[K("div",sn,[K("video",Ct({ref:_,class:["d-player-video-main",{"video-mirror":q(o).mirror}],id:"dPlayerVideoMain",controls:!(!q(ut)||!q(o).speed),"webkit-playsinline":D.playsinline,playsinline:D.playsinline},q(f),{volume:q(o).volume,muted:q(o).muted,loop:q(o).loop,preload:w.preload,width:"100%",height:"100%",src:D.src,poster:D.poster}),"\u60A8\u7684\u6D4F\u89C8\u5668\u4E0D\u652F\u6301Video\u6807\u7B7E\u3002",16,on)]),z(Tt,{name:"d-fade-in"},{default:Q(()=>[Le(K("div",ln,null,512),[[Oe,q(o).lightOff]])]),_:1}),q(o).fullScreen?(J(),we(Ii,{key:0,title:D.title},null,8,["title"])):be("",!0),q(ut)?be("",!0):(J(),ae("div",un,[z(Tt,{name:"d-scale-out"},{default:Q(()=>[Le(K("div",cn,[z(Ke,{icon:"icon-play",size:40})],512),[[Oe,q(o).playBtnState=="play"]])]),_:1}),z(mr,{state:q(o)},null,8,["state"])])),q(ut)?be("",!0):(J(),ae("input",{key:2,type:"input",readonly:"readonly",ref:R,onDblclick:I,onKeyup:[lt(I,["f"]),O[0]||(O[0]=lt(F=>q(o).webFullScreen=!1,["esc"])),t],onClick:c,onKeydown:[lt(c,["space"]),lt(i,["arrow-left"]),lt(e,["arrow-up","arrow-down"]),t],class:"d-player-input",maxlength:"0"},null,40,dn)),z(yr,{loadType:q(o).loadStateType},null,8,["loadType"]),z(Tr),!q(ut)&&q(o).control?(J(),ae("div",{key:3,class:"d-player-control",ref:C},[K("div",fn,[z(nt,{class:"d-progress-bar",onOnMousemove:y,onChange:p,disabled:!q(o).speed,hoverText:q(o).progressCursorTime,modelValue:q(o).playProgress,"onUpdate:modelValue":O[1]||(O[1]=F=>q(o).playProgress=F),preload:q(o).preloadBar},null,8,["disabled","hoverText","modelValue","preload"])]),K("div",{class:"d-control-tool",onClick:s},[K("div",hn,[K("div",{class:"d-tool-item",onClick:c},[z(Ke,{size:"24",icon:`icon-${q(o).playBtnState}`},null,8,["icon"])]),D.controlBtns.includes("audioTrack")?(J(),ae("div",vn,[K("span",null,le(q(o).currentTime),1),gn,K("span",pn,le(q(o).totalTime),1)])):be("",!0)]),K("div",mn,[q(o).qualityLevels.length&&D.controlBtns.includes("quality")?(J(),ae("div",yn,[De(le(q(o).qualityLevels.length&&(q(o).qualityLevels[q(o).currentLevel]||{}).height)+"P ",1),K("div",Tn,[K("ul",En,[(J(!0),ae(Be,null,Ge(q(o).qualityLevels,(F,M)=>(J(),ae("li",{class:Ze({"speed-active":q(o).currentLevel==M}),onClick:N=>((B,U)=>{d.currentLevel=U,o.currentLevel=U})(0,M),key:F},le(F.height)+"P",11,bn))),128))])])])):be("",!0),D.controlBtns.includes("speedRate")?(J(),ae("div",Sn,[De(le(q(o).speedActive=="1.0"?"\u500D\u901F":q(o).speedActive+"x")+" ",1),K("div",Ln,[K("ul",kn,[(J(!0),ae(Be,null,Ge(q(o).speedRate,F=>(J(),ae("li",{class:Ze({"speed-active":q(o).speedActive==F}),onClick:M=>(N=>{o.speedActive=N,o.dVideo.playbackRate=N})(F),key:F},le(F)+"x",11,An))),128))])])])):be("",!0),D.controlBtns.includes("volume")?(J(),ae("div",Dn,[K("div",_n,[K("div",{class:Ze(["volume-main",{"is-muted":q(o).muted}])},[K("span",Rn,le(q(o).muted?0:~~(100*q(o).volume))+"%",1),z(nt,{onChange:O[2]||(O[2]=F=>q(o).muted=!1),hover:!1,size:"5px",vertical:!0,modelValue:q(o).volume,"onUpdate:modelValue":O[3]||(O[3]=F=>q(o).volume=F)},null,8,["modelValue"])],2)]),K("span",{onClick:m,style:{display:"flex"}},[z(Ke,{size:"20",icon:"icon-volume-"+(q(o).volume==0||q(o).muted?"mute":q(o).volume>.5?"up":"down")},null,8,["icon"])])])):be("",!0),D.controlBtns.includes("setting")?(J(),ae("div",Cn,[z(Ke,{size:"20",class:"rotateHover",icon:"icon-settings"}),K("div",wn,[K("ul",In,[K("li",null,[xn,z(mt,{onChange:g,modelValue:q(o).mirror,"onUpdate:modelValue":O[4]||(O[4]=F=>q(o).mirror=F)},null,8,["modelValue"])]),K("li",null,[On,z(mt,{onChange:k,modelValue:q(o).loop,"onUpdate:modelValue":O[5]||(O[5]=F=>q(o).loop=F)},null,8,["modelValue"])]),K("li",null,[Pn,z(mt,{onChange:S,modelValue:q(o).lightOff,"onUpdate:modelValue":O[6]||(O[6]=F=>q(o).lightOff=F)},null,8,["modelValue"])])])])])):be("",!0),D.controlBtns.includes("pip")?(J(),ae("div",{key:4,class:"d-tool-item pip-btn",onClick:A},[z(Ke,{size:"20",icon:"icon-pip"}),Fn])):be("",!0),D.controlBtns.includes("pageFullScreen")?(J(),ae("div",{key:5,class:"d-tool-item pip-btn",onClick:O[7]||(O[7]=F=>q(o).webFullScreen=!q(o).webFullScreen)},[z(Ke,{size:"20",icon:"icon-web-screen"}),Mn])):be("",!0),D.controlBtns.includes("fullScreen")?(J(),ae("div",{key:6,class:"d-tool-item fullScreen-btn",onClick:I},[Nn,z(Ke,{size:"20",icon:"icon-screen"})])):be("",!0)])])],512)):be("",!0)],34))}}));function Bn(P){P.component(at.name,at)}at.__scopeId="data-v-01791e9e",at.install=Bn;const Un={style:{display:"flex","flex-direction":"row"}},Gn={style:{width:"200px","max-height":"50vh"}},jn={style:{display:"flex","flex-direction":"row","justify-content":"flex-start"}},Vn={key:2},Kn=["onClick"],Hn={style:{overflow:"auto","background-color":"rgba(0, 0, 0, 0.4)"}},qn={class:"row justify-center"},zn={style:{padding:"0",margin:"0","background-color":"rgba(0, 0, 0, 0)",display:"flex","flex-direction":"row","justify-content":"space-between",width:"100%"}},Wn=["onClick"],$n=["onClick"],Yn=["onClick"],Xn={class:"text-subtitle2",style:{overflow:"auto",padding:"0"}},Qn={style:{color:"#0e4a2e"}},Zn={class:"row justify-between",style:{"background-color":"rgba(0, 0, 0, 0.8)","white-space":"nowrap","text-overflow":"ellipsis",overflow:"hidden"}},Jn={class:"q-mr-sm",style:{"-webkit-app-region":"drag",color:"rgb(213, 90, 90)","font-weight":"550","font-size":"medium",overflow:"hidden"}},ea={style:{overflow:"auto","background-color":"rgba(0, 0, 0, 0.4)"}},ta={class:"row justify-center"},ra={style:{padding:"0",margin:"0","background-color":"rgba(0, 0, 0, 0)",display:"flex","flex-direction":"row","justify-content":"space-between",width:"100%"}},ia=["onClick"],na=["onClick"],aa=["onClick"],sa={class:"text-subtitle2",style:{overflow:"auto",padding:"0"}},oa={style:{color:"#0e4a2e"}},la={style:{width:"200px","max-height":"50vh"}},ua={key:2},ca=["onClick"],da={__name:"PlayingVideo",props:{mode:{type:String,default:"drawer"}},emits:["close"],setup(P,{expose:x,emit:h}){var r,a,g,k;const D=P,d=ii(),L=ni(),_=re(null),{replace:C}=Wr(),R=G(()=>d.platform.is.mobile),o=re(!0),E=re(380),f=He({playList:[],queryParam:{SortType:"desc"},showMore:!1,settingInfo:{},currentTime:1,playing:{}});Ht(["ArrowLeft"],()=>{n(-10)}),Ht(["ArrowRight"],()=>{n(60)});const v=async S=>{await ti(S),await ri(),await m()},b=G(()=>L.getSuggestions),T=G(()=>L.drawerRight);fe(T,S=>{S&&m()});const u=S=>{f.playing=S,y.currentTime=1,y.src=Gt(S.Id),y.webFullScreen=!0;const A=document.querySelector(".topRef");A&&A.scrollTo(0,0),D.mode=="page"&&C(`/playing/${S.Id}`),setTimeout(()=>{_.value.play()},100),!f.queryParam.Keyword&&D.mode!=="picInPic"&&(f.queryParam.Keyword=S.Actress,m())},e=async()=>{const S=await ai();f.settingInfo=S.data},i=()=>{y.src=null},t=()=>{L.drawerRight=!1},s=S=>{f.currentTime=S.target.currentTime},l=S=>{L.videoOptions.volume=S.target.volume,y.volume=S.target.volume},n=S=>{if(_.value){y.currentTime=f.currentTime+S;const A=y.src;y.src="",setTimeout(()=>{y.src=A},1)}},c=()=>{i(),D.mode=="drawer"?t():window.close(),h("close")},m=async()=>{const S=await ei({...L.FileSearchParam,...f.queryParam,Page:1,PageSize:500});f.playList=[...S.Data],f.playing||(f.playing=f.playList[0],u(f.playing))},p=S=>{if(!!f.playList){for(let A=0;A<f.playList.length;A++)if(f.playList[A].Id===f.playing.Id)if(A==f.playList.length-1){u(f.playList[0]);return}else if(A+S<=0){u(f.playList[0]);return}else{u(f.playList[A+S]);return}}},y=He({width:"100%",height:"auto",color:"#ffffff",title:(r=f.playing)==null?void 0:r.Title,src:Gt(f.playing.Id),muted:!1,preload:"false",webFullScreen:!1,speedRate:["1.0","1.25","1.5","2.0"],autoPlay:!1,loop:!1,mirror:!1,ligthOff:!0,currentTime:1,volume:(a=L.videoOptions)==null?void 0:a.volume,control:(g=L.videoOptions)==null?void 0:g.control,controlBtns:(k=L.videoOptions)==null?void 0:k.controlBtns});return x({open:u,stop:i}),(S,A)=>(J(),ae(Be,null,[D.mode!=="page"||R.value?(J(),we(er,{key:0,view:"lHh Lpr lFf",container:"",style:{height:"120vh"},class:"shadow-2 rounded-borders"},{default:Q(()=>[z(qt,{style:{width:"100%"}},{default:Q(()=>[D.mode==="drawer"?(J(),we(hi,{key:0,class:"row justify-between bg-black",style:{overflow:"hidden"}},{default:Q(()=>[De(le(f.playing.Title)+" ",1),z(li),z(Ae,{dense:"",flat:"",icon:"close",onClick:c},{default:Q(()=>[z(Nt,{class:"bg-white text-primary"},{default:Q(()=>[De("\u5173\u95ED")]),_:1})]),_:1})]),_:1})):be("",!0),z(gt,null,{default:Q(()=>{var I,w,O;return[Le(z(q(at),Ct({ref_key:"vue3VideoPlayRef",ref:_,id:"vue3VideoPlayRef",style:{"object-fit":"contain",width:"100%",height:"auto","max-height":"99vh"}},y,{onEnded:A[0]||(A[0]=F=>p(1)),onTimeupdate:s,onVolumeupdate:l}),null,16),[[Oe,(I=f.playing)==null?void 0:I.Id]]),K("div",Un,[z(Ae,{size:"sm",flat:"",style:{color:"#59d89d"},label:(w=f.playing.Actress)==null?void 0:w.substring(0,8),onClick:A[1]||(A[1]=F=>{f.queryParam.Keyword=f.playing.Actress,m()})},null,8,["label"]),z(Ae,{size:"sm",flat:"",style:{color:"goldenrod"},label:(O=f.playing.Code)==null?void 0:O.substring(0,8),onClick:A[2]||(A[2]=F=>{f.queryParam.Keyword=f.playing.Code,m()})},null,8,["label"]),z(Pt,{modelValue:f.queryParam.Keyword,"onUpdate:modelValue":[A[3]||(A[3]=F=>f.queryParam.Keyword=F),m],dense:!0,clearable:""},{prepend:Q(()=>[z(pt,{name:"ti-list",class:"cursor-pointer"},{default:Q(()=>[z(tr,null,{default:Q(()=>[K("div",Gn,[z(Wt,null,{default:Q(()=>[(J(!0),ae(Be,null,Ge(b.value,F=>Le((J(),we(Bt,{clickable:"",key:F,onClick:M=>{f.queryParam.Keyword=F,m()}},{default:Q(()=>[z(Ut,null,{default:Q(()=>[z(zt,null,{default:Q(()=>[De(le(F),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[Ft]])),128))]),_:1})])]),_:1})]),_:1})]),append:Q(()=>[z(pt,{name:"ti-search",title:"\u641C",class:"cursor-pointer",onClick:m})]),_:1},8,["modelValue"])]),K("div",jn,[z(jt,{modelValue:f.queryParam.SortType,"onUpdate:modelValue":[A[4]||(A[4]=F=>f.queryParam.SortType=F),A[5]||(A[5]=F=>m())],"toggle-color":"primary",textColor:"primary",options:[{label:"\u6B63",value:"asc"},{label:"\u5012",value:"desc"}]},null,8,["modelValue"]),f.playlist?be("",!0):(J(),we(Ae,{key:0,size:"sm",color:"primary",label:"\u4E0A\u4E00\u4E2A",onClick:A[6]||(A[6]=F=>p(-1))})),f.playlist?be("",!0):(J(),we(Ae,{key:1,size:"sm",color:"primary",label:"\u4E0B\u4E00\u4E2A",onClick:A[7]||(A[7]=F=>p(1))})),z(Ae,{color:"orange",size:"sm",label:"\u66F4\u591A",onClick:A[8]||(A[8]=F=>{f.showMore=!f.showMore,e()})}),f.showMore?(J(),ae("span",Vn,[(J(!0),ae(Be,null,Ge(f.settingInfo.Tags,F=>(J(),we($e,{square:"",color:"red","text-color":"white",key:F,style:{"margin-left":"0px",padding:"0 4px"}},{default:Q(()=>[K("span",{onClick:M=>{f.queryParam.Keyword=F,m()}},le(F),9,Kn)]),_:2},1024))),128))])):be("",!0)])]}),_:1})]),_:1}),z(Jt,null,{default:Q(()=>[z(ir,null,{default:Q(()=>[K("div",Hn,[K("div",qn,[(J(!0),ae(Be,null,Ge([...f.playList],I=>(J(),we(gt,{class:"q-ma-sm example-item",key:I.Id},{default:Q(()=>[z(Vt,{fit:"cover",easier:"",draggable:"",src:q(Kt)(I.Id),class:"item-img",onClick:w=>u(I)},{default:Q(()=>[K("div",zn,[K("div",{onClick:Qe(()=>{},["stop"]),style:{display:"flex","flex-direction":"column","justify-content":"flex-start",width:"fit-content"}},[z(Ae,{square:"",color:"red",size:"sm","text-color":"white",style:{"margin-left":"0px",padding:"0 4px"}},{default:Q(()=>[K("span",{onClick:w=>v(I.Id)},"\u5220\u9664",8,$n)]),_:2},1024),(J(!0),ae(Be,null,Ge(I.Tags,w=>(J(),we($e,{square:"",color:"red","text-color":"white",key:w,style:{"margin-left":"0px",padding:"0 4px"}},{default:Q(()=>[K("span",{onClick:O=>{f.queryParam.Keyword=w,m()}},le(w),9,Yn)]),_:2},1024))),128))],8,Wn),z($e,{onClick:Qe(()=>{},["stop"]),square:"",color:"green","text-color":"white",style:{width:"fit-content","margin-right":"0px",padding:"0 6px"}},{default:Q(()=>[K("span",null,le(I.MovieType),1)]),_:2},1032,["onClick"])])]),_:2},1032,["src","onClick"]),z(Mt,{style:{overflow:"auto",padding:"4px"}},{default:Q(()=>{var w;return[K("div",Xn,[z($e,{onClick:Qe(()=>{},["stop"]),square:"",color:"green","text-color":"orange",style:{padding:"0px 4px"}},{default:Q(()=>[De(le(I.SizeStr),1)]),_:2},1032,["onClick"]),K("span",Qn,le((w=I.Title)==null?void 0:w.substring(0,20)),1)])]}),_:2},1024)]),_:2},1024))),128))])]),z(rr,{position:"bottom-right","scroll-offset":150,offset:[18,18]},{default:Q(()=>[z(Ae,{fab:"",icon:"keyboard_arrow_up",color:"accent"})]),_:1})]),_:1})]),_:1})]),_:1})):be("",!0),D.mode==="page"&&!R.value?(J(),we(er,{key:1,view:"hhh Lpr Lfr",style:{width:"100%"},class:"shadow-2 rounded-borders"},{default:Q(()=>[z(qt,{reveal:"",class:"bg-black"},{default:Q(()=>[z(ui,null,{default:Q(()=>[z(si,null,{default:Q(()=>[K("div",Zn,[K("span",Jn,le(f.playing.Title),1),z(Ae,{dense:"",flat:"",icon:"close",onClick:c},{default:Q(()=>[z(Nt,{class:"bg-white text-primary"},{default:Q(()=>[De("\u5173\u95ED")]),_:1})]),_:1})])]),_:1}),z(Ae,{flat:"",onClick:A[9]||(A[9]=I=>o.value=!o.value),round:"",dense:"",icon:"menu"})]),_:1})]),_:1}),z(fi,{side:"right",modelValue:o.value,"onUpdate:modelValue":A[11]||(A[11]=I=>o.value=I),bordered:"",width:E.value,breakpoint:500,class:"bg-grey-3"},{default:Q(()=>[z(Ei,{size:"sm",modelValue:E.value,"onUpdate:modelValue":A[10]||(A[10]=I=>E.value=I),min:380,max:740},null,8,["modelValue"]),z(di,{class:"fit"},{default:Q(()=>[K("div",ea,[K("div",ta,[(J(!0),ae(Be,null,Ge([...f.playList],I=>(J(),we(gt,{class:"q-ma-sm example-item",key:I.Id},{default:Q(()=>[z(Vt,{fit:"cover",easier:"",draggable:"",src:q(Kt)(I.Id),class:"item-img",onClick:w=>u(I)},{default:Q(()=>[K("div",ra,[K("div",{onClick:Qe(()=>{},["stop"]),style:{display:"flex","flex-direction":"column","justify-content":"flex-start",width:"fit-content"}},[z(Ae,{square:"",color:"red",size:"sm","text-color":"white",style:{"margin-left":"0px",padding:"0 4px"}},{default:Q(()=>[K("span",{onClick:w=>v(I.Id)},"\u5220\u9664",8,na)]),_:2},1024),(J(!0),ae(Be,null,Ge(I.Tags,w=>(J(),we($e,{square:"",color:"red","text-color":"white",key:w,style:{"margin-left":"0px",padding:"0 4px"}},{default:Q(()=>[K("span",{onClick:O=>{f.queryParam.Keyword=w,m()}},le(w),9,aa)]),_:2},1024))),128))],8,ia),z($e,{onClick:Qe(()=>{},["stop"]),square:"",color:"green","text-color":"white",style:{width:"fit-content","margin-right":"0px",padding:"0 6px"}},{default:Q(()=>[K("span",null,le(I.MovieType),1)]),_:2},1032,["onClick"])])]),_:2},1032,["src","onClick"]),z(Mt,{style:{overflow:"auto",padding:"4px"}},{default:Q(()=>{var w;return[K("div",sa,[z($e,{onClick:Qe(()=>{},["stop"]),square:"",color:"green","text-color":"orange",style:{padding:"0px 4px"}},{default:Q(()=>[De(le(I.SizeStr),1)]),_:2},1032,["onClick"]),K("span",oa,le((w=I.Title)==null?void 0:w.substring(0,20)),1)])]}),_:2},1024)]),_:2},1024))),128))])])]),_:1})]),_:1},8,["modelValue","width"]),z(Jt,{style:{width:"fit-content"}},{default:Q(()=>[z(ir,null,{default:Q(()=>[z(gt,{class:"q-dialog-plugin",style:{width:"100%","max-height":"95vh","background-color":"rgba(0, 0, 0, 0.1)"}},{default:Q(()=>{var I;return[Le(z(q(at),Ct({ref_key:"vue3VideoPlayRef",ref:_,id:"vue3VideoPlayRef",style:{"object-fit":"contain",width:"100%",height:"auto","max-height":"99vh"}},y,{onEnded:A[12]||(A[12]=w=>p(1)),onTimeupdate:s,onVolumeupdate:l}),null,16),[[Oe,(I=f.playing)==null?void 0:I.Id]]),z($r,{align:"left"},{default:Q(()=>{var w,O;return[K("div",null,[z(Ae,{flat:"",style:{color:"#59d89d"},label:(w=f.playing.Actress)==null?void 0:w.substring(0,8),onClick:A[13]||(A[13]=F=>{f.queryParam.Keyword=f.playing.Actress,m()})},null,8,["label"]),z(Ae,{flat:"",style:{color:"goldenrod"},label:(O=f.playing.Code)==null?void 0:O.substring(0,8),onClick:A[14]||(A[14]=F=>{f.queryParam.Keyword=f.playing.Code,m()})},null,8,["label"]),z(Pt,{modelValue:f.queryParam.Keyword,"onUpdate:modelValue":[A[15]||(A[15]=F=>f.queryParam.Keyword=F),m],dense:!0,clearable:""},{prepend:Q(()=>[z(pt,{name:"ti-list",class:"cursor-pointer"},{default:Q(()=>[z(tr,null,{default:Q(()=>[K("div",la,[z(Wt,null,{default:Q(()=>[(J(!0),ae(Be,null,Ge(b.value,F=>Le((J(),we(Bt,{clickable:"",key:F,onClick:M=>{f.queryParam.Keyword=F,m()}},{default:Q(()=>[z(Ut,null,{default:Q(()=>[z(zt,null,{default:Q(()=>[De(le(F),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[Ft]])),128))]),_:1})])]),_:1})]),_:1})]),append:Q(()=>[z(pt,{name:"ti-search",title:"\u641C",class:"cursor-pointer",onClick:m})]),_:1},8,["modelValue"])]),K("div",null,[z(jt,{modelValue:f.queryParam.SortType,"onUpdate:modelValue":[A[16]||(A[16]=F=>f.queryParam.SortType=F),A[17]||(A[17]=F=>m())],"toggle-color":"primary",options:[{label:"\u6B63",value:"asc"},{label:"\u5012",value:"desc"}]},null,8,["modelValue"]),f.playlist?be("",!0):(J(),we(Ae,{key:0,color:"primary",label:"\u4E0A\u4E00\u4E2A",onClick:A[18]||(A[18]=F=>p(-1))})),f.playlist?be("",!0):(J(),we(Ae,{key:1,color:"primary",label:"\u4E0B\u4E00\u4E2A",onClick:A[19]||(A[19]=F=>p(1))})),z(Ae,{color:"orange",label:"\u66F4\u591A",onClick:A[20]||(A[20]=F=>{f.showMore=!f.showMore,e()})}),f.showMore?(J(),ae("span",ua,[(J(!0),ae(Be,null,Ge(f.settingInfo.Tags,F=>(J(),we($e,{square:"",color:"red","text-color":"white",key:F,style:{"margin-left":"0px",padding:"0 4px"}},{default:Q(()=>[K("span",{onClick:M=>{f.queryParam.Keyword=F,m()}},le(F),9,ca)]),_:2},1024))),128))])):be("",!0)])]}),_:1})]}),_:1})]),_:1}),z(rr,{position:"bottom"},{default:Q(()=>[z(Ae,{fab:"",icon:"keyboard_arrow_up",color:"red"})]),_:1})]),_:1})]),_:1})):be("",!0)],64))}};var ba=zr(da,[["__scopeId","data-v-d5eb4ffc"]]);export{ba as P,zt as Q,er as a,qt as b,ui as c,si as d,li as e,fi as f,di as g,Wt as h,Jt as i,ir as j,hi as k,tr as l,rr as m};
