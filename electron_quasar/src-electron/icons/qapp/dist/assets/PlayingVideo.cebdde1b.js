import{E as Ne,u as j,G as ne,H as $e,I as lt,J as Ie,r as se,v as pe,K as _t,L as fr,M as bt,N as Ke,O as ut,P as gt,R as pt,S as hr,T as vr,U as gr,V as pr,W as mr,X as ft,Y as Ve,Z as Rt,_ as vt,n as Le,$ as St,a0 as yr,a1 as ir,a2 as nr,a3 as Tr,a4 as mt,g as He,a5 as wt,a6 as Er,a7 as br,a8 as Sr,s as Lr,a9 as kr,aa as yt,ab as Ar,ac as Dr,ad as _r,ae as Rr,af as wr,o as J,k as ie,ag as Ze,ah as Je,C as q,f as De,d as at,A as xe,h as V,a as W,t as le,ai as Ct,e as be,w as Q,aj as Lt,F as Fe,z as Be,ak as tt,al as rt,am as Qe,an as Cr,B as kt,c as Ce,ao as st,ap as Ir,aq as xr,p as Ae,q as dt,l as It,Q as ct,ar as xt,i as Ot,as as Pt,D as Or,m as Pr}from"./index.3a29eae7.js";import{u as Fr,b as Mr,c as Nr,d as Ft,Q as Mt,a as Nt}from"./QMenu.d88dc170.js";import{g as Bt,Q as Ut,a as Gt,b as jt}from"./index.d7326852.js";import{Q as Ye}from"./QChip.5dea51ee.js";import{u as Br,o as Kt}from"./index.27d30962.js";import{u as Ur}from"./System.d4b99f85.js";import{S as Gr,D as jr,R as Kr}from"./searchAPI.28a64331.js";import{a as Vr}from"./settingAPI.c05ae860.js";var Hr=Ne({name:"QToolbarTitle",props:{shrink:Boolean},setup(F,{slots:I}){const v=j(()=>"q-toolbar__title ellipsis"+(F.shrink===!0?" col-shrink":""));return()=>ne("div",{class:v.value},$e(I.default))}});const qr=ne("div",{class:"q-space"});var Wr=Ne({name:"QSpace",setup(){return()=>qr}}),zr=Ne({name:"QToolbar",props:{inset:Boolean},setup(F,{slots:I}){const v=j(()=>"q-toolbar row no-wrap items-center"+(F.inset===!0?" q-toolbar--inset":""));return()=>ne("div",{class:v.value,role:"toolbar"},$e(I.default))}}),Vt=Ne({name:"QHeader",props:{modelValue:{type:Boolean,default:!0},reveal:Boolean,revealOffset:{type:Number,default:250},bordered:Boolean,elevated:Boolean,heightHint:{type:[String,Number],default:50}},emits:["reveal","focusin"],setup(F,{slots:I,emit:v}){const{proxy:{$q:D}}=Ke(),h=lt(ut,Ie);if(h===Ie)return console.error("QHeader needs to be child of QLayout"),Ie;const k=se(parseInt(F.heightHint,10)),R=se(!0),w=j(()=>F.reveal===!0||h.view.value.indexOf("H")>-1||D.platform.is.ios&&h.isContainer.value===!0),_=j(()=>{if(F.modelValue!==!0)return 0;if(w.value===!0)return R.value===!0?k.value:0;const t=k.value-h.scroll.value.position;return t>0?t:0}),l=j(()=>F.modelValue!==!0||w.value===!0&&R.value!==!0),E=j(()=>F.modelValue===!0&&l.value===!0&&F.reveal===!0),f=j(()=>"q-header q-layout__section--marginal "+(w.value===!0?"fixed":"absolute")+"-top"+(F.bordered===!0?" q-header--bordered":"")+(l.value===!0?" q-header--hidden":"")+(F.modelValue!==!0?" q-layout--prevent-focus":"")),g=j(()=>{const t=h.rows.value.top,s={};return t[0]==="l"&&h.left.space===!0&&(s[D.lang.rtl===!0?"right":"left"]=`${h.left.size}px`),t[2]==="r"&&h.right.space===!0&&(s[D.lang.rtl===!0?"left":"right"]=`${h.right.size}px`),s});function b(t,s){h.update("header",t,s)}function T(t,s){t.value!==s&&(t.value=s)}function u({height:t}){T(k,t),b("size",t)}function e(t){E.value===!0&&T(R,!0),v("focusin",t)}pe(()=>F.modelValue,t=>{b("space",t),T(R,!0),h.animate()}),pe(_,t=>{b("offset",t)}),pe(()=>F.reveal,t=>{t===!1&&T(R,F.modelValue)}),pe(R,t=>{h.animate(),v("reveal",t)}),pe(h.scroll,t=>{F.reveal===!0&&T(R,t.direction==="up"||t.position<=F.revealOffset||t.position-t.inflectionPoint<100)});const n={};return h.instances.header=n,F.modelValue===!0&&b("size",k.value),b("space",F.modelValue),b("offset",_.value),_t(()=>{h.instances.header===n&&(h.instances.header=void 0,b("size",0),b("offset",0),b("space",!1))}),()=>{const t=fr(I.default,[]);return F.elevated===!0&&t.push(ne("div",{class:"q-layout__shadow absolute-full overflow-hidden no-pointer-events"})),t.push(ne(bt,{debounce:0,onResize:u})),ne("header",{class:f.value,style:g.value,onFocusin:e},t)}}}),Ht=Ne({name:"QItemLabel",props:{overline:Boolean,caption:Boolean,header:Boolean,lines:[Number,String]},setup(F,{slots:I}){const v=j(()=>parseInt(F.lines,10)),D=j(()=>"q-item__label"+(F.overline===!0?" q-item__label--overline text-overline":"")+(F.caption===!0?" q-item__label--caption text-caption":"")+(F.header===!0?" q-item__label--header":"")+(v.value===1?" ellipsis":"")),h=j(()=>F.lines!==void 0&&v.value>1?{overflow:"hidden",display:"-webkit-box","-webkit-box-orient":"vertical","-webkit-line-clamp":v.value}:null);return()=>ne("div",{style:h.value,class:D.value},$e(I.default))}}),qt=Ne({name:"QList",props:{...gt,bordered:Boolean,dense:Boolean,separator:Boolean,padding:Boolean,tag:{type:String,default:"div"}},setup(F,{slots:I}){const v=Ke(),D=pt(F,v.proxy.$q),h=j(()=>"q-list"+(F.bordered===!0?" q-list--bordered":"")+(F.dense===!0?" q-list--dense":"")+(F.separator===!0?" q-list--separator":"")+(D.value===!0?" q-list--dark":"")+(F.padding===!0?" q-list--padding":""));return()=>ne(F.tag,{class:h.value},$e(I.default))}});const Wt=150;var Yr=Ne({name:"QDrawer",inheritAttrs:!1,props:{...hr,...gt,side:{type:String,default:"left",validator:F=>["left","right"].includes(F)},width:{type:Number,default:300},mini:Boolean,miniToOverlay:Boolean,miniWidth:{type:Number,default:57},noMiniAnimation:Boolean,breakpoint:{type:Number,default:1023},showIfAbove:Boolean,behavior:{type:String,validator:F=>["default","desktop","mobile"].includes(F),default:"default"},bordered:Boolean,elevated:Boolean,overlay:Boolean,persistent:Boolean,noSwipeOpen:Boolean,noSwipeClose:Boolean,noSwipeBackdrop:Boolean},emits:[...vr,"onLayout","miniState"],setup(F,{slots:I,emit:v,attrs:D}){const h=Ke(),{proxy:{$q:k}}=h,R=pt(F,k),{preventBodyScroll:w}=yr(),{registerTimeout:_,removeTimeout:l}=gr(),E=lt(ut,Ie);if(E===Ie)return console.error("QDrawer needs to be child of QLayout"),Ie;let f,g=null,b;const T=se(F.behavior==="mobile"||F.behavior!=="desktop"&&E.totalWidth.value<=F.breakpoint),u=j(()=>F.mini===!0&&T.value!==!0),e=j(()=>u.value===!0?F.miniWidth:F.width),n=se(F.showIfAbove===!0&&T.value===!1?!0:F.modelValue===!0),t=j(()=>F.persistent!==!0&&(T.value===!0||M.value===!0));function s(H,ee){if(m(),H!==!1&&E.animate(),te(0),T.value===!0){const Ee=E.instances[x.value];Ee!==void 0&&Ee.belowBreakpoint===!0&&Ee.hide(!1),fe(1),E.isContainer.value!==!0&&w(!0)}else fe(0),H!==!1&&ae(!1);_(()=>{H!==!1&&ae(!0),ee!==!0&&v("show",H)},Wt)}function o(H,ee){p(),H!==!1&&E.animate(),fe(0),te(a.value*e.value),Se(),ee!==!0?_(()=>{v("hide",H)},Wt):l()}const{show:i,hide:d}=pr({showing:n,hideOnRouteChange:t,handleShow:s,handleHide:o}),{addToHistory:m,removeFromHistory:p}=mr(n,d,t),y={belowBreakpoint:T,hide:d},r=j(()=>F.side==="right"),a=j(()=>(k.lang.rtl===!0?-1:1)*(r.value===!0?1:-1)),c=se(0),L=se(!1),S=se(!1),A=se(e.value*a.value),x=j(()=>r.value===!0?"left":"right"),C=j(()=>n.value===!0&&T.value===!1&&F.overlay===!1?F.miniToOverlay===!0?F.miniWidth:e.value:0),O=j(()=>F.overlay===!0||F.miniToOverlay===!0||E.view.value.indexOf(r.value?"R":"L")>-1||k.platform.is.ios===!0&&E.isContainer.value===!0),P=j(()=>F.overlay===!1&&n.value===!0&&T.value===!1),M=j(()=>F.overlay===!0&&n.value===!0&&T.value===!1),N=j(()=>"fullscreen q-drawer__backdrop"+(n.value===!1&&L.value===!1?" hidden":"")),B=j(()=>({backgroundColor:`rgba(0,0,0,${c.value*.4})`})),U=j(()=>r.value===!0?E.rows.value.top[2]==="r":E.rows.value.top[0]==="l"),G=j(()=>r.value===!0?E.rows.value.bottom[2]==="r":E.rows.value.bottom[0]==="l"),z=j(()=>{const H={};return E.header.space===!0&&U.value===!1&&(O.value===!0?H.top=`${E.header.offset}px`:E.header.space===!0&&(H.top=`${E.header.size}px`)),E.footer.space===!0&&G.value===!1&&(O.value===!0?H.bottom=`${E.footer.offset}px`:E.footer.space===!0&&(H.bottom=`${E.footer.size}px`)),H}),Y=j(()=>{const H={width:`${e.value}px`,transform:`translateX(${A.value}px)`};return T.value===!0?H:Object.assign(H,z.value)}),X=j(()=>"q-drawer__content fit "+(E.isContainer.value!==!0?"scroll":"overflow-auto")),$=j(()=>`q-drawer q-drawer--${F.side}`+(S.value===!0?" q-drawer--mini-animate":"")+(F.bordered===!0?" q-drawer--bordered":"")+(R.value===!0?" q-drawer--dark q-dark":"")+(L.value===!0?" no-transition":n.value===!0?"":" q-layout--prevent-focus")+(T.value===!0?" fixed q-drawer--on-top q-drawer--mobile q-drawer--top-padding":` q-drawer--${u.value===!0?"mini":"standard"}`+(O.value===!0||P.value!==!0?" fixed":"")+(F.overlay===!0||F.miniToOverlay===!0?" q-drawer--on-top":"")+(U.value===!0?" q-drawer--top-padding":""))),Z=j(()=>{const H=k.lang.rtl===!0?F.side:x.value;return[[ft,me,void 0,{[H]:!0,mouse:!0}]]}),ue=j(()=>{const H=k.lang.rtl===!0?x.value:F.side;return[[ft,ge,void 0,{[H]:!0,mouse:!0}]]}),de=j(()=>{const H=k.lang.rtl===!0?x.value:F.side;return[[ft,ge,void 0,{[H]:!0,mouse:!0,mouseAllDir:!0}]]});function ve(){_e(T,F.behavior==="mobile"||F.behavior!=="desktop"&&E.totalWidth.value<=F.breakpoint)}pe(T,H=>{H===!0?(f=n.value,n.value===!0&&d(!1)):F.overlay===!1&&F.behavior!=="mobile"&&f!==!1&&(n.value===!0?(te(0),fe(0),Se()):i(!1))}),pe(()=>F.side,(H,ee)=>{E.instances[ee]===y&&(E.instances[ee]=void 0,E[ee].space=!1,E[ee].offset=0),E.instances[H]=y,E[H].size=e.value,E[H].space=P.value,E[H].offset=C.value}),pe(E.totalWidth,()=>{(E.isContainer.value===!0||document.qScrollPrevented!==!0)&&ve()}),pe(()=>F.behavior+F.breakpoint,ve),pe(E.isContainer,H=>{n.value===!0&&w(H!==!0),H===!0&&ve()}),pe(E.scrollbarWidth,()=>{te(n.value===!0?0:void 0)}),pe(C,H=>{Te("offset",H)}),pe(P,H=>{v("onLayout",H),Te("space",H)}),pe(r,()=>{te()}),pe(e,H=>{te(),Re(F.miniToOverlay,H)}),pe(()=>F.miniToOverlay,H=>{Re(H,e.value)}),pe(()=>k.lang.rtl,()=>{te()}),pe(()=>F.mini,()=>{F.noMiniAnimation||F.modelValue===!0&&(oe(),E.animate())}),pe(u,H=>{v("miniState",H)});function te(H){H===void 0?vt(()=>{H=n.value===!0?0:e.value,te(a.value*H)}):(E.isContainer.value===!0&&r.value===!0&&(T.value===!0||Math.abs(H)===e.value)&&(H+=a.value*E.scrollbarWidth.value),A.value=H)}function fe(H){c.value=H}function ae(H){const ee=H===!0?"remove":E.isContainer.value!==!0?"add":"";ee!==""&&document.body.classList[ee]("q-body--drawer-toggle")}function oe(){g!==null&&clearTimeout(g),h.proxy&&h.proxy.$el&&h.proxy.$el.classList.add("q-drawer--mini-animate"),S.value=!0,g=setTimeout(()=>{g=null,S.value=!1,h&&h.proxy&&h.proxy.$el&&h.proxy.$el.classList.remove("q-drawer--mini-animate")},150)}function me(H){if(n.value!==!1)return;const ee=e.value,Ee=Ve(H.distance.x,0,ee);if(H.isFinal===!0){Ee>=Math.min(75,ee)===!0?i():(E.animate(),fe(0),te(a.value*ee)),L.value=!1;return}te((k.lang.rtl===!0?r.value!==!0:r.value)?Math.max(ee-Ee,0):Math.min(0,Ee-ee)),fe(Ve(Ee/ee,0,1)),H.isFirst===!0&&(L.value=!0)}function ge(H){if(n.value!==!0)return;const ee=e.value,Ee=H.direction===F.side,ke=(k.lang.rtl===!0?Ee!==!0:Ee)?Ve(H.distance.x,0,ee):0;if(H.isFinal===!0){Math.abs(ke)<Math.min(75,ee)===!0?(E.animate(),fe(1),te(0)):d(),L.value=!1;return}te(a.value*ke),fe(Ve(1-ke/ee,0,1)),H.isFirst===!0&&(L.value=!0)}function Se(){w(!1),ae(!0)}function Te(H,ee){E.update(F.side,H,ee)}function _e(H,ee){H.value!==ee&&(H.value=ee)}function Re(H,ee){Te("size",H===!0?F.miniWidth:ee)}return E.instances[F.side]=y,Re(F.miniToOverlay,e.value),Te("space",P.value),Te("offset",C.value),F.showIfAbove===!0&&F.modelValue!==!0&&n.value===!0&&F["onUpdate:modelValue"]!==void 0&&v("update:modelValue",!0),Rt(()=>{v("onLayout",P.value),v("miniState",u.value),f=F.showIfAbove===!0;const H=()=>{(n.value===!0?s:o)(!1,!0)};if(E.totalWidth.value!==0){vt(H);return}b=pe(E.totalWidth,()=>{b(),b=void 0,n.value===!1&&F.showIfAbove===!0&&T.value===!1?i(!1):H()})}),_t(()=>{b!==void 0&&b(),g!==null&&(clearTimeout(g),g=null),n.value===!0&&Se(),E.instances[F.side]===y&&(E.instances[F.side]=void 0,Te("size",0),Te("offset",0),Te("space",!1))}),()=>{const H=[];T.value===!0&&(F.noSwipeOpen===!1&&H.push(Le(ne("div",{key:"open",class:`q-drawer__opener fixed-${F.side}`,"aria-hidden":"true"}),Z.value)),H.push(St("div",{ref:"backdrop",class:N.value,style:B.value,"aria-hidden":"true",onClick:d},void 0,"backdrop",F.noSwipeBackdrop!==!0&&n.value===!0,()=>de.value)));const ee=u.value===!0&&I.mini!==void 0,Ee=[ne("div",{...D,key:""+ee,class:[X.value,D.class]},ee===!0?I.mini():$e(I.default))];return F.elevated===!0&&n.value===!0&&Ee.push(ne("div",{class:"q-layout__shadow absolute-full overflow-hidden no-pointer-events"})),H.push(St("aside",{ref:"content",class:$.value,style:Y.value},Ee,"contentclose",F.noSwipeClose!==!0&&T.value===!0,()=>ue.value)),ne("div",{class:"q-drawer-container"},H)}}}),zt=Ne({name:"QPageContainer",setup(F,{slots:I}){const{proxy:{$q:v}}=Ke(),D=lt(ut,Ie);if(D===Ie)return console.error("QPageContainer needs to be child of QLayout"),Ie;ir(nr,!0);const h=j(()=>{const k={};return D.header.space===!0&&(k.paddingTop=`${D.header.size}px`),D.right.space===!0&&(k[`padding${v.lang.rtl===!0?"Left":"Right"}`]=`${D.right.size}px`),D.footer.space===!0&&(k.paddingBottom=`${D.footer.size}px`),D.left.space===!0&&(k[`padding${v.lang.rtl===!0?"Right":"Left"}`]=`${D.left.size}px`),k});return()=>ne("div",{class:"q-page-container",style:h.value},$e(I.default))}}),Yt=Ne({name:"QLayout",props:{container:Boolean,view:{type:String,default:"hhh lpr fff",validator:F=>/^(h|l)h(h|r) lpr (f|l)f(f|r)$/.test(F.toLowerCase())},onScroll:Function,onScrollHeight:Function,onResize:Function},setup(F,{slots:I,emit:v}){const{proxy:{$q:D}}=Ke(),h=se(null),k=se(D.screen.height),R=se(F.container===!0?0:D.screen.width),w=se({position:0,direction:"down",inflectionPoint:0}),_=se(0),l=se(Tr.value===!0?0:mt()),E=j(()=>"q-layout q-layout--"+(F.container===!0?"containerized":"standard")),f=j(()=>F.container===!1?{minHeight:D.screen.height+"px"}:null),g=j(()=>l.value!==0?{[D.lang.rtl===!0?"left":"right"]:`${l.value}px`}:null),b=j(()=>l.value!==0?{[D.lang.rtl===!0?"right":"left"]:0,[D.lang.rtl===!0?"left":"right"]:`-${l.value}px`,width:`calc(100% + ${l.value}px)`}:null);function T(o){if(F.container===!0||document.qScrollPrevented!==!0){const i={position:o.position.top,direction:o.direction,directionChanged:o.directionChanged,inflectionPoint:o.inflectionPoint.top,delta:o.delta.top};w.value=i,F.onScroll!==void 0&&v("scroll",i)}}function u(o){const{height:i,width:d}=o;let m=!1;k.value!==i&&(m=!0,k.value=i,F.onScrollHeight!==void 0&&v("scrollHeight",i),n()),R.value!==d&&(m=!0,R.value=d),m===!0&&F.onResize!==void 0&&v("resize",o)}function e({height:o}){_.value!==o&&(_.value=o,n())}function n(){if(F.container===!0){const o=k.value>_.value?mt():0;l.value!==o&&(l.value=o)}}let t=null;const s={instances:{},view:j(()=>F.view),isContainer:j(()=>F.container),rootRef:h,height:k,containerHeight:_,scrollbarWidth:l,totalWidth:j(()=>R.value+l.value),rows:j(()=>{const o=F.view.toLowerCase().split(" ");return{top:o[0].split(""),middle:o[1].split(""),bottom:o[2].split("")}}),header:He({size:0,offset:0,space:!1}),right:He({size:300,offset:0,space:!1}),footer:He({size:0,offset:0,space:!1}),left:He({size:300,offset:0,space:!1}),scroll:w,animate(){t!==null?clearTimeout(t):document.body.classList.add("q-body--layout-animate"),t=setTimeout(()=>{t=null,document.body.classList.remove("q-body--layout-animate")},155)},update(o,i,d){s[o][i]=d}};if(ir(ut,s),mt()>0){let d=function(){o=null,i.classList.remove("hide-scrollbar")},m=function(){if(o===null){if(i.scrollHeight>D.screen.height)return;i.classList.add("hide-scrollbar")}else clearTimeout(o);o=setTimeout(d,300)},p=function(y){o!==null&&y==="remove"&&(clearTimeout(o),d()),window[`${y}EventListener`]("resize",m)},o=null;const i=document.body;pe(()=>F.container!==!0?"add":"remove",p),F.container!==!0&&p("add"),wt(()=>{p("remove")})}return()=>{const o=Er(I.default,[ne(br,{onScroll:T}),ne(bt,{onResize:u})]),i=ne("div",{class:E.value,style:f.value,ref:F.container===!0?void 0:h,tabindex:-1},o);return F.container===!0?ne("div",{class:"q-layout-container overflow-hidden",ref:h},[ne(bt,{onResize:e}),ne("div",{class:"absolute-full",style:g.value},[ne("div",{class:"scroll",style:b.value},[i])])]):i}}}),$r=Ne({name:"QBar",props:{...gt,dense:Boolean},setup(F,{slots:I}){const{proxy:{$q:v}}=Ke(),D=pt(F,v),h=j(()=>`q-bar row no-wrap items-center q-bar--${F.dense===!0?"dense":"standard"}  q-bar--${D.value===!0?"dark":"light"}`);return()=>ne("div",{class:h.value,role:"toolbar"},$e(I.default))}}),$t=Ne({name:"QPopupProxy",props:{...Fr,breakpoint:{type:[String,Number],default:450}},emits:["show","hide"],setup(F,{slots:I,emit:v,attrs:D}){const{proxy:h}=Ke(),{$q:k}=h,R=se(!1),w=se(null),_=j(()=>parseInt(F.breakpoint,10)),{canShow:l}=Mr({showing:R});function E(){return k.screen.width<_.value||k.screen.height<_.value?"dialog":"menu"}const f=se(E()),g=j(()=>f.value==="menu"?{maxHeight:"99vh"}:{});pe(()=>E(),u=>{R.value!==!0&&(f.value=u)});function b(u){R.value=!0,v("show",u)}function T(u){R.value=!1,f.value=E(),v("hide",u)}return Object.assign(h,{show(u){l(u)===!0&&w.value.show(u)},hide(u){w.value.hide(u)},toggle(u){w.value.toggle(u)}}),Sr(h,"currentComponent",()=>({type:f.value,ref:w.value})),()=>{const u={ref:w,...g.value,...D,onShow:b,onHide:T};let e;return f.value==="dialog"?e=Lr:(e=Nr,Object.assign(u,{target:F.target,contextMenu:F.contextMenu,noParentEvent:!0,separateClosePopup:!0})),ne(e,u,I.default)}}}),Xt=Ne({name:"QPage",props:{padding:Boolean,styleFn:Function},setup(F,{slots:I}){const{proxy:{$q:v}}=Ke(),D=lt(ut,Ie);if(D===Ie)return console.error("QPage needs to be a deep child of QLayout"),Ie;if(lt(nr,Ie)===Ie)return console.error("QPage needs to be child of QPageContainer"),Ie;const k=j(()=>{const w=(D.header.space===!0?D.header.size:0)+(D.footer.space===!0?D.footer.size:0);if(typeof F.styleFn=="function"){const _=D.isContainer.value===!0?D.containerHeight.value:v.screen.height;return F.styleFn(w,_)}return{minHeight:D.isContainer.value===!0?D.containerHeight.value-w+"px":v.screen.height===0?w!==0?`calc(100vh - ${w}px)`:"100vh":v.screen.height-w+"px"}}),R=j(()=>`q-page${F.padding===!0?" q-layout-padding":""}`);return()=>ne("main",{class:R.value,style:k.value},$e(I.default))}});const Qt="q-slider__marker-labels",Xr=F=>({value:F}),Qr=({marker:F})=>ne("div",{key:F.value,style:F.style,class:F.classes},F.label),ar=[34,37,40,33,39,38],Zr={...gt,...Ar,min:{type:Number,default:0},max:{type:Number,default:100},innerMin:Number,innerMax:Number,step:{type:Number,default:1,validator:F=>F>=0},snap:Boolean,vertical:Boolean,reverse:Boolean,hideSelection:Boolean,color:String,markerLabelsClass:String,label:Boolean,labelColor:String,labelTextColor:String,labelAlways:Boolean,switchLabelSide:Boolean,markers:[Boolean,Number],markerLabels:[Boolean,Array,Object,Function],switchMarkerLabelsSide:Boolean,trackImg:String,trackColor:String,innerTrackImg:String,innerTrackColor:String,selectionColor:String,selectionImg:String,thumbSize:{type:String,default:"20px"},trackSize:{type:String,default:"4px"},disable:Boolean,readonly:Boolean,dense:Boolean,tabindex:[String,Number],thumbColor:String,thumbPath:{type:String,default:"M 4, 10 a 6,6 0 1,0 12,0 a 6,6 0 1,0 -12,0"}},Jr=["pan","update:modelValue","change"];function ei({updateValue:F,updatePosition:I,getDragging:v,formAttrs:D}){const{props:h,emit:k,slots:R,proxy:{$q:w}}=Ke(),_=pt(h,w),l=_r(D),E=se(!1),f=se(!1),g=se(!1),b=se(!1),T=j(()=>h.vertical===!0?"--v":"--h"),u=j(()=>"-"+(h.switchLabelSide===!0?"switched":"standard")),e=j(()=>h.vertical===!0?h.reverse===!0:h.reverse!==(w.lang.rtl===!0)),n=j(()=>isNaN(h.innerMin)===!0||h.innerMin<h.min?h.min:h.innerMin),t=j(()=>isNaN(h.innerMax)===!0||h.innerMax>h.max?h.max:h.innerMax),s=j(()=>h.disable!==!0&&h.readonly!==!0&&n.value<t.value),o=j(()=>(String(h.step).trim().split(".")[1]||"").length),i=j(()=>h.step===0?1:h.step),d=j(()=>s.value===!0?h.tabindex||0:-1),m=j(()=>h.max-h.min),p=j(()=>t.value-n.value),y=j(()=>de(n.value)),r=j(()=>de(t.value)),a=j(()=>h.vertical===!0?e.value===!0?"bottom":"top":e.value===!0?"right":"left"),c=j(()=>h.vertical===!0?"height":"width"),L=j(()=>h.vertical===!0?"width":"height"),S=j(()=>h.vertical===!0?"vertical":"horizontal"),A=j(()=>{const K={role:"slider","aria-valuemin":n.value,"aria-valuemax":t.value,"aria-orientation":S.value,"data-step":h.step};return h.disable===!0?K["aria-disabled"]="true":h.readonly===!0&&(K["aria-readonly"]="true"),K}),x=j(()=>`q-slider q-slider${T.value} q-slider--${E.value===!0?"":"in"}active inline no-wrap `+(h.vertical===!0?"row":"column")+(h.disable===!0?" disabled":" q-slider--enabled"+(s.value===!0?" q-slider--editable":""))+(g.value==="both"?" q-slider--focus":"")+(h.label||h.labelAlways===!0?" q-slider--label":"")+(h.labelAlways===!0?" q-slider--label-always":"")+(_.value===!0?" q-slider--dark":"")+(h.dense===!0?" q-slider--dense q-slider--dense"+T.value:""));function C(K){const re="q-slider__"+K;return`${re} ${re}${T.value} ${re}${T.value}${u.value}`}function O(K){const re="q-slider__"+K;return`${re} ${re}${T.value}`}const P=j(()=>{const K=h.selectionColor||h.color;return"q-slider__selection absolute"+(K!==void 0?` text-${K}`:"")}),M=j(()=>O("markers")+" absolute overflow-hidden"),N=j(()=>O("track-container")),B=j(()=>C("pin")),U=j(()=>C("label")),G=j(()=>C("text-container")),z=j(()=>C("marker-labels-container")+(h.markerLabelsClass!==void 0?` ${h.markerLabelsClass}`:"")),Y=j(()=>"q-slider__track relative-position no-outline"+(h.trackColor!==void 0?` bg-${h.trackColor}`:"")),X=j(()=>{const K={[L.value]:h.trackSize};return h.trackImg!==void 0&&(K.backgroundImage=`url(${h.trackImg}) !important`),K}),$=j(()=>"q-slider__inner absolute"+(h.innerTrackColor!==void 0?` bg-${h.innerTrackColor}`:"")),Z=j(()=>{const K=r.value-y.value,re={[a.value]:`${100*y.value}%`,[c.value]:K===0?"2px":`${100*K}%`};return h.innerTrackImg!==void 0&&(re.backgroundImage=`url(${h.innerTrackImg}) !important`),re});function ue(K){const{min:re,max:ce,step:he}=h;let ye=re+K*(ce-re);if(he>0){const we=(ye-re)%he;ye+=(Math.abs(we)>=he/2?(we<0?-1:1)*he:0)-we}return o.value>0&&(ye=parseFloat(ye.toFixed(o.value))),Ve(ye,n.value,t.value)}function de(K){return m.value===0?0:(K-h.min)/m.value}function ve(K,re){const ce=Dr(K),he=h.vertical===!0?Ve((ce.top-re.top)/re.height,0,1):Ve((ce.left-re.left)/re.width,0,1);return Ve(e.value===!0?1-he:he,y.value,r.value)}const te=j(()=>kr(h.markers)===!0?h.markers:i.value),fe=j(()=>{const K=[],re=te.value,ce=h.max;let he=h.min;do K.push(he),he+=re;while(he<ce);return K.push(ce),K}),ae=j(()=>{const K=` ${Qt}${T.value}-`;return Qt+`${K}${h.switchMarkerLabelsSide===!0?"switched":"standard"}${K}${e.value===!0?"rtl":"ltr"}`}),oe=j(()=>h.markerLabels===!1?null:Se(h.markerLabels).map((K,re)=>({index:re,value:K.value,label:K.label||K.value,classes:ae.value+(K.classes!==void 0?" "+K.classes:""),style:{...Te(K.value),...K.style||{}}}))),me=j(()=>({markerList:oe.value,markerMap:_e.value,classes:ae.value,getStyle:Te})),ge=j(()=>{const K=p.value===0?"2px":100*te.value/p.value;return{...Z.value,backgroundSize:h.vertical===!0?`2px ${K}%`:`${K}% 2px`}});function Se(K){if(K===!1)return null;if(K===!0)return fe.value.map(Xr);if(typeof K=="function")return fe.value.map(ce=>{const he=K(ce);return yt(he)===!0?{...he,value:ce}:{value:ce,label:he}});const re=({value:ce})=>ce>=h.min&&ce<=h.max;return Array.isArray(K)===!0?K.map(ce=>yt(ce)===!0?ce:{value:ce}).filter(re):Object.keys(K).map(ce=>{const he=K[ce],ye=Number(ce);return yt(he)===!0?{...he,value:ye}:{value:ye,label:he}}).filter(re)}function Te(K){return{[a.value]:`${100*(K-h.min)/m.value}%`}}const _e=j(()=>{if(h.markerLabels===!1)return null;const K={};return oe.value.forEach(re=>{K[re.value]=re}),K});function Re(){if(R["marker-label-group"]!==void 0)return R["marker-label-group"](me.value);const K=R["marker-label"]||Qr;return oe.value.map(re=>K({marker:re,...me.value}))}const H=j(()=>[[ft,ee,void 0,{[S.value]:!0,prevent:!0,stop:!0,mouse:!0,mouseAllDir:!0}]]);function ee(K){K.isFinal===!0?(b.value!==void 0&&(I(K.evt),K.touch===!0&&F(!0),b.value=void 0,k("pan","end")),E.value=!1,g.value=!1):K.isFirst===!0?(b.value=v(K.evt),I(K.evt),F(),E.value=!0,k("pan","start")):(I(K.evt),F())}function Ee(){g.value=!1}function ke(K){I(K,v(K)),F(),f.value=!0,E.value=!0,document.addEventListener("mouseup",Pe,!0)}function Pe(){f.value=!1,E.value=!1,F(!0),Ee(),document.removeEventListener("mouseup",Pe,!0)}function We(K){I(K,v(K)),F(!0)}function qe(K){ar.includes(K.keyCode)&&F(!0)}function Ue(K){if(h.vertical===!0)return null;const re=w.lang.rtl!==h.reverse?1-K:K;return{transform:`translateX(calc(${2*re-1} * ${h.thumbSize} / 2 + ${50-100*re}%))`}}function Xe(K){const re=j(()=>f.value===!1&&(g.value===K.focusValue||g.value==="both")?" q-slider--focus":""),ce=j(()=>`q-slider__thumb q-slider__thumb${T.value} q-slider__thumb${T.value}-${e.value===!0?"rtl":"ltr"} absolute non-selectable`+re.value+(K.thumbColor.value!==void 0?` text-${K.thumbColor.value}`:"")),he=j(()=>({width:h.thumbSize,height:h.thumbSize,[a.value]:`${100*K.ratio.value}%`,zIndex:g.value===K.focusValue?2:void 0})),ye=j(()=>K.labelColor.value!==void 0?` text-${K.labelColor.value}`:""),we=j(()=>Ue(K.ratio.value)),Oe=j(()=>"q-slider__text"+(K.labelTextColor.value!==void 0?` text-${K.labelTextColor.value}`:""));return()=>{const Ge=[ne("svg",{class:"q-slider__thumb-shape absolute-full",viewBox:"0 0 20 20","aria-hidden":"true"},[ne("path",{d:h.thumbPath})]),ne("div",{class:"q-slider__focus-ring fit"})];return(h.label===!0||h.labelAlways===!0)&&(Ge.push(ne("div",{class:B.value+" absolute fit no-pointer-events"+ye.value},[ne("div",{class:U.value,style:{minWidth:h.thumbSize}},[ne("div",{class:G.value,style:we.value},[ne("span",{class:Oe.value},K.label.value)])])])),h.name!==void 0&&h.disable!==!0&&l(Ge,"push")),ne("div",{class:ce.value,style:he.value,...K.getNodeData()},Ge)}}function ze(K,re,ce,he){const ye=[];h.innerTrackColor!=="transparent"&&ye.push(ne("div",{key:"inner",class:$.value,style:Z.value})),h.selectionColor!=="transparent"&&ye.push(ne("div",{key:"selection",class:P.value,style:K.value})),h.markers!==!1&&ye.push(ne("div",{key:"marker",class:M.value,style:ge.value})),he(ye);const we=[St("div",{key:"trackC",class:N.value,tabindex:re.value,...ce.value},[ne("div",{class:Y.value,style:X.value},ye)],"slide",s.value,()=>H.value)];if(h.markerLabels!==!1){const Oe=h.switchMarkerLabelsSide===!0?"unshift":"push";we[Oe](ne("div",{key:"markerL",class:z.value},Re()))}return we}return _t(()=>{document.removeEventListener("mouseup",Pe,!0)}),{state:{active:E,focus:g,preventFocus:f,dragging:b,editable:s,classes:x,tabindex:d,attributes:A,step:i,decimals:o,trackLen:m,innerMin:n,innerMinRatio:y,innerMax:t,innerMaxRatio:r,positionProp:a,sizeProp:c,isReversed:e},methods:{onActivate:ke,onMobileClick:We,onBlur:Ee,onKeyup:qe,getContent:ze,getThumbRenderFn:Xe,convertRatioToModel:ue,convertModelToRatio:de,getDraggingRatio:ve}}}const ti=()=>({});var ri=Ne({name:"QSlider",props:{...Zr,modelValue:{required:!0,default:null,validator:F=>typeof F=="number"||F===null},labelValue:[String,Number]},emits:Jr,setup(F,{emit:I}){const{proxy:{$q:v}}=Ke(),{state:D,methods:h}=ei({updateValue:T,updatePosition:e,getDragging:u,formAttrs:Rr(F)}),k=se(null),R=se(0),w=se(0);function _(){w.value=F.modelValue===null?D.innerMin.value:Ve(F.modelValue,D.innerMin.value,D.innerMax.value)}pe(()=>`${F.modelValue}|${D.innerMin.value}|${D.innerMax.value}`,_),_();const l=j(()=>h.convertModelToRatio(w.value)),E=j(()=>D.active.value===!0?R.value:l.value),f=j(()=>{const s={[D.positionProp.value]:`${100*D.innerMinRatio.value}%`,[D.sizeProp.value]:`${100*(E.value-D.innerMinRatio.value)}%`};return F.selectionImg!==void 0&&(s.backgroundImage=`url(${F.selectionImg}) !important`),s}),g=h.getThumbRenderFn({focusValue:!0,getNodeData:ti,ratio:E,label:j(()=>F.labelValue!==void 0?F.labelValue:w.value),thumbColor:j(()=>F.thumbColor||F.color),labelColor:j(()=>F.labelColor),labelTextColor:j(()=>F.labelTextColor)}),b=j(()=>D.editable.value!==!0?{}:v.platform.is.mobile===!0?{onClick:h.onMobileClick}:{onMousedown:h.onActivate,onFocus:n,onBlur:h.onBlur,onKeydown:t,onKeyup:h.onKeyup});function T(s){w.value!==F.modelValue&&I("update:modelValue",w.value),s===!0&&I("change",w.value)}function u(){return k.value.getBoundingClientRect()}function e(s,o=D.dragging.value){const i=h.getDraggingRatio(s,o);w.value=h.convertRatioToModel(i),R.value=F.snap!==!0||F.step===0?i:h.convertModelToRatio(w.value)}function n(){D.focus.value=!0}function t(s){if(!ar.includes(s.keyCode))return;wr(s);const o=([34,33].includes(s.keyCode)?10:1)*D.step.value,i=([34,37,40].includes(s.keyCode)?-1:1)*(D.isReversed.value===!0?-1:1)*(F.vertical===!0?-1:1)*o;w.value=Ve(parseFloat((w.value+i).toFixed(D.decimals.value)),D.innerMin.value,D.innerMax.value),T()}return()=>{const s=h.getContent(f,D.tabindex,b,o=>{o.push(g())});return ne("div",{ref:k,class:D.classes.value+(F.modelValue===null?" q-slider--no-value":""),...D.attributes.value,"aria-valuenow":F.modelValue},s)}}}),ii=Object.defineProperty,ni=Object.defineProperties,ai=Object.getOwnPropertyDescriptors,Zt=Object.getOwnPropertySymbols,si=Object.prototype.hasOwnProperty,oi=Object.prototype.propertyIsEnumerable,Jt=(F,I,v)=>I in F?ii(F,I,{enumerable:!0,configurable:!0,writable:!0,value:v}):F[I]=v,At=(F,I)=>{for(var v in I||(I={}))si.call(I,v)&&Jt(F,v,I[v]);if(Zt)for(var v of Zt(I))oi.call(I,v)&&Jt(F,v,I[v]);return F},Dt=(F,I)=>ni(F,ai(I));function er(F,I,v,D){var h,k=!1,R=0;function w(){h&&clearTimeout(h)}function _(){for(var l=arguments.length,E=new Array(l),f=0;f<l;f++)E[f]=arguments[f];var g=this,b=Date.now()-R;function T(){R=Date.now(),v.apply(g,E)}function u(){h=void 0}k||(D&&!h&&T(),w(),D===void 0&&b>F?T():I!==!0&&(h=setTimeout(D?u:T,D===void 0?F-b:F)))}return typeof I!="boolean"&&(D=v,v=I,I=void 0),_.cancel=function(){w(),k=!0},_}function tr(F,I,v){return v===void 0?er(F,I,!1):er(F,v,I!==!1)}function li(F){return F&&F.__esModule&&Object.prototype.hasOwnProperty.call(F,"default")?F.default:F}var sr={exports:{}};typeof window!="undefined"&&(sr.exports=function(F){var I={};function v(D){if(I[D])return I[D].exports;var h=I[D]={i:D,l:!1,exports:{}};return F[D].call(h.exports,h,h.exports,v),h.l=!0,h.exports}return v.m=F,v.c=I,v.d=function(D,h,k){v.o(D,h)||Object.defineProperty(D,h,{enumerable:!0,get:k})},v.r=function(D){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(D,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(D,"__esModule",{value:!0})},v.t=function(D,h){if(1&h&&(D=v(D)),8&h||4&h&&typeof D=="object"&&D&&D.__esModule)return D;var k=Object.create(null);if(v.r(k),Object.defineProperty(k,"default",{enumerable:!0,value:D}),2&h&&typeof D!="string")for(var R in D)v.d(k,R,function(w){return D[w]}.bind(null,R));return k},v.n=function(D){var h=D&&D.__esModule?function(){return D.default}:function(){return D};return v.d(h,"a",h),h},v.o=function(D,h){return Object.prototype.hasOwnProperty.call(D,h)},v.p="/dist/",v(v.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(F,I,v){var D=Object.prototype.hasOwnProperty,h="~";function k(){}function R(E,f,g){this.fn=E,this.context=f,this.once=g||!1}function w(E,f,g,b,T){if(typeof g!="function")throw new TypeError("The listener must be a function");var u=new R(g,b||E,T),e=h?h+f:f;return E._events[e]?E._events[e].fn?E._events[e]=[E._events[e],u]:E._events[e].push(u):(E._events[e]=u,E._eventsCount++),E}function _(E,f){--E._eventsCount==0?E._events=new k:delete E._events[f]}function l(){this._events=new k,this._eventsCount=0}Object.create&&(k.prototype=Object.create(null),new k().__proto__||(h=!1)),l.prototype.eventNames=function(){var E,f,g=[];if(this._eventsCount===0)return g;for(f in E=this._events)D.call(E,f)&&g.push(h?f.slice(1):f);return Object.getOwnPropertySymbols?g.concat(Object.getOwnPropertySymbols(E)):g},l.prototype.listeners=function(E){var f=h?h+E:E,g=this._events[f];if(!g)return[];if(g.fn)return[g.fn];for(var b=0,T=g.length,u=new Array(T);b<T;b++)u[b]=g[b].fn;return u},l.prototype.listenerCount=function(E){var f=h?h+E:E,g=this._events[f];return g?g.fn?1:g.length:0},l.prototype.emit=function(E,f,g,b,T,u){var e=h?h+E:E;if(!this._events[e])return!1;var n,t,s=this._events[e],o=arguments.length;if(s.fn){switch(s.once&&this.removeListener(E,s.fn,void 0,!0),o){case 1:return s.fn.call(s.context),!0;case 2:return s.fn.call(s.context,f),!0;case 3:return s.fn.call(s.context,f,g),!0;case 4:return s.fn.call(s.context,f,g,b),!0;case 5:return s.fn.call(s.context,f,g,b,T),!0;case 6:return s.fn.call(s.context,f,g,b,T,u),!0}for(t=1,n=new Array(o-1);t<o;t++)n[t-1]=arguments[t];s.fn.apply(s.context,n)}else{var i,d=s.length;for(t=0;t<d;t++)switch(s[t].once&&this.removeListener(E,s[t].fn,void 0,!0),o){case 1:s[t].fn.call(s[t].context);break;case 2:s[t].fn.call(s[t].context,f);break;case 3:s[t].fn.call(s[t].context,f,g);break;case 4:s[t].fn.call(s[t].context,f,g,b);break;default:if(!n)for(i=1,n=new Array(o-1);i<o;i++)n[i-1]=arguments[i];s[t].fn.apply(s[t].context,n)}}return!0},l.prototype.on=function(E,f,g){return w(this,E,f,g,!1)},l.prototype.once=function(E,f,g){return w(this,E,f,g,!0)},l.prototype.removeListener=function(E,f,g,b){var T=h?h+E:E;if(!this._events[T])return this;if(!f)return _(this,T),this;var u=this._events[T];if(u.fn)u.fn!==f||b&&!u.once||g&&u.context!==g||_(this,T);else{for(var e=0,n=[],t=u.length;e<t;e++)(u[e].fn!==f||b&&!u[e].once||g&&u[e].context!==g)&&n.push(u[e]);n.length?this._events[T]=n.length===1?n[0]:n:_(this,T)}return this},l.prototype.removeAllListeners=function(E){var f;return E?(f=h?h+E:E,this._events[f]&&_(this,f)):(this._events=new k,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=h,l.EventEmitter=l,F.exports=l},"./node_modules/url-toolkit/src/url-toolkit.js":function(F,I,v){var D,h,k,R,w;D=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#[^]*)?$/,h=/^([^\/?#]*)([^]*)$/,k=/(?:\/|^)\.(?=\/)/g,R=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,w={buildAbsoluteURL:function(_,l,E){if(E=E||{},_=_.trim(),!(l=l.trim())){if(!E.alwaysNormalize)return _;var f=w.parseURL(_);if(!f)throw new Error("Error trying to parse base URL.");return f.path=w.normalizePath(f.path),w.buildURLFromParts(f)}var g=w.parseURL(l);if(!g)throw new Error("Error trying to parse relative URL.");if(g.scheme)return E.alwaysNormalize?(g.path=w.normalizePath(g.path),w.buildURLFromParts(g)):l;var b=w.parseURL(_);if(!b)throw new Error("Error trying to parse base URL.");if(!b.netLoc&&b.path&&b.path[0]!=="/"){var T=h.exec(b.path);b.netLoc=T[1],b.path=T[2]}b.netLoc&&!b.path&&(b.path="/");var u={scheme:b.scheme,netLoc:g.netLoc,path:null,params:g.params,query:g.query,fragment:g.fragment};if(!g.netLoc&&(u.netLoc=b.netLoc,g.path[0]!=="/"))if(g.path){var e=b.path,n=e.substring(0,e.lastIndexOf("/")+1)+g.path;u.path=w.normalizePath(n)}else u.path=b.path,g.params||(u.params=b.params,g.query||(u.query=b.query));return u.path===null&&(u.path=E.alwaysNormalize?w.normalizePath(g.path):g.path),w.buildURLFromParts(u)},parseURL:function(_){var l=D.exec(_);return l?{scheme:l[1]||"",netLoc:l[2]||"",path:l[3]||"",params:l[4]||"",query:l[5]||"",fragment:l[6]||""}:null},normalizePath:function(_){for(_=_.split("").reverse().join("").replace(k,"");_.length!==(_=_.replace(R,"")).length;);return _.split("").reverse().join("")},buildURLFromParts:function(_){return _.scheme+_.netLoc+_.path+_.params+_.query+_.fragment}},F.exports=w},"./node_modules/webworkify-webpack/index.js":function(F,I,v){function D(l){var E={};function f(b){if(E[b])return E[b].exports;var T=E[b]={i:b,l:!1,exports:{}};return l[b].call(T.exports,T,T.exports,f),T.l=!0,T.exports}f.m=l,f.c=E,f.i=function(b){return b},f.d=function(b,T,u){f.o(b,T)||Object.defineProperty(b,T,{configurable:!1,enumerable:!0,get:u})},f.r=function(b){Object.defineProperty(b,"__esModule",{value:!0})},f.n=function(b){var T=b&&b.__esModule?function(){return b.default}:function(){return b};return f.d(T,"a",T),T},f.o=function(b,T){return Object.prototype.hasOwnProperty.call(b,T)},f.p="/",f.oe=function(b){throw console.error(b),b};var g=f(f.s=ENTRY_MODULE);return g.default||g}var h="[\\.|\\-|\\+|\\w|/|@]+",k="\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)";function R(l){return(l+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function w(l,E,f){var g={};g[f]=[];var b=E.toString(),T=b.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!T)return g;for(var u,e=T[1],n=new RegExp("(\\\\n|\\W)"+R(e)+k,"g");u=n.exec(b);)u[3]!=="dll-reference"&&g[f].push(u[3]);for(n=new RegExp("\\("+R(e)+'\\("(dll-reference\\s('+h+'))"\\)\\)'+k,"g");u=n.exec(b);)l[u[2]]||(g[f].push(u[1]),l[u[2]]=v(u[1]).m),g[u[2]]=g[u[2]]||[],g[u[2]].push(u[4]);for(var t,s=Object.keys(g),o=0;o<s.length;o++)for(var i=0;i<g[s[o]].length;i++)t=g[s[o]][i],isNaN(1*t)||(g[s[o]][i]=1*g[s[o]][i]);return g}function _(l){return Object.keys(l).reduce(function(E,f){return E||l[f].length>0},!1)}F.exports=function(l,E){E=E||{};var f={main:v.m},g=E.all?{main:Object.keys(f.main)}:function(n,t){for(var s={main:[t]},o={main:[]},i={main:{}};_(s);)for(var d=Object.keys(s),m=0;m<d.length;m++){var p=d[m],y=s[p].pop();if(i[p]=i[p]||{},!i[p][y]&&n[p][y]){i[p][y]=!0,o[p]=o[p]||[],o[p].push(y);for(var r=w(n,n[p][y],p),a=Object.keys(r),c=0;c<a.length;c++)s[a[c]]=s[a[c]]||[],s[a[c]]=s[a[c]].concat(r[a[c]])}}return o}(f,l),b="";Object.keys(g).filter(function(n){return n!=="main"}).forEach(function(n){for(var t=0;g[n][t];)t++;g[n].push(t),f[n][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",b=b+"var "+n+" = ("+D.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+g[n].map(function(s){return JSON.stringify(s)+": "+f[n][s].toString()}).join(",")+`});
`}),b=b+"new (("+D.toString().replace("ENTRY_MODULE",JSON.stringify(l))+")({"+g.main.map(function(n){return JSON.stringify(n)+": "+f.main[n].toString()}).join(",")+"}))(self);";var T=new window.Blob([b],{type:"text/javascript"});if(E.bare)return T;var u=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(T),e=new window.Worker(u);return e.objectURL=u,e}},"./src/config.ts":function(F,I,v){v.r(I),v.d(I,"hlsDefaultConfig",function(){return d}),v.d(I,"mergeConfig",function(){return m}),v.d(I,"enableStreamingMode",function(){return p});var D=v("./src/controller/abr-controller.ts"),h=v("./src/controller/audio-stream-controller.ts"),k=v("./src/controller/audio-track-controller.ts"),R=v("./src/controller/subtitle-stream-controller.ts"),w=v("./src/controller/subtitle-track-controller.ts"),_=v("./src/controller/buffer-controller.ts"),l=v("./src/controller/timeline-controller.ts"),E=v("./src/controller/cap-level-controller.ts"),f=v("./src/controller/fps-controller.ts"),g=v("./src/controller/eme-controller.ts"),b=v("./src/utils/xhr-loader.ts"),T=v("./src/utils/fetch-loader.ts"),u=v("./src/utils/cues.ts"),e=v("./src/utils/mediakeys-helper.ts"),n=v("./src/utils/logger.ts");function t(){return(t=Object.assign||function(y){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(y[c]=a[c])}return y}).apply(this,arguments)}function s(y,r){var a=Object.keys(y);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(y);r&&(c=c.filter(function(L){return Object.getOwnPropertyDescriptor(y,L).enumerable})),a.push.apply(a,c)}return a}function o(y){for(var r=1;r<arguments.length;r++){var a=arguments[r]!=null?arguments[r]:{};r%2?s(Object(a),!0).forEach(function(c){i(y,c,a[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(y,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach(function(c){Object.defineProperty(y,c,Object.getOwnPropertyDescriptor(a,c))})}return y}function i(y,r,a){return r in y?Object.defineProperty(y,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):y[r]=a,y}var d=o(o({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:b.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:D.default,bufferController:_.default,capLevelController:E.default,fpsController:f.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:e.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0},{cueHandler:u.default,enableCEA708Captions:!0,enableWebVTT:!0,enableIMSC1:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:R.SubtitleStreamController,subtitleTrackController:w.default,timelineController:l.TimelineController,audioStreamController:h.default,audioTrackController:k.default,emeController:g.default});function m(y,r){if((r.liveSyncDurationCount||r.liveMaxLatencyDurationCount)&&(r.liveSyncDuration||r.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(r.liveMaxLatencyDurationCount!==void 0&&(r.liveSyncDurationCount===void 0||r.liveMaxLatencyDurationCount<=r.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(r.liveMaxLatencyDuration!==void 0&&(r.liveSyncDuration===void 0||r.liveMaxLatencyDuration<=r.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return t({},y,r)}function p(y){var r=y.loader;r!==T.default&&r!==b.default?(n.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),y.progressive=!1):Object(T.fetchSupported)()&&(y.loader=T.default,y.progressive=!0,y.enableSoftwareAES=!0,n.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}},"./src/controller/abr-controller.ts":function(F,I,v){v.r(I);var D=v("./src/polyfills/number.ts"),h=v("./src/utils/ewma-bandwidth-estimator.ts"),k=v("./src/events.ts"),R=v("./src/utils/buffer-helper.ts"),w=v("./src/errors.ts"),_=v("./src/types/loader.ts"),l=v("./src/utils/logger.ts");function E(g,b){for(var T=0;T<b.length;T++){var u=b[T];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(g,u.key,u)}}var f=function(){function g(e){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=e;var n=e.config;this.bwEstimator=new h.default(n.abrEwmaSlowVoD,n.abrEwmaFastVoD,n.abrEwmaDefaultEstimate),this.registerListeners()}var b,T,u=g.prototype;return u.registerListeners=function(){var e=this.hls;e.on(k.Events.FRAG_LOADING,this.onFragLoading,this),e.on(k.Events.FRAG_LOADED,this.onFragLoaded,this),e.on(k.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.on(k.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(k.Events.ERROR,this.onError,this)},u.unregisterListeners=function(){var e=this.hls;e.off(k.Events.FRAG_LOADING,this.onFragLoading,this),e.off(k.Events.FRAG_LOADED,this.onFragLoaded,this),e.off(k.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.off(k.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(k.Events.ERROR,this.onError,this)},u.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},u.onFragLoading=function(e,n){var t,s=n.frag;s.type===_.PlaylistLevelType.MAIN&&(this.timer||(this.fragCurrent=s,this.partCurrent=(t=n.part)!=null?t:null,this.timer=self.setInterval(this.onCheck,100)))},u.onLevelLoaded=function(e,n){var t=this.hls.config;n.details.live?this.bwEstimator.update(t.abrEwmaSlowLive,t.abrEwmaFastLive):this.bwEstimator.update(t.abrEwmaSlowVoD,t.abrEwmaFastVoD)},u._abandonRulesCheck=function(){var e=this.fragCurrent,n=this.partCurrent,t=this.hls,s=t.autoLevelEnabled,o=t.config,i=t.media;if(e&&i){var d=n?n.stats:e.stats,m=n?n.duration:e.duration;if(d.aborted)return l.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);if(s&&!i.paused&&i.playbackRate&&i.readyState){var p=performance.now()-d.loading.start,y=Math.abs(i.playbackRate);if(!(p<=500*m/y)){var r=t.levels,a=t.minAutoLevel,c=r[e.level],L=d.total||Math.max(d.loaded,Math.round(m*c.maxBitrate/8)),S=Math.max(1,d.bwEstimate?d.bwEstimate/8:1e3*d.loaded/p),A=(L-d.loaded)/S,x=i.currentTime,C=(R.BufferHelper.bufferInfo(i,x,o.maxBufferHole).end-x)/y;if(!(C>=2*m/y||A<=C)){var O,P=Number.POSITIVE_INFINITY;for(O=e.level-1;O>a&&!((P=m*r[O].maxBitrate/(6.4*S))<C);O--);if(!(P>=A)){var M=this.bwEstimator.getEstimate();l.logger.warn("Fragment "+e.sn+(n?" part "+n.index:"")+" of level "+e.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+O+`
      Current BW estimate: `+(Object(D.isFiniteNumber)(M)?(M/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+A.toFixed(3)+` s
      Estimated load time for the next fragment: `+P.toFixed(3)+` s
      Time to underbuffer: `+C.toFixed(3)+" s"),t.nextLoadLevel=O,this.bwEstimator.sample(p,d.loaded),this.clearTimer(),e.loader&&(this.fragCurrent=this.partCurrent=null,e.loader.abort()),t.trigger(k.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:e,part:n,stats:d})}}}}}},u.onFragLoaded=function(e,n){var t=n.frag,s=n.part;if(t.type===_.PlaylistLevelType.MAIN&&Object(D.isFiniteNumber)(t.sn)){var o=s?s.stats:t.stats,i=s?s.duration:t.duration;if(this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var d=this.hls.levels[t.level],m=(d.loaded?d.loaded.bytes:0)+o.loaded,p=(d.loaded?d.loaded.duration:0)+i;d.loaded={bytes:m,duration:p},d.realBitrate=Math.round(8*m/p)}if(t.bitrateTest){var y={stats:o,frag:t,part:s,id:t.type};this.onFragBuffered(k.Events.FRAG_BUFFERED,y),t.bitrateTest=!1}}},u.onFragBuffered=function(e,n){var t=n.frag,s=n.part,o=s?s.stats:t.stats;if(!o.aborted&&t.type===_.PlaylistLevelType.MAIN&&t.sn!=="initSegment"){var i=o.parsing.end-o.loading.start;this.bwEstimator.sample(i,o.loaded),o.bwEstimate=this.bwEstimator.getEstimate(),t.bitrateTest?this.bitrateTestDelay=i/1e3:this.bitrateTestDelay=0}},u.onError=function(e,n){switch(n.details){case w.ErrorDetails.FRAG_LOAD_ERROR:case w.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},u.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},u.getNextABRAutoLevel=function(){var e=this.fragCurrent,n=this.partCurrent,t=this.hls,s=t.maxAutoLevel,o=t.config,i=t.minAutoLevel,d=t.media,m=n?n.duration:e?e.duration:0,p=d?d.currentTime:0,y=d&&d.playbackRate!==0?Math.abs(d.playbackRate):1,r=this.bwEstimator?this.bwEstimator.getEstimate():o.abrEwmaDefaultEstimate,a=(R.BufferHelper.bufferInfo(d,p,o.maxBufferHole).end-p)/y,c=this.findBestLevel(r,i,s,a,o.abrBandWidthFactor,o.abrBandWidthUpFactor);if(c>=0)return c;l.logger.trace((a?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var L=m?Math.min(m,o.maxStarvationDelay):o.maxStarvationDelay,S=o.abrBandWidthFactor,A=o.abrBandWidthUpFactor;if(!a){var x=this.bitrateTestDelay;x&&(L=(m?Math.min(m,o.maxLoadingDelay):o.maxLoadingDelay)-x,l.logger.trace("bitrate test took "+Math.round(1e3*x)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*L)+" ms"),S=A=1)}return c=this.findBestLevel(r,i,s,a+L,S,A),Math.max(c,0)},u.findBestLevel=function(e,n,t,s,o,i){for(var d,m=this.fragCurrent,p=this.partCurrent,y=this.lastLoadedFragLevel,r=this.hls.levels,a=r[y],c=!(a==null||(d=a.details)===null||d===void 0||!d.live),L=a==null?void 0:a.codecSet,S=p?p.duration:m?m.duration:0,A=t;A>=n;A--){var x=r[A];if(x&&(!L||x.codecSet===L)){var C=x.details,O=(p?C==null?void 0:C.partTarget:C==null?void 0:C.averagetargetduration)||S,P=void 0;P=A<=y?o*e:i*e;var M=r[A].maxBitrate,N=M*O/P;if(l.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+A+"/"+Math.round(P)+"/"+M+"/"+O+"/"+s+"/"+N),P>M&&(!N||c&&!this.bitrateTestDelay||N<s))return A}}return-1},b=g,(T=[{key:"nextAutoLevel",get:function(){var e=this._nextAutoLevel,n=this.bwEstimator;if(!(e===-1||n&&n.canEstimate()))return e;var t=this.getNextABRAutoLevel();return e!==-1&&(t=Math.min(e,t)),t},set:function(e){this._nextAutoLevel=e}}])&&E(b.prototype,T),g}();I.default=f},"./src/controller/audio-stream-controller.ts":function(F,I,v){v.r(I);var D=v("./src/polyfills/number.ts"),h=v("./src/controller/base-stream-controller.ts"),k=v("./src/events.ts"),R=v("./src/utils/buffer-helper.ts"),w=v("./src/controller/fragment-tracker.ts"),_=v("./src/types/level.ts"),l=v("./src/types/loader.ts"),E=v("./src/loader/fragment.ts"),f=v("./src/demux/chunk-cache.ts"),g=v("./src/demux/transmuxer-interface.ts"),b=v("./src/types/transmuxer.ts"),T=v("./src/controller/fragment-finders.ts"),u=v("./src/utils/discontinuities.ts"),e=v("./src/errors.ts"),n=v("./src/utils/logger.ts");function t(){return(t=Object.assign||function(i){for(var d=1;d<arguments.length;d++){var m=arguments[d];for(var p in m)Object.prototype.hasOwnProperty.call(m,p)&&(i[p]=m[p])}return i}).apply(this,arguments)}function s(i,d){return(s=Object.setPrototypeOf||function(m,p){return m.__proto__=p,m})(i,d)}var o=function(i){var d,m;function p(r,a){var c;return(c=i.call(this,r,a,"[audio-stream-controller]")||this).videoBuffer=null,c.videoTrackCC=-1,c.waitingVideoCC=-1,c.audioSwitch=!1,c.trackId=-1,c.waitingData=null,c.mainDetails=null,c.bufferFlushed=!1,c._registerListeners(),c}m=i,(d=p).prototype=Object.create(m.prototype),d.prototype.constructor=d,s(d,m);var y=p.prototype;return y.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},y._registerListeners=function(){var r=this.hls;r.on(k.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(k.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(k.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(k.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.on(k.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),r.on(k.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.on(k.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.on(k.Events.ERROR,this.onError,this),r.on(k.Events.BUFFER_RESET,this.onBufferReset,this),r.on(k.Events.BUFFER_CREATED,this.onBufferCreated,this),r.on(k.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.on(k.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),r.on(k.Events.FRAG_BUFFERED,this.onFragBuffered,this)},y._unregisterListeners=function(){var r=this.hls;r.off(k.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(k.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(k.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(k.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.off(k.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),r.off(k.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.off(k.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.off(k.Events.ERROR,this.onError,this),r.off(k.Events.BUFFER_RESET,this.onBufferReset,this),r.off(k.Events.BUFFER_CREATED,this.onBufferCreated,this),r.off(k.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.off(k.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),r.off(k.Events.FRAG_BUFFERED,this.onFragBuffered,this)},y.onInitPtsFound=function(r,a){var c=a.frag,L=a.id,S=a.initPTS;if(L==="main"){var A=c.cc;this.initPTS[c.cc]=S,this.log("InitPTS for cc: "+A+" found from main: "+S),this.videoTrackCC=A,this.state===h.State.WAITING_INIT_PTS&&this.tick()}},y.startLoad=function(r){if(!this.levels)return this.startPosition=r,void(this.state=h.State.STOPPED);var a=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,a>0&&r===-1?(this.log("Override startPosition with lastCurrentTime @"+a.toFixed(3)),this.state=h.State.IDLE):(this.loadedmetadata=!1,this.state=h.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=r,this.tick()},y.doTick=function(){switch(this.state){case h.State.IDLE:this.doTickIdle();break;case h.State.WAITING_TRACK:var r,a=this.levels,c=this.trackId,L=a==null||(r=a[c])===null||r===void 0?void 0:r.details;if(L){if(this.waitForCdnTuneIn(L))break;this.state=h.State.WAITING_INIT_PTS}break;case h.State.FRAG_LOADING_WAITING_RETRY:var S,A=performance.now(),x=this.retryDate;(!x||A>=x||(S=this.media)!==null&&S!==void 0&&S.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state=h.State.IDLE);break;case h.State.WAITING_INIT_PTS:var C=this.waitingData;if(C){var O=C.frag,P=C.part,M=C.cache,N=C.complete;if(this.initPTS[O.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=h.State.FRAG_LOADING;var B={frag:O,part:P,payload:M.flush(),networkDetails:null};this._handleFragmentLoadProgress(B),N&&i.prototype._handleFragmentLoadComplete.call(this,B)}else if(this.videoTrackCC!==this.waitingVideoCC)n.logger.log("Waiting fragment cc ("+O.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var U=this.getLoadPosition(),G=R.BufferHelper.bufferInfo(this.mediaBuffer,U,this.config.maxBufferHole);Object(T.fragmentWithinToleranceTest)(G.end,this.config.maxFragLookUpTolerance,O)<0&&(n.logger.log("Waiting fragment cc ("+O.cc+") @ "+O.start+" cancelled because another fragment at "+G.end+" is needed"),this.clearWaitingFragment())}}else this.state=h.State.IDLE}this.onTickEnd()},y.clearWaitingFragment=function(){var r=this.waitingData;r&&(this.fragmentTracker.removeFragment(r.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=h.State.IDLE)},y.onTickEnd=function(){var r=this.media;if(r&&r.readyState){var a=(this.mediaBuffer?this.mediaBuffer:r).buffered;!this.loadedmetadata&&a.length&&(this.loadedmetadata=!0),this.lastCurrentTime=r.currentTime}},y.doTickIdle=function(){var r,a,c=this.hls,L=this.levels,S=this.media,A=this.trackId,x=c.config;if(L&&L[A]&&(S||!this.startFragRequested&&x.startFragPrefetch)){var C=L[A].details;if(!C||C.live&&this.levelLastLoaded!==A||this.waitForCdnTuneIn(C))this.state=h.State.WAITING_TRACK;else{this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer?this.mediaBuffer:this.media,E.ElementaryStreamTypes.AUDIO,l.PlaylistLevelType.AUDIO));var O=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,l.PlaylistLevelType.AUDIO);if(O!==null){var P=O.len,M=this.getMaxBufferLength(),N=this.audioSwitch;if(!(P>=M)||N){if(!N&&this._streamEnded(O,C))return c.trigger(k.Events.BUFFER_EOS,{type:"audio"}),void(this.state=h.State.ENDED);var B=C.fragments[0].start,U=O.end;if(N){var G=this.getLoadPosition();U=G,C.PTSKnown&&G<B&&(O.end>B||O.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),S.currentTime=B+.05)}var z=this.getNextFragment(U,C);z?((r=z.decryptdata)===null||r===void 0?void 0:r.keyFormat)!=="identity"||(a=z.decryptdata)!==null&&a!==void 0&&a.key?this.loadFragment(z,C,U):this.loadKey(z,C):this.bufferFlushed=!0}}}}},y.getMaxBufferLength=function(){var r=i.prototype.getMaxBufferLength.call(this),a=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,l.PlaylistLevelType.MAIN);return a===null?r:Math.max(r,a.len)},y.onMediaDetaching=function(){this.videoBuffer=null,i.prototype.onMediaDetaching.call(this)},y.onAudioTracksUpdated=function(r,a){var c=a.audioTracks;this.resetTransmuxer(),this.levels=c.map(function(L){return new _.Level(L)})},y.onAudioTrackSwitching=function(r,a){var c=!!a.url;this.trackId=a.id;var L=this.fragCurrent;L!=null&&L.loader&&L.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),c?this.setInterval(100):this.resetTransmuxer(),c?(this.audioSwitch=!0,this.state=h.State.IDLE):this.state=h.State.STOPPED,this.tick()},y.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},y.onLevelLoaded=function(r,a){this.mainDetails=a.details},y.onAudioTrackLoaded=function(r,a){var c,L=this.levels,S=a.details,A=a.id;if(L){this.log("Track "+A+" loaded ["+S.startSN+","+S.endSN+"],duration:"+S.totalduration);var x=L[A],C=0;if(S.live||(c=x.details)!==null&&c!==void 0&&c.live){var O=this.mainDetails;if(S.fragments[0]||(S.deltaUpdateFailed=!0),S.deltaUpdateFailed||!O)return;!x.details&&S.hasProgramDateTime&&O.hasProgramDateTime?(Object(u.alignPDT)(S,O),C=S.fragments[0].start):C=this.alignPlaylists(S,x.details)}x.details=S,this.levelLastLoaded=A,this.startFragRequested||!this.mainDetails&&S.live||this.setStartPosition(x.details,C),this.state!==h.State.WAITING_TRACK||this.waitForCdnTuneIn(S)||(this.state=h.State.IDLE),this.tick()}else this.warn("Audio tracks were reset while loading level "+A)},y._handleFragmentLoadProgress=function(r){var a,c=r.frag,L=r.part,S=r.payload,A=this.config,x=this.trackId,C=this.levels;if(C){var O=C[x];console.assert(O,"Audio track is defined on fragment load progress");var P=O.details;console.assert(P,"Audio track details are defined on fragment load progress");var M=A.defaultAudioCodec||O.audioCodec||"mp4a.40.2",N=this.transmuxer;N||(N=this.transmuxer=new g.default(this.hls,l.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var B=this.initPTS[c.cc],U=(a=c.initSegment)===null||a===void 0?void 0:a.data;if(B!==void 0){var G=L?L.index:-1,z=G!==-1,Y=new b.ChunkMetadata(c.level,c.sn,c.stats.chunkCount,S.byteLength,G,z);N.push(S,U,M,"",c,L,P.totalduration,!1,Y,B)}else n.logger.log("Unknown video PTS for cc "+c.cc+", waiting for video PTS before demuxing audio frag "+c.sn+" of ["+P.startSN+" ,"+P.endSN+"],track "+x),(this.waitingData=this.waitingData||{frag:c,part:L,cache:new f.default,complete:!1}).cache.push(new Uint8Array(S)),this.waitingVideoCC=this.videoTrackCC,this.state=h.State.WAITING_INIT_PTS}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+c.sn+" of level "+c.level+" will not be buffered")},y._handleFragmentLoadComplete=function(r){this.waitingData?this.waitingData.complete=!0:i.prototype._handleFragmentLoadComplete.call(this,r)},y.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},y.onBufferCreated=function(r,a){var c=a.tracks.audio;c&&(this.mediaBuffer=c.buffer),a.tracks.video&&(this.videoBuffer=a.tracks.video.buffer)},y.onFragBuffered=function(r,a){var c=a.frag,L=a.part;c.type===l.PlaylistLevelType.AUDIO&&(this.fragContextChanged(c)?this.warn("Fragment "+c.sn+(L?" p: "+L.index:"")+" of level "+c.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch):(c.sn!=="initSegment"&&(this.fragPrevious=c,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(k.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(c,L)))},y.onError=function(r,a){switch(a.details){case e.ErrorDetails.FRAG_LOAD_ERROR:case e.ErrorDetails.FRAG_LOAD_TIMEOUT:case e.ErrorDetails.KEY_LOAD_ERROR:case e.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(l.PlaylistLevelType.AUDIO,a);break;case e.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case e.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==h.State.ERROR&&this.state!==h.State.STOPPED&&(this.state=a.fatal?h.State.ERROR:h.State.IDLE,this.warn(a.details+" while loading frag, switching to "+this.state+" state"));break;case e.ErrorDetails.BUFFER_FULL_ERROR:if(a.parent==="audio"&&(this.state===h.State.PARSING||this.state===h.State.PARSED)){var c=!0,L=this.getFwdBufferInfo(this.mediaBuffer,l.PlaylistLevelType.AUDIO);L&&L.len>.5&&(c=!this.reduceMaxBufferLength(L.len)),c&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,i.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}}},y.onBufferFlushed=function(r,a){a.type===E.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},y._handleTransmuxComplete=function(r){var a,c="audio",L=this.hls,S=r.remuxResult,A=r.chunkMeta,x=this.getCurrentContext(A);if(!x)return this.warn("The loading context changed while buffering fragment "+A.sn+" of level "+A.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(A.level);var C=x.frag,O=x.part,P=S.audio,M=S.text,N=S.id3,B=S.initSegment;if(!this.fragContextChanged(C)){if(this.state=h.State.PARSING,this.audioSwitch&&P&&this.completeAudioSwitch(),B!=null&&B.tracks&&(this._bufferInitSegment(B.tracks,C,A),L.trigger(k.Events.FRAG_PARSING_INIT_SEGMENT,{frag:C,id:c,tracks:B.tracks})),P){var U=P.startPTS,G=P.endPTS,z=P.startDTS,Y=P.endDTS;O&&(O.elementaryStreams[E.ElementaryStreamTypes.AUDIO]={startPTS:U,endPTS:G,startDTS:z,endDTS:Y}),C.setElementaryStreamInfo(E.ElementaryStreamTypes.AUDIO,U,G,z,Y),this.bufferFragmentData(P,C,O,A)}if(N!=null&&(a=N.samples)!==null&&a!==void 0&&a.length){var X=t({frag:C,id:c},N);L.trigger(k.Events.FRAG_PARSING_METADATA,X)}if(M){var $=t({frag:C,id:c},M);L.trigger(k.Events.FRAG_PARSING_USERDATA,$)}}},y._bufferInitSegment=function(r,a,c){if(this.state===h.State.PARSING){r.video&&delete r.video;var L=r.audio;if(L){L.levelCodec=L.codec,L.id="audio",this.log("Init audio buffer, container:"+L.container+", codecs[parsed]=["+L.codec+"]"),this.hls.trigger(k.Events.BUFFER_CODECS,r);var S=L.initSegment;if(S!=null&&S.byteLength){var A={type:"audio",frag:a,part:null,chunkMeta:c,parent:a.type,data:S};this.hls.trigger(k.Events.BUFFER_APPENDING,A)}this.tick()}}},y.loadFragment=function(r,a,c){var L=this.fragmentTracker.getState(r);this.fragCurrent=r,(this.audioSwitch||L===w.FragmentState.NOT_LOADED||L===w.FragmentState.PARTIAL)&&(r.sn==="initSegment"?this._loadInitSegment(r):a.live&&!Object(D.isFiniteNumber)(this.initPTS[r.cc])?(this.log("Waiting for video PTS in continuity counter "+r.cc+" of live stream before loading audio fragment "+r.sn+" of level "+this.trackId),this.state=h.State.WAITING_INIT_PTS):(this.startFragRequested=!0,i.prototype.loadFragment.call(this,r,a,c)))},y.completeAudioSwitch=function(){var r=this.hls,a=this.media,c=this.trackId;a&&(this.log("Switching audio track : flushing all audio"),i.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,r.trigger(k.Events.AUDIO_TRACK_SWITCHED,{id:c})},p}(h.default);I.default=o},"./src/controller/audio-track-controller.ts":function(F,I,v){v.r(I);var D=v("./src/events.ts"),h=v("./src/errors.ts"),k=v("./src/controller/base-playlist-controller.ts"),R=v("./src/types/loader.ts");function w(E,f){for(var g=0;g<f.length;g++){var b=f[g];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(E,b.key,b)}}function _(E,f){return(_=Object.setPrototypeOf||function(g,b){return g.__proto__=b,g})(E,f)}var l=function(E){var f,g;function b(n){var t;return(t=E.call(this,n,"[audio-track-controller]")||this).tracks=[],t.groupId=null,t.tracksInGroup=[],t.trackId=-1,t.trackName="",t.selectDefaultTrack=!0,t.registerListeners(),t}g=E,(f=b).prototype=Object.create(g.prototype),f.prototype.constructor=f,_(f,g);var T,u,e=b.prototype;return e.registerListeners=function(){var n=this.hls;n.on(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.on(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),n.on(D.Events.LEVEL_LOADING,this.onLevelLoading,this),n.on(D.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),n.on(D.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.on(D.Events.ERROR,this.onError,this)},e.unregisterListeners=function(){var n=this.hls;n.off(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.off(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),n.off(D.Events.LEVEL_LOADING,this.onLevelLoading,this),n.off(D.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),n.off(D.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.off(D.Events.ERROR,this.onError,this)},e.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,E.prototype.destroy.call(this)},e.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},e.onManifestParsed=function(n,t){this.tracks=t.audioTracks||[]},e.onAudioTrackLoaded=function(n,t){var s=t.id,o=t.details,i=this.tracksInGroup[s];if(i){var d=i.details;i.details=t.details,this.log("audioTrack "+s+" loaded ["+o.startSN+"-"+o.endSN+"]"),s===this.trackId&&(this.retryCount=0,this.playlistLoaded(s,t,d))}else this.warn("Invalid audio track id "+s)},e.onLevelLoading=function(n,t){this.switchLevel(t.level)},e.onLevelSwitching=function(n,t){this.switchLevel(t.level)},e.switchLevel=function(n){var t=this.hls.levels[n];if(t!=null&&t.audioGroupIds){var s=t.audioGroupIds[t.urlId];if(this.groupId!==s){this.groupId=s;var o=this.tracks.filter(function(d){return!s||d.groupId===s});this.selectDefaultTrack&&!o.some(function(d){return d.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=o;var i={audioTracks:o};this.log("Updating audio tracks, "+o.length+' track(s) found in "'+s+'" group-id'),this.hls.trigger(D.Events.AUDIO_TRACKS_UPDATED,i),this.selectInitialTrack()}}},e.onError=function(n,t){E.prototype.onError.call(this,n,t),!t.fatal&&t.context&&t.context.type===R.PlaylistContextType.AUDIO_TRACK&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&this.retryLoadingOrFail(t)},e.setAudioTrack=function(n){var t=this.tracksInGroup;if(n<0||n>=t.length)this.warn("Invalid id passed to audio-track controller");else{this.clearTimer();var s=t[this.trackId];this.log("Now switching to audio-track index "+n);var o=t[n],i=o.id,d=o.groupId,m=d===void 0?"":d,p=o.name,y=o.type,r=o.url;if(this.trackId=n,this.trackName=p,this.selectDefaultTrack=!1,this.hls.trigger(D.Events.AUDIO_TRACK_SWITCHING,{id:i,groupId:m,name:p,type:y,url:r}),!o.details||o.details.live){var a=this.switchParams(o.url,s==null?void 0:s.details);this.loadPlaylist(a)}}},e.selectInitialTrack=function(){var n=this.tracksInGroup;console.assert(n.length,"Initial audio track should be selected when tracks are known");var t=this.trackName,s=this.findTrackId(t)||this.findTrackId();s!==-1?this.setAudioTrack(s):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(D.Events.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},e.findTrackId=function(n){for(var t=this.tracksInGroup,s=0;s<t.length;s++){var o=t[s];if((!this.selectDefaultTrack||o.default)&&(!n||n===o.name))return o.id}return-1},e.loadPlaylist=function(n){var t=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(t)){var s=t.id,o=t.groupId,i=t.url;if(n)try{i=n.addDirectives(i)}catch(d){this.warn("Could not construct new URL with HLS Delivery Directives: "+d)}this.log("loading audio-track playlist for id: "+s),this.clearTimer(),this.hls.trigger(D.Events.AUDIO_TRACK_LOADING,{url:i,id:s,groupId:o,deliveryDirectives:n||null})}},T=b,(u=[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(n){this.selectDefaultTrack=!1,this.setAudioTrack(n)}}])&&w(T.prototype,u),b}(k.default);I.default=l},"./src/controller/base-playlist-controller.ts":function(F,I,v){v.r(I),v.d(I,"default",function(){return _});var D=v("./src/polyfills/number.ts"),h=v("./src/types/level.ts"),k=v("./src/controller/level-helper.ts"),R=v("./src/utils/logger.ts"),w=v("./src/errors.ts"),_=function(){function l(f,g){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=R.logger.log.bind(R.logger,g+":"),this.warn=R.logger.warn.bind(R.logger,g+":"),this.hls=f}var E=l.prototype;return E.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},E.onError=function(f,g){g.fatal&&g.type===w.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},E.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},E.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},E.stopLoad=function(){this.canLoad=!1,this.clearTimer()},E.switchParams=function(f,g){var b=g==null?void 0:g.renditionReports;if(b)for(var T=0;T<b.length;T++){var u=b[T],e=""+u.URI;if(e===f.substr(-e.length)){var n=parseInt(u["LAST-MSN"]),t=parseInt(u["LAST-PART"]);if(g&&this.hls.config.lowLatencyMode){var s=Math.min(g.age-g.partTarget,g.targetduration);t!==void 0&&s>g.partTarget&&(t+=1)}if(Object(D.isFiniteNumber)(n))return new h.HlsUrlParameters(n,Object(D.isFiniteNumber)(t)?t:void 0,h.HlsSkip.No)}}},E.loadPlaylist=function(f){},E.shouldLoadTrack=function(f){return this.canLoad&&f&&!!f.url&&(!f.details||f.details.live)},E.playlistLoaded=function(f,g,b){var T=this,u=g.details,e=g.stats,n=e.loading.end?Math.max(0,self.performance.now()-e.loading.end):0;if(u.advancedDateTime=Date.now()-n,u.live||b!=null&&b.live){if(u.reloaded(b),b&&this.log("live playlist "+f+" "+(u.advanced?"REFRESHED "+u.lastPartSn+"-"+u.lastPartIndex:"MISSED")),b&&u.fragments.length>0&&Object(k.mergeDetails)(b,u),!this.canLoad||!u.live)return;var t,s=void 0,o=void 0;if(u.canBlockReload&&u.endSN&&u.advanced){var i=this.hls.config.lowLatencyMode,d=u.lastPartSn,m=u.endSN,p=u.lastPartIndex,y=d===m;p!==-1?(s=y?m+1:d,o=y?i?0:p:p+1):s=m+1;var r=u.age,a=r+u.ageHeader,c=Math.min(a-u.partTarget,1.5*u.targetduration);if(c>0){if(b&&c>b.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+b.tuneInGoal+" to: "+c+" with playlist age: "+u.age),c=0;else{var L=Math.floor(c/u.targetduration);s+=L,o!==void 0&&(o+=Math.round(c%u.targetduration/u.partTarget)),this.log("CDN Tune-in age: "+u.ageHeader+"s last advanced "+r.toFixed(2)+"s goal: "+c+" skip sn "+L+" to part "+o)}u.tuneInGoal=c}if(t=this.getDeliveryDirectives(u,g.deliveryDirectives,s,o),i||!y)return void this.loadPlaylist(t)}else t=this.getDeliveryDirectives(u,g.deliveryDirectives,s,o);var S=Object(k.computeReloadInterval)(u,e);s!==void 0&&u.canBlockReload&&(S-=u.partTarget||1),this.log("reload live playlist "+f+" in "+Math.round(S)+" ms"),this.timer=self.setTimeout(function(){return T.loadPlaylist(t)},S)}else this.clearTimer()},E.getDeliveryDirectives=function(f,g,b,T){var u=Object(h.getSkipValue)(f,b);return g!=null&&g.skip&&f.deltaUpdateFailed&&(b=g.msn,T=g.part,u=h.HlsSkip.No),new h.HlsUrlParameters(b,T,u)},E.retryLoadingOrFail=function(f){var g,b=this,T=this.hls.config,u=this.retryCount<T.levelLoadingMaxRetry;if(u)if(this.retryCount++,f.details.indexOf("LoadTimeOut")>-1&&(g=f.context)!==null&&g!==void 0&&g.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+f.details+'"'),this.loadPlaylist();else{var e=Math.min(Math.pow(2,this.retryCount)*T.levelLoadingRetryDelay,T.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return b.loadPlaylist()},e),this.warn("retry playlist loading #"+this.retryCount+" in "+e+' ms after "'+f.details+'"')}else this.warn('cannot recover from error "'+f.details+'"'),this.clearTimer(),f.fatal=!0;return u},l}()},"./src/controller/base-stream-controller.ts":function(F,I,v){v.r(I),v.d(I,"State",function(){return i}),v.d(I,"default",function(){return d});var D=v("./src/polyfills/number.ts"),h=v("./src/task-loop.ts"),k=v("./src/controller/fragment-tracker.ts"),R=v("./src/utils/buffer-helper.ts"),w=v("./src/utils/logger.ts"),_=v("./src/events.ts"),l=v("./src/errors.ts"),E=v("./src/types/transmuxer.ts"),f=v("./src/utils/mp4-tools.ts"),g=v("./src/utils/discontinuities.ts"),b=v("./src/controller/fragment-finders.ts"),T=v("./src/controller/level-helper.ts"),u=v("./src/loader/fragment-loader.ts"),e=v("./src/crypt/decrypter.ts"),n=v("./src/utils/time-ranges.ts"),t=v("./src/types/loader.ts");function s(m,p){for(var y=0;y<p.length;y++){var r=p[y];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(m,r.key,r)}}function o(m,p){return(o=Object.setPrototypeOf||function(y,r){return y.__proto__=r,y})(m,p)}var i={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BACKTRACKING:"BACKTRACKING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},d=function(m){var p,y;function r(S,A,x){var C;return(C=m.call(this)||this).hls=void 0,C.fragPrevious=null,C.fragCurrent=null,C.fragmentTracker=void 0,C.transmuxer=null,C._state=i.STOPPED,C.media=void 0,C.mediaBuffer=void 0,C.config=void 0,C.bitrateTest=!1,C.lastCurrentTime=0,C.nextLoadPosition=0,C.startPosition=0,C.loadedmetadata=!1,C.fragLoadError=0,C.retryDate=0,C.levels=null,C.fragmentLoader=void 0,C.levelLastLoaded=null,C.startFragRequested=!1,C.decrypter=void 0,C.initPTS=[],C.onvseeking=null,C.onvended=null,C.logPrefix="",C.log=void 0,C.warn=void 0,C.logPrefix=x,C.log=w.logger.log.bind(w.logger,x+":"),C.warn=w.logger.warn.bind(w.logger,x+":"),C.hls=S,C.fragmentLoader=new u.default(S.config),C.fragmentTracker=A,C.config=S.config,C.decrypter=new e.default(S,S.config),S.on(_.Events.KEY_LOADED,C.onKeyLoaded,function(O){if(O===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return O}(C)),C}y=m,(p=r).prototype=Object.create(y.prototype),p.prototype.constructor=p,o(p,y);var a,c,L=r.prototype;return L.doTick=function(){this.onTickEnd()},L.onTickEnd=function(){},L.startLoad=function(S){},L.stopLoad=function(){this.fragmentLoader.abort();var S=this.fragCurrent;S&&this.fragmentTracker.removeFragment(S),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=i.STOPPED},L._streamEnded=function(S,A){var x=this.fragCurrent,C=this.fragmentTracker;if(!A.live&&x&&x.sn===A.endSN&&!S.nextStart){var O=C.getState(x);return O===k.FragmentState.PARTIAL||O===k.FragmentState.OK}return!1},L.onMediaAttached=function(S,A){var x=this.media=this.mediaBuffer=A.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),x.addEventListener("seeking",this.onvseeking),x.addEventListener("ended",this.onvended);var C=this.config;this.levels&&C.autoStartLoad&&this.state===i.STOPPED&&this.startLoad(C.startPosition)},L.onMediaDetaching=function(){var S=this.media;S!=null&&S.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),S&&(S.removeEventListener("seeking",this.onvseeking),S.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},L.onMediaSeeking=function(){var S=this.config,A=this.fragCurrent,x=this.media,C=this.mediaBuffer,O=this.state,P=x?x.currentTime:0,M=R.BufferHelper.bufferInfo(C||x,P,S.maxBufferHole);if(this.log("media seeking to "+(Object(D.isFiniteNumber)(P)?P.toFixed(3):P)+", state: "+O),O===i.ENDED)this.resetLoadingState();else if(A&&!M.len){var N=S.maxFragLookUpTolerance,B=A.start-N,U=P>A.start+A.duration+N;(P<B||U)&&(U&&A.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),A.loader.abort()),this.resetLoadingState())}x&&(this.lastCurrentTime=P),this.loadedmetadata||M.len||(this.nextLoadPosition=this.startPosition=P),this.tickImmediate()},L.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},L.onKeyLoaded=function(S,A){if(this.state===i.KEY_LOADING&&A.frag===this.fragCurrent&&this.levels){this.state=i.IDLE;var x=this.levels[A.frag.level].details;x&&this.loadFragment(A.frag,x,A.frag.start)}},L.onHandlerDestroying=function(){this.stopLoad(),m.prototype.onHandlerDestroying.call(this)},L.onHandlerDestroyed=function(){this.state=i.STOPPED,this.hls.off(_.Events.KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,m.prototype.onHandlerDestroyed.call(this)},L.loadKey=function(S,A){this.log("Loading key for "+S.sn+" of ["+A.startSN+"-"+A.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+S.level),this.state=i.KEY_LOADING,this.fragCurrent=S,this.hls.trigger(_.Events.KEY_LOADING,{frag:S})},L.loadFragment=function(S,A,x){this._loadFragForPlayback(S,A,x)},L._loadFragForPlayback=function(S,A,x){var C=this;this._doFragLoad(S,A,x,function(O){if(C.fragContextChanged(S))return C.warn("Fragment "+S.sn+(O.part?" p: "+O.part.index:"")+" of level "+S.level+" was dropped during download."),void C.fragmentTracker.removeFragment(S);S.stats.chunkCount++,C._handleFragmentLoadProgress(O)}).then(function(O){if(O){C.fragLoadError=0;var P=C.state;if(!C.fragContextChanged(S))return"payload"in O&&(C.log("Loaded fragment "+S.sn+" of level "+S.level),C.hls.trigger(_.Events.FRAG_LOADED,O),C.state===i.BACKTRACKING)?(C.fragmentTracker.backtrack(S,O),void C.resetFragmentLoading(S)):void C._handleFragmentLoadComplete(O);(P===i.FRAG_LOADING||P===i.BACKTRACKING||!C.fragCurrent&&P===i.PARSING)&&(C.fragmentTracker.removeFragment(S),C.state=i.IDLE)}}).catch(function(O){C.warn(O),C.resetFragmentLoading(S)})},L.flushMainBuffer=function(S,A,x){if(x===void 0&&(x=null),S-A){var C={startOffset:S,endOffset:A,type:x};this.fragLoadError=0,this.hls.trigger(_.Events.BUFFER_FLUSHING,C)}},L._loadInitSegment=function(S){var A=this;this._doFragLoad(S).then(function(x){if(!x||A.fragContextChanged(S)||!A.levels)throw new Error("init load aborted");return x}).then(function(x){var C=A.hls,O=x.payload,P=S.decryptdata;if(O&&O.byteLength>0&&P&&P.key&&P.iv&&P.method==="AES-128"){var M=self.performance.now();return A.decrypter.webCryptoDecrypt(new Uint8Array(O),P.key.buffer,P.iv.buffer).then(function(N){var B=self.performance.now();return C.trigger(_.Events.FRAG_DECRYPTED,{frag:S,payload:N,stats:{tstart:M,tdecrypt:B}}),x.payload=N,x})}return x}).then(function(x){var C=A.fragCurrent,O=A.hls,P=A.levels;if(!P)throw new Error("init load aborted, missing levels");var M=P[S.level].details;console.assert(M,"Level details are defined when init segment is loaded");var N=S.stats;A.state=i.IDLE,A.fragLoadError=0,S.data=new Uint8Array(x.payload),N.parsing.start=N.buffering.start=self.performance.now(),N.parsing.end=N.buffering.end=self.performance.now(),x.frag===C&&O.trigger(_.Events.FRAG_BUFFERED,{stats:N,frag:C,part:null,id:S.type}),A.tick()}).catch(function(x){A.warn(x),A.resetFragmentLoading(S)})},L.fragContextChanged=function(S){var A=this.fragCurrent;return!S||!A||S.level!==A.level||S.sn!==A.sn||S.urlId!==A.urlId},L.fragBufferedComplete=function(S,A){var x=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+S.type+" sn: "+S.sn+(A?" part: "+A.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+S.level+" "+n.default.toString(R.BufferHelper.getBuffered(x))),this.state=i.IDLE,this.tick()},L._handleFragmentLoadComplete=function(S){var A=this.transmuxer;if(A){var x=S.frag,C=S.part,O=S.partsLoaded,P=!O||O.length===0||O.some(function(N){return!N}),M=new E.ChunkMetadata(x.level,x.sn,x.stats.chunkCount+1,0,C?C.index:-1,!P);A.flush(M)}},L._handleFragmentLoadProgress=function(S){},L._doFragLoad=function(S,A,x,C){var O=this;if(x===void 0&&(x=null),!this.levels)throw new Error("frag load aborted, missing levels");if(x=Math.max(S.start,x||0),this.config.lowLatencyMode&&A){var P=A.partList;if(P&&C){x>S.end&&A.fragmentHint&&(S=A.fragmentHint);var M=this.getNextPart(P,S,x);if(M>-1){var N=P[M];return this.log("Loading part sn: "+S.sn+" p: "+N.index+" cc: "+S.cc+" of playlist ["+A.startSN+"-"+A.endSN+"] parts [0-"+M+"-"+(P.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+S.level+", target: "+parseFloat(x.toFixed(3))),this.nextLoadPosition=N.start+N.duration,this.state=i.FRAG_LOADING,this.hls.trigger(_.Events.FRAG_LOADING,{frag:S,part:P[M],targetBufferTime:x}),this.doFragPartsLoad(S,P,M,C).catch(function(B){return O.handleFragLoadError(B)})}if(!S.url||this.loadedEndOfParts(P,x))return Promise.resolve(null)}}return this.log("Loading fragment "+S.sn+" cc: "+S.cc+" "+(A?"of ["+A.startSN+"-"+A.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+S.level+", target: "+parseFloat(x.toFixed(3))),Object(D.isFiniteNumber)(S.sn)&&!this.bitrateTest&&(this.nextLoadPosition=S.start+S.duration),this.state=i.FRAG_LOADING,this.hls.trigger(_.Events.FRAG_LOADING,{frag:S,targetBufferTime:x}),this.fragmentLoader.load(S,C).catch(function(B){return O.handleFragLoadError(B)})},L.doFragPartsLoad=function(S,A,x,C){var O=this;return new Promise(function(P,M){var N=[];(function B(U){var G=A[U];O.fragmentLoader.loadPart(S,G,C).then(function(z){N[G.index]=z;var Y=z.part;O.hls.trigger(_.Events.FRAG_LOADED,z);var X=A[U+1];if(!X||X.fragment!==S)return P({frag:S,part:Y,partsLoaded:N});B(U+1)}).catch(M)})(x)})},L.handleFragLoadError=function(S){var A=S.data;return A&&A.details===l.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(A.frag,A.part):this.hls.trigger(_.Events.ERROR,A),null},L._handleTransmuxerFlush=function(S){var A=this.getCurrentContext(S);if(A&&this.state===i.PARSING){var x=A.frag,C=A.part,O=A.level,P=self.performance.now();x.stats.parsing.end=P,C&&(C.stats.parsing.end=P),this.updateLevelTiming(x,C,O,S.partial)}else this.fragCurrent||(this.state=i.IDLE)},L.getCurrentContext=function(S){var A=this.levels,x=S.level,C=S.sn,O=S.part;if(!A||!A[x])return this.warn("Levels object was unset while buffering fragment "+C+" of level "+x+". The current chunk will not be buffered."),null;var P=A[x],M=O>-1?Object(T.getPartWith)(P,C,O):null,N=M?M.fragment:Object(T.getFragmentWithSN)(P,C,this.fragCurrent);return N?{frag:N,part:M,level:P}:null},L.bufferFragmentData=function(S,A,x,C){if(S&&this.state===i.PARSING){var O=S.data1,P=S.data2,M=O;if(O&&P&&(M=Object(f.appendUint8Array)(O,P)),M&&M.length){var N={type:S.type,frag:A,part:x,chunkMeta:C,parent:A.type,data:M};this.hls.trigger(_.Events.BUFFER_APPENDING,N),S.dropped&&S.independent&&!x&&this.flushBufferGap(A)}}},L.flushBufferGap=function(S){var A=this.media;if(A)if(R.BufferHelper.isBuffered(A,A.currentTime)){var x=A.currentTime,C=R.BufferHelper.bufferInfo(A,x,0),O=S.duration,P=Math.min(2*this.config.maxFragLookUpTolerance,.25*O),M=Math.max(Math.min(S.start-P,C.end-P),x+P);S.start-M>P&&this.flushMainBuffer(M,S.start)}else this.flushMainBuffer(0,S.start)},L.getFwdBufferInfo=function(S,A){var x=this.config,C=this.getLoadPosition();if(!Object(D.isFiniteNumber)(C))return null;var O=R.BufferHelper.bufferInfo(S,C,x.maxBufferHole);if(O.len===0&&O.nextStart!==void 0){var P=this.fragmentTracker.getBufferedFrag(C,A);if(P&&O.nextStart<P.end)return R.BufferHelper.bufferInfo(S,C,Math.max(O.nextStart,x.maxBufferHole))}return O},L.getMaxBufferLength=function(S){var A,x=this.config;return A=S?Math.max(8*x.maxBufferSize/S,x.maxBufferLength):x.maxBufferLength,Math.min(A,x.maxMaxBufferLength)},L.reduceMaxBufferLength=function(S){var A=this.config,x=S||A.maxBufferLength;return A.maxMaxBufferLength>=x&&(A.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+A.maxMaxBufferLength+"s"),!0)},L.getNextFragment=function(S,A){var x,C,O=A.fragments,P=O.length;if(!P)return null;var M,N=this.config,B=O[0].start;if(A.live){var U=N.initialLiveManifestSize;if(P<U)return this.warn("Not enough fragments to start playback (have: "+P+", need: "+U+")"),null;A.PTSKnown||this.startFragRequested||this.startPosition!==-1||(M=this.getInitialLiveFragment(A,O),this.startPosition=M?this.hls.liveSyncPosition||M.start:S)}else S<=B&&(M=O[0]);if(!M){var G=N.lowLatencyMode?A.partEnd:A.fragmentEnd;M=this.getFragmentAtPosition(S,G,A)}return(x=M)===null||x===void 0||!x.initSegment||(C=M)!==null&&C!==void 0&&C.initSegment.data||this.bitrateTest||(M=M.initSegment),M},L.getNextPart=function(S,A,x){for(var C=-1,O=!1,P=!0,M=0,N=S.length;M<N;M++){var B=S[M];if(P=P&&!B.independent,C>-1&&x<B.start)break;var U=B.loaded;!U&&(O||B.independent||P)&&B.fragment===A&&(C=M),O=U}return C},L.loadedEndOfParts=function(S,A){var x=S[S.length-1];return x&&A>x.start&&x.loaded},L.getInitialLiveFragment=function(S,A){var x=this.fragPrevious,C=null;if(x){if(S.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+x.programDateTime),C=Object(b.findFragmentByPDT)(A,x.endProgramDateTime,this.config.maxFragLookUpTolerance)),!C){var O=x.sn+1;if(O>=S.startSN&&O<=S.endSN){var P=A[O-S.startSN];x.cc===P.cc&&(C=P,this.log("Live playlist, switching playlist, load frag with next SN: "+C.sn))}C||(C=Object(b.findFragWithCC)(A,x.cc))&&this.log("Live playlist, switching playlist, load frag with same CC: "+C.sn)}}else{var M=this.hls.liveSyncPosition;M!==null&&(C=this.getFragmentAtPosition(M,this.bitrateTest?S.fragmentEnd:S.edge,S))}return C},L.getFragmentAtPosition=function(S,A,x){var C,O=this.config,P=this.fragPrevious,M=x.fragments,N=x.endSN,B=x.fragmentHint,U=O.maxFragLookUpTolerance,G=!!(O.lowLatencyMode&&x.partList&&B);if(G&&B&&!this.bitrateTest&&(M=M.concat(B),N=B.sn),S<A){var z=S>A-U?0:U;C=Object(b.findFragmentByPTS)(P,M,S,z)}else C=M[M.length-1];if(C){var Y=C.sn-x.startSN,X=P&&C.level===P.level,$=M[Y+1];if(this.fragmentTracker.getState(C)===k.FragmentState.BACKTRACKED){C=null;for(var Z=Y;M[Z]&&this.fragmentTracker.getState(M[Z])===k.FragmentState.BACKTRACKED;)C=P?M[Z--]:M[--Z];C||(C=$)}else P&&C.sn===P.sn&&!G&&X&&(C.sn<N&&this.fragmentTracker.getState($)!==k.FragmentState.OK?(this.log("SN "+C.sn+" just loaded, load next one: "+$.sn),C=$):C=null)}return C},L.synchronizeToLiveEdge=function(S){var A=this.config,x=this.media;if(x){var C=this.hls.liveSyncPosition,O=x.currentTime,P=S.fragments[0].start,M=S.edge,N=O>=P-A.maxFragLookUpTolerance&&O<=M;if(C!==null&&x.duration>C&&(O<C||!N)){var B=A.liveMaxLatencyDuration!==void 0?A.liveMaxLatencyDuration:A.liveMaxLatencyDurationCount*S.targetduration;(!N&&x.readyState<4||O<M-B)&&(this.loadedmetadata||(this.nextLoadPosition=C),x.readyState&&(this.warn("Playback: "+O.toFixed(3)+" is located too far from the end of live sliding playlist: "+M+", reset currentTime to : "+C.toFixed(3)),x.currentTime=C))}}},L.alignPlaylists=function(S,A){var x=this.levels,C=this.levelLastLoaded,O=this.fragPrevious,P=C!==null?x[C]:null,M=S.fragments.length;if(!M)return this.warn("No fragments in live playlist"),0;var N=S.fragments[0].start,B=!A,U=S.alignedSliding&&Object(D.isFiniteNumber)(N);if(B||!U&&!N){Object(g.alignStream)(O,P,S);var G=S.fragments[0].start;return this.log("Live playlist sliding: "+G.toFixed(2)+" start-sn: "+(A?A.startSN:"na")+"->"+S.startSN+" prev-sn: "+(O?O.sn:"na")+" fragments: "+M),G}return N},L.waitForCdnTuneIn=function(S){return S.live&&S.canBlockReload&&S.tuneInGoal>Math.max(S.partHoldBack,3*S.partTarget)},L.setStartPosition=function(S,A){var x=this.startPosition;if(x<A&&(x=-1),x===-1||this.lastCurrentTime===-1){var C=S.startTimeOffset;Object(D.isFiniteNumber)(C)?(x=A+C,C<0&&(x+=S.totalduration),x=Math.min(Math.max(A,x),A+S.totalduration),this.log("Start time offset "+C+" found in playlist, adjust startPosition to "+x),this.startPosition=x):S.live?x=this.hls.liveSyncPosition||A:this.startPosition=x=0,this.lastCurrentTime=x}this.nextLoadPosition=x},L.getLoadPosition=function(){var S=this.media,A=0;return this.loadedmetadata&&S?A=S.currentTime:this.nextLoadPosition&&(A=this.nextLoadPosition),A},L.handleFragLoadAborted=function(S,A){this.transmuxer&&S.sn!=="initSegment"&&S.stats.aborted&&(this.warn("Fragment "+S.sn+(A?" part"+A.index:"")+" of level "+S.level+" was aborted"),this.resetFragmentLoading(S))},L.resetFragmentLoading=function(S){this.fragCurrent&&this.fragContextChanged(S)||(this.state=i.IDLE)},L.onFragmentOrKeyLoadError=function(S,A){if(!A.fatal){var x=A.frag;if(x&&x.type===S){var C=this.fragCurrent;console.assert(C&&x.sn===C.sn&&x.level===C.level&&x.urlId===C.urlId,"Frag load error must match current frag to retry");var O=this.config;if(this.fragLoadError+1<=O.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded(x.level))return;var P=Math.min(Math.pow(2,this.fragLoadError)*O.fragLoadingRetryDelay,O.fragLoadingMaxRetryTimeout);this.warn("Fragment "+x.sn+" of "+S+" "+x.level+" failed to load, retrying in "+P+"ms"),this.retryDate=self.performance.now()+P,this.fragLoadError++,this.state=i.FRAG_LOADING_WAITING_RETRY}else A.levelRetry?(S===t.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=i.IDLE):(w.logger.error(A.details+" reaches max retry, redispatch as fatal ..."),A.fatal=!0,this.hls.stopLoad(),this.state=i.ERROR)}}},L.afterBufferFlushed=function(S,A,x){if(S){var C=R.BufferHelper.getBuffered(S);this.fragmentTracker.detectEvictedFragments(A,C,x),this.state===i.ENDED&&this.resetLoadingState()}},L.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=i.IDLE},L.resetLiveStartWhenNotLoaded=function(S){if(!this.loadedmetadata){this.startFragRequested=!1;var A=this.levels?this.levels[S].details:null;if(A!=null&&A.live)return this.startPosition=-1,this.setStartPosition(A,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},L.updateLevelTiming=function(S,A,x,C){var O=this,P=x.details;console.assert(!!P,"level.details must be defined"),Object.keys(S.elementaryStreams).reduce(function(M,N){var B=S.elementaryStreams[N];if(B){var U=B.endPTS-B.startPTS;if(U<=0)return O.warn("Could not parse fragment "+S.sn+" "+N+" duration reliably ("+U+") resetting transmuxer to fallback to playlist timing"),O.resetTransmuxer(),M||!1;var G=C?0:Object(T.updateFragPTSDTS)(P,S,B.startPTS,B.endPTS,B.startDTS,B.endDTS);return O.hls.trigger(_.Events.LEVEL_PTS_UPDATED,{details:P,level:x,drift:G,type:N,frag:S,start:B.startPTS,end:B.endPTS}),!0}return M},!1)?(this.state=i.PARSED,this.hls.trigger(_.Events.FRAG_PARSED,{frag:S,part:A})):this.resetLoadingState()},L.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},a=r,(c=[{key:"state",get:function(){return this._state},set:function(S){var A=this._state;A!==S&&(this._state=S,this.log(A+"->"+S))}}])&&s(a.prototype,c),r}(h.default)},"./src/controller/buffer-controller.ts":function(F,I,v){v.r(I),v.d(I,"default",function(){return b});var D=v("./src/polyfills/number.ts"),h=v("./src/events.ts"),k=v("./src/utils/logger.ts"),R=v("./src/errors.ts"),w=v("./src/utils/buffer-helper.ts"),_=v("./src/utils/mediasource-helper.ts"),l=v("./src/loader/fragment.ts"),E=v("./src/controller/buffer-operation-queue.ts"),f=Object(_.getMediaSource)(),g=/([ha]vc.)(?:\.[^.,]+)+/,b=function(){function T(e){var n=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var t=n.hls,s=n.media,o=n.mediaSource;k.logger.log("[buffer-controller]: Media source opened"),s&&(n.updateMediaElementDuration(),t.trigger(h.Events.MEDIA_ATTACHED,{media:s})),o&&o.removeEventListener("sourceopen",n._onMediaSourceOpen),n.checkPendingTracks()},this._onMediaSourceClose=function(){k.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){k.logger.log("[buffer-controller]: Media source ended")},this.hls=e,this._initSourceBuffer(),this.registerListeners()}var u=T.prototype;return u.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},u.destroy=function(){this.unregisterListeners(),this.details=null},u.registerListeners=function(){var e=this.hls;e.on(h.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(h.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(h.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(h.Events.BUFFER_RESET,this.onBufferReset,this),e.on(h.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.on(h.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.on(h.Events.BUFFER_EOS,this.onBufferEos,this),e.on(h.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(h.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(h.Events.FRAG_PARSED,this.onFragParsed,this),e.on(h.Events.FRAG_CHANGED,this.onFragChanged,this)},u.unregisterListeners=function(){var e=this.hls;e.off(h.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(h.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(h.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(h.Events.BUFFER_RESET,this.onBufferReset,this),e.off(h.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.off(h.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.off(h.Events.BUFFER_EOS,this.onBufferEos,this),e.off(h.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(h.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(h.Events.FRAG_PARSED,this.onFragParsed,this),e.off(h.Events.FRAG_CHANGED,this.onFragChanged,this)},u._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new E.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},u.onManifestParsed=function(e,n){var t=2;(n.audio&&!n.video||!n.altAudio)&&(t=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=t,this.details=null,k.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},u.onMediaAttaching=function(e,n){var t=this.media=n.media;if(t&&f){var s=this.mediaSource=new f;s.addEventListener("sourceopen",this._onMediaSourceOpen),s.addEventListener("sourceended",this._onMediaSourceEnded),s.addEventListener("sourceclose",this._onMediaSourceClose),t.src=self.URL.createObjectURL(s),this._objectUrl=t.src}},u.onMediaDetaching=function(){var e=this.media,n=this.mediaSource,t=this._objectUrl;if(n){if(k.logger.log("[buffer-controller]: media source detaching"),n.readyState==="open")try{n.endOfStream()}catch(s){k.logger.warn("[buffer-controller]: onMediaDetaching: "+s.message+" while calling endOfStream")}this.onBufferReset(),n.removeEventListener("sourceopen",this._onMediaSourceOpen),n.removeEventListener("sourceended",this._onMediaSourceEnded),n.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(t&&self.URL.revokeObjectURL(t),e.src===t?(e.removeAttribute("src"),e.load()):k.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(h.Events.MEDIA_DETACHED,void 0)},u.onBufferReset=function(){var e=this;this.getSourceBufferTypes().forEach(function(n){var t=e.sourceBuffer[n];try{t&&(e.removeBufferListeners(n),e.mediaSource&&e.mediaSource.removeSourceBuffer(t),e.sourceBuffer[n]=void 0)}catch(s){k.logger.warn("[buffer-controller]: Failed to reset the "+n+" buffer",s)}}),this._initSourceBuffer()},u.onBufferCodecs=function(e,n){var t=this,s=this.getSourceBufferTypes().length;Object.keys(n).forEach(function(o){if(s){var i=t.tracks[o];if(i&&typeof i.buffer.changeType=="function"){var d=n[o],m=d.codec,p=d.levelCodec,y=d.container;if((i.levelCodec||i.codec).replace(g,"$1")!==(p||m).replace(g,"$1")){var r=y+";codecs="+(p||m);t.appendChangeType(o,r)}}}else t.pendingTracks[o]=n[o]}),s||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},u.appendChangeType=function(e,n){var t=this,s=this.operationQueue,o={execute:function(){var i=t.sourceBuffer[e];i&&(k.logger.log("[buffer-controller]: changing "+e+" sourceBuffer type to "+n),i.changeType(n)),s.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(i){k.logger.warn("[buffer-controller]: Failed to change "+e+" SourceBuffer type",i)}};s.append(o,e)},u.onBufferAppending=function(e,n){var t=this,s=this.hls,o=this.operationQueue,i=this.tracks,d=n.data,m=n.type,p=n.frag,y=n.part,r=n.chunkMeta,a=r.buffering[m],c=self.performance.now();a.start=c;var L=p.stats.buffering,S=y?y.stats.buffering:null;L.start===0&&(L.start=c),S&&S.start===0&&(S.start=c);var A=i.audio,x=m==="audio"&&r.id===1&&(A==null?void 0:A.container)==="audio/mpeg",C={execute:function(){if(a.executeStart=self.performance.now(),x){var O=t.sourceBuffer[m];if(O){var P=p.start-O.timestampOffset;Math.abs(P)>=.1&&(k.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+p.start+" (delta: "+P+") sn: "+p.sn+")"),O.timestampOffset=p.start)}}t.appendExecutor(d,m)},onStart:function(){},onComplete:function(){var O=self.performance.now();a.executeEnd=a.end=O,L.first===0&&(L.first=O),S&&S.first===0&&(S.first=O);var P=t.sourceBuffer,M={};for(var N in P)M[N]=w.BufferHelper.getBuffered(P[N]);t.appendError=0,t.hls.trigger(h.Events.BUFFER_APPENDED,{type:m,frag:p,part:y,chunkMeta:r,parent:p.type,timeRanges:M})},onError:function(O){k.logger.error("[buffer-controller]: Error encountered while trying to append to the "+m+" SourceBuffer",O);var P={type:R.ErrorTypes.MEDIA_ERROR,parent:p.type,details:R.ErrorDetails.BUFFER_APPEND_ERROR,err:O,fatal:!1};O.code===DOMException.QUOTA_EXCEEDED_ERR?P.details=R.ErrorDetails.BUFFER_FULL_ERROR:(t.appendError++,P.details=R.ErrorDetails.BUFFER_APPEND_ERROR,t.appendError>s.config.appendErrorMaxRetry&&(k.logger.error("[buffer-controller]: Failed "+s.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),P.fatal=!0)),s.trigger(h.Events.ERROR,P)}};o.append(C,m)},u.onBufferFlushing=function(e,n){var t=this,s=this.operationQueue,o=function(i){return{execute:t.removeExecutor.bind(t,i,n.startOffset,n.endOffset),onStart:function(){},onComplete:function(){t.hls.trigger(h.Events.BUFFER_FLUSHED,{type:i})},onError:function(d){k.logger.warn("[buffer-controller]: Failed to remove from "+i+" SourceBuffer",d)}}};n.type?s.append(o(n.type),n.type):this.getSourceBufferTypes().forEach(function(i){s.append(o(i),i)})},u.onFragParsed=function(e,n){var t=this,s=n.frag,o=n.part,i=[],d=o?o.elementaryStreams:s.elementaryStreams;d[l.ElementaryStreamTypes.AUDIOVIDEO]?i.push("audiovideo"):(d[l.ElementaryStreamTypes.AUDIO]&&i.push("audio"),d[l.ElementaryStreamTypes.VIDEO]&&i.push("video")),i.length===0&&k.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+s.type+" level: "+s.level+" sn: "+s.sn),this.blockBuffers(function(){var m=self.performance.now();s.stats.buffering.end=m,o&&(o.stats.buffering.end=m);var p=o?o.stats:s.stats;t.hls.trigger(h.Events.FRAG_BUFFERED,{frag:s,part:o,stats:p,id:s.type})},i)},u.onFragChanged=function(e,n){this.flushBackBuffer()},u.onBufferEos=function(e,n){var t=this;this.getSourceBufferTypes().reduce(function(s,o){var i=t.sourceBuffer[o];return n.type&&n.type!==o||i&&!i.ended&&(i.ended=!0,k.logger.log("[buffer-controller]: "+o+" sourceBuffer now EOS")),s&&!(i&&!i.ended)},!0)&&this.blockBuffers(function(){var s=t.mediaSource;s&&s.readyState==="open"&&s.endOfStream()})},u.onLevelUpdated=function(e,n){var t=n.details;t.fragments.length&&(this.details=t,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},u.flushBackBuffer=function(){var e=this.hls,n=this.details,t=this.media,s=this.sourceBuffer;if(t&&n!==null){var o=this.getSourceBufferTypes();if(o.length){var i=n.live&&e.config.liveBackBufferLength!==null?e.config.liveBackBufferLength:e.config.backBufferLength;if(Object(D.isFiniteNumber)(i)&&!(i<0)){var d=t.currentTime,m=n.levelTargetDuration,p=Math.max(i,m),y=Math.floor(d/m)*m-p;o.forEach(function(r){var a=s[r];if(a){var c=w.BufferHelper.getBuffered(a);c.length>0&&y>c.start(0)&&(e.trigger(h.Events.BACK_BUFFER_REACHED,{bufferEnd:y}),n.live&&e.trigger(h.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:y}),e.trigger(h.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:y,type:r}))}})}}}},u.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&this.mediaSource.readyState==="open"){var e=this.details,n=this.hls,t=this.media,s=this.mediaSource,o=e.fragments[0].start+e.totalduration,i=t.duration,d=Object(D.isFiniteNumber)(s.duration)?s.duration:0;e.live&&n.config.liveDurationInfinity?(k.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),s.duration=1/0,this.updateSeekableRange(e)):(o>d&&o>i||!Object(D.isFiniteNumber)(i))&&(k.logger.log("[buffer-controller]: Updating Media Source duration to "+o.toFixed(3)),s.duration=o)}},u.updateSeekableRange=function(e){var n=this.mediaSource,t=e.fragments;if(t.length&&e.live&&n!=null&&n.setLiveSeekableRange){var s=Math.max(0,t[0].start),o=Math.max(s,s+e.totalduration);n.setLiveSeekableRange(s,o)}},u.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,n=this.operationQueue,t=this.pendingTracks,s=Object.keys(t).length;if(s&&!e||s===2){this.createSourceBuffers(t),this.pendingTracks={};var o=this.getSourceBufferTypes();if(o.length===0)return void this.hls.trigger(h.Events.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});o.forEach(function(i){n.executeNext(i)})}},u.createSourceBuffers=function(e){var n=this.sourceBuffer,t=this.mediaSource;if(!t)throw Error("createSourceBuffers called when mediaSource was null");var s=0;for(var o in e)if(!n[o]){var i=e[o];if(!i)throw Error("source buffer exists for track "+o+", however track does not");var d=i.levelCodec||i.codec,m=i.container+";codecs="+d;k.logger.log("[buffer-controller]: creating sourceBuffer("+m+")");try{var p=n[o]=t.addSourceBuffer(m),y=o;this.addBufferListener(y,"updatestart",this._onSBUpdateStart),this.addBufferListener(y,"updateend",this._onSBUpdateEnd),this.addBufferListener(y,"error",this._onSBUpdateError),this.tracks[o]={buffer:p,codec:d,container:i.container,levelCodec:i.levelCodec,id:i.id},s++}catch(r){k.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+r.message),this.hls.trigger(h.Events.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:r,mimeType:m})}}s&&this.hls.trigger(h.Events.BUFFER_CREATED,{tracks:this.tracks})},u._onSBUpdateStart=function(e){this.operationQueue.current(e).onStart()},u._onSBUpdateEnd=function(e){var n=this.operationQueue;n.current(e).onComplete(),n.shiftAndExecuteNext(e)},u._onSBUpdateError=function(e,n){k.logger.error("[buffer-controller]: "+e+" SourceBuffer error",n),this.hls.trigger(h.Events.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var t=this.operationQueue.current(e);t&&t.onError(n)},u.removeExecutor=function(e,n,t){var s=this.media,o=this.mediaSource,i=this.operationQueue,d=this.sourceBuffer[e];if(!s||!o||!d)return k.logger.warn("[buffer-controller]: Attempting to remove from the "+e+" SourceBuffer, but it does not exist"),void i.shiftAndExecuteNext(e);var m=Object(D.isFiniteNumber)(s.duration)?s.duration:1/0,p=Object(D.isFiniteNumber)(o.duration)?o.duration:1/0,y=Math.max(0,n),r=Math.min(t,m,p);r>y?(k.logger.log("[buffer-controller]: Removing ["+y+","+r+"] from the "+e+" SourceBuffer"),console.assert(!d.updating,e+" sourceBuffer must not be updating"),d.remove(y,r)):i.shiftAndExecuteNext(e)},u.appendExecutor=function(e,n){var t=this.operationQueue,s=this.sourceBuffer[n];if(!s)return k.logger.warn("[buffer-controller]: Attempting to append to the "+n+" SourceBuffer, but it does not exist"),void t.shiftAndExecuteNext(n);s.ended=!1,console.assert(!s.updating,n+" sourceBuffer must not be updating"),s.appendBuffer(e)},u.blockBuffers=function(e,n){var t=this;if(n===void 0&&(n=this.getSourceBufferTypes()),!n.length)return k.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve(e);var s=this.operationQueue,o=n.map(function(i){return s.appendBlocker(i)});Promise.all(o).then(function(){e(),n.forEach(function(i){var d=t.sourceBuffer[i];d&&d.updating||s.shiftAndExecuteNext(i)})})},u.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},u.addBufferListener=function(e,n,t){var s=this.sourceBuffer[e];if(s){var o=t.bind(this,e);this.listeners[e].push({event:n,listener:o}),s.addEventListener(n,o)}},u.removeBufferListeners=function(e){var n=this.sourceBuffer[e];n&&this.listeners[e].forEach(function(t){n.removeEventListener(t.event,t.listener)})},T}()},"./src/controller/buffer-operation-queue.ts":function(F,I,v){v.r(I),v.d(I,"default",function(){return h});var D=v("./src/utils/logger.ts"),h=function(){function k(w){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=w}var R=k.prototype;return R.append=function(w,_){var l=this.queues[_];l.push(w),l.length===1&&this.buffers[_]&&this.executeNext(_)},R.insertAbort=function(w,_){this.queues[_].unshift(w),this.executeNext(_)},R.appendBlocker=function(w){var _,l=new Promise(function(f){_=f}),E={execute:_,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(E,w),l},R.executeNext=function(w){var _=this.buffers,l=this.queues,E=_[w],f=l[w];if(f.length){var g=f[0];try{g.execute()}catch(b){D.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),g.onError(b),E&&E.updating||(f.shift(),this.executeNext(w))}}},R.shiftAndExecuteNext=function(w){this.queues[w].shift(),this.executeNext(w)},R.current=function(w){return this.queues[w][0]},k}()},"./src/controller/cap-level-controller.ts":function(F,I,v){v.r(I);var D=v("./src/events.ts");function h(R,w){for(var _=0;_<w.length;_++){var l=w[_];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(R,l.key,l)}}var k=function(){function R(f){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=f,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var w,_,l,E=R.prototype;return E.setStreamController=function(f){this.streamController=f},E.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},E.registerListeners=function(){var f=this.hls;f.on(D.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),f.on(D.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),f.on(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),f.on(D.Events.BUFFER_CODECS,this.onBufferCodecs,this),f.on(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},E.unregisterListener=function(){var f=this.hls;f.off(D.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),f.off(D.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),f.off(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),f.off(D.Events.BUFFER_CODECS,this.onBufferCodecs,this),f.off(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},E.onFpsDropLevelCapping=function(f,g){R.isLevelAllowed(g.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(g.droppedLevel)},E.onMediaAttaching=function(f,g){this.media=g.media instanceof HTMLVideoElement?g.media:null},E.onManifestParsed=function(f,g){var b=this.hls;this.restrictedLevels=[],this.firstLevel=g.firstLevel,b.config.capLevelToPlayerSize&&g.video&&this.startCapping()},E.onBufferCodecs=function(f,g){this.hls.config.capLevelToPlayerSize&&g.video&&this.startCapping()},E.onMediaDetaching=function(){this.stopCapping()},E.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var f=this.hls.levels;if(f.length){var g=this.hls;g.autoLevelCapping=this.getMaxLevel(f.length-1),g.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=g.autoLevelCapping}}},E.getMaxLevel=function(f){var g=this,b=this.hls.levels;if(!b.length)return-1;var T=b.filter(function(u,e){return R.isLevelAllowed(e,g.restrictedLevels)&&e<=f});return this.clientRect=null,R.getMaxLevelByMediaSize(T,this.mediaWidth,this.mediaHeight)},E.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},E.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},E.getDimensions=function(){if(this.clientRect)return this.clientRect;var f=this.media,g={width:0,height:0};if(f){var b=f.getBoundingClientRect();g.width=b.width,g.height=b.height,g.width||g.height||(g.width=b.right-b.left||f.width||0,g.height=b.bottom-b.top||f.height||0)}return this.clientRect=g,g},R.isLevelAllowed=function(f,g){return g===void 0&&(g=[]),g.indexOf(f)===-1},R.getMaxLevelByMediaSize=function(f,g,b){if(!f||!f.length)return-1;for(var T,u,e=f.length-1,n=0;n<f.length;n+=1){var t=f[n];if((t.width>=g||t.height>=b)&&(T=t,!(u=f[n+1])||T.width!==u.width||T.height!==u.height)){e=n;break}}return e},w=R,l=[{key:"contentScaleFactor",get:function(){var f=1;try{f=self.devicePixelRatio}catch{}return f}}],(_=[{key:"mediaWidth",get:function(){return this.getDimensions().width*R.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*R.contentScaleFactor}}])&&h(w.prototype,_),l&&h(w,l),R}();I.default=k},"./src/controller/eme-controller.ts":function(F,I,v){v.r(I);var D=v("./src/events.ts"),h=v("./src/errors.ts"),k=v("./src/utils/logger.ts"),R=v("./src/utils/mediakeys-helper.ts");function w(l,E){for(var f=0;f<E.length;f++){var g=E[f];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(l,g.key,g)}}var _=function(){function l(b){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=b,this._config=b.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var E,f,g=l.prototype;return g.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},g._registerListeners=function(){this.hls.on(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(D.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(D.Events.MANIFEST_PARSED,this.onManifestParsed,this)},g._unregisterListeners=function(){this.hls.off(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(D.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(D.Events.MANIFEST_PARSED,this.onManifestParsed,this)},g.getLicenseServerUrl=function(b){switch(b){case R.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+b+'"')},g._attemptKeySystemAccess=function(b,T,u){var e=this,n=function(s,o,i,d){switch(s){case R.KeySystems.WIDEVINE:return function(m,p,y){var r={audioCapabilities:[],videoCapabilities:[]};return m.forEach(function(a){r.audioCapabilities.push({contentType:'audio/mp4; codecs="'+a+'"',robustness:y.audioRobustness||""})}),p.forEach(function(a){r.videoCapabilities.push({contentType:'video/mp4; codecs="'+a+'"',robustness:y.videoRobustness||""})}),[r]}(o,i,d);default:throw new Error("Unknown key-system: "+s)}}(b,T,u,this._drmSystemOptions);k.logger.log("Requesting encrypted media key-system access");var t=this.requestMediaKeySystemAccess(b,n);this.mediaKeysPromise=t.then(function(s){return e._onMediaKeySystemAccessObtained(b,s)}),t.catch(function(s){k.logger.error('Failed to obtain key-system "'+b+'" access:',s)})},g._onMediaKeySystemAccessObtained=function(b,T){var u=this;k.logger.log('Access for key-system "'+b+'" obtained');var e={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:T,mediaKeySystemDomain:b};this._mediaKeysList.push(e);var n=Promise.resolve().then(function(){return T.createMediaKeys()}).then(function(t){return e.mediaKeys=t,k.logger.log('Media-keys created for key-system "'+b+'"'),u._onMediaKeysCreated(),t});return n.catch(function(t){k.logger.error("Failed to create media-keys:",t)}),n},g._onMediaKeysCreated=function(){var b=this;this._mediaKeysList.forEach(function(T){T.mediaKeysSession||(T.mediaKeysSession=T.mediaKeys.createSession(),b._onNewMediaKeySession(T.mediaKeysSession))})},g._onNewMediaKeySession=function(b){var T=this;k.logger.log("New key-system session "+b.sessionId),b.addEventListener("message",function(u){T._onKeySessionMessage(b,u.message)},!1)},g._onKeySessionMessage=function(b,T){k.logger.log("Got EME message event, creating license request"),this._requestLicense(T,function(u){k.logger.log("Received license data (length: "+(u&&u.byteLength)+"), updating key-session"),b.update(u)})},g.onMediaEncrypted=function(b){var T=this;if(k.logger.log('Media is encrypted using "'+b.initDataType+'" init data type'),!this.mediaKeysPromise)return k.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),void this.hls.trigger(D.Events.ERROR,{type:h.ErrorTypes.KEY_SYSTEM_ERROR,details:h.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});var u=function(e){T._media&&(T._attemptSetMediaKeys(e),T._generateRequestWithPreferredKeySession(b.initDataType,b.initData))};this.mediaKeysPromise.then(u).catch(u)},g._attemptSetMediaKeys=function(b){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var T=this._mediaKeysList[0];if(!T||!T.mediaKeys)return k.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(D.Events.ERROR,{type:h.ErrorTypes.KEY_SYSTEM_ERROR,details:h.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});k.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(T.mediaKeys),this._hasSetMediaKeys=!0}},g._generateRequestWithPreferredKeySession=function(b,T){var u=this,e=this._mediaKeysList[0];if(!e)return k.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(D.Events.ERROR,{type:h.ErrorTypes.KEY_SYSTEM_ERROR,details:h.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(e.mediaKeysSessionInitialized)k.logger.warn("Key-Session already initialized but requested again");else{var n=e.mediaKeysSession;if(!n)return k.logger.error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(D.Events.ERROR,{type:h.ErrorTypes.KEY_SYSTEM_ERROR,details:h.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});if(!T)return k.logger.warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(D.Events.ERROR,{type:h.ErrorTypes.KEY_SYSTEM_ERROR,details:h.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});k.logger.log('Generating key-session request for "'+b+'" init data type'),e.mediaKeysSessionInitialized=!0,n.generateRequest(b,T).then(function(){k.logger.debug("Key-session generation succeeded")}).catch(function(t){k.logger.error("Error generating key-session request:",t),u.hls.trigger(D.Events.ERROR,{type:h.ErrorTypes.KEY_SYSTEM_ERROR,details:h.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})}},g._createLicenseXhr=function(b,T,u){var e=new XMLHttpRequest;e.responseType="arraybuffer",e.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,e,b,T,u);var n=this._licenseXhrSetup;if(n)try{n.call(this.hls,e,b),n=void 0}catch(t){k.logger.error(t)}try{e.readyState||e.open("POST",b,!0),n&&n.call(this.hls,e,b)}catch(t){throw new Error("issue setting up KeySystem license XHR "+t)}return e},g._onLicenseRequestReadyStageChange=function(b,T,u,e){switch(b.readyState){case 4:if(b.status===200){this._requestLicenseFailureCount=0,k.logger.log("License request succeeded");var n=b.response,t=this._licenseResponseCallback;if(t)try{n=t.call(this.hls,b,T)}catch(o){k.logger.error(o)}e(n)}else{if(k.logger.error("License Request XHR failed ("+T+"). Status: "+b.status+" ("+b.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>3)return void this.hls.trigger(D.Events.ERROR,{type:h.ErrorTypes.KEY_SYSTEM_ERROR,details:h.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});var s=3-this._requestLicenseFailureCount+1;k.logger.warn("Retrying license request, "+s+" attempts left"),this._requestLicense(u,e)}}},g._generateLicenseRequestChallenge=function(b,T){switch(b.mediaKeySystemDomain){case R.KeySystems.WIDEVINE:return T}throw new Error("unsupported key-system: "+b.mediaKeySystemDomain)},g._requestLicense=function(b,T){k.logger.log("Requesting content license for key-system");var u=this._mediaKeysList[0];if(!u)return k.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(D.Events.ERROR,{type:h.ErrorTypes.KEY_SYSTEM_ERROR,details:h.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});try{var e=this.getLicenseServerUrl(u.mediaKeySystemDomain),n=this._createLicenseXhr(e,b,T);k.logger.log("Sending license request to URL: "+e);var t=this._generateLicenseRequestChallenge(u,b);n.send(t)}catch(s){k.logger.error("Failure requesting DRM license: "+s),this.hls.trigger(D.Events.ERROR,{type:h.ErrorTypes.KEY_SYSTEM_ERROR,details:h.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},g.onMediaAttached=function(b,T){if(this._emeEnabled){var u=T.media;this._media=u,u.addEventListener("encrypted",this._onMediaEncrypted)}},g.onMediaDetached=function(){var b=this._media,T=this._mediaKeysList;b&&(b.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(T.map(function(u){if(u.mediaKeysSession)return u.mediaKeysSession.close().catch(function(){})})).then(function(){return b.setMediaKeys(null)}).catch(function(){}))},g.onManifestParsed=function(b,T){if(this._emeEnabled){var u=T.levels.map(function(n){return n.audioCodec}).filter(function(n){return!!n}),e=T.levels.map(function(n){return n.videoCodec}).filter(function(n){return!!n});this._attemptKeySystemAccess(R.KeySystems.WIDEVINE,u,e)}},E=l,(f=[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}])&&w(E.prototype,f),l}();I.default=_},"./src/controller/fps-controller.ts":function(F,I,v){v.r(I);var D=v("./src/events.ts"),h=v("./src/utils/logger.ts"),k=function(){function R(_){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=_,this.registerListeners()}var w=R.prototype;return w.setStreamController=function(_){this.streamController=_},w.registerListeners=function(){this.hls.on(D.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},w.unregisterListeners=function(){this.hls.off(D.Events.MEDIA_ATTACHING,this.onMediaAttaching)},w.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},w.onMediaAttaching=function(_,l){var E=this.hls.config;if(E.capLevelOnFPSDrop){var f=l.media instanceof self.HTMLVideoElement?l.media:null;this.media=f,f&&typeof f.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),E.fpsDroppedMonitoringPeriod)}},w.checkFPS=function(_,l,E){var f=performance.now();if(l){if(this.lastTime){var g=f-this.lastTime,b=E-this.lastDroppedFrames,T=l-this.lastDecodedFrames,u=1e3*b/g,e=this.hls;if(e.trigger(D.Events.FPS_DROP,{currentDropped:b,currentDecoded:T,totalDroppedFrames:E}),u>0&&b>e.config.fpsDroppedMonitoringThreshold*T){var n=e.currentLevel;h.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+n),n>0&&(e.autoLevelCapping===-1||e.autoLevelCapping>=n)&&(n-=1,e.trigger(D.Events.FPS_DROP_LEVEL_CAPPING,{level:n,droppedLevel:e.currentLevel}),e.autoLevelCapping=n,this.streamController.nextLevelSwitch())}}this.lastTime=f,this.lastDroppedFrames=E,this.lastDecodedFrames=l}},w.checkFPSInterval=function(){var _=this.media;if(_)if(this.isVideoPlaybackQualityAvailable){var l=_.getVideoPlaybackQuality();this.checkFPS(_,l.totalVideoFrames,l.droppedVideoFrames)}else this.checkFPS(_,_.webkitDecodedFrameCount,_.webkitDroppedFrameCount)},R}();I.default=k},"./src/controller/fragment-finders.ts":function(F,I,v){v.r(I),v.d(I,"findFragmentByPDT",function(){return k}),v.d(I,"findFragmentByPTS",function(){return R}),v.d(I,"fragmentWithinToleranceTest",function(){return w}),v.d(I,"pdtWithinToleranceTest",function(){return _}),v.d(I,"findFragWithCC",function(){return l});var D=v("./src/polyfills/number.ts"),h=v("./src/utils/binary-search.ts");function k(E,f,g){if(f===null||!Array.isArray(E)||!E.length||!Object(D.isFiniteNumber)(f)||f<(E[0].programDateTime||0)||f>=(E[E.length-1].endProgramDateTime||0))return null;g=g||0;for(var b=0;b<E.length;++b){var T=E[b];if(_(f,g,T))return T}return null}function R(E,f,g,b){g===void 0&&(g=0),b===void 0&&(b=0);var T=null;if(E?T=f[E.sn-f[0].sn+1]||null:g===0&&f[0].start===0&&(T=f[0]),T&&w(g,b,T)===0)return T;var u=h.default.search(f,w.bind(null,g,b));return u||T}function w(E,f,g){E===void 0&&(E=0),f===void 0&&(f=0);var b=Math.min(f,g.duration+(g.deltaPTS?g.deltaPTS:0));return g.start+g.duration-b<=E?1:g.start-b>E&&g.start?-1:0}function _(E,f,g){var b=1e3*Math.min(f,g.duration+(g.deltaPTS?g.deltaPTS:0));return(g.endProgramDateTime||0)-b>E}function l(E,f){return h.default.search(E,function(g){return g.cc<f?1:g.cc>f?-1:0})}},"./src/controller/fragment-tracker.ts":function(F,I,v){v.r(I),v.d(I,"FragmentState",function(){return D}),v.d(I,"FragmentTracker",function(){return w});var D,h,k=v("./src/events.ts"),R=v("./src/types/loader.ts");(h=D||(D={})).NOT_LOADED="NOT_LOADED",h.BACKTRACKED="BACKTRACKED",h.APPENDING="APPENDING",h.PARTIAL="PARTIAL",h.OK="OK";var w=function(){function E(g){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=g,this._registerListeners()}var f=E.prototype;return f._registerListeners=function(){var g=this.hls;g.on(k.Events.BUFFER_APPENDED,this.onBufferAppended,this),g.on(k.Events.FRAG_BUFFERED,this.onFragBuffered,this),g.on(k.Events.FRAG_LOADED,this.onFragLoaded,this)},f._unregisterListeners=function(){var g=this.hls;g.off(k.Events.BUFFER_APPENDED,this.onBufferAppended,this),g.off(k.Events.FRAG_BUFFERED,this.onFragBuffered,this),g.off(k.Events.FRAG_LOADED,this.onFragLoaded,this)},f.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},f.getAppendedFrag=function(g,b){if(b===R.PlaylistLevelType.MAIN){var T=this.activeFragment,u=this.activeParts;if(!T)return null;if(u)for(var e=u.length;e--;){var n=u[e],t=n?n.end:T.appendedPTS;if(n.start<=g&&t!==void 0&&g<=t)return e>9&&(this.activeParts=u.slice(e-9)),n}else if(T.start<=g&&T.appendedPTS!==void 0&&g<=T.appendedPTS)return T}return this.getBufferedFrag(g,b)},f.getBufferedFrag=function(g,b){for(var T=this.fragments,u=Object.keys(T),e=u.length;e--;){var n=T[u[e]];if((n==null?void 0:n.body.type)===b&&n.buffered){var t=n.body;if(t.start<=g&&g<=t.end)return t}}return null},f.detectEvictedFragments=function(g,b,T){var u=this;Object.keys(this.fragments).forEach(function(e){var n=u.fragments[e];if(n)if(n.buffered){var t=n.range[g];t&&t.time.some(function(s){var o=!u.isTimeBuffered(s.startPTS,s.endPTS,b);return o&&u.removeFragment(n.body),o})}else n.body.type===T&&u.removeFragment(n.body)})},f.detectPartialFragments=function(g){var b=this,T=this.timeRanges,u=g.frag,e=g.part;if(T&&u.sn!=="initSegment"){var n=l(u),t=this.fragments[n];t&&(Object.keys(T).forEach(function(s){var o=u.elementaryStreams[s];if(o){var i=T[s],d=e!==null||o.partial===!0;t.range[s]=b.getBufferedTimes(u,e,d,i)}}),t.backtrack=t.loaded=null,Object.keys(t.range).length?t.buffered=!0:this.removeFragment(t.body))}},f.fragBuffered=function(g){var b=l(g),T=this.fragments[b];T&&(T.backtrack=T.loaded=null,T.buffered=!0)},f.getBufferedTimes=function(g,b,T,u){for(var e={time:[],partial:T},n=b?b.start:g.start,t=b?b.end:g.end,s=g.minEndPTS||t,o=g.maxStartPTS||n,i=0;i<u.length;i++){var d=u.start(i)-this.bufferPadding,m=u.end(i)+this.bufferPadding;if(o>=d&&s<=m){e.time.push({startPTS:Math.max(n,u.start(i)),endPTS:Math.min(t,u.end(i))});break}if(n<m&&t>d)e.partial=!0,e.time.push({startPTS:Math.max(n,u.start(i)),endPTS:Math.min(t,u.end(i))});else if(t<=d)break}return e},f.getPartialFragment=function(g){var b,T,u,e=null,n=0,t=this.bufferPadding,s=this.fragments;return Object.keys(s).forEach(function(o){var i=s[o];i&&_(i)&&(T=i.body.start-t,u=i.body.end+t,g>=T&&g<=u&&(b=Math.min(g-T,u-g),n<=b&&(e=i.body,n=b)))}),e},f.getState=function(g){var b=l(g),T=this.fragments[b];return T?T.buffered?_(T)?D.PARTIAL:D.OK:T.backtrack?D.BACKTRACKED:D.APPENDING:D.NOT_LOADED},f.backtrack=function(g,b){var T=l(g),u=this.fragments[T];if(!u||u.backtrack)return null;var e=u.backtrack=b||u.loaded;return u.loaded=null,e},f.getBacktrackData=function(g){var b=l(g),T=this.fragments[b];if(T){var u,e=T.backtrack;if(e!=null&&(u=e.payload)!==null&&u!==void 0&&u.byteLength)return e;this.removeFragment(g)}return null},f.isTimeBuffered=function(g,b,T){for(var u,e,n=0;n<T.length;n++){if(u=T.start(n)-this.bufferPadding,e=T.end(n)+this.bufferPadding,g>=u&&b<=e)return!0;if(b<=u)return!1}return!1},f.onFragLoaded=function(g,b){var T=b.frag,u=b.part;if(T.sn!=="initSegment"&&!T.bitrateTest&&!u){var e=l(T);this.fragments[e]={body:T,loaded:b,backtrack:null,buffered:!1,range:Object.create(null)}}},f.onBufferAppended=function(g,b){var T=this,u=b.frag,e=b.part,n=b.timeRanges;if(u.type===R.PlaylistLevelType.MAIN)if(this.activeFragment=u,e){var t=this.activeParts;t||(this.activeParts=t=[]),t.push(e)}else this.activeParts=null;this.timeRanges=n,Object.keys(n).forEach(function(s){var o=n[s];if(T.detectEvictedFragments(s,o),!e)for(var i=0;i<o.length;i++)u.appendedPTS=Math.max(o.end(i),u.appendedPTS||0)})},f.onFragBuffered=function(g,b){this.detectPartialFragments(b)},f.hasFragment=function(g){var b=l(g);return!!this.fragments[b]},f.removeFragmentsInRange=function(g,b,T){var u=this;Object.keys(this.fragments).forEach(function(e){var n=u.fragments[e];if(n&&n.buffered){var t=n.body;t.type===T&&t.start<b&&t.end>g&&u.removeFragment(t)}})},f.removeFragment=function(g){var b=l(g);g.stats.loaded=0,g.clearElementaryStreamInfo(),delete this.fragments[b]},f.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},E}();function _(E){var f,g;return E.buffered&&(((f=E.range.video)===null||f===void 0?void 0:f.partial)||((g=E.range.audio)===null||g===void 0?void 0:g.partial))}function l(E){return E.type+"_"+E.level+"_"+E.urlId+"_"+E.sn}},"./src/controller/gap-controller.ts":function(F,I,v){v.r(I),v.d(I,"STALL_MINIMUM_DURATION_MS",function(){return w}),v.d(I,"MAX_START_GAP_JUMP",function(){return _}),v.d(I,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return l}),v.d(I,"SKIP_BUFFER_RANGE_START",function(){return E}),v.d(I,"default",function(){return f});var D=v("./src/utils/buffer-helper.ts"),h=v("./src/errors.ts"),k=v("./src/events.ts"),R=v("./src/utils/logger.ts"),w=250,_=2,l=.1,E=.05,f=function(){function g(T,u,e,n){this.config=void 0,this.media=void 0,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=T,this.media=u,this.fragmentTracker=e,this.hls=n}var b=g.prototype;return b.destroy=function(){this.hls=this.fragmentTracker=this.media=null},b.poll=function(T){var u=this.config,e=this.media,n=this.stalled,t=e.currentTime,s=e.seeking,o=this.seeking&&!s,i=!this.seeking&&s;if(this.seeking=s,t===T){if((i||o)&&(this.stalled=null),!e.paused&&!e.ended&&e.playbackRate!==0&&D.BufferHelper.getBuffered(e).length){var d=D.BufferHelper.bufferInfo(e,t,0),m=d.len>0,p=d.nextStart||0;if(m||p){if(s){var y=d.len>_,r=!p||p-t>_&&!this.fragmentTracker.getPartialFragment(t);if(y||r)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var a,c=Math.max(p,d.start||0)-t,L=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,S=!(L==null||(a=L.details)===null||a===void 0)&&a.live?2*L.details.targetduration:_;if(c>0&&c<=S)return void this._trySkipBufferHole(null)}var A=self.performance.now();if(n!==null){var x=A-n;!s&&x>=w&&this._reportStall(d.len);var C=D.BufferHelper.bufferInfo(e,t,u.maxBufferHole);this._tryFixBufferStall(C,x)}else this.stalled=A}}}else if(this.moved=!0,n!==null){if(this.stallReported){var O=self.performance.now()-n;R.logger.warn("playback not stuck anymore @"+t+", after "+Math.round(O)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}},b._tryFixBufferStall=function(T,u){var e=this.config,n=this.fragmentTracker,t=this.media.currentTime,s=n.getPartialFragment(t);s&&this._trySkipBufferHole(s)||T.len>e.maxBufferHole&&u>1e3*e.highBufferWatchdogPeriod&&(R.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},b._reportStall=function(T){var u=this.hls,e=this.media;this.stallReported||(this.stallReported=!0,R.logger.warn("Playback stalling at @"+e.currentTime+" due to low buffer (buffer="+T+")"),u.trigger(k.Events.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:T}))},b._trySkipBufferHole=function(T){for(var u=this.config,e=this.hls,n=this.media,t=n.currentTime,s=0,o=D.BufferHelper.getBuffered(n),i=0;i<o.length;i++){var d=o.start(i);if(t+u.maxBufferHole>=s&&t<d){var m=Math.max(d+E,n.currentTime+l);return R.logger.warn("skipping hole, adjusting currentTime from "+t+" to "+m),this.moved=!0,this.stalled=null,n.currentTime=m,T&&e.trigger(k.Events.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+t+" to "+m,frag:T}),m}s=o.end(i)}return 0},b._tryNudgeBuffer=function(){var T=this.config,u=this.hls,e=this.media,n=e.currentTime,t=(this.nudgeRetry||0)+1;if(this.nudgeRetry=t,t<T.nudgeMaxRetry){var s=n+t*T.nudgeOffset;R.logger.warn("Nudging 'currentTime' from "+n+" to "+s),e.currentTime=s,u.trigger(k.Events.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else R.logger.error("Playhead still not moving while enough data buffered @"+n+" after "+T.nudgeMaxRetry+" nudges"),u.trigger(k.Events.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},g}()},"./src/controller/id3-track-controller.ts":function(F,I,v){v.r(I);var D=v("./src/events.ts"),h=v("./src/utils/texttrack-utils.ts"),k=v("./src/demux/id3.ts"),R=function(){function w(l){this.hls=void 0,this.id3Track=null,this.media=null,this.hls=l,this._registerListeners()}var _=w.prototype;return _.destroy=function(){this._unregisterListeners()},_._registerListeners=function(){var l=this.hls;l.on(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),l.on(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),l.on(D.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),l.on(D.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},_._unregisterListeners=function(){var l=this.hls;l.off(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),l.off(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),l.off(D.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),l.off(D.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},_.onMediaAttached=function(l,E){this.media=E.media},_.onMediaDetaching=function(){this.id3Track&&(Object(h.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null)},_.getID3Track=function(l){if(this.media){for(var E=0;E<l.length;E++){var f=l[E];if(f.kind==="metadata"&&f.label==="id3")return Object(h.sendAddTrackEvent)(f,this.media),f}return this.media.addTextTrack("metadata","id3")}},_.onFragParsingMetadata=function(l,E){if(this.media){var f=E.frag,g=E.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var b=self.WebKitDataCue||self.VTTCue||self.TextTrackCue,T=0;T<g.length;T++){var u=k.getID3Frames(g[T].data);if(u){var e=g[T].pts,n=T<g.length-1?g[T+1].pts:f.end;n-e<=0&&(n=e+.25);for(var t=0;t<u.length;t++){var s=u[t];if(!k.isTimeStampFrame(s)){var o=new b(e,n,"");o.value=s,this.id3Track.addCue(o)}}}}}},_.onBufferFlushing=function(l,E){var f=E.startOffset,g=E.endOffset,b=E.type;if(!b||b==="audio"){var T=this.id3Track;T&&Object(h.removeCuesInRange)(T,f,g)}},w}();I.default=R},"./src/controller/latency-controller.ts":function(F,I,v){v.r(I),v.d(I,"default",function(){return w});var D=v("./src/errors.ts"),h=v("./src/events.ts"),k=v("./src/utils/logger.ts");function R(_,l){for(var E=0;E<l.length;E++){var f=l[E];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(_,f.key,f)}}var w=function(){function _(g){var b=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return b.timeupdate()},this.hls=g,this.config=g.config,this.registerListeners()}var l,E,f=_.prototype;return f.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},f.registerListeners=function(){this.hls.on(h.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(h.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(h.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(h.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(h.Events.ERROR,this.onError,this)},f.unregisterListeners=function(){this.hls.off(h.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(h.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(h.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(h.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(h.Events.ERROR,this.onError)},f.onMediaAttached=function(g,b){this.media=b.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},f.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},f.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},f.onLevelUpdated=function(g,b){var T=b.details;this.levelDetails=T,T.advanced&&this.timeupdate(),!T.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},f.onError=function(g,b){b.details===D.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,k.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},f.timeupdate=function(){var g=this.media,b=this.levelDetails;if(g&&b){this.currentTime=g.currentTime;var T=this.computeLatency();if(T!==null){this._latency=T;var u=this.config,e=u.lowLatencyMode,n=u.maxLiveSyncPlaybackRate;if(e&&n!==1){var t=this.targetLatency;if(t!==null){var s=T-t,o=s<Math.min(this.maxLatency,t+b.targetduration);if(b.live&&o&&s>.05&&this.forwardBufferLength>1){var i=Math.min(2,Math.max(1,n)),d=Math.round(2/(1+Math.exp(-.75*s-this.edgeStalled))*20)/20;g.playbackRate=Math.min(i,Math.max(1,d))}else g.playbackRate!==1&&g.playbackRate!==0&&(g.playbackRate=1)}}}}},f.estimateLiveEdge=function(){var g=this.levelDetails;return g===null?null:g.edge+g.age},f.computeLatency=function(){var g=this.estimateLiveEdge();return g===null?null:g-this.currentTime},l=_,(E=[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var g=this.config,b=this.levelDetails;return g.liveMaxLatencyDuration!==void 0?g.liveMaxLatencyDuration:b?g.liveMaxLatencyDurationCount*b.targetduration:0}},{key:"targetLatency",get:function(){var g=this.levelDetails;if(g===null)return null;var b=g.holdBack,T=g.partHoldBack,u=g.targetduration,e=this.config,n=e.liveSyncDuration,t=e.liveSyncDurationCount,s=e.lowLatencyMode,o=this.hls.userConfig,i=s&&T||b;(o.liveSyncDuration||o.liveSyncDurationCount||i===0)&&(i=n!==void 0?n:t*u);var d=u;return i+Math.min(1*this.stallCount,d)}},{key:"liveSyncPosition",get:function(){var g=this.estimateLiveEdge(),b=this.targetLatency,T=this.levelDetails;if(g===null||b===null||T===null)return null;var u=T.edge,e=g-b-this.edgeStalled,n=u-T.totalduration,t=u-(this.config.lowLatencyMode&&T.partTarget||T.targetduration);return Math.min(Math.max(n,e),t)}},{key:"drift",get:function(){var g=this.levelDetails;return g===null?1:g.drift}},{key:"edgeStalled",get:function(){var g=this.levelDetails;if(g===null)return 0;var b=3*(this.config.lowLatencyMode&&g.partTarget||g.targetduration);return Math.max(g.age-b,0)}},{key:"forwardBufferLength",get:function(){var g=this.media,b=this.levelDetails;if(!g||!b)return 0;var T=g.buffered.length;return T?g.buffered.end(T-1):b.edge-this.currentTime}}])&&R(l.prototype,E),_}()},"./src/controller/level-controller.ts":function(F,I,v){v.r(I),v.d(I,"default",function(){return T});var D=v("./src/types/level.ts"),h=v("./src/events.ts"),k=v("./src/errors.ts"),R=v("./src/utils/codecs.ts"),w=v("./src/controller/level-helper.ts"),_=v("./src/controller/base-playlist-controller.ts"),l=v("./src/types/loader.ts");function E(){return(E=Object.assign||function(u){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(u[t]=n[t])}return u}).apply(this,arguments)}function f(u,e){for(var n=0;n<e.length;n++){var t=e[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(u,t.key,t)}}function g(u,e){return(g=Object.setPrototypeOf||function(n,t){return n.__proto__=t,n})(u,e)}var b=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),T=function(u){var e,n;function t(d){var m;return(m=u.call(this,d,"[level-controller]")||this)._levels=[],m._firstLevel=-1,m._startLevel=void 0,m.currentLevelIndex=-1,m.manualLevelIndex=-1,m.onParsedComplete=void 0,m._registerListeners(),m}n=u,(e=t).prototype=Object.create(n.prototype),e.prototype.constructor=e,g(e,n);var s,o,i=t.prototype;return i._registerListeners=function(){var d=this.hls;d.on(h.Events.MANIFEST_LOADED,this.onManifestLoaded,this),d.on(h.Events.LEVEL_LOADED,this.onLevelLoaded,this),d.on(h.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),d.on(h.Events.FRAG_LOADED,this.onFragLoaded,this),d.on(h.Events.ERROR,this.onError,this)},i._unregisterListeners=function(){var d=this.hls;d.off(h.Events.MANIFEST_LOADED,this.onManifestLoaded,this),d.off(h.Events.LEVEL_LOADED,this.onLevelLoaded,this),d.off(h.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),d.off(h.Events.FRAG_LOADED,this.onFragLoaded,this),d.off(h.Events.ERROR,this.onError,this)},i.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,u.prototype.destroy.call(this)},i.startLoad=function(){this._levels.forEach(function(d){d.loadError=0}),u.prototype.startLoad.call(this)},i.onManifestLoaded=function(d,m){var p,y,r=[],a=[],c=[],L={},S=!1,A=!1,x=!1;if(m.levels.forEach(function(M){var N=M.attrs;S=S||!(!M.width||!M.height),A=A||!!M.videoCodec,x=x||!!M.audioCodec,b&&M.audioCodec&&M.audioCodec.indexOf("mp4a.40.34")!==-1&&(M.audioCodec=void 0);var B=M.bitrate+"-"+M.attrs.RESOLUTION+"-"+M.attrs.CODECS;(y=L[B])?y.url.push(M.url):(y=new D.Level(M),L[B]=y,r.push(y)),N&&(N.AUDIO&&Object(w.addGroupId)(y,"audio",N.AUDIO),N.SUBTITLES&&Object(w.addGroupId)(y,"text",N.SUBTITLES))}),(S||A)&&x&&(r=r.filter(function(M){var N=M.videoCodec,B=M.width,U=M.height;return!!N||!(!B||!U)})),r=r.filter(function(M){var N=M.audioCodec,B=M.videoCodec;return(!N||Object(R.isCodecSupportedInMp4)(N,"audio"))&&(!B||Object(R.isCodecSupportedInMp4)(B,"video"))}),m.audioTracks&&(a=m.audioTracks.filter(function(M){return!M.audioCodec||Object(R.isCodecSupportedInMp4)(M.audioCodec,"audio")}),Object(w.assignTrackIdsByGroup)(a)),m.subtitles&&(c=m.subtitles,Object(w.assignTrackIdsByGroup)(c)),r.length>0){p=r[0].bitrate,r.sort(function(M,N){return M.bitrate-N.bitrate}),this._levels=r;for(var C=0;C<r.length;C++)if(r[C].bitrate===p){this._firstLevel=C,this.log("manifest loaded, "+r.length+" level(s) found, first bitrate: "+p);break}var O=x&&!A,P={levels:r,audioTracks:a,subtitleTracks:c,firstLevel:this._firstLevel,stats:m.stats,audio:x,video:A,altAudio:!O&&a.some(function(M){return!!M.url})};this.hls.trigger(h.Events.MANIFEST_PARSED,P),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(h.Events.ERROR,{type:k.ErrorTypes.MEDIA_ERROR,details:k.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:m.url,reason:"no level with compatible codecs found in manifest"})},i.onError=function(d,m){if(u.prototype.onError.call(this,d,m),!m.fatal){var p=m.context,y=this._levels[this.currentLevelIndex];if(p&&(p.type===l.PlaylistContextType.AUDIO_TRACK&&y.audioGroupIds&&p.groupId===y.audioGroupIds[y.urlId]||p.type===l.PlaylistContextType.SUBTITLE_TRACK&&y.textGroupIds&&p.groupId===y.textGroupIds[y.urlId]))this.redundantFailover(this.currentLevelIndex);else{var r,a=!1,c=!0;switch(m.details){case k.ErrorDetails.FRAG_LOAD_ERROR:case k.ErrorDetails.FRAG_LOAD_TIMEOUT:case k.ErrorDetails.KEY_LOAD_ERROR:case k.ErrorDetails.KEY_LOAD_TIMEOUT:if(m.frag){var L=this._levels[m.frag.level];L?(L.fragmentError++,L.fragmentError>this.hls.config.fragLoadingMaxRetry&&(r=m.frag.level)):r=m.frag.level}break;case k.ErrorDetails.LEVEL_LOAD_ERROR:case k.ErrorDetails.LEVEL_LOAD_TIMEOUT:p&&(p.deliveryDirectives&&(c=!1),r=p.level),a=!0;break;case k.ErrorDetails.REMUX_ALLOC_ERROR:r=m.level,a=!0}r!==void 0&&this.recoverLevel(m,r,a,c)}}},i.recoverLevel=function(d,m,p,y){var r=d.details,a=this._levels[m];if(a.loadError++,p){if(!this.retryLoadingOrFail(d))return void(this.currentLevelIndex=-1);d.levelRetry=!0}if(y){var c=a.url.length;if(c>1&&a.loadError<c)d.levelRetry=!0,this.redundantFailover(m);else if(this.manualLevelIndex===-1){var L=m===0?this._levels.length-1:m-1;this.currentLevelIndex!==L&&this._levels[L].loadError===0&&(this.warn(r+": switch to "+L),d.levelRetry=!0,this.hls.nextAutoLevel=L)}}},i.redundantFailover=function(d){var m=this._levels[d],p=m.url.length;if(p>1){var y=(m.urlId+1)%p;this.warn("Switching to redundant URL-id "+y),this._levels.forEach(function(r){r.urlId=y}),this.level=d}},i.onFragLoaded=function(d,m){var p=m.frag;if(p!==void 0&&p.type===l.PlaylistLevelType.MAIN){var y=this._levels[p.level];y!==void 0&&(y.fragmentError=0,y.loadError=0)}},i.onLevelLoaded=function(d,m){var p,y,r=m.level,a=m.details,c=this._levels[r];if(!c)return this.warn("Invalid level index "+r),void((y=m.deliveryDirectives)!==null&&y!==void 0&&y.skip&&(a.deltaUpdateFailed=!0));r===this.currentLevelIndex?(c.fragmentError===0&&(c.loadError=0,this.retryCount=0),this.playlistLoaded(r,m,c.details)):(p=m.deliveryDirectives)!==null&&p!==void 0&&p.skip&&(a.deltaUpdateFailed=!0)},i.onAudioTrackSwitched=function(d,m){var p=this.hls.levels[this.currentLevelIndex];if(p&&p.audioGroupIds){for(var y=-1,r=this.hls.audioTracks[m.id].groupId,a=0;a<p.audioGroupIds.length;a++)if(p.audioGroupIds[a]===r){y=a;break}y!==p.urlId&&(p.urlId=y,this.startLoad())}},i.loadPlaylist=function(d){var m=this.currentLevelIndex,p=this._levels[m];if(this.canLoad&&p&&p.url.length>0){var y=p.urlId,r=p.url[y];if(d)try{r=d.addDirectives(r)}catch(a){this.warn("Could not construct new URL with HLS Delivery Directives: "+a)}this.log("Attempt loading level index "+m+(d?" at sn "+d.msn+" part "+d.part:"")+" with URL-id "+y+" "+r),this.clearTimer(),this.hls.trigger(h.Events.LEVEL_LOADING,{url:r,level:m,id:y,deliveryDirectives:d||null})}},i.removeLevel=function(d,m){var p=function(r,a){return a!==m},y=this._levels.filter(function(r,a){return a!==d||r.url.length>1&&m!==void 0&&(r.url=r.url.filter(p),r.audioGroupIds&&(r.audioGroupIds=r.audioGroupIds.filter(p)),r.textGroupIds&&(r.textGroupIds=r.textGroupIds.filter(p)),r.urlId=0,!0)}).map(function(r,a){var c=r.details;return c!=null&&c.fragments&&c.fragments.forEach(function(L){L.level=a}),r});this._levels=y,this.hls.trigger(h.Events.LEVELS_UPDATED,{levels:y})},s=t,(o=[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(d){var m,p=this._levels;if(p.length!==0&&(this.currentLevelIndex!==d||(m=p[d])===null||m===void 0||!m.details)){if(d<0||d>=p.length){var y=d<0;if(this.hls.trigger(h.Events.ERROR,{type:k.ErrorTypes.OTHER_ERROR,details:k.ErrorDetails.LEVEL_SWITCH_ERROR,level:d,fatal:y,reason:"invalid level idx"}),y)return;d=Math.min(d,p.length-1)}this.clearTimer();var r=this.currentLevelIndex,a=p[r],c=p[d];this.log("switching to level "+d+" from "+r),this.currentLevelIndex=d;var L=E({},c,{level:d,maxBitrate:c.maxBitrate,uri:c.uri,urlId:c.urlId});delete L._urlId,this.hls.trigger(h.Events.LEVEL_SWITCHING,L);var S=c.details;if(!S||S.live){var A=this.switchParams(c.uri,a==null?void 0:a.details);this.loadPlaylist(A)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(d){this.manualLevelIndex=d,this._startLevel===void 0&&(this._startLevel=d),d!==-1&&(this.level=d)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(d){this._firstLevel=d}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var d=this.hls.config.startLevel;return d!==void 0?d:this._firstLevel}return this._startLevel},set:function(d){this._startLevel=d}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(d){this.level=d,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=d)}}])&&f(s.prototype,o),t}(_.default)},"./src/controller/level-helper.ts":function(F,I,v){v.r(I),v.d(I,"addGroupId",function(){return k}),v.d(I,"assignTrackIdsByGroup",function(){return R}),v.d(I,"updatePTS",function(){return w}),v.d(I,"updateFragPTSDTS",function(){return l}),v.d(I,"mergeDetails",function(){return E}),v.d(I,"mapPartIntersection",function(){return f}),v.d(I,"mapFragmentIntersection",function(){return g}),v.d(I,"adjustSliding",function(){return b}),v.d(I,"addSliding",function(){return T}),v.d(I,"computeReloadInterval",function(){return u}),v.d(I,"getFragmentWithSN",function(){return e}),v.d(I,"getPartWith",function(){return n});var D=v("./src/polyfills/number.ts"),h=v("./src/utils/logger.ts");function k(t,s,o){switch(s){case"audio":t.audioGroupIds||(t.audioGroupIds=[]),t.audioGroupIds.push(o);break;case"text":t.textGroupIds||(t.textGroupIds=[]),t.textGroupIds.push(o)}}function R(t){var s={};t.forEach(function(o){var i=o.groupId||"";o.id=s[i]=s[i]||0,s[i]++})}function w(t,s,o){_(t[s],t[o])}function _(t,s){var o=s.startPTS;if(Object(D.isFiniteNumber)(o)){var i,d=0;s.sn>t.sn?(d=o-t.start,i=t):(d=t.start-o,i=s),i.duration!==d&&(i.duration=d)}else s.sn>t.sn?t.cc===s.cc&&t.minEndPTS?s.start=t.start+(t.minEndPTS-t.start):s.start=t.start+t.duration:s.start=Math.max(t.start-s.duration,0)}function l(t,s,o,i,d,m){i-o<=0&&(h.logger.warn("Fragment should have a positive duration",s),i=o+s.duration,m=d+s.duration);var p=o,y=i,r=s.startPTS,a=s.endPTS;if(Object(D.isFiniteNumber)(r)){var c=Math.abs(r-o);Object(D.isFiniteNumber)(s.deltaPTS)?s.deltaPTS=Math.max(c,s.deltaPTS):s.deltaPTS=c,p=Math.max(o,r),o=Math.min(o,r),d=Math.min(d,s.startDTS),y=Math.min(i,a),i=Math.max(i,a),m=Math.max(m,s.endDTS)}s.duration=i-o;var L=o-s.start;s.appendedPTS=i,s.start=s.startPTS=o,s.maxStartPTS=p,s.startDTS=d,s.endPTS=i,s.minEndPTS=y,s.endDTS=m;var S,A=s.sn;if(!t||A<t.startSN||A>t.endSN)return 0;var x=A-t.startSN,C=t.fragments;for(C[x]=s,S=x;S>0;S--)_(C[S],C[S-1]);for(S=x;S<C.length-1;S++)_(C[S],C[S+1]);return t.fragmentHint&&_(C[C.length-1],t.fragmentHint),t.PTSKnown=t.alignedSliding=!0,L}function E(t,s){for(var o=null,i=t.fragments,d=i.length-1;d>=0;d--){var m=i[d].initSegment;if(m){o=m;break}}t.fragmentHint&&delete t.fragmentHint.endPTS;var p,y=0;if(g(t,s,function(A,x){var C;A.relurl&&(y=A.cc-x.cc),Object(D.isFiniteNumber)(A.startPTS)&&Object(D.isFiniteNumber)(A.endPTS)&&(x.start=x.startPTS=A.startPTS,x.startDTS=A.startDTS,x.appendedPTS=A.appendedPTS,x.maxStartPTS=A.maxStartPTS,x.endPTS=A.endPTS,x.endDTS=A.endDTS,x.minEndPTS=A.minEndPTS,x.duration=A.endPTS-A.startPTS,x.duration&&(p=x),s.PTSKnown=s.alignedSliding=!0),x.elementaryStreams=A.elementaryStreams,x.loader=A.loader,x.stats=A.stats,x.urlId=A.urlId,A.initSegment?(x.initSegment=A.initSegment,o=A.initSegment):x.initSegment&&x.initSegment.relurl!=((C=o)===null||C===void 0?void 0:C.relurl)||(x.initSegment=o)}),s.skippedSegments&&(s.deltaUpdateFailed=s.fragments.some(function(A){return!A}),s.deltaUpdateFailed)){h.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var r=s.skippedSegments;r--;)s.fragments.shift();s.startSN=s.fragments[0].sn,s.startCC=s.fragments[0].cc}var a=s.fragments;if(y){h.logger.warn("discontinuity sliding from playlist, take drift into account");for(var c=0;c<a.length;c++)a[c].cc+=y}s.skippedSegments&&(s.startCC=s.fragments[0].cc),f(t.partList,s.partList,function(A,x){x.elementaryStreams=A.elementaryStreams,x.stats=A.stats}),p?l(s,p,p.startPTS,p.endPTS,p.startDTS,p.endDTS):b(t,s),a.length&&(s.totalduration=s.edge-a[0].start),s.driftStartTime=t.driftStartTime,s.driftStart=t.driftStart;var L=s.advancedDateTime;if(s.advanced&&L){var S=s.edge;s.driftStart||(s.driftStartTime=L,s.driftStart=S),s.driftEndTime=L,s.driftEnd=S}else s.driftEndTime=t.driftEndTime,s.driftEnd=t.driftEnd,s.advancedDateTime=t.advancedDateTime}function f(t,s,o){if(t&&s)for(var i=0,d=0,m=t.length;d<=m;d++){var p=t[d],y=s[d+i];p&&y&&p.index===y.index&&p.fragment.sn===y.fragment.sn?o(p,y):i--}}function g(t,s,o){for(var i=s.skippedSegments,d=Math.max(t.startSN,s.startSN)-s.startSN,m=(t.fragmentHint?1:0)+(i?s.endSN:Math.min(t.endSN,s.endSN))-s.startSN,p=s.startSN-t.startSN,y=s.fragmentHint?s.fragments.concat(s.fragmentHint):s.fragments,r=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,a=d;a<=m;a++){var c=r[p+a],L=y[a];i&&!L&&a<i&&(L=s.fragments[a]=c),c&&L&&o(c,L)}}function b(t,s){var o=s.startSN+s.skippedSegments-t.startSN,i=t.fragments;o<0||o>=i.length||T(s,i[o].start)}function T(t,s){if(s){for(var o=t.fragments,i=t.skippedSegments;i<o.length;i++)o[i].start+=s;t.fragmentHint&&(t.fragmentHint.start+=s)}}function u(t,s){var o,i=1e3*t.levelTargetDuration,d=i/2,m=t.age,p=m>0&&m<3*i,y=s.loading.end-s.loading.start,r=t.availabilityDelay;if(t.updated===!1)if(p){var a=333*t.misses;o=Math.max(Math.min(d,2*y),a),t.availabilityDelay=(t.availabilityDelay||0)+o}else o=d;else p?(r=Math.min(r||i/2,m),t.availabilityDelay=r,o=r+i-m):o=i-y;return Math.round(o)}function e(t,s,o){if(!t||!t.details)return null;var i=t.details,d=i.fragments[s-i.startSN];return d||((d=i.fragmentHint)&&d.sn===s?d:s<i.startSN&&o&&o.sn===s?o:null)}function n(t,s,o){if(!t||!t.details)return null;var i=t.details.partList;if(i)for(var d=i.length;d--;){var m=i[d];if(m.index===o&&m.fragment.sn===s)return m}return null}},"./src/controller/stream-controller.ts":function(F,I,v){v.r(I),v.d(I,"default",function(){return t});var D=v("./src/polyfills/number.ts"),h=v("./src/controller/base-stream-controller.ts"),k=v("./src/is-supported.ts"),R=v("./src/events.ts"),w=v("./src/utils/buffer-helper.ts"),_=v("./src/controller/fragment-tracker.ts"),l=v("./src/types/loader.ts"),E=v("./src/loader/fragment.ts"),f=v("./src/demux/transmuxer-interface.ts"),g=v("./src/types/transmuxer.ts"),b=v("./src/controller/gap-controller.ts"),T=v("./src/errors.ts"),u=v("./src/utils/logger.ts");function e(s,o){for(var i=0;i<o.length;i++){var d=o[i];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(s,d.key,d)}}function n(s,o){return(n=Object.setPrototypeOf||function(i,d){return i.__proto__=d,i})(s,o)}var t=function(s){var o,i;function d(r,a){var c;return(c=s.call(this,r,a,"[stream-controller]")||this).audioCodecSwap=!1,c.gapController=null,c.level=-1,c._forceStartLoad=!1,c.altAudio=!1,c.audioOnly=!1,c.fragPlaying=null,c.onvplaying=null,c.onvseeked=null,c.fragLastKbps=0,c.stalled=!1,c.couldBacktrack=!1,c.audioCodecSwitch=!1,c.videoBuffer=null,c._registerListeners(),c}i=s,(o=d).prototype=Object.create(i.prototype),o.prototype.constructor=o,n(o,i);var m,p,y=d.prototype;return y._registerListeners=function(){var r=this.hls;r.on(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.on(R.Events.LEVEL_LOADING,this.onLevelLoading,this),r.on(R.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.on(R.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),r.on(R.Events.ERROR,this.onError,this),r.on(R.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.on(R.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),r.on(R.Events.BUFFER_CREATED,this.onBufferCreated,this),r.on(R.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.on(R.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),r.on(R.Events.FRAG_BUFFERED,this.onFragBuffered,this)},y._unregisterListeners=function(){var r=this.hls;r.off(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.off(R.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.off(R.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),r.off(R.Events.ERROR,this.onError,this),r.off(R.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.off(R.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),r.off(R.Events.BUFFER_CREATED,this.onBufferCreated,this),r.off(R.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.off(R.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),r.off(R.Events.FRAG_BUFFERED,this.onFragBuffered,this)},y.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},y.startLoad=function(r){if(this.levels){var a=this.lastCurrentTime,c=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var L=c.startLevel;L===-1&&(c.config.testBandwidth?(L=0,this.bitrateTest=!0):L=c.nextAutoLevel),this.level=c.nextLoadLevel=L,this.loadedmetadata=!1}a>0&&r===-1&&(this.log("Override startPosition with lastCurrentTime @"+a.toFixed(3)),r=a),this.state=h.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=r,this.tick()}else this._forceStartLoad=!0,this.state=h.State.STOPPED},y.stopLoad=function(){this._forceStartLoad=!1,s.prototype.stopLoad.call(this)},y.doTick=function(){switch(this.state){case h.State.IDLE:this.doTickIdle();break;case h.State.WAITING_LEVEL:var r,a=this.levels,c=this.level,L=a==null||(r=a[c])===null||r===void 0?void 0:r.details;if(L&&(!L.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(L))break;this.state=h.State.IDLE;break}break;case h.State.FRAG_LOADING_WAITING_RETRY:var S,A=self.performance.now(),x=this.retryDate;(!x||A>=x||(S=this.media)!==null&&S!==void 0&&S.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=h.State.IDLE)}this.onTickEnd()},y.onTickEnd=function(){s.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},y.doTickIdle=function(){var r,a,c=this.hls,L=this.levelLastLoaded,S=this.levels,A=this.media,x=c.config,C=c.nextLoadLevel;if(L!==null&&(A||!this.startFragRequested&&x.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&S&&S[C]){var O=S[C];this.level=c.nextLoadLevel=C;var P=O.details;if(!P||this.state===h.State.WAITING_LEVEL||P.live&&this.levelLastLoaded!==C)this.state=h.State.WAITING_LEVEL;else{var M=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:A,l.PlaylistLevelType.MAIN);if(M!==null&&!(M.len>=this.getMaxBufferLength(O.maxBitrate))){if(this._streamEnded(M,P)){var N={};return this.altAudio&&(N.type="video"),this.hls.trigger(R.Events.BUFFER_EOS,N),void(this.state=h.State.ENDED)}var B=M.end,U=this.getNextFragment(B,P);if(this.couldBacktrack&&!this.fragPrevious&&U&&U.sn!=="initSegment"){var G=U.sn-P.startSN;G>1&&(U=P.fragments[G-1],this.fragmentTracker.removeFragment(U))}if(U&&this.fragmentTracker.getState(U)===_.FragmentState.OK&&this.nextLoadPosition>B){var z=this.audioOnly&&!this.altAudio?E.ElementaryStreamTypes.AUDIO:E.ElementaryStreamTypes.VIDEO;this.afterBufferFlushed(A,z,l.PlaylistLevelType.MAIN),U=this.getNextFragment(this.nextLoadPosition,P)}U&&(!U.initSegment||U.initSegment.data||this.bitrateTest||(U=U.initSegment),((r=U.decryptdata)===null||r===void 0?void 0:r.keyFormat)!=="identity"||(a=U.decryptdata)!==null&&a!==void 0&&a.key?this.loadFragment(U,P,B):this.loadKey(U,P))}}}},y.loadFragment=function(r,a,c){var L,S=this.fragmentTracker.getState(r);if(this.fragCurrent=r,S===_.FragmentState.BACKTRACKED){var A=this.fragmentTracker.getBacktrackData(r);if(A)return this._handleFragmentLoadProgress(A),void this._handleFragmentLoadComplete(A);S=_.FragmentState.NOT_LOADED}S===_.FragmentState.NOT_LOADED||S===_.FragmentState.PARTIAL?r.sn==="initSegment"?this._loadInitSegment(r):this.bitrateTest?(r.bitrateTest=!0,this.log("Fragment "+r.sn+" of level "+r.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(r)):(this.startFragRequested=!0,s.prototype.loadFragment.call(this,r,a,c)):S===_.FragmentState.APPENDING?this.reduceMaxBufferLength(r.duration)&&this.fragmentTracker.removeFragment(r):((L=this.media)===null||L===void 0?void 0:L.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},y.getAppendedFrag=function(r){var a=this.fragmentTracker.getAppendedFrag(r,l.PlaylistLevelType.MAIN);return a&&"fragment"in a?a.fragment:a},y.getBufferedFrag=function(r){return this.fragmentTracker.getBufferedFrag(r,l.PlaylistLevelType.MAIN)},y.followingBufferedFrag=function(r){return r?this.getBufferedFrag(r.end+.5):null},y.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},y.nextLevelSwitch=function(){var r=this.levels,a=this.media;if(a!=null&&a.readyState){var c,L=this.getAppendedFrag(a.currentTime);if(L&&L.start>1&&this.flushMainBuffer(0,L.start-1),!a.paused&&r){var S=r[this.hls.nextLoadLevel],A=this.fragLastKbps;c=A&&this.fragCurrent?this.fragCurrent.duration*S.maxBitrate/(1e3*A)+1:0}else c=0;var x=this.getBufferedFrag(a.currentTime+c);if(x){var C=this.followingBufferedFrag(x);if(C){this.abortCurrentFrag();var O=C.maxStartPTS?C.maxStartPTS:C.start,P=C.duration,M=Math.max(x.end,O+Math.min(Math.max(P-this.config.maxFragLookUpTolerance,.5*P),.75*P));this.flushMainBuffer(M,Number.POSITIVE_INFINITY)}}}},y.abortCurrentFrag=function(){var r=this.fragCurrent;this.fragCurrent=null,r!=null&&r.loader&&r.loader.abort(),this.state===h.State.KEY_LOADING&&(this.state=h.State.IDLE),this.nextLoadPosition=this.getLoadPosition()},y.flushMainBuffer=function(r,a){s.prototype.flushMainBuffer.call(this,r,a,this.altAudio?"video":null)},y.onMediaAttached=function(r,a){s.prototype.onMediaAttached.call(this,r,a);var c=a.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),c.addEventListener("playing",this.onvplaying),c.addEventListener("seeked",this.onvseeked),this.gapController=new b.default(this.config,c,this.fragmentTracker,this.hls)},y.onMediaDetaching=function(){var r=this.media;r&&(r.removeEventListener("playing",this.onvplaying),r.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),s.prototype.onMediaDetaching.call(this)},y.onMediaPlaying=function(){this.tick()},y.onMediaSeeked=function(){var r=this.media,a=r?r.currentTime:null;Object(D.isFiniteNumber)(a)&&this.log("Media seeked to "+a.toFixed(3)),this.tick()},y.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(R.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=this.stalled=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null},y.onManifestParsed=function(r,a){var c,L=!1,S=!1;a.levels.forEach(function(A){(c=A.audioCodec)&&(c.indexOf("mp4a.40.2")!==-1&&(L=!0),c.indexOf("mp4a.40.5")!==-1&&(S=!0))}),this.audioCodecSwitch=L&&S&&!Object(k.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=a.levels,this.startFragRequested=!1},y.onLevelLoading=function(r,a){var c=this.levels;if(c&&this.state===h.State.IDLE){var L=c[a.level];(!L.details||L.details.live&&this.levelLastLoaded!==a.level||this.waitForCdnTuneIn(L.details))&&(this.state=h.State.WAITING_LEVEL)}},y.onLevelLoaded=function(r,a){var c,L=this.levels,S=a.level,A=a.details,x=A.totalduration;if(L){this.log("Level "+S+" loaded ["+A.startSN+","+A.endSN+"], cc ["+A.startCC+", "+A.endCC+"] duration:"+x);var C=this.fragCurrent;!C||this.state!==h.State.FRAG_LOADING&&this.state!==h.State.FRAG_LOADING_WAITING_RETRY||C.level!==a.level&&C.loader&&(this.state=h.State.IDLE,C.loader.abort());var O=L[S],P=0;if(A.live||(c=O.details)!==null&&c!==void 0&&c.live){if(A.fragments[0]||(A.deltaUpdateFailed=!0),A.deltaUpdateFailed)return;P=this.alignPlaylists(A,O.details)}if(O.details=A,this.levelLastLoaded=S,this.hls.trigger(R.Events.LEVEL_UPDATED,{details:A,level:S}),this.state===h.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(A))return;this.state=h.State.IDLE}this.startFragRequested?A.live&&this.synchronizeToLiveEdge(A):this.setStartPosition(A,P),this.tick()}else this.warn("Levels were reset while loading level "+S)},y._handleFragmentLoadProgress=function(r){var a,c=r.frag,L=r.part,S=r.payload,A=this.levels;if(A){var x=A[c.level],C=x.details;if(C){var O=x.videoCodec,P=C.PTSKnown||!C.live,M=(a=c.initSegment)===null||a===void 0?void 0:a.data,N=this._getAudioCodec(x),B=this.transmuxer=this.transmuxer||new f.default(this.hls,l.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),U=L?L.index:-1,G=U!==-1,z=new g.ChunkMetadata(c.level,c.sn,c.stats.chunkCount,S.byteLength,U,G),Y=this.initPTS[c.cc];B.push(S,M,N,O,c,L,C.totalduration,P,z,Y)}else this.warn("Dropping fragment "+c.sn+" of level "+c.level+" after level details were reset")}else this.warn("Levels were reset while fragment load was in progress. Fragment "+c.sn+" of level "+c.level+" will not be buffered")},y.onAudioTrackSwitching=function(r,a){var c=this.altAudio,L=!!a.url,S=a.id;if(!L){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var A=this.fragCurrent;A!=null&&A.loader&&(this.log("Switching to main audio track, cancel main fragment load"),A.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var x=this.hls;c&&x.trigger(R.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),x.trigger(R.Events.AUDIO_TRACK_SWITCHED,{id:S})}},y.onAudioTrackSwitched=function(r,a){var c=a.id,L=!!this.hls.audioTracks[c].url;if(L){var S=this.videoBuffer;S&&this.mediaBuffer!==S&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=S)}this.altAudio=L,this.tick()},y.onBufferCreated=function(r,a){var c,L,S=a.tracks,A=!1;for(var x in S){var C=S[x];if(C.id==="main"){if(L=x,c=C,x==="video"){var O=S[x];O&&(this.videoBuffer=O.buffer)}}else A=!0}A&&c?(this.log("Alternate track found, use "+L+".buffered to schedule main fragment loading"),this.mediaBuffer=c.buffer):this.mediaBuffer=this.media},y.onFragBuffered=function(r,a){var c=a.frag,L=a.part;if(!c||c.type===l.PlaylistLevelType.MAIN){if(this.fragContextChanged(c))return this.warn("Fragment "+c.sn+(L?" p: "+L.index:"")+" of level "+c.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===h.State.PARSED&&(this.state=h.State.IDLE));var S=L?L.stats:c.stats;this.fragLastKbps=Math.round(8*S.total/(S.buffering.end-S.loading.first)),c.sn!=="initSegment"&&(this.fragPrevious=c),this.fragBufferedComplete(c,L)}},y.onError=function(r,a){switch(a.details){case T.ErrorDetails.FRAG_LOAD_ERROR:case T.ErrorDetails.FRAG_LOAD_TIMEOUT:case T.ErrorDetails.KEY_LOAD_ERROR:case T.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(l.PlaylistLevelType.MAIN,a);break;case T.ErrorDetails.LEVEL_LOAD_ERROR:case T.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==h.State.ERROR&&(a.fatal?(this.warn(""+a.details),this.state=h.State.ERROR):a.levelRetry||this.state!==h.State.WAITING_LEVEL||(this.state=h.State.IDLE));break;case T.ErrorDetails.BUFFER_FULL_ERROR:if(a.parent==="main"&&(this.state===h.State.PARSING||this.state===h.State.PARSED)){var c=!0,L=this.getFwdBufferInfo(this.media,l.PlaylistLevelType.MAIN);L&&L.len>.5&&(c=!this.reduceMaxBufferLength(L.len)),c&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}}},y.checkBuffer=function(){var r=this.media,a=this.gapController;if(r&&a&&r.readyState){var c=w.BufferHelper.getBuffered(r);!this.loadedmetadata&&c.length?(this.loadedmetadata=!0,this.seekToStartPos()):a.poll(this.lastCurrentTime),this.lastCurrentTime=r.currentTime}},y.onFragLoadEmergencyAborted=function(){this.state=h.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},y.onBufferFlushed=function(r,a){var c=a.type;if(c!==E.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var L=(c===E.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(L,c,l.PlaylistLevelType.MAIN)}},y.onLevelsUpdated=function(r,a){this.levels=a.levels},y.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},y.seekToStartPos=function(){var r=this.media,a=r.currentTime,c=this.startPosition;if(c>=0&&a<c){if(r.seeking)return void u.logger.log("could not seek to "+c+", already seeking at "+a);var L=w.BufferHelper.getBuffered(r),S=(L.length?L.start(0):0)-c;S>0&&S<this.config.maxBufferHole&&(u.logger.log("adjusting start position by "+S+" to match buffer start"),c+=S,this.startPosition=c),this.log("seek to target start position "+c+" from current time "+a),r.currentTime=c}},y._getAudioCodec=function(r){var a=this.config.defaultAudioCodec||r.audioCodec;return this.audioCodecSwap&&a&&(this.log("Swapping audio codec"),a=a.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),a},y._loadBitrateTestFrag=function(r){var a=this;this._doFragLoad(r).then(function(c){var L=a.hls;if(c&&!L.nextLoadLevel&&!a.fragContextChanged(r)){a.fragLoadError=0,a.state=h.State.IDLE,a.startFragRequested=!1,a.bitrateTest=!1;var S=r.stats;S.parsing.start=S.parsing.end=S.buffering.start=S.buffering.end=self.performance.now(),L.trigger(R.Events.FRAG_LOADED,c)}})},y._handleTransmuxComplete=function(r){var a,c="main",L=this.hls,S=r.remuxResult,A=r.chunkMeta,x=this.getCurrentContext(A);if(!x)return this.warn("The loading context changed while buffering fragment "+A.sn+" of level "+A.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(A.level);var C=x.frag,O=x.part,P=x.level,M=S.video,N=S.text,B=S.id3,U=S.initSegment,G=this.altAudio?void 0:S.audio;if(!this.fragContextChanged(C)){if(this.state=h.State.PARSING,U){U.tracks&&(this._bufferInitSegment(P,U.tracks,C,A),L.trigger(R.Events.FRAG_PARSING_INIT_SEGMENT,{frag:C,id:c,tracks:U.tracks}));var z=U.initPTS,Y=U.timescale;Object(D.isFiniteNumber)(z)&&(this.initPTS[C.cc]=z,L.trigger(R.Events.INIT_PTS_FOUND,{frag:C,id:c,initPTS:z,timescale:Y}))}if(M&&S.independent!==!1){if(P.details){var X=M.startPTS,$=M.endPTS,Z=M.startDTS,ue=M.endDTS;if(O)O.elementaryStreams[M.type]={startPTS:X,endPTS:$,startDTS:Z,endDTS:ue};else if(M.firstKeyFrame&&M.independent&&(this.couldBacktrack=!0),M.dropped&&M.independent){if(this.getLoadPosition()+this.config.maxBufferHole<X)return void this.backtrack(C);C.setElementaryStreamInfo(M.type,C.start,$,C.start,ue,!0)}C.setElementaryStreamInfo(M.type,X,$,Z,ue),this.bufferFragmentData(M,C,O,A)}}else if(S.independent===!1)return void this.backtrack(C);if(G){var de=G.startPTS,ve=G.endPTS,te=G.startDTS,fe=G.endDTS;O&&(O.elementaryStreams[E.ElementaryStreamTypes.AUDIO]={startPTS:de,endPTS:ve,startDTS:te,endDTS:fe}),C.setElementaryStreamInfo(E.ElementaryStreamTypes.AUDIO,de,ve,te,fe),this.bufferFragmentData(G,C,O,A)}if(B!=null&&(a=B.samples)!==null&&a!==void 0&&a.length){var ae={frag:C,id:c,samples:B.samples};L.trigger(R.Events.FRAG_PARSING_METADATA,ae)}if(N){var oe={frag:C,id:c,samples:N.samples};L.trigger(R.Events.FRAG_PARSING_USERDATA,oe)}}},y._bufferInitSegment=function(r,a,c,L){var S=this;if(this.state===h.State.PARSING){this.audioOnly=!!a.audio&&!a.video,this.altAudio&&!this.audioOnly&&delete a.audio;var A=a.audio,x=a.video,C=a.audiovideo;if(A){var O=r.audioCodec,P=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(O&&(O=O.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),A.metadata.channelCount!==1&&P.indexOf("firefox")===-1&&(O="mp4a.40.5")),P.indexOf("android")!==-1&&A.container!=="audio/mpeg"&&(O="mp4a.40.2",this.log("Android: force audio codec to "+O)),r.audioCodec&&r.audioCodec!==O&&this.log('Swapping manifest audio codec "'+r.audioCodec+'" for "'+O+'"'),A.levelCodec=O,A.id="main",this.log("Init audio buffer, container:"+A.container+", codecs[selected/level/parsed]=["+(O||"")+"/"+(r.audioCodec||"")+"/"+A.codec+"]")}x&&(x.levelCodec=r.videoCodec,x.id="main",this.log("Init video buffer, container:"+x.container+", codecs[level/parsed]=["+(r.videoCodec||"")+"/"+x.codec+"]")),C&&this.log("Init audiovideo buffer, container:"+C.container+", codecs[level/parsed]=["+(r.attrs.CODECS||"")+"/"+C.codec+"]"),this.hls.trigger(R.Events.BUFFER_CODECS,a),Object.keys(a).forEach(function(M){var N=a[M].initSegment;N!=null&&N.byteLength&&S.hls.trigger(R.Events.BUFFER_APPENDING,{type:M,data:N,frag:c,part:null,chunkMeta:L,parent:c.type})}),this.tick()}},y.backtrack=function(r){this.couldBacktrack=!0,this.resetTransmuxer(),this.flushBufferGap(r);var a=this.fragmentTracker.backtrack(r);this.fragPrevious=null,this.nextLoadPosition=r.start,a?this.resetFragmentLoading(r):this.state=h.State.BACKTRACKING},y.checkFragmentChanged=function(){var r=this.media,a=null;if(r&&r.readyState>1&&r.seeking===!1){var c=r.currentTime;if(w.BufferHelper.isBuffered(r,c)?a=this.getAppendedFrag(c):w.BufferHelper.isBuffered(r,c+.1)&&(a=this.getAppendedFrag(c+.1)),a){var L=this.fragPlaying,S=a.level;L&&a.sn===L.sn&&L.level===S&&a.urlId===L.urlId||(this.hls.trigger(R.Events.FRAG_CHANGED,{frag:a}),L&&L.level===S||this.hls.trigger(R.Events.LEVEL_SWITCHED,{level:S}),this.fragPlaying=a)}}},m=d,(p=[{key:"nextLevel",get:function(){var r=this.nextBufferedFrag;return r?r.level:-1}},{key:"currentLevel",get:function(){var r=this.media;if(r){var a=this.getAppendedFrag(r.currentTime);if(a)return a.level}return-1}},{key:"nextBufferedFrag",get:function(){var r=this.media;if(r){var a=this.getAppendedFrag(r.currentTime);return this.followingBufferedFrag(a)}return null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}])&&e(m.prototype,p),d}(h.default)},"./src/controller/subtitle-stream-controller.ts":function(F,I,v){v.r(I),v.d(I,"SubtitleStreamController",function(){return u});var D=v("./src/events.ts"),h=v("./src/utils/logger.ts"),k=v("./src/utils/buffer-helper.ts"),R=v("./src/controller/fragment-finders.ts"),w=v("./src/utils/discontinuities.ts"),_=v("./src/controller/level-helper.ts"),l=v("./src/controller/fragment-tracker.ts"),E=v("./src/controller/base-stream-controller.ts"),f=v("./src/types/loader.ts"),g=v("./src/types/level.ts");function b(e,n){for(var t=0;t<n.length;t++){var s=n[t];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function T(e,n){return(T=Object.setPrototypeOf||function(t,s){return t.__proto__=s,t})(e,n)}var u=function(e){var n,t;function s(m,p){var y;return(y=e.call(this,m,p,"[subtitle-stream-controller]")||this).levels=[],y.currentTrackId=-1,y.tracksBuffered=[],y.mainDetails=null,y._registerListeners(),y}t=e,(n=s).prototype=Object.create(t.prototype),n.prototype.constructor=n,T(n,t);var o,i,d=s.prototype;return d.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},d._registerListeners=function(){var m=this.hls;m.on(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),m.on(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),m.on(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),m.on(D.Events.LEVEL_LOADED,this.onLevelLoaded,this),m.on(D.Events.ERROR,this.onError,this),m.on(D.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),m.on(D.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),m.on(D.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),m.on(D.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),m.on(D.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},d._unregisterListeners=function(){var m=this.hls;m.off(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),m.off(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),m.off(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),m.off(D.Events.LEVEL_LOADED,this.onLevelLoaded,this),m.off(D.Events.ERROR,this.onError,this),m.off(D.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),m.off(D.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),m.off(D.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),m.off(D.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),m.off(D.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},d.startLoad=function(){this.stopLoad(),this.state=E.State.IDLE,this.setInterval(500),this.tick()},d.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},d.onLevelLoaded=function(m,p){this.mainDetails=p.details},d.onSubtitleFragProcessed=function(m,p){var y=p.frag,r=p.success;if(this.fragPrevious=y,this.state=E.State.IDLE,r){var a=this.tracksBuffered[this.currentTrackId];if(a){for(var c,L=y.start,S=0;S<a.length;S++)if(L>=a[S].start&&L<=a[S].end){c=a[S];break}var A=y.start+y.duration;c?c.end=A:(c={start:L,end:A},a.push(c)),this.fragmentTracker.fragBuffered(y)}}},d.onBufferFlushing=function(m,p){var y=p.startOffset,r=p.endOffset;if(y===0&&r!==Number.POSITIVE_INFINITY){var a=this.currentTrackId,c=this.levels;if(!c.length||!c[a]||!c[a].details)return;var L=r-c[a].details.targetduration;if(L<=0)return;p.endOffsetSubtitles=Math.max(0,L),this.tracksBuffered.forEach(function(S){for(var A=0;A<S.length;)if(S[A].end<=L)S.shift();else{if(!(S[A].start<L))break;S[A].start=L,A++}}),this.fragmentTracker.removeFragmentsInRange(y,L,f.PlaylistLevelType.SUBTITLE)}},d.onError=function(m,p){var y,r=p.frag;r&&r.type===f.PlaylistLevelType.SUBTITLE&&((y=this.fragCurrent)!==null&&y!==void 0&&y.loader&&this.fragCurrent.loader.abort(),this.state=E.State.IDLE)},d.onSubtitleTracksUpdated=function(m,p){var y=this,r=p.subtitleTracks;this.tracksBuffered=[],this.levels=r.map(function(a){return new g.Level(a)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(a){y.tracksBuffered[a.id]=[]}),this.mediaBuffer=null},d.onSubtitleTrackSwitch=function(m,p){if(this.currentTrackId=p.id,this.levels.length&&this.currentTrackId!==-1){var y=this.levels[this.currentTrackId];y!=null&&y.details?(this.mediaBuffer=this.mediaBufferTimeRanges,this.setInterval(500)):this.mediaBuffer=null}else this.clearInterval()},d.onSubtitleTrackLoaded=function(m,p){var y,r=p.details,a=p.id,c=this.currentTrackId,L=this.levels;if(L.length){var S=L[c];if(!(a>=L.length||a!==c)&&S){if(this.mediaBuffer=this.mediaBufferTimeRanges,r.live||(y=S.details)!==null&&y!==void 0&&y.live){var A=this.mainDetails;if(r.deltaUpdateFailed||!A)return;var x=A.fragments[0];S.details?this.alignPlaylists(r,S.details)===0&&x&&Object(_.addSliding)(r,x.start):r.hasProgramDateTime&&A.hasProgramDateTime?Object(w.alignPDT)(r,A):x&&Object(_.addSliding)(r,x.start)}S.details=r,this.levelLastLoaded=a,this.tick(),r.live&&!this.fragCurrent&&this.media&&this.state===E.State.IDLE&&(Object(R.findFragmentByPTS)(null,r.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),S.details=void 0))}}},d._handleFragmentLoadComplete=function(m){var p=m.frag,y=m.payload,r=p.decryptdata,a=this.hls;if(!this.fragContextChanged(p)&&y&&y.byteLength>0&&r&&r.key&&r.iv&&r.method==="AES-128"){var c=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(y),r.key.buffer,r.iv.buffer).then(function(L){var S=performance.now();a.trigger(D.Events.FRAG_DECRYPTED,{frag:p,payload:L,stats:{tstart:c,tdecrypt:S}})})}},d.doTick=function(){if(this.media){if(this.state===E.State.IDLE){var m,p=this.currentTrackId,y=this.levels;if(!y.length||!y[p]||!y[p].details)return;var r=y[p].details,a=r.targetduration,c=this.config,L=this.media,S=k.BufferHelper.bufferedInfo(this.mediaBufferTimeRanges,L.currentTime-a,c.maxBufferHole),A=S.end;if(S.len>this.getMaxBufferLength()+a)return;console.assert(r,"Subtitle track details are defined on idle subtitle stream controller tick");var x,C=r.fragments,O=C.length,P=r.edge,M=this.fragPrevious;if(A<P){var N=c.maxFragLookUpTolerance;M&&r.hasProgramDateTime&&(x=Object(R.findFragmentByPDT)(C,M.endProgramDateTime,N)),x||!(x=Object(R.findFragmentByPTS)(M,C,A,N))&&M&&M.start<C[0].start&&(x=C[0])}else x=C[O-1];(m=x)!==null&&m!==void 0&&m.encrypted?(h.logger.log("Loading key for "+x.sn),this.state=E.State.KEY_LOADING,this.hls.trigger(D.Events.KEY_LOADING,{frag:x})):x&&this.fragmentTracker.getState(x)===l.FragmentState.NOT_LOADED&&this.loadFragment(x,r,A)}}else this.state=E.State.IDLE},d.loadFragment=function(m,p,y){this.fragCurrent=m,e.prototype.loadFragment.call(this,m,p,y)},o=s,(i=[{key:"mediaBufferTimeRanges",get:function(){return this.tracksBuffered[this.currentTrackId]||[]}}])&&b(o.prototype,i),s}(E.default)},"./src/controller/subtitle-track-controller.ts":function(F,I,v){v.r(I);var D=v("./src/events.ts"),h=v("./src/utils/texttrack-utils.ts"),k=v("./src/controller/base-playlist-controller.ts"),R=v("./src/types/loader.ts");function w(f,g){for(var b=0;b<g.length;b++){var T=g[b];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(f,T.key,T)}}function _(f,g){return(_=Object.setPrototypeOf||function(b,T){return b.__proto__=T,b})(f,g)}var l=function(f){var g,b;function T(t){var s;return(s=f.call(this,t,"[subtitle-track-controller]")||this).media=null,s.tracks=[],s.groupId=null,s.tracksInGroup=[],s.trackId=-1,s.selectDefaultTrack=!0,s.queuedDefaultTrack=-1,s.trackChangeListener=function(){return s.onTextTracksChanged()},s.asyncPollTrackChange=function(){return s.pollTrackChange(0)},s.useTextTrackPolling=!1,s.subtitlePollingInterval=-1,s.subtitleDisplay=!0,s.registerListeners(),s}b=f,(g=T).prototype=Object.create(b.prototype),g.prototype.constructor=g,_(g,b);var u,e,n=T.prototype;return n.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,f.prototype.destroy.call(this)},n.registerListeners=function(){var t=this.hls;t.on(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(D.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(D.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(D.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(D.Events.ERROR,this.onError,this)},n.unregisterListeners=function(){var t=this.hls;t.off(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(D.Events.LEVEL_LOADING,this.onLevelLoading,this),t.off(D.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(D.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(D.Events.ERROR,this.onError,this)},n.onMediaAttached=function(t,s){this.media=s.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},n.pollTrackChange=function(t){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,t)},n.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),E(this.media.textTracks).forEach(function(t){Object(h.clearCurrentCues)(t)}),this.subtitleTrack=-1,this.media=null)},n.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},n.onManifestParsed=function(t,s){this.tracks=s.subtitleTracks},n.onSubtitleTrackLoaded=function(t,s){var o=s.id,i=s.details,d=this.trackId,m=this.tracksInGroup[d];if(m){var p=m.details;m.details=s.details,this.log("subtitle track "+o+" loaded ["+i.startSN+"-"+i.endSN+"]"),o===this.trackId&&(this.retryCount=0,this.playlistLoaded(o,s,p))}else this.warn("Invalid subtitle track id "+o)},n.onLevelLoading=function(t,s){this.switchLevel(s.level)},n.onLevelSwitching=function(t,s){this.switchLevel(s.level)},n.switchLevel=function(t){var s=this.hls.levels[t];if(s!=null&&s.textGroupIds){var o=s.textGroupIds[s.urlId];if(this.groupId!==o){var i=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,d=this.tracks.filter(function(y){return!o||y.groupId===o});this.tracksInGroup=d;var m=this.findTrackId(i==null?void 0:i.name)||this.findTrackId();this.groupId=o;var p={subtitleTracks:d};this.log("Updating subtitle tracks, "+d.length+' track(s) found in "'+o+'" group-id'),this.hls.trigger(D.Events.SUBTITLE_TRACKS_UPDATED,p),m!==-1&&this.setSubtitleTrack(m,i)}}},n.findTrackId=function(t){for(var s=this.tracksInGroup,o=0;o<s.length;o++){var i=s[o];if((!this.selectDefaultTrack||i.default)&&(!t||t===i.name))return i.id}return-1},n.onError=function(t,s){f.prototype.onError.call(this,t,s),!s.fatal&&s.context&&s.context.type===R.PlaylistContextType.SUBTITLE_TRACK&&s.context.id===this.trackId&&s.context.groupId===this.groupId&&this.retryLoadingOrFail(s)},n.loadPlaylist=function(t){var s=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(s)){var o=s.id,i=s.groupId,d=s.url;if(t)try{d=t.addDirectives(d)}catch(m){this.warn("Could not construct new URL with HLS Delivery Directives: "+m)}this.log("Loading subtitle playlist for id "+o),this.hls.trigger(D.Events.SUBTITLE_TRACK_LOADING,{url:d,id:o,groupId:i,deliveryDirectives:t||null})}},n.toggleTrackModes=function(t){var s=this,o=this.media,i=this.subtitleDisplay,d=this.trackId;if(o){var m=E(o.textTracks),p=m.filter(function(a){return a.groupId===s.groupId});if(t===-1)[].slice.call(m).forEach(function(a){a.mode="disabled"});else{var y=p[d];y&&(y.mode="disabled")}var r=p[t];r&&(r.mode=i?"showing":"hidden")}},n.setSubtitleTrack=function(t,s){var o,i=this.tracksInGroup;if(this.media){if(this.trackId!==t&&this.toggleTrackModes(t),!(this.trackId===t&&(t===-1||(o=i[t])!==null&&o!==void 0&&o.details)||t<-1||t>=i.length)){this.clearTimer();var d=i[t];if(this.log("Switching to subtitle track "+t),this.trackId=t,d){var m=d.id,p=d.groupId,y=p===void 0?"":p,r=d.name,a=d.type,c=d.url;this.hls.trigger(D.Events.SUBTITLE_TRACK_SWITCH,{id:m,groupId:y,name:r,type:a,url:c});var L=this.switchParams(d.url,s==null?void 0:s.details);this.loadPlaylist(L)}else this.hls.trigger(D.Events.SUBTITLE_TRACK_SWITCH,{id:t})}}else this.queuedDefaultTrack=t},n.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var t=-1,s=E(this.media.textTracks),o=0;o<s.length;o++)if(s[o].mode==="hidden")t=o;else if(s[o].mode==="showing"){t=o;break}this.subtitleTrack!==t&&(this.subtitleTrack=t)}},u=T,(e=[{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(t){this.selectDefaultTrack=!1;var s=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(t,s)}}])&&w(u.prototype,e),T}(k.default);function E(f){for(var g=[],b=0;b<f.length;b++){var T=f[b];T.kind==="subtitles"&&T.label&&g.push(f[b])}return g}I.default=l},"./src/controller/timeline-controller.ts":function(F,I,v){v.r(I),v.d(I,"TimelineController",function(){return g});var D=v("./src/polyfills/number.ts"),h=v("./src/events.ts"),k=v("./src/utils/cea-608-parser.ts"),R=v("./src/utils/output-filter.ts"),w=v("./src/utils/webvtt-parser.ts"),_=v("./src/utils/texttrack-utils.ts"),l=v("./src/utils/imsc1-ttml-parser.ts"),E=v("./src/types/loader.ts"),f=v("./src/utils/logger.ts"),g=function(){function T(e){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var n=new R.default(this,"textTrack1"),t=new R.default(this,"textTrack2"),s=new R.default(this,"textTrack3"),o=new R.default(this,"textTrack4");this.cea608Parser1=new k.default(1,n,t),this.cea608Parser2=new k.default(3,s,o)}e.on(h.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(h.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(h.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(h.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(h.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(h.Events.FRAG_LOADING,this.onFragLoading,this),e.on(h.Events.FRAG_LOADED,this.onFragLoaded,this),e.on(h.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(h.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(h.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(h.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(h.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var u=T.prototype;return u.destroy=function(){var e=this.hls;e.off(h.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(h.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(h.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(h.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(h.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(h.Events.FRAG_LOADING,this.onFragLoading,this),e.off(h.Events.FRAG_LOADED,this.onFragLoaded,this),e.off(h.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(h.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(h.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(h.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(h.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},u.addCues=function(e,n,t,s,o){for(var i,d,m,p,y=!1,r=o.length;r--;){var a=o[r],c=(i=a[0],d=a[1],m=n,p=t,Math.min(d,p)-Math.max(i,m));if(c>=0&&(a[0]=Math.min(a[0],n),a[1]=Math.max(a[1],t),y=!0,c/(t-n)>.5))return}if(y||o.push([n,t]),this.config.renderTextTracksNatively){var L=this.captionsTracks[e];this.Cues.newCue(L,n,t,s)}else{var S=this.Cues.newCue(null,n,t,s);this.hls.trigger(h.Events.CUES_PARSED,{type:"captions",cues:S,track:e})}},u.onInitPtsFound=function(e,n){var t=this,s=n.frag,o=n.id,i=n.initPTS,d=n.timescale,m=this.unparsedVttFrags;o==="main"&&(this.initPTS[s.cc]=i,this.timescale[s.cc]=d),m.length&&(this.unparsedVttFrags=[],m.forEach(function(p){t.onFragLoaded(h.Events.FRAG_LOADED,p)}))},u.getExistingTrack=function(e){var n=this.media;if(n)for(var t=0;t<n.textTracks.length;t++){var s=n.textTracks[t];if(s[e])return s}return null},u.createCaptionsTrack=function(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)},u.createNativeTrack=function(e){if(!this.captionsTracks[e]){var n=this.captionsProperties,t=this.captionsTracks,s=this.media,o=n[e],i=o.label,d=o.languageCode,m=this.getExistingTrack(e);if(m)t[e]=m,Object(_.clearCurrentCues)(t[e]),Object(_.sendAddTrackEvent)(t[e],s);else{var p=this.createTextTrack("captions",i,d);p&&(p[e]=!0,t[e]=p)}}},u.createNonNativeTrack=function(e){if(!this.nonNativeCaptionsTracks[e]){var n=this.captionsProperties[e];if(n){var t={_id:e,label:n.label,kind:"captions",default:!!n.media&&!!n.media.default,closedCaptions:n.media};this.nonNativeCaptionsTracks[e]=t,this.hls.trigger(h.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[t]})}}},u.createTextTrack=function(e,n,t){var s=this.media;if(s)return s.addTextTrack(e,n,t)},u.onMediaAttaching=function(e,n){this.media=n.media,this._cleanTracks()},u.onMediaDetaching=function(){var e=this.captionsTracks;Object.keys(e).forEach(function(n){Object(_.clearCurrentCues)(e[n]),delete e[n]}),this.nonNativeCaptionsTracks={}},u.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},u._cleanTracks=function(){var e=this.media;if(e){var n=e.textTracks;if(n)for(var t=0;t<n.length;t++)Object(_.clearCurrentCues)(n[t])}},u.onSubtitleTracksUpdated=function(e,n){var t=this;this.textTracks=[];var s=n.subtitleTracks||[],o=s.some(function(p){return p.textCodec===l.IMSC1_CODEC});if(this.config.enableWebVTT||o&&this.config.enableIMSC1){var i=this.tracks&&s&&this.tracks.length===s.length;if(this.tracks=s||[],this.config.renderTextTracksNatively){var d=this.media?this.media.textTracks:[];this.tracks.forEach(function(p,y){var r;if(y<d.length){for(var a=null,c=0;c<d.length;c++)if(b(d[c],p)){a=d[c];break}a&&(r=a)}r?Object(_.clearCurrentCues)(r):(r=t.createTextTrack("subtitles",p.name,p.lang))&&(r.mode="disabled"),r&&(r.groupId=p.groupId,t.textTracks.push(r))})}else if(!i&&this.tracks&&this.tracks.length){var m=this.tracks.map(function(p){return{label:p.name,kind:p.type.toLowerCase(),default:p.default,subtitleTrack:p}});this.hls.trigger(h.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:m})}}},u.onManifestLoaded=function(e,n){var t=this;this.config.enableCEA708Captions&&n.captions&&n.captions.forEach(function(s){var o=/(?:CC|SERVICE)([1-4])/.exec(s.instreamId);if(o){var i="textTrack"+o[1],d=t.captionsProperties[i];d&&(d.label=s.name,s.lang&&(d.languageCode=s.lang),d.media=s)}})},u.onFragLoading=function(e,n){var t=this.cea608Parser1,s=this.cea608Parser2,o=this.lastSn;if(this.enabled&&t&&s&&n.frag.type===E.PlaylistLevelType.MAIN){var i=n.frag.sn;i!==o+1&&(t.reset(),s.reset()),this.lastSn=i}},u.onFragLoaded=function(e,n){var t=n.frag,s=n.payload,o=this.initPTS,i=this.unparsedVttFrags;if(t.type===E.PlaylistLevelType.SUBTITLE)if(s.byteLength){if(!Object(D.isFiniteNumber)(o[t.cc]))return i.push(n),void(o.length&&this.hls.trigger(h.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:new Error("Missing initial subtitle PTS")}));var d=t.decryptdata;if(d==null||d.key==null||d.method!=="AES-128"){var m=this.tracks[t.level],p=this.vttCCs;p[t.cc]||(p[t.cc]={start:t.start,prevCC:this.prevCC,new:!0},this.prevCC=t.cc),m&&m.textCodec===l.IMSC1_CODEC?this._parseIMSC1(t,s):this._parseVTTs(t,s,p)}}else this.hls.trigger(h.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:new Error("Empty subtitle payload")})},u._parseIMSC1=function(e,n){var t=this,s=this.hls;Object(l.parseIMSC1)(n,this.initPTS[e.cc],this.timescale[e.cc],function(o){t._appendCues(o,e.level),s.trigger(h.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(o){f.logger.log("Failed to parse IMSC1: "+o),s.trigger(h.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:o})})},u._parseVTTs=function(e,n,t){var s=this,o=this.hls;Object(w.parseWebVTT)(n,this.initPTS[e.cc],this.timescale[e.cc],t,e.cc,e.start,function(i){s._appendCues(i,e.level),o.trigger(h.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(i){s._fallbackToIMSC1(e,n),f.logger.log("Failed to parse VTT cue: "+i),o.trigger(h.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:i})})},u._fallbackToIMSC1=function(e,n){var t=this,s=this.tracks[e.level];s.textCodec||Object(l.parseIMSC1)(n,this.initPTS[e.cc],this.timescale[e.cc],function(){s.textCodec=l.IMSC1_CODEC,t._parseIMSC1(e,n)},function(){s.textCodec="wvtt"})},u._appendCues=function(e,n){var t=this.hls;if(this.config.renderTextTracksNatively){var s=this.textTracks[n];if(s.mode==="disabled")return;e.forEach(function(i){return Object(_.addCueToTrack)(s,i)})}else{var o=this.tracks[n].default?"default":"subtitles"+n;t.trigger(h.Events.CUES_PARSED,{type:"subtitles",cues:e,track:o})}},u.onFragDecrypted=function(e,n){var t=n.frag;if(t.type===E.PlaylistLevelType.SUBTITLE){if(!Object(D.isFiniteNumber)(this.initPTS[t.cc]))return void this.unparsedVttFrags.push(n);this.onFragLoaded(h.Events.FRAG_LOADED,n)}},u.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},u.onFragParsingUserdata=function(e,n){var t=this.cea608Parser1,s=this.cea608Parser2;if(this.enabled&&t&&s)for(var o=0;o<n.samples.length;o++){var i=n.samples[o].bytes;if(i){var d=this.extractCea608Data(i);t.addData(n.samples[o].pts,d[0]),s.addData(n.samples[o].pts,d[1])}}},u.onBufferFlushing=function(e,n){var t=n.startOffset,s=n.endOffset,o=n.endOffsetSubtitles,i=n.type,d=this.media;if(d&&!(d.currentTime<s)){if(!i||i==="video"){var m=this.captionsTracks;Object.keys(m).forEach(function(y){return Object(_.removeCuesInRange)(m[y],t,s)})}if(this.config.renderTextTracksNatively&&t===0&&o!==void 0){var p=this.textTracks;Object.keys(p).forEach(function(y){return Object(_.removeCuesInRange)(p[y],t,o)})}}},u.extractCea608Data=function(e){for(var n=31&e[0],t=2,s=[[],[]],o=0;o<n;o++){var i=e[t++],d=127&e[t++],m=127&e[t++],p=3&i;d===0&&m===0||(4&i)!=0&&(p!==0&&p!==1||(s[p].push(d),s[p].push(m)))}return s},T}();function b(T,u){return T&&T.label===u.name&&!(T.textTrack1||T.textTrack2)}},"./src/crypt/aes-crypto.ts":function(F,I,v){v.r(I),v.d(I,"default",function(){return D});var D=function(){function h(k,R){this.subtle=void 0,this.aesIV=void 0,this.subtle=k,this.aesIV=R}return h.prototype.decrypt=function(k,R){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},R,k)},h}()},"./src/crypt/aes-decryptor.ts":function(F,I,v){v.r(I),v.d(I,"removePadding",function(){return h}),v.d(I,"default",function(){return k});var D=v("./src/utils/typed-array.ts");function h(R){var w=R.byteLength,_=w&&new DataView(R.buffer).getUint8(w-1);return _?Object(D.sliceUint8)(R,0,w-_):R}var k=function(){function R(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var w=R.prototype;return w.uint8ArrayToUint32Array_=function(_){for(var l=new DataView(_),E=new Uint32Array(4),f=0;f<4;f++)E[f]=l.getUint32(4*f);return E},w.initTable=function(){var _=this.sBox,l=this.invSBox,E=this.subMix,f=E[0],g=E[1],b=E[2],T=E[3],u=this.invSubMix,e=u[0],n=u[1],t=u[2],s=u[3],o=new Uint32Array(256),i=0,d=0,m=0;for(m=0;m<256;m++)o[m]=m<128?m<<1:m<<1^283;for(m=0;m<256;m++){var p=d^d<<1^d<<2^d<<3^d<<4;p=p>>>8^255&p^99,_[i]=p,l[p]=i;var y=o[i],r=o[y],a=o[r],c=257*o[p]^16843008*p;f[i]=c<<24|c>>>8,g[i]=c<<16|c>>>16,b[i]=c<<8|c>>>24,T[i]=c,c=16843009*a^65537*r^257*y^16843008*i,e[p]=c<<24|c>>>8,n[p]=c<<16|c>>>16,t[p]=c<<8|c>>>24,s[p]=c,i?(i=y^o[o[o[a^y]]],d^=o[o[d]]):i=d=1}},w.expandKey=function(_){for(var l=this.uint8ArrayToUint32Array_(_),E=!0,f=0;f<l.length&&E;)E=l[f]===this.key[f],f++;if(!E){this.key=l;var g=this.keySize=l.length;if(g!==4&&g!==6&&g!==8)throw new Error("Invalid aes key size="+g);var b,T,u,e,n=this.ksRows=4*(g+6+1),t=this.keySchedule=new Uint32Array(n),s=this.invKeySchedule=new Uint32Array(n),o=this.sBox,i=this.rcon,d=this.invSubMix,m=d[0],p=d[1],y=d[2],r=d[3];for(b=0;b<n;b++)b<g?u=t[b]=l[b]:(e=u,b%g==0?(e=o[(e=e<<8|e>>>24)>>>24]<<24|o[e>>>16&255]<<16|o[e>>>8&255]<<8|o[255&e],e^=i[b/g|0]<<24):g>6&&b%g==4&&(e=o[e>>>24]<<24|o[e>>>16&255]<<16|o[e>>>8&255]<<8|o[255&e]),t[b]=u=(t[b-g]^e)>>>0);for(T=0;T<n;T++)b=n-T,e=3&T?t[b]:t[b-4],s[T]=T<4||b<=4?e:m[o[e>>>24]]^p[o[e>>>16&255]]^y[o[e>>>8&255]]^r[o[255&e]],s[T]=s[T]>>>0}},w.networkToHostOrderSwap=function(_){return _<<24|(65280&_)<<8|(16711680&_)>>8|_>>>24},w.decrypt=function(_,l,E){for(var f,g,b,T,u,e,n,t,s,o,i,d,m,p,y=this.keySize+6,r=this.invKeySchedule,a=this.invSBox,c=this.invSubMix,L=c[0],S=c[1],A=c[2],x=c[3],C=this.uint8ArrayToUint32Array_(E),O=C[0],P=C[1],M=C[2],N=C[3],B=new Int32Array(_),U=new Int32Array(B.length),G=this.networkToHostOrderSwap;l<B.length;){for(s=G(B[l]),o=G(B[l+1]),i=G(B[l+2]),d=G(B[l+3]),u=s^r[0],e=d^r[1],n=i^r[2],t=o^r[3],m=4,p=1;p<y;p++)f=L[u>>>24]^S[e>>16&255]^A[n>>8&255]^x[255&t]^r[m],g=L[e>>>24]^S[n>>16&255]^A[t>>8&255]^x[255&u]^r[m+1],b=L[n>>>24]^S[t>>16&255]^A[u>>8&255]^x[255&e]^r[m+2],T=L[t>>>24]^S[u>>16&255]^A[e>>8&255]^x[255&n]^r[m+3],u=f,e=g,n=b,t=T,m+=4;f=a[u>>>24]<<24^a[e>>16&255]<<16^a[n>>8&255]<<8^a[255&t]^r[m],g=a[e>>>24]<<24^a[n>>16&255]<<16^a[t>>8&255]<<8^a[255&u]^r[m+1],b=a[n>>>24]<<24^a[t>>16&255]<<16^a[u>>8&255]<<8^a[255&e]^r[m+2],T=a[t>>>24]<<24^a[u>>16&255]<<16^a[e>>8&255]<<8^a[255&n]^r[m+3],U[l]=G(f^O),U[l+1]=G(T^P),U[l+2]=G(b^M),U[l+3]=G(g^N),O=s,P=o,M=i,N=d,l+=4}return U.buffer},R}()},"./src/crypt/decrypter.ts":function(F,I,v){v.r(I),v.d(I,"default",function(){return l});var D=v("./src/crypt/aes-crypto.ts"),h=v("./src/crypt/fast-aes-key.ts"),k=v("./src/crypt/aes-decryptor.ts"),R=v("./src/utils/logger.ts"),w=v("./src/utils/mp4-tools.ts"),_=v("./src/utils/typed-array.ts"),l=function(){function E(g,b,T){var u=(T===void 0?{}:T).removePKCS7Padding,e=u===void 0||u;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=g,this.config=b,this.removePKCS7Padding=e,e)try{var n=self.crypto;n&&(this.subtle=n.subtle||n.webkitSubtle)}catch{}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var f=E.prototype;return f.destroy=function(){this.observer=null},f.isSync=function(){return this.config.enableSoftwareAES},f.flush=function(){var g=this.currentResult;if(g){var b=new Uint8Array(g);return this.reset(),this.removePKCS7Padding?Object(k.removePadding)(b):b}this.reset()},f.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},f.decrypt=function(g,b,T,u){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(g),b,T);var e=this.flush();e&&u(e.buffer)}else this.webCryptoDecrypt(new Uint8Array(g),b,T).then(u)},f.softwareDecrypt=function(g,b,T){var u=this.currentIV,e=this.currentResult,n=this.remainderData;this.logOnce("JS AES decrypt"),n&&(g=Object(w.appendUint8Array)(n,g),this.remainderData=null);var t=this.getValidChunk(g);if(!t.length)return null;u&&(T=u);var s=this.softwareDecrypter;s||(s=this.softwareDecrypter=new k.default),s.expandKey(b);var o=e;return this.currentResult=s.decrypt(t.buffer,0,T),this.currentIV=Object(_.sliceUint8)(t,-16).buffer,o||null},f.webCryptoDecrypt=function(g,b,T){var u=this,e=this.subtle;return this.key===b&&this.fastAesKey||(this.key=b,this.fastAesKey=new h.default(e,b)),this.fastAesKey.expandKey().then(function(n){return e?new D.default(e,T).decrypt(g.buffer,n):Promise.reject(new Error("web crypto not initialized"))}).catch(function(n){return u.onWebCryptoError(n,g,b,T)})},f.onWebCryptoError=function(g,b,T,u){return R.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",g),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(b,T,u)},f.getValidChunk=function(g){var b=g,T=g.length-g.length%16;return T!==g.length&&(b=Object(_.sliceUint8)(g,0,T),this.remainderData=Object(_.sliceUint8)(g,T)),b},f.logOnce=function(g){this.logEnabled&&(R.logger.log("[decrypter.ts]: "+g),this.logEnabled=!1)},E}()},"./src/crypt/fast-aes-key.ts":function(F,I,v){v.r(I),v.d(I,"default",function(){return D});var D=function(){function h(k,R){this.subtle=void 0,this.key=void 0,this.subtle=k,this.key=R}return h.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},h}()},"./src/demux/aacdemuxer.ts":function(F,I,v){v.r(I);var D=v("./src/demux/base-audio-demuxer.ts"),h=v("./src/demux/adts.ts"),k=v("./src/utils/logger.ts"),R=v("./src/demux/id3.ts");function w(l,E){return(w=Object.setPrototypeOf||function(f,g){return f.__proto__=g,f})(l,E)}var _=function(l){var E,f;function g(T,u){var e;return(e=l.call(this)||this).observer=void 0,e.config=void 0,e.observer=T,e.config=u,e}f=l,(E=g).prototype=Object.create(f.prototype),E.prototype.constructor=E,w(E,f);var b=g.prototype;return b.resetInitSegment=function(T,u,e){l.prototype.resetInitSegment.call(this,T,u,e),this._audioTrack={container:"audio/adts",type:"audio",id:0,pid:-1,sequenceNumber:0,isAAC:!0,samples:[],manifestCodec:T,duration:e,inputTimeScale:9e4,dropped:0}},g.probe=function(T){if(!T)return!1;for(var u=(R.getID3Data(T,0)||[]).length,e=T.length;u<e;u++)if(h.probe(T,u))return k.logger.log("ADTS sync word found !"),!0;return!1},b.canParse=function(T,u){return h.canParse(T,u)},b.appendFrame=function(T,u,e){h.initTrackConfig(T,this.observer,u,e,T.manifestCodec);var n=h.appendFrame(T,u,e,this.initPTS,this.frameIndex);if(n&&n.missing===0)return n},g}(D.default);_.minProbeByteLength=9,I.default=_},"./src/demux/adts.ts":function(F,I,v){v.r(I),v.d(I,"getAudioConfig",function(){return R}),v.d(I,"isHeaderPattern",function(){return w}),v.d(I,"getHeaderLength",function(){return _}),v.d(I,"getFullFrameLength",function(){return l}),v.d(I,"canGetFrameLength",function(){return E}),v.d(I,"isHeader",function(){return f}),v.d(I,"canParse",function(){return g}),v.d(I,"probe",function(){return b}),v.d(I,"initTrackConfig",function(){return T}),v.d(I,"getFrameDuration",function(){return u}),v.d(I,"parseFrameHeader",function(){return e}),v.d(I,"appendFrame",function(){return n});var D=v("./src/utils/logger.ts"),h=v("./src/errors.ts"),k=v("./src/events.ts");function R(t,s,o,i){var d,m,p,y,r=navigator.userAgent.toLowerCase(),a=i,c=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];d=1+((192&s[o+2])>>>6);var L=(60&s[o+2])>>>2;if(!(L>c.length-1))return p=(1&s[o+2])<<2,p|=(192&s[o+3])>>>6,D.logger.log("manifest codec:"+i+", ADTS type:"+d+", samplingIndex:"+L),/firefox/i.test(r)?L>=6?(d=5,y=new Array(4),m=L-3):(d=2,y=new Array(2),m=L):r.indexOf("android")!==-1?(d=2,y=new Array(2),m=L):(d=5,y=new Array(4),i&&(i.indexOf("mp4a.40.29")!==-1||i.indexOf("mp4a.40.5")!==-1)||!i&&L>=6?m=L-3:((i&&i.indexOf("mp4a.40.2")!==-1&&(L>=6&&p===1||/vivaldi/i.test(r))||!i&&p===1)&&(d=2,y=new Array(2)),m=L)),y[0]=d<<3,y[0]|=(14&L)>>1,y[1]|=(1&L)<<7,y[1]|=p<<3,d===5&&(y[1]|=(14&m)>>1,y[2]=(1&m)<<7,y[2]|=8,y[3]=0),{config:y,samplerate:c[L],channelCount:p,codec:"mp4a.40."+d,manifestCodec:a};t.trigger(k.Events.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+L})}function w(t,s){return t[s]===255&&(246&t[s+1])==240}function _(t,s){return 1&t[s+1]?7:9}function l(t,s){return(3&t[s+3])<<11|t[s+4]<<3|(224&t[s+5])>>>5}function E(t,s){return s+5<t.length}function f(t,s){return s+1<t.length&&w(t,s)}function g(t,s){return E(t,s)&&w(t,s)&&l(t,s)<=t.length-s}function b(t,s){if(f(t,s)){var o=_(t,s);if(s+o>=t.length)return!1;var i=l(t,s);if(i<=o)return!1;var d=s+i;return d===t.length||f(t,d)}return!1}function T(t,s,o,i,d){if(!t.samplerate){var m=R(s,o,i,d);if(!m)return;t.config=m.config,t.samplerate=m.samplerate,t.channelCount=m.channelCount,t.codec=m.codec,t.manifestCodec=m.manifestCodec,D.logger.log("parsed codec:"+t.codec+", rate:"+m.samplerate+", channels:"+m.channelCount)}}function u(t){return 9216e4/t}function e(t,s,o,i,d){var m=_(t,s),p=l(t,s);if((p-=m)>0)return{headerLength:m,frameLength:p,stamp:o+i*d}}function n(t,s,o,i,d){var m=e(s,o,i,d,u(t.samplerate));if(m){var p,y=m.frameLength,r=m.headerLength,a=m.stamp,c=r+y,L=Math.max(0,o+c-s.length);L?(p=new Uint8Array(c-r)).set(s.subarray(o+r,s.length),0):p=s.subarray(o+r,o+c);var S={unit:p,pts:a};return L||t.samples.push(S),{sample:S,length:c,missing:L}}}},"./src/demux/base-audio-demuxer.ts":function(F,I,v){v.r(I),v.d(I,"initPTSFn",function(){return l});var D=v("./src/polyfills/number.ts"),h=v("./src/demux/id3.ts"),k=v("./src/demux/dummy-demuxed-track.ts"),R=v("./src/utils/mp4-tools.ts"),w=v("./src/utils/typed-array.ts"),_=function(){function E(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.initPTS=null}var f=E.prototype;return f.resetInitSegment=function(g,b,T){this._id3Track={type:"id3",id:0,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},f.resetTimeStamp=function(){},f.resetContiguity=function(){},f.canParse=function(g,b){return!1},f.appendFrame=function(g,b,T){},f.demux=function(g,b){this.cachedData&&(g=Object(R.appendUint8Array)(this.cachedData,g),this.cachedData=null);var T,u,e=h.getID3Data(g,0),n=e?e.length:0,t=this._audioTrack,s=this._id3Track,o=e?h.getTimeStamp(e):void 0,i=g.length;for(this.frameIndex!==0&&this.initPTS!==null||(this.initPTS=l(o,b)),e&&e.length>0&&s.samples.push({pts:this.initPTS,dts:this.initPTS,data:e}),u=this.initPTS;n<i;){if(this.canParse(g,n)){var d=this.appendFrame(t,g,n);d?(this.frameIndex++,u=d.sample.pts,T=n+=d.length):n=i}else h.canParse(g,n)?(e=h.getID3Data(g,n),s.samples.push({pts:u,dts:u,data:e}),T=n+=e.length):n++;if(n===i&&T!==i){var m=Object(w.sliceUint8)(g,T);this.cachedData?this.cachedData=Object(R.appendUint8Array)(this.cachedData,m):this.cachedData=m}}return{audioTrack:t,avcTrack:Object(k.dummyTrack)(),id3Track:s,textTrack:Object(k.dummyTrack)()}},f.demuxSampleAes=function(g,b,T){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},f.flush=function(g){var b=this.cachedData;return b&&(this.cachedData=null,this.demux(b,0)),this.frameIndex=0,{audioTrack:this._audioTrack,avcTrack:Object(k.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(k.dummyTrack)()}},f.destroy=function(){},E}(),l=function(E,f){return Object(D.isFiniteNumber)(E)?90*E:9e4*f};I.default=_},"./src/demux/chunk-cache.ts":function(F,I,v){v.r(I),v.d(I,"default",function(){return D});var D=function(){function h(){this.chunks=[],this.dataLength=0}var k=h.prototype;return k.push=function(R){this.chunks.push(R),this.dataLength+=R.length},k.flush=function(){var R,w=this.chunks,_=this.dataLength;return w.length?(R=w.length===1?w[0]:function(l,E){for(var f=new Uint8Array(E),g=0,b=0;b<l.length;b++){var T=l[b];f.set(T,g),g+=T.length}return f}(w,_),this.reset(),R):new Uint8Array(0)},k.reset=function(){this.chunks.length=0,this.dataLength=0},h}()},"./src/demux/dummy-demuxed-track.ts":function(F,I,v){function D(){return{type:"",id:-1,pid:-1,inputTimeScale:9e4,sequenceNumber:-1,samples:[],dropped:0}}v.r(I),v.d(I,"dummyTrack",function(){return D})},"./src/demux/exp-golomb.ts":function(F,I,v){v.r(I);var D=v("./src/utils/logger.ts"),h=function(){function k(w){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=w,this.bytesAvailable=w.byteLength,this.word=0,this.bitsAvailable=0}var R=k.prototype;return R.loadWord=function(){var w=this.data,_=this.bytesAvailable,l=w.byteLength-_,E=new Uint8Array(4),f=Math.min(4,_);if(f===0)throw new Error("no bytes available");E.set(w.subarray(l,l+f)),this.word=new DataView(E.buffer).getUint32(0),this.bitsAvailable=8*f,this.bytesAvailable-=f},R.skipBits=function(w){var _;this.bitsAvailable>w?(this.word<<=w,this.bitsAvailable-=w):(w-=this.bitsAvailable,w-=(_=w>>3)>>3,this.bytesAvailable-=_,this.loadWord(),this.word<<=w,this.bitsAvailable-=w)},R.readBits=function(w){var _=Math.min(this.bitsAvailable,w),l=this.word>>>32-_;return w>32&&D.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=_,this.bitsAvailable>0?this.word<<=_:this.bytesAvailable>0&&this.loadWord(),(_=w-_)>0&&this.bitsAvailable?l<<_|this.readBits(_):l},R.skipLZ=function(){var w;for(w=0;w<this.bitsAvailable;++w)if((this.word&2147483648>>>w)!=0)return this.word<<=w,this.bitsAvailable-=w,w;return this.loadWord(),w+this.skipLZ()},R.skipUEG=function(){this.skipBits(1+this.skipLZ())},R.skipEG=function(){this.skipBits(1+this.skipLZ())},R.readUEG=function(){var w=this.skipLZ();return this.readBits(w+1)-1},R.readEG=function(){var w=this.readUEG();return 1&w?1+w>>>1:-1*(w>>>1)},R.readBoolean=function(){return this.readBits(1)===1},R.readUByte=function(){return this.readBits(8)},R.readUShort=function(){return this.readBits(16)},R.readUInt=function(){return this.readBits(32)},R.skipScalingList=function(w){for(var _=8,l=8,E=0;E<w;E++)l!==0&&(l=(_+this.readEG()+256)%256),_=l===0?_:l},R.readSPS=function(){var w,_,l,E=0,f=0,g=0,b=0,T=this.readUByte.bind(this),u=this.readBits.bind(this),e=this.readUEG.bind(this),n=this.readBoolean.bind(this),t=this.skipBits.bind(this),s=this.skipEG.bind(this),o=this.skipUEG.bind(this),i=this.skipScalingList.bind(this);T();var d=T();if(u(5),t(3),T(),o(),d===100||d===110||d===122||d===244||d===44||d===83||d===86||d===118||d===128){var m=e();if(m===3&&t(1),o(),o(),t(1),n())for(_=m!==3?8:12,l=0;l<_;l++)n()&&i(l<6?16:64)}o();var p=e();if(p===0)e();else if(p===1)for(t(1),s(),s(),w=e(),l=0;l<w;l++)s();o(),t(1);var y=e(),r=e(),a=u(1);a===0&&t(1),t(1),n()&&(E=e(),f=e(),g=e(),b=e());var c=[1,1];if(n()&&n())switch(T()){case 1:c=[1,1];break;case 2:c=[12,11];break;case 3:c=[10,11];break;case 4:c=[16,11];break;case 5:c=[40,33];break;case 6:c=[24,11];break;case 7:c=[20,11];break;case 8:c=[32,11];break;case 9:c=[80,33];break;case 10:c=[18,11];break;case 11:c=[15,11];break;case 12:c=[64,33];break;case 13:c=[160,99];break;case 14:c=[4,3];break;case 15:c=[3,2];break;case 16:c=[2,1];break;case 255:c=[T()<<8|T(),T()<<8|T()]}return{width:Math.ceil(16*(y+1)-2*E-2*f),height:(2-a)*(r+1)*16-(a?2:4)*(g+b),pixelRatio:c}},R.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},k}();I.default=h},"./src/demux/id3.ts":function(F,I,v){v.r(I),v.d(I,"isHeader",function(){return h}),v.d(I,"isFooter",function(){return k}),v.d(I,"getID3Data",function(){return R}),v.d(I,"canParse",function(){return _}),v.d(I,"getTimeStamp",function(){return l}),v.d(I,"isTimeStampFrame",function(){return E}),v.d(I,"getID3Frames",function(){return g}),v.d(I,"decodeFrame",function(){return b}),v.d(I,"utf8ArrayToStr",function(){return t}),v.d(I,"testables",function(){return s});var D,h=function(o,i){return i+10<=o.length&&o[i]===73&&o[i+1]===68&&o[i+2]===51&&o[i+3]<255&&o[i+4]<255&&o[i+6]<128&&o[i+7]<128&&o[i+8]<128&&o[i+9]<128},k=function(o,i){return i+10<=o.length&&o[i]===51&&o[i+1]===68&&o[i+2]===73&&o[i+3]<255&&o[i+4]<255&&o[i+6]<128&&o[i+7]<128&&o[i+8]<128&&o[i+9]<128},R=function(o,i){for(var d=i,m=0;h(o,i);)m+=10,m+=w(o,i+6),k(o,i+10)&&(m+=10),i+=m;if(m>0)return o.subarray(d,d+m)},w=function(o,i){var d=0;return d=(127&o[i])<<21,d|=(127&o[i+1])<<14,d|=(127&o[i+2])<<7,d|=127&o[i+3]},_=function(o,i){return h(o,i)&&w(o,i+6)+10<=o.length-i},l=function(o){for(var i=g(o),d=0;d<i.length;d++){var m=i[d];if(E(m))return n(m)}},E=function(o){return o&&o.key==="PRIV"&&o.info==="com.apple.streaming.transportStreamTimestamp"},f=function(o){var i=String.fromCharCode(o[0],o[1],o[2],o[3]),d=w(o,4);return{type:i,size:d,data:o.subarray(10,10+d)}},g=function(o){for(var i=0,d=[];h(o,i);){for(var m=w(o,i+6),p=(i+=10)+m;i+8<p;){var y=f(o.subarray(i)),r=b(y);r&&d.push(r),i+=y.size+10}k(o,i)&&(i+=10)}return d},b=function(o){return o.type==="PRIV"?T(o):o.type[0]==="W"?e(o):u(o)},T=function(o){if(!(o.size<2)){var i=t(o.data,!0),d=new Uint8Array(o.data.subarray(i.length+1));return{key:o.type,info:i,data:d.buffer}}},u=function(o){if(!(o.size<2)){if(o.type==="TXXX"){var i=1,d=t(o.data.subarray(i),!0);i+=d.length+1;var m=t(o.data.subarray(i));return{key:o.type,info:d,data:m}}var p=t(o.data.subarray(1));return{key:o.type,data:p}}},e=function(o){if(o.type==="WXXX"){if(o.size<2)return;var i=1,d=t(o.data.subarray(i),!0);i+=d.length+1;var m=t(o.data.subarray(i));return{key:o.type,info:d,data:m}}var p=t(o.data);return{key:o.type,data:p}},n=function(o){if(o.data.byteLength===8){var i=new Uint8Array(o.data),d=1&i[3],m=(i[4]<<23)+(i[5]<<15)+(i[6]<<7)+i[7];return m/=45,d&&(m+=4772185884e-2),Math.round(m)}},t=function(o,i){i===void 0&&(i=!1);var d=(D||self.TextDecoder===void 0||(D=new self.TextDecoder("utf-8")),D);if(d){var m=d.decode(o);if(i){var p=m.indexOf("\0");return p!==-1?m.substring(0,p):m}return m.replace(/\0/g,"")}for(var y,r,a,c=o.length,L="",S=0;S<c;){if((y=o[S++])===0&&i)return L;if(y!==0&&y!==3)switch(y>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:L+=String.fromCharCode(y);break;case 12:case 13:r=o[S++],L+=String.fromCharCode((31&y)<<6|63&r);break;case 14:r=o[S++],a=o[S++],L+=String.fromCharCode((15&y)<<12|(63&r)<<6|(63&a)<<0)}}return L},s={decodeTextFrame:u}},"./src/demux/mp3demuxer.ts":function(F,I,v){v.r(I);var D=v("./src/demux/base-audio-demuxer.ts"),h=v("./src/demux/id3.ts"),k=v("./src/utils/logger.ts"),R=v("./src/demux/mpegaudio.ts");function w(l,E){return(w=Object.setPrototypeOf||function(f,g){return f.__proto__=g,f})(l,E)}var _=function(l){var E,f;function g(){return l.apply(this,arguments)||this}f=l,(E=g).prototype=Object.create(f.prototype),E.prototype.constructor=E,w(E,f);var b=g.prototype;return b.resetInitSegment=function(T,u,e){l.prototype.resetInitSegment.call(this,T,u,e),this._audioTrack={container:"audio/mpeg",type:"audio",id:0,pid:-1,sequenceNumber:0,isAAC:!1,samples:[],manifestCodec:T,duration:e,inputTimeScale:9e4,dropped:0}},g.probe=function(T){if(!T)return!1;for(var u=(h.getID3Data(T,0)||[]).length,e=T.length;u<e;u++)if(R.probe(T,u))return k.logger.log("MPEG Audio sync word found !"),!0;return!1},b.canParse=function(T,u){return R.canParse(T,u)},b.appendFrame=function(T,u,e){if(this.initPTS!==null)return R.appendFrame(T,u,e,this.initPTS,this.frameIndex)},g}(D.default);_.minProbeByteLength=4,I.default=_},"./src/demux/mp4demuxer.ts":function(F,I,v){v.r(I);var D=v("./src/utils/mp4-tools.ts"),h=v("./src/demux/dummy-demuxed-track.ts"),k=function(){function R(_,l){this.remainderData=null,this.config=void 0,this.config=l}var w=R.prototype;return w.resetTimeStamp=function(){},w.resetInitSegment=function(){},w.resetContiguity=function(){},R.probe=function(_){return Object(D.findBox)({data:_,start:0,end:Math.min(_.length,16384)},["moof"]).length>0},w.demux=function(_){var l=_,E=Object(h.dummyTrack)();if(this.config.progressive){this.remainderData&&(l=Object(D.appendUint8Array)(this.remainderData,_));var f=Object(D.segmentValidRange)(l);this.remainderData=f.remainder,E.samples=f.valid||new Uint8Array}else E.samples=l;return{audioTrack:Object(h.dummyTrack)(),avcTrack:E,id3Track:Object(h.dummyTrack)(),textTrack:Object(h.dummyTrack)()}},w.flush=function(){var _=Object(h.dummyTrack)();return _.samples=this.remainderData||new Uint8Array,this.remainderData=null,{audioTrack:Object(h.dummyTrack)(),avcTrack:_,id3Track:Object(h.dummyTrack)(),textTrack:Object(h.dummyTrack)()}},w.demuxSampleAes=function(_,l,E){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},w.destroy=function(){},R}();k.minProbeByteLength=1024,I.default=k},"./src/demux/mpegaudio.ts":function(F,I,v){v.r(I),v.d(I,"appendFrame",function(){return _}),v.d(I,"parseHeader",function(){return l}),v.d(I,"isHeaderPattern",function(){return E}),v.d(I,"isHeader",function(){return f}),v.d(I,"canParse",function(){return g}),v.d(I,"probe",function(){return b});var D=null,h=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],k=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],R=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],w=[0,1,1,4];function _(T,u,e,n,t){if(!(e+24>u.length)){var s=l(u,e);if(s&&e+s.frameLength<=u.length){var o=n+t*(9e4*s.samplesPerFrame/s.sampleRate),i={unit:u.subarray(e,e+s.frameLength),pts:o,dts:o};return T.config=[],T.channelCount=s.channelCount,T.samplerate=s.sampleRate,T.samples.push(i),{sample:i,length:s.frameLength,missing:0}}}}function l(T,u){var e=T[u+1]>>3&3,n=T[u+1]>>1&3,t=T[u+2]>>4&15,s=T[u+2]>>2&3;if(e!==1&&t!==0&&t!==15&&s!==3){var o=T[u+2]>>1&1,i=T[u+3]>>6,d=1e3*h[14*(e===3?3-n:n===3?3:4)+t-1],m=k[3*(e===3?0:e===2?1:2)+s],p=i===3?1:2,y=R[e][n],r=w[n],a=8*y*r,c=Math.floor(y*d/m+o)*r;if(D===null){var L=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);D=L?parseInt(L[1]):0}return!!D&&D<=87&&n===2&&d>=224e3&&i===0&&(T[u+3]=128|T[u+3]),{sampleRate:m,channelCount:p,frameLength:c,samplesPerFrame:a}}}function E(T,u){return T[u]===255&&(224&T[u+1])==224&&(6&T[u+1])!=0}function f(T,u){return u+1<T.length&&E(T,u)}function g(T,u){return E(T,u)&&4<=T.length-u}function b(T,u){if(u+1<T.length&&E(T,u)){var e=l(T,u),n=4;e!=null&&e.frameLength&&(n=e.frameLength);var t=u+n;return t===T.length||f(T,t)}return!1}},"./src/demux/sample-aes.ts":function(F,I,v){v.r(I);var D=v("./src/crypt/decrypter.ts"),h=v("./src/demux/tsdemuxer.ts"),k=function(){function R(_,l,E){this.keyData=void 0,this.decrypter=void 0,this.keyData=E,this.decrypter=new D.default(_,l,{removePKCS7Padding:!1})}var w=R.prototype;return w.decryptBuffer=function(_,l){this.decrypter.decrypt(_,this.keyData.key.buffer,this.keyData.iv.buffer,l)},w.decryptAacSample=function(_,l,E,f){var g=_[l].unit,b=g.subarray(16,g.length-g.length%16),T=b.buffer.slice(b.byteOffset,b.byteOffset+b.length),u=this;this.decryptBuffer(T,function(e){var n=new Uint8Array(e);g.set(n,16),f||u.decryptAacSamples(_,l+1,E)})},w.decryptAacSamples=function(_,l,E){for(;;l++){if(l>=_.length)return void E();if(!(_[l].unit.length<32)){var f=this.decrypter.isSync();if(this.decryptAacSample(_,l,E,f),!f)return}}},w.getAvcEncryptedData=function(_){for(var l=16*Math.floor((_.length-48)/160)+16,E=new Int8Array(l),f=0,g=32;g<=_.length-16;g+=160,f+=16)E.set(_.subarray(g,g+16),f);return E},w.getAvcDecryptedUnit=function(_,l){for(var E=new Uint8Array(l),f=0,g=32;g<=_.length-16;g+=160,f+=16)_.set(E.subarray(f,f+16),g);return _},w.decryptAvcSample=function(_,l,E,f,g,b){var T=Object(h.discardEPB)(g.data),u=this.getAvcEncryptedData(T),e=this;this.decryptBuffer(u.buffer,function(n){g.data=e.getAvcDecryptedUnit(T,n),b||e.decryptAvcSamples(_,l,E+1,f)})},w.decryptAvcSamples=function(_,l,E,f){if(_ instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;l++,E=0){if(l>=_.length)return void f();for(var g=_[l].units;!(E>=g.length);E++){var b=g[E];if(!(b.data.length<=48||b.type!==1&&b.type!==5)){var T=this.decrypter.isSync();if(this.decryptAvcSample(_,l,E,f,b,T),!T)return}}}},R}();I.default=k},"./src/demux/transmuxer-interface.ts":function(F,I,v){v.r(I),v.d(I,"default",function(){return f});var D=v("./node_modules/webworkify-webpack/index.js"),h=v("./src/events.ts"),k=v("./src/demux/transmuxer.ts"),R=v("./src/utils/logger.ts"),w=v("./src/errors.ts"),_=v("./src/utils/mediasource-helper.ts"),l=v("./node_modules/eventemitter3/index.js"),E=Object(_.getMediaSource)()||{isTypeSupported:function(){return!1}},f=function(){function g(T,u,e,n){var t=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=T,this.id=u,this.onTransmuxComplete=e,this.onFlush=n;var s=T.config,o=function(p,y){(y=y||{}).frag=t.frag,y.id=t.id,T.trigger(p,y)};this.observer=new l.EventEmitter,this.observer.on(h.Events.FRAG_DECRYPTED,o),this.observer.on(h.Events.ERROR,o);var i={mp4:E.isTypeSupported("video/mp4"),mpeg:E.isTypeSupported("audio/mpeg"),mp3:E.isTypeSupported('audio/mp4; codecs="mp3"')},d=navigator.vendor;if(s.enableWorker&&typeof Worker!="undefined"){var m;R.logger.log("demuxing in webworker");try{m=this.worker=D("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),m.addEventListener("message",this.onwmsg),m.onerror=function(p){T.trigger(h.Events.ERROR,{type:w.ErrorTypes.OTHER_ERROR,details:w.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(p.message+"  ("+p.filename+":"+p.lineno+")")})},m.postMessage({cmd:"init",typeSupported:i,vendor:d,id:u,config:JSON.stringify(s)})}catch(p){R.logger.warn("Error in worker:",p),R.logger.error("Error while initializing DemuxerWorker, fallback to inline"),m&&self.URL.revokeObjectURL(m.objectURL),this.transmuxer=new k.default(this.observer,i,s,d,u),this.worker=null}}else this.transmuxer=new k.default(this.observer,i,s,d,u)}var b=g.prototype;return b.destroy=function(){var T=this.worker;if(T)T.removeEventListener("message",this.onwmsg),T.terminate(),this.worker=null;else{var u=this.transmuxer;u&&(u.destroy(),this.transmuxer=null)}var e=this.observer;e&&e.removeAllListeners(),this.observer=null},b.push=function(T,u,e,n,t,s,o,i,d,m){var p=this;d.transmuxing.start=self.performance.now();var y=this.transmuxer,r=this.worker,a=s?s.start:t.start,c=t.decryptdata,L=this.frag,S=!(L&&t.cc===L.cc),A=!(L&&d.level===L.level),x=L?d.sn-L.sn:-1,C=this.part?d.part-this.part.index:1,O=!A&&(x===1||x===0&&C===1),P=self.performance.now();(A||x||t.stats.parsing.start===0)&&(t.stats.parsing.start=P),!s||!C&&O||(s.stats.parsing.start=P);var M=new k.TransmuxState(S,O,i,A,a);if(!O||S){R.logger.log("[transmuxer-interface, "+t.type+"]: Starting new transmux session for sn: "+d.sn+" p: "+d.part+" level: "+d.level+" id: "+d.id+`
        discontinuity: `+S+`
        trackSwitch: `+A+`
        contiguous: `+O+`
        accurateTimeOffset: `+i+`
        timeOffset: `+a);var N=new k.TransmuxConfig(e,n,u,o,m);this.configureTransmuxer(N)}if(this.frag=t,this.part=s,r)r.postMessage({cmd:"demux",data:T,decryptdata:c,chunkMeta:d,state:M},T instanceof ArrayBuffer?[T]:[]);else if(y){var B=y.push(T,c,d,M);Object(k.isPromise)(B)?B.then(function(U){p.handleTransmuxComplete(U)}):this.handleTransmuxComplete(B)}},b.flush=function(T){var u=this;T.transmuxing.start=self.performance.now();var e=this.transmuxer,n=this.worker;if(n)n.postMessage({cmd:"flush",chunkMeta:T});else if(e){var t=e.flush(T);Object(k.isPromise)(t)?t.then(function(s){u.handleFlushResult(s,T)}):this.handleFlushResult(t,T)}},b.handleFlushResult=function(T,u){var e=this;T.forEach(function(n){e.handleTransmuxComplete(n)}),this.onFlush(u)},b.onWorkerMessage=function(T){var u=T.data,e=this.hls;switch(u.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(u.data);break;case"flush":this.onFlush(u.data);break;default:u.data=u.data||{},u.data.frag=this.frag,u.data.id=this.id,e.trigger(u.event,u.data)}},b.configureTransmuxer=function(T){var u=this.worker,e=this.transmuxer;u?u.postMessage({cmd:"configure",config:T}):e&&e.configure(T)},b.handleTransmuxComplete=function(T){T.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(T)},g}()},"./src/demux/transmuxer-worker.ts":function(F,I,v){v.r(I),v.d(I,"default",function(){return w});var D=v("./src/demux/transmuxer.ts"),h=v("./src/events.ts"),k=v("./src/utils/logger.ts"),R=v("./node_modules/eventemitter3/index.js");function w(f){var g=new R.EventEmitter,b=function(T,u){f.postMessage({event:T,data:u})};g.on(h.Events.FRAG_DECRYPTED,b),g.on(h.Events.ERROR,b),f.addEventListener("message",function(T){var u=T.data;switch(u.cmd){case"init":var e=JSON.parse(u.config);f.transmuxer=new D.default(g,u.typeSupported,e,u.vendor,u.id),Object(k.enableLogs)(e.debug),b("init",null);break;case"configure":f.transmuxer.configure(u.config);break;case"demux":var n=f.transmuxer.push(u.data,u.decryptdata,u.chunkMeta,u.state);Object(D.isPromise)(n)?n.then(function(o){_(f,o)}):_(f,n);break;case"flush":var t=u.chunkMeta,s=f.transmuxer.flush(t);Object(D.isPromise)(s)?s.then(function(o){E(f,o,t)}):E(f,s,t)}})}function _(f,g){if((b=g.remuxResult).audio||b.video||b.text||b.id3||b.initSegment){var b,T=[],u=g.remuxResult,e=u.audio,n=u.video;e&&l(T,e),n&&l(T,n),f.postMessage({event:"transmuxComplete",data:g},T)}}function l(f,g){g.data1&&f.push(g.data1.buffer),g.data2&&f.push(g.data2.buffer)}function E(f,g,b){g.forEach(function(T){_(f,T)}),f.postMessage({event:"flush",data:b})}},"./src/demux/transmuxer.ts":function(F,I,v){v.r(I),v.d(I,"default",function(){return t}),v.d(I,"isPromise",function(){return o}),v.d(I,"TransmuxConfig",function(){return i}),v.d(I,"TransmuxState",function(){return d});var D,h=v("./src/events.ts"),k=v("./src/errors.ts"),R=v("./src/crypt/decrypter.ts"),w=v("./src/demux/aacdemuxer.ts"),_=v("./src/demux/mp4demuxer.ts"),l=v("./src/demux/tsdemuxer.ts"),E=v("./src/demux/mp3demuxer.ts"),f=v("./src/remux/mp4-remuxer.ts"),g=v("./src/remux/passthrough-remuxer.ts"),b=v("./src/demux/chunk-cache.ts"),T=v("./src/utils/mp4-tools.ts"),u=v("./src/utils/logger.ts");try{D=self.performance.now.bind(self.performance)}catch{u.logger.debug("Unable to use Performance API on this environment"),D=self.Date.now}var e=[{demux:l.default,remux:f.default},{demux:_.default,remux:g.default},{demux:w.default,remux:f.default},{demux:E.default,remux:f.default}],n=1024;e.forEach(function(m){var p=m.demux;n=Math.max(n,p.minProbeByteLength)});var t=function(){function m(y,r,a,c,L){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new b.default,this.observer=y,this.typeSupported=r,this.config=a,this.vendor=c,this.id=L}var p=m.prototype;return p.configure=function(y){this.transmuxConfig=y,this.decrypter&&this.decrypter.reset()},p.push=function(y,r,a,c){var L=this,S=a.transmuxing;S.executeStart=D();var A=new Uint8Array(y),x=this.cache,C=this.config,O=this.currentTransmuxState,P=this.transmuxConfig;c&&(this.currentTransmuxState=c);var M=function(me,ge){var Se=null;return me.byteLength>0&&ge!=null&&ge.key!=null&&ge.iv!==null&&ge.method!=null&&(Se=ge),Se}(A,r);if(M&&M.method==="AES-128"){var N=this.getDecrypter();if(!C.enableSoftwareAES)return this.decryptionPromise=N.webCryptoDecrypt(A,M.key.buffer,M.iv.buffer).then(function(me){var ge=L.push(me,null,a);return L.decryptionPromise=null,ge}),this.decryptionPromise;var B=N.softwareDecrypt(A,M.key.buffer,M.iv.buffer);if(!B)return S.executeEnd=D(),s(a);A=new Uint8Array(B)}var U=c||O,G=U.contiguous,z=U.discontinuity,Y=U.trackSwitch,X=U.accurateTimeOffset,$=U.timeOffset,Z=P.audioCodec,ue=P.videoCodec,de=P.defaultInitPts,ve=P.duration,te=P.initSegmentData;if((z||Y)&&this.resetInitSegment(te,Z,ue,ve),z&&this.resetInitialTimestamp(de),G||this.resetContiguity(),this.needsProbing(A,z,Y)){if(x.dataLength){var fe=x.flush();A=Object(T.appendUint8Array)(fe,A)}this.configureTransmuxer(A,P)}var ae=this.transmux(A,M,$,X,a),oe=this.currentTransmuxState;return oe.contiguous=!0,oe.discontinuity=!1,oe.trackSwitch=!1,S.executeEnd=D(),ae},p.flush=function(y){var r=this,a=y.transmuxing;a.executeStart=D();var c=this.decrypter,L=this.cache,S=this.currentTransmuxState,A=this.decryptionPromise;if(A)return A.then(function(){return r.flush(y)});var x=[],C=S.timeOffset;if(c){var O=c.flush();O&&x.push(this.push(O,null,y))}var P=L.dataLength;L.reset();var M=this.demuxer,N=this.remuxer;if(!M||!N)return P>=n&&this.observer.emit(h.Events.ERROR,h.Events.ERROR,{type:k.ErrorTypes.MEDIA_ERROR,details:k.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),a.executeEnd=D(),[s(y)];var B=M.flush(C);return o(B)?B.then(function(U){return r.flushRemux(x,U,y),x}):(this.flushRemux(x,B,y),x)},p.flushRemux=function(y,r,a){var c=r.audioTrack,L=r.avcTrack,S=r.id3Track,A=r.textTrack,x=this.currentTransmuxState,C=x.accurateTimeOffset,O=x.timeOffset;u.logger.log("[transmuxer.ts]: Flushed fragment "+a.sn+(a.part>-1?" p: "+a.part:"")+" of level "+a.level);var P=this.remuxer.remux(c,L,S,A,O,C,!0,this.id);y.push({remuxResult:P,chunkMeta:a}),a.transmuxing.executeEnd=D()},p.resetInitialTimestamp=function(y){var r=this.demuxer,a=this.remuxer;r&&a&&(r.resetTimeStamp(y),a.resetTimeStamp(y))},p.resetContiguity=function(){var y=this.demuxer,r=this.remuxer;y&&r&&(y.resetContiguity(),r.resetNextTimestamp())},p.resetInitSegment=function(y,r,a,c){var L=this.demuxer,S=this.remuxer;L&&S&&(L.resetInitSegment(r,a,c),S.resetInitSegment(y,r,a))},p.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},p.transmux=function(y,r,a,c,L){return r&&r.method==="SAMPLE-AES"?this.transmuxSampleAes(y,r,a,c,L):this.transmuxUnencrypted(y,a,c,L)},p.transmuxUnencrypted=function(y,r,a,c){var L=this.demuxer.demux(y,r,!1,!this.config.progressive),S=L.audioTrack,A=L.avcTrack,x=L.id3Track,C=L.textTrack;return{remuxResult:this.remuxer.remux(S,A,x,C,r,a,!1,this.id),chunkMeta:c}},p.transmuxSampleAes=function(y,r,a,c,L){var S=this;return this.demuxer.demuxSampleAes(y,r,a).then(function(A){return{remuxResult:S.remuxer.remux(A.audioTrack,A.avcTrack,A.id3Track,A.textTrack,a,c,!1,S.id),chunkMeta:L}})},p.configureTransmuxer=function(y,r){for(var a,c=this.config,L=this.observer,S=this.typeSupported,A=this.vendor,x=r.audioCodec,C=r.defaultInitPts,O=r.duration,P=r.initSegmentData,M=r.videoCodec,N=0,B=e.length;N<B;N++)if(e[N].demux.probe(y)){a=e[N];break}a||(u.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),a={demux:_.default,remux:g.default});var U=this.demuxer,G=this.remuxer,z=a.remux,Y=a.demux;G&&G instanceof z||(this.remuxer=new z(L,c,S,A)),U&&U instanceof Y||(this.demuxer=new Y(L,c,S),this.probe=Y.probe),this.resetInitSegment(P,x,M,O),this.resetInitialTimestamp(C)},p.needsProbing=function(y,r,a){return!this.demuxer||!this.remuxer||r||a},p.getDecrypter=function(){var y=this.decrypter;return y||(y=this.decrypter=new R.default(this.observer,this.config)),y},m}(),s=function(m){return{remuxResult:{},chunkMeta:m}};function o(m){return"then"in m&&m.then instanceof Function}var i=function(m,p,y,r,a){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=m,this.videoCodec=p,this.initSegmentData=y,this.duration=r,this.defaultInitPts=a},d=function(m,p,y,r,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.discontinuity=m,this.contiguous=p,this.accurateTimeOffset=y,this.trackSwitch=r,this.timeOffset=a}},"./src/demux/tsdemuxer.ts":function(F,I,v){v.r(I),v.d(I,"discardEPB",function(){return o});var D=v("./src/demux/adts.ts"),h=v("./src/demux/mpegaudio.ts"),k=v("./src/demux/exp-golomb.ts"),R=v("./src/demux/id3.ts"),w=v("./src/demux/sample-aes.ts"),_=v("./src/events.ts"),l=v("./src/utils/mp4-tools.ts"),E=v("./src/utils/logger.ts"),f=v("./src/errors.ts"),g={video:1,audio:2,id3:3,text:4},b=function(){function i(m,p,y){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this.aacLastPTS=null,this._initPTS=null,this._initDTS=null,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=m,this.config=p,this.typeSupported=y}i.probe=function(m){var p=i.syncOffset(m);return!(p<0||(p&&E.logger.warn("MPEG2-TS detected but first sync word found @ offset "+p+", junk ahead ?"),0))},i.syncOffset=function(m){for(var p=Math.min(1e3,m.length-564),y=0;y<p;){if(m[y]===71&&m[y+188]===71&&m[y+376]===71)return y;y++}return-1},i.createTrack=function(m,p){return{container:m==="video"||m==="audio"?"video/mp2t":void 0,type:m,id:g[m],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:m==="audio"?p:void 0}};var d=i.prototype;return d.resetInitSegment=function(m,p,y){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=i.createTrack("video",y),this._audioTrack=i.createTrack("audio",y),this._id3Track=i.createTrack("id3",y),this._txtTrack=i.createTrack("text",y),this._audioTrack.isAAC=!0,this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=m,this.videoCodec=p,this._duration=y},d.resetTimeStamp=function(){},d.resetContiguity=function(){var m=this._audioTrack,p=this._avcTrack,y=this._id3Track;m&&(m.pesData=null),p&&(p.pesData=null),y&&(y.pesData=null),this.aacOverFlow=null,this.aacLastPTS=null},d.demux=function(m,p,y,r){var a;y===void 0&&(y=!1),r===void 0&&(r=!1),y||(this.sampleAes=null);var c=this._avcTrack,L=this._audioTrack,S=this._id3Track,A=c.pid,x=c.pesData,C=L.pid,O=S.pid,P=L.pesData,M=S.pesData,N=!1,B=this.pmtParsed,U=this._pmtId,G=m.length;if(this.remainderData&&(G=(m=Object(l.appendUint8Array)(this.remainderData,m)).length,this.remainderData=null),G<188&&!r)return this.remainderData=m,{audioTrack:L,avcTrack:c,id3Track:S,textTrack:this._txtTrack};var z=Math.max(0,i.syncOffset(m));(G-=(G+z)%188)<m.byteLength&&!r&&(this.remainderData=new Uint8Array(m.buffer,G,m.buffer.byteLength-G));for(var Y=z;Y<G;Y+=188)if(m[Y]===71){var X=!!(64&m[Y+1]),$=((31&m[Y+1])<<8)+m[Y+2],Z=void 0;if((48&m[Y+3])>>4>1){if((Z=Y+5+m[Y+4])===Y+188)continue}else Z=Y+4;switch($){case A:X&&(x&&(a=n(x))&&this.parseAVCPES(a,!1),x={data:[],size:0}),x&&(x.data.push(m.subarray(Z,Y+188)),x.size+=Y+188-Z);break;case C:X&&(P&&(a=n(P))&&(L.isAAC?this.parseAACPES(a):this.parseMPEGPES(a)),P={data:[],size:0}),P&&(P.data.push(m.subarray(Z,Y+188)),P.size+=Y+188-Z);break;case O:X&&(M&&(a=n(M))&&this.parseID3PES(a),M={data:[],size:0}),M&&(M.data.push(m.subarray(Z,Y+188)),M.size+=Y+188-Z);break;case 0:X&&(Z+=m[Z]+1),U=this._pmtId=u(m,Z);break;case U:X&&(Z+=m[Z]+1);var ue=e(m,Z,this.typeSupported.mpeg===!0||this.typeSupported.mp3===!0,y);(A=ue.avc)>0&&(c.pid=A),(C=ue.audio)>0&&(L.pid=C,L.isAAC=ue.isAAC),(O=ue.id3)>0&&(S.pid=O),N&&!B&&(E.logger.log("reparse from beginning"),N=!1,Y=z-188),B=this.pmtParsed=!0;break;case 17:case 8191:break;default:N=!0}}else this.observer.emit(_.Events.ERROR,_.Events.ERROR,{type:f.ErrorTypes.MEDIA_ERROR,details:f.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});c.pesData=x,L.pesData=P,S.pesData=M;var de={audioTrack:L,avcTrack:c,id3Track:S,textTrack:this._txtTrack};return r&&this.extractRemainingSamples(de),de},d.flush=function(){var m,p=this.remainderData;return this.remainderData=null,m=p?this.demux(p,-1,!1,!0):{audioTrack:this._audioTrack,avcTrack:this._avcTrack,textTrack:this._txtTrack,id3Track:this._id3Track},this.extractRemainingSamples(m),this.sampleAes?this.decrypt(m,this.sampleAes):m},d.extractRemainingSamples=function(m){var p,y=m.audioTrack,r=m.avcTrack,a=m.id3Track,c=r.pesData,L=y.pesData,S=a.pesData;c&&(p=n(c))?(this.parseAVCPES(p,!0),r.pesData=null):r.pesData=c,L&&(p=n(L))?(y.isAAC?this.parseAACPES(p):this.parseMPEGPES(p),y.pesData=null):(L!=null&&L.size&&E.logger.log("last AAC PES packet truncated,might overlap between fragments"),y.pesData=L),S&&(p=n(S))?(this.parseID3PES(p),a.pesData=null):a.pesData=S},d.demuxSampleAes=function(m,p,y){var r=this.demux(m,y,!0,!this.config.progressive),a=this.sampleAes=new w.default(this.observer,this.config,p);return this.decrypt(r,a)},d.decrypt=function(m,p){return new Promise(function(y){var r=m.audioTrack,a=m.avcTrack;r.samples&&r.isAAC?p.decryptAacSamples(r.samples,0,function(){a.samples?p.decryptAvcSamples(a.samples,0,0,function(){y(m)}):y(m)}):a.samples&&p.decryptAvcSamples(a.samples,0,0,function(){y(m)})})},d.destroy=function(){this._initPTS=this._initDTS=null,this._duration=0},d.parseAVCPES=function(m,p){var y,r=this,a=this._avcTrack,c=this.parseAVCNALu(m.data),L=this.avcSample,S=!1;m.data=null,L&&c.length&&!a.audFound&&(t(L,a),L=this.avcSample=T(!1,m.pts,m.dts,"")),c.forEach(function(A){switch(A.type){case 1:y=!0,L||(L=r.avcSample=T(!0,m.pts,m.dts,"")),L.frame=!0;var x=A.data;if(S&&x.length>4){var C=new k.default(x).readSliceType();C!==2&&C!==4&&C!==7&&C!==9||(L.key=!0)}break;case 5:y=!0,L||(L=r.avcSample=T(!0,m.pts,m.dts,"")),L.key=!0,L.frame=!0;break;case 6:y=!0;var O=new k.default(o(A.data));O.readUByte();for(var P=0,M=0,N=!1,B=0;!N&&O.bytesAvailable>1;){P=0;do P+=B=O.readUByte();while(B===255);M=0;do M+=B=O.readUByte();while(B===255);if(P===4&&O.bytesAvailable!==0){if(N=!0,O.readUByte()===181&&O.readUShort()===49&&O.readUInt()===1195456820&&O.readUByte()===3){for(var U=O.readUByte(),G=31&U,z=[U,O.readUByte()],Y=0;Y<G;Y++)z.push(O.readUByte()),z.push(O.readUByte()),z.push(O.readUByte());s(r._txtTrack.samples,{type:3,pts:m.pts,bytes:z})}}else if(P===5&&O.bytesAvailable!==0){if(N=!0,M>16){for(var X=[],$=0;$<16;$++)X.push(O.readUByte().toString(16)),$!==3&&$!==5&&$!==7&&$!==9||X.push("-");for(var Z=M-16,ue=new Uint8Array(Z),de=0;de<Z;de++)ue[de]=O.readUByte();s(r._txtTrack.samples,{pts:m.pts,payloadType:P,uuid:X.join(""),userData:Object(R.utf8ArrayToStr)(ue),userDataBytes:ue})}}else if(M<O.bytesAvailable)for(var ve=0;ve<M;ve++)O.readUByte()}break;case 7:if(y=!0,S=!0,!a.sps){var te=new k.default(A.data).readSPS();a.width=te.width,a.height=te.height,a.pixelRatio=te.pixelRatio,a.sps=[A.data],a.duration=r._duration;for(var fe=A.data.subarray(1,4),ae="avc1.",oe=0;oe<3;oe++){var me=fe[oe].toString(16);me.length<2&&(me="0"+me),ae+=me}a.codec=ae}break;case 8:y=!0,a.pps||(a.pps=[A.data]);break;case 9:y=!1,a.audFound=!0,L&&t(L,a),L=r.avcSample=T(!1,m.pts,m.dts,"");break;case 12:y=!1;break;default:y=!1,L&&(L.debug+="unknown NAL "+A.type+" ")}L&&y&&L.units.push(A)}),p&&L&&(t(L,a),this.avcSample=null)},d.getLastNalUnit=function(){var m,p,y=this.avcSample;if(!y||y.units.length===0){var r=this._avcTrack.samples;y=r[r.length-1]}if((m=y)!==null&&m!==void 0&&m.units){var a=y.units;p=a[a.length-1]}return p},d.parseAVCNALu=function(m){var p,y,r=m.byteLength,a=this._avcTrack,c=a.naluState||0,L=c,S=[],A=0,x=-1,C=0;for(c===-1&&(x=0,C=31&m[0],c=0,A=1);A<r;)if(p=m[A++],c)if(c!==1)if(p)if(p===1){if(x>=0){var O={data:m.subarray(x,A-c-1),type:C};S.push(O)}else{var P=this.getLastNalUnit();if(P&&(L&&A<=4-L&&P.state&&(P.data=P.data.subarray(0,P.data.byteLength-L)),(y=A-c-1)>0)){var M=new Uint8Array(P.data.byteLength+y);M.set(P.data,0),M.set(m.subarray(0,y),P.data.byteLength),P.data=M}}A<r?(x=A,C=31&m[A],c=0):c=-1}else c=0;else c=3;else c=p?0:2;else c=p?0:1;if(x>=0&&c>=0){var N={data:m.subarray(x,r),type:C,state:c};S.push(N)}if(S.length===0){var B=this.getLastNalUnit();if(B){var U=new Uint8Array(B.data.byteLength+m.byteLength);U.set(B.data,0),U.set(m,B.data.byteLength),B.data=U}}return a.naluState=c,S},d.parseAACPES=function(m){var p,y,r,a,c,L=0,S=this._audioTrack,A=this.aacOverFlow,x=m.data;if(A){this.aacOverFlow=null;var C=A.sample.unit.byteLength,O=Math.min(A.missing,C),P=C-O;A.sample.unit.set(x.subarray(0,O),P),S.samples.push(A.sample),L=A.missing}for(p=L,y=x.length;p<y-1&&!D.isHeader(x,p);p++);if(p===L||(p<y-1?(r="AAC PES did not start with ADTS header,offset:"+p,a=!1):(r="no ADTS header found in AAC PES",a=!0),E.logger.warn("parsing error:"+r),this.observer.emit(_.Events.ERROR,_.Events.ERROR,{type:f.ErrorTypes.MEDIA_ERROR,details:f.ErrorDetails.FRAG_PARSING_ERROR,fatal:a,reason:r}),!a)){if(D.initTrackConfig(S,this.observer,x,p,this.audioCodec),m.pts!==void 0)c=m.pts;else{if(!A)return void E.logger.warn("[tsdemuxer]: AAC PES unknown PTS");var M=D.getFrameDuration(S.samplerate);c=A.sample.pts+M}for(var N=0;p<y;){if(D.isHeader(x,p)){if(p+5<y){var B=D.appendFrame(S,x,p,c,N);if(B){if(!B.missing){p+=B.length,N++;continue}this.aacOverFlow=B}}break}p++}}},d.parseMPEGPES=function(m){var p=m.data,y=p.length,r=0,a=0,c=m.pts;if(c!==void 0)for(;a<y;)if(h.isHeader(p,a)){var L=h.appendFrame(this._audioTrack,p,a,c,r);if(!L)break;a+=L.length,r++}else a++;else E.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")},d.parseID3PES=function(m){m.pts!==void 0?this._id3Track.samples.push(m):E.logger.warn("[tsdemuxer]: ID3 PES unknown PTS")},i}();function T(i,d,m,p){return{key:i,frame:!1,pts:d,dts:m,units:[],debug:p,length:0}}function u(i,d){return(31&i[d+10])<<8|i[d+11]}function e(i,d,m,p){var y={audio:-1,avc:-1,id3:-1,isAAC:!0},r=d+3+((15&i[d+1])<<8|i[d+2])-4;for(d+=12+((15&i[d+10])<<8|i[d+11]);d<r;){var a=(31&i[d+1])<<8|i[d+2];switch(i[d]){case 207:if(!p){E.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:y.audio===-1&&(y.audio=a);break;case 21:y.id3===-1&&(y.id3=a);break;case 219:if(!p){E.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:y.avc===-1&&(y.avc=a);break;case 3:case 4:m?y.audio===-1&&(y.audio=a,y.isAAC=!1):E.logger.log("MPEG audio found, not supported in this browser");break;case 36:E.logger.warn("Unsupported HEVC stream type found")}d+=5+((15&i[d+3])<<8|i[d+4])}return y}function n(i){var d,m,p,y,r,a=0,c=i.data;if(!i||i.size===0)return null;for(;c[0].length<19&&c.length>1;){var L=new Uint8Array(c[0].length+c[1].length);L.set(c[0]),L.set(c[1],c[0].length),c[0]=L,c.splice(1,1)}if(((d=c[0])[0]<<16)+(d[1]<<8)+d[2]===1){if((m=(d[4]<<8)+d[5])&&m>i.size-6)return null;var S=d[7];192&S&&(y=536870912*(14&d[9])+4194304*(255&d[10])+16384*(254&d[11])+128*(255&d[12])+(254&d[13])/2,64&S?y-(r=536870912*(14&d[14])+4194304*(255&d[15])+16384*(254&d[16])+128*(255&d[17])+(254&d[18])/2)>54e5&&(E.logger.warn(Math.round((y-r)/9e4)+"s delta between PTS and DTS, align them"),y=r):r=y);var A=(p=d[8])+9;if(i.size<=A)return null;i.size-=A;for(var x=new Uint8Array(i.size),C=0,O=c.length;C<O;C++){var P=(d=c[C]).byteLength;if(A){if(A>P){A-=P;continue}d=d.subarray(A),P-=A,A=0}x.set(d,a),a+=P}return m&&(m-=p+3),{data:x,pts:y,dts:r,len:m}}return null}function t(i,d){if(i.units.length&&i.frame){if(i.pts===void 0){var m=d.samples,p=m.length;if(!p)return void d.dropped++;var y=m[p-1];i.pts=y.pts,i.dts=y.dts}d.samples.push(i)}i.debug.length&&E.logger.log(i.pts+"/"+i.dts+":"+i.debug)}function s(i,d){var m=i.length;if(m>0){if(d.pts>=i[m-1].pts)i.push(d);else for(var p=m-1;p>=0;p--)if(d.pts<i[p].pts){i.splice(p,0,d);break}}else i.push(d)}function o(i){for(var d=i.byteLength,m=[],p=1;p<d-2;)i[p]===0&&i[p+1]===0&&i[p+2]===3?(m.push(p+2),p+=2):p++;if(m.length===0)return i;var y=d-m.length,r=new Uint8Array(y),a=0;for(p=0;p<y;a++,p++)a===m[0]&&(a++,m.shift()),r[p]=i[a];return r}b.minProbeByteLength=188,I.default=b},"./src/errors.ts":function(F,I,v){var D,h,k,R;v.r(I),v.d(I,"ErrorTypes",function(){return D}),v.d(I,"ErrorDetails",function(){return k}),(h=D||(D={})).NETWORK_ERROR="networkError",h.MEDIA_ERROR="mediaError",h.KEY_SYSTEM_ERROR="keySystemError",h.MUX_ERROR="muxError",h.OTHER_ERROR="otherError",(R=k||(k={})).KEY_SYSTEM_NO_KEYS="keySystemNoKeys",R.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",R.KEY_SYSTEM_NO_SESSION="keySystemNoSession",R.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",R.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",R.MANIFEST_LOAD_ERROR="manifestLoadError",R.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",R.MANIFEST_PARSING_ERROR="manifestParsingError",R.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",R.LEVEL_EMPTY_ERROR="levelEmptyError",R.LEVEL_LOAD_ERROR="levelLoadError",R.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",R.LEVEL_SWITCH_ERROR="levelSwitchError",R.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",R.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",R.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",R.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",R.FRAG_LOAD_ERROR="fragLoadError",R.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",R.FRAG_DECRYPT_ERROR="fragDecryptError",R.FRAG_PARSING_ERROR="fragParsingError",R.REMUX_ALLOC_ERROR="remuxAllocError",R.KEY_LOAD_ERROR="keyLoadError",R.KEY_LOAD_TIMEOUT="keyLoadTimeOut",R.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",R.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",R.BUFFER_APPEND_ERROR="bufferAppendError",R.BUFFER_APPENDING_ERROR="bufferAppendingError",R.BUFFER_STALLED_ERROR="bufferStalledError",R.BUFFER_FULL_ERROR="bufferFullError",R.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",R.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",R.INTERNAL_EXCEPTION="internalException",R.INTERNAL_ABORTED="aborted",R.UNKNOWN="unknown"},"./src/events.ts":function(F,I,v){var D,h;v.r(I),v.d(I,"Events",function(){return D}),(h=D||(D={})).MEDIA_ATTACHING="hlsMediaAttaching",h.MEDIA_ATTACHED="hlsMediaAttached",h.MEDIA_DETACHING="hlsMediaDetaching",h.MEDIA_DETACHED="hlsMediaDetached",h.BUFFER_RESET="hlsBufferReset",h.BUFFER_CODECS="hlsBufferCodecs",h.BUFFER_CREATED="hlsBufferCreated",h.BUFFER_APPENDING="hlsBufferAppending",h.BUFFER_APPENDED="hlsBufferAppended",h.BUFFER_EOS="hlsBufferEos",h.BUFFER_FLUSHING="hlsBufferFlushing",h.BUFFER_FLUSHED="hlsBufferFlushed",h.MANIFEST_LOADING="hlsManifestLoading",h.MANIFEST_LOADED="hlsManifestLoaded",h.MANIFEST_PARSED="hlsManifestParsed",h.LEVEL_SWITCHING="hlsLevelSwitching",h.LEVEL_SWITCHED="hlsLevelSwitched",h.LEVEL_LOADING="hlsLevelLoading",h.LEVEL_LOADED="hlsLevelLoaded",h.LEVEL_UPDATED="hlsLevelUpdated",h.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",h.LEVELS_UPDATED="hlsLevelsUpdated",h.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",h.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",h.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",h.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",h.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",h.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",h.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",h.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",h.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",h.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",h.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",h.CUES_PARSED="hlsCuesParsed",h.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",h.INIT_PTS_FOUND="hlsInitPtsFound",h.FRAG_LOADING="hlsFragLoading",h.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",h.FRAG_LOADED="hlsFragLoaded",h.FRAG_DECRYPTED="hlsFragDecrypted",h.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",h.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",h.FRAG_PARSING_METADATA="hlsFragParsingMetadata",h.FRAG_PARSED="hlsFragParsed",h.FRAG_BUFFERED="hlsFragBuffered",h.FRAG_CHANGED="hlsFragChanged",h.FPS_DROP="hlsFpsDrop",h.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",h.ERROR="hlsError",h.DESTROYING="hlsDestroying",h.KEY_LOADING="hlsKeyLoading",h.KEY_LOADED="hlsKeyLoaded",h.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",h.BACK_BUFFER_REACHED="hlsBackBufferReached"},"./src/hls.ts":function(F,I,v){v.r(I),v.d(I,"default",function(){return t});var D=v("./node_modules/url-toolkit/src/url-toolkit.js"),h=v("./src/loader/playlist-loader.ts"),k=v("./src/loader/key-loader.ts"),R=v("./src/controller/id3-track-controller.ts"),w=v("./src/controller/latency-controller.ts"),_=v("./src/controller/level-controller.ts"),l=v("./src/controller/fragment-tracker.ts"),E=v("./src/controller/stream-controller.ts"),f=v("./src/is-supported.ts"),g=v("./src/utils/logger.ts"),b=v("./src/config.ts"),T=v("./node_modules/eventemitter3/index.js"),u=v("./src/events.ts"),e=v("./src/errors.ts");function n(s,o){for(var i=0;i<o.length;i++){var d=o[i];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(s,d.key,d)}}var t=function(){function s(p){p===void 0&&(p={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new T.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this._media=null,this.url=null;var y=this.config=Object(b.mergeConfig)(s.DefaultConfig,p);this.userConfig=p,Object(g.enableLogs)(y.debug),this._autoLevelCapping=-1,y.progressive&&Object(b.enableStreamingMode)(y);var r=y.abrController,a=y.bufferController,c=y.capLevelController,L=y.fpsController,S=this.abrController=new r(this),A=this.bufferController=new a(this),x=this.capLevelController=new c(this),C=new L(this),O=new h.default(this),P=new k.default(this),M=new R.default(this),N=this.levelController=new _.default(this),B=new l.FragmentTracker(this),U=this.streamController=new E.default(this,B);x.setStreamController(U),C.setStreamController(U);var G=[N,U];this.networkControllers=G;var z=[O,P,S,A,x,C,M,B];this.audioTrackController=this.createController(y.audioTrackController,null,G),this.createController(y.audioStreamController,B,G),this.subtitleTrackController=this.createController(y.subtitleTrackController,null,G),this.createController(y.subtitleStreamController,B,G),this.createController(y.timelineController,null,z),this.emeController=this.createController(y.emeController,null,z),this.latencyController=this.createController(w.default,null,z),this.coreComponents=z}s.isSupported=function(){return Object(f.isSupported)()};var o,i,d,m=s.prototype;return m.createController=function(p,y,r){if(p){var a=y?new p(this,y):new p(this);return r&&r.push(a),a}return null},m.on=function(p,y,r){r===void 0&&(r=this),this._emitter.on(p,y,r)},m.once=function(p,y,r){r===void 0&&(r=this),this._emitter.once(p,y,r)},m.removeAllListeners=function(p){this._emitter.removeAllListeners(p)},m.off=function(p,y,r,a){r===void 0&&(r=this),this._emitter.off(p,y,r,a)},m.listeners=function(p){return this._emitter.listeners(p)},m.emit=function(p,y,r){return this._emitter.emit(p,y,r)},m.trigger=function(p,y){if(this.config.debug)return this.emit(p,p,y);try{return this.emit(p,p,y)}catch(r){g.logger.error("An internal error happened while handling event "+p+'. Error message: "'+r.message+'". Here is a stacktrace:',r),this.trigger(u.Events.ERROR,{type:e.ErrorTypes.OTHER_ERROR,details:e.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:p,error:r})}return!1},m.listenerCount=function(p){return this._emitter.listenerCount(p)},m.destroy=function(){g.logger.log("destroy"),this.trigger(u.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(p){return p.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(p){return p.destroy()}),this.coreComponents.length=0},m.attachMedia=function(p){g.logger.log("attachMedia"),this._media=p,this.trigger(u.Events.MEDIA_ATTACHING,{media:p})},m.detachMedia=function(){g.logger.log("detachMedia"),this.trigger(u.Events.MEDIA_DETACHING,void 0),this._media=null},m.loadSource=function(p){this.stopLoad();var y=this.media,r=this.url,a=this.url=D.buildAbsoluteURL(self.location.href,p,{alwaysNormalize:!0});g.logger.log("loadSource:"+a),y&&r&&r!==a&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(y)),this.trigger(u.Events.MANIFEST_LOADING,{url:p})},m.startLoad=function(p){p===void 0&&(p=-1),g.logger.log("startLoad("+p+")"),this.networkControllers.forEach(function(y){y.startLoad(p)})},m.stopLoad=function(){g.logger.log("stopLoad"),this.networkControllers.forEach(function(p){p.stopLoad()})},m.swapAudioCodec=function(){g.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},m.recoverMediaError=function(){g.logger.log("recoverMediaError");var p=this._media;this.detachMedia(),p&&this.attachMedia(p)},m.removeLevel=function(p,y){y===void 0&&(y=0),this.levelController.removeLevel(p,y)},o=s,d=[{key:"version",get:function(){return"1.0.10"}},{key:"Events",get:function(){return u.Events}},{key:"ErrorTypes",get:function(){return e.ErrorTypes}},{key:"ErrorDetails",get:function(){return e.ErrorDetails}},{key:"DefaultConfig",get:function(){return s.defaultConfig?s.defaultConfig:b.hlsDefaultConfig},set:function(p){s.defaultConfig=p}}],(i=[{key:"levels",get:function(){var p=this.levelController.levels;return p||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(p){g.logger.log("set currentLevel:"+p),this.loadLevel=p,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(p){g.logger.log("set nextLevel:"+p),this.levelController.manualLevel=p,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(p){g.logger.log("set loadLevel:"+p),this.levelController.manualLevel=p}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(p){this.levelController.nextLoadLevel=p}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(p){g.logger.log("set firstLevel:"+p),this.levelController.firstLevel=p}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(p){g.logger.log("set startLevel:"+p),p!==-1&&(p=Math.max(p,this.minAutoLevel)),this.levelController.startLevel=p}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(p){var y=!!p;y!==this.config.capLevelToPlayerSize&&(y?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=y)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(p){this._autoLevelCapping!==p&&(g.logger.log("set autoLevelCapping:"+p),this._autoLevelCapping=p)}},{key:"bandwidthEstimate",get:function(){var p=this.abrController.bwEstimator;return p?p.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var p=this.levels,y=this.config.minAutoBitrate;if(!p)return 0;for(var r=p.length,a=0;a<r;a++)if(p[a].maxBitrate>y)return a;return 0}},{key:"maxAutoLevel",get:function(){var p=this.levels,y=this.autoLevelCapping;return y===-1&&p&&p.length?p.length-1:y}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(p){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,p)}},{key:"audioTracks",get:function(){var p=this.audioTrackController;return p?p.audioTracks:[]}},{key:"audioTrack",get:function(){var p=this.audioTrackController;return p?p.audioTrack:-1},set:function(p){var y=this.audioTrackController;y&&(y.audioTrack=p)}},{key:"subtitleTracks",get:function(){var p=this.subtitleTrackController;return p?p.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var p=this.subtitleTrackController;return p?p.subtitleTrack:-1},set:function(p){var y=this.subtitleTrackController;y&&(y.subtitleTrack=p)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var p=this.subtitleTrackController;return!!p&&p.subtitleDisplay},set:function(p){var y=this.subtitleTrackController;y&&(y.subtitleDisplay=p)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(p){this.config.lowLatencyMode=p}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}])&&n(o.prototype,i),d&&n(o,d),s}();t.defaultConfig=void 0},"./src/is-supported.ts":function(F,I,v){v.r(I),v.d(I,"isSupported",function(){return k}),v.d(I,"changeTypeSupported",function(){return R});var D=v("./src/utils/mediasource-helper.ts");function h(){return self.SourceBuffer||self.WebKitSourceBuffer}function k(){var w=Object(D.getMediaSource)();if(!w)return!1;var _=h(),l=w&&typeof w.isTypeSupported=="function"&&w.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),E=!_||_.prototype&&typeof _.prototype.appendBuffer=="function"&&typeof _.prototype.remove=="function";return!!l&&!!E}function R(){var w,_=h();return typeof(_==null||(w=_.prototype)===null||w===void 0?void 0:w.changeType)=="function"}},"./src/loader/fragment-loader.ts":function(F,I,v){v.r(I),v.d(I,"default",function(){return f}),v.d(I,"LoadError",function(){return b});var D=v("./src/polyfills/number.ts"),h=v("./src/errors.ts");function k(T){var u=typeof Map=="function"?new Map:void 0;return(k=function(e){if(e===null||(n=e,Function.toString.call(n).indexOf("[native code]")===-1))return e;var n;if(typeof e!="function")throw new TypeError("Super expression must either be null or a function");if(u!==void 0){if(u.has(e))return u.get(e);u.set(e,t)}function t(){return R(e,arguments,l(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),_(t,e)})(T)}function R(T,u,e){return(R=w()?Reflect.construct:function(n,t,s){var o=[null];o.push.apply(o,t);var i=new(Function.bind.apply(n,o));return s&&_(i,s.prototype),i}).apply(null,arguments)}function w(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function _(T,u){return(_=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(T,u)}function l(T){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(u){return u.__proto__||Object.getPrototypeOf(u)})(T)}var E=Math.pow(2,17),f=function(){function T(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}var u=T.prototype;return u.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},u.abort=function(){this.loader&&this.loader.abort()},u.load=function(e,n){var t=this,s=e.url;if(!s)return Promise.reject(new b({type:h.ErrorTypes.NETWORK_ERROR,details:h.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,networkDetails:null},"Fragment does not have a "+(s?"part list":"url")));this.abort();var o=this.config,i=o.fLoader,d=o.loader;return new Promise(function(m,p){t.loader&&t.loader.destroy();var y=t.loader=e.loader=i?new i(o):new d(o),r=g(e),a={timeout:o.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:o.fragLoadingMaxRetryTimeout,highWaterMark:E};e.stats=y.stats,y.load(r,a,{onSuccess:function(c,L,S,A){t.resetLoader(e,y),m({frag:e,part:null,payload:c.data,networkDetails:A})},onError:function(c,L,S){t.resetLoader(e,y),p(new b({type:h.ErrorTypes.NETWORK_ERROR,details:h.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:c,networkDetails:S}))},onAbort:function(c,L,S){t.resetLoader(e,y),p(new b({type:h.ErrorTypes.NETWORK_ERROR,details:h.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:e,networkDetails:S}))},onTimeout:function(c,L,S){t.resetLoader(e,y),p(new b({type:h.ErrorTypes.NETWORK_ERROR,details:h.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,networkDetails:S}))},onProgress:function(c,L,S,A){n&&n({frag:e,part:null,payload:S,networkDetails:A})}})})},u.loadPart=function(e,n,t){var s=this;this.abort();var o=this.config,i=o.fLoader,d=o.loader;return new Promise(function(m,p){s.loader&&s.loader.destroy();var y=s.loader=e.loader=i?new i(o):new d(o),r=g(e,n),a={timeout:o.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:o.fragLoadingMaxRetryTimeout,highWaterMark:E};n.stats=y.stats,y.load(r,a,{onSuccess:function(c,L,S,A){s.resetLoader(e,y),s.updateStatsFromPart(e,n);var x={frag:e,part:n,payload:c.data,networkDetails:A};t(x),m(x)},onError:function(c,L,S){s.resetLoader(e,y),p(new b({type:h.ErrorTypes.NETWORK_ERROR,details:h.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:n,response:c,networkDetails:S}))},onAbort:function(c,L,S){e.stats.aborted=n.stats.aborted,s.resetLoader(e,y),p(new b({type:h.ErrorTypes.NETWORK_ERROR,details:h.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:e,part:n,networkDetails:S}))},onTimeout:function(c,L,S){s.resetLoader(e,y),p(new b({type:h.ErrorTypes.NETWORK_ERROR,details:h.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:n,networkDetails:S}))}})})},u.updateStatsFromPart=function(e,n){var t=e.stats,s=n.stats,o=s.total;if(t.loaded+=s.loaded,o){var i=Math.round(e.duration/n.duration),d=Math.min(Math.round(t.loaded/o),i),m=(i-d)*Math.round(t.loaded/d);t.total=t.loaded+m}else t.total=Math.max(t.loaded,t.total);var p=t.loading,y=s.loading;p.start?p.first+=y.first-y.start:(p.start=y.start,p.first=y.first),p.end=y.end},u.resetLoader=function(e,n){e.loader=null,this.loader===n&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),n.destroy()},T}();function g(T,u){u===void 0&&(u=null);var e=u||T,n={frag:T,part:u,responseType:"arraybuffer",url:e.url,rangeStart:0,rangeEnd:0},t=e.byteRangeStartOffset,s=e.byteRangeEndOffset;return Object(D.isFiniteNumber)(t)&&Object(D.isFiniteNumber)(s)&&(n.rangeStart=t,n.rangeEnd=s),n}var b=function(T){var u,e;function n(t){for(var s,o=arguments.length,i=new Array(o>1?o-1:0),d=1;d<o;d++)i[d-1]=arguments[d];return(s=T.call.apply(T,[this].concat(i))||this).data=void 0,s.data=t,s}return e=T,(u=n).prototype=Object.create(e.prototype),u.prototype.constructor=u,_(u,e),n}(k(Error))},"./src/loader/fragment.ts":function(F,I,v){v.r(I),v.d(I,"ElementaryStreamTypes",function(){return D}),v.d(I,"BaseSegment",function(){return T}),v.d(I,"Fragment",function(){return u}),v.d(I,"Part",function(){return e});var D,h,k=v("./src/polyfills/number.ts"),R=v("./node_modules/url-toolkit/src/url-toolkit.js"),w=v("./src/utils/logger.ts"),_=v("./src/loader/level-key.ts"),l=v("./src/loader/load-stats.ts");function E(n,t){n.prototype=Object.create(t.prototype),n.prototype.constructor=n,f(n,t)}function f(n,t){return(f=Object.setPrototypeOf||function(s,o){return s.__proto__=o,s})(n,t)}function g(n,t){for(var s=0;s<t.length;s++){var o=t[s];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(n,o.key,o)}}function b(n,t,s){return t&&g(n.prototype,t),s&&g(n,s),n}(h=D||(D={})).AUDIO="audio",h.VIDEO="video",h.AUDIOVIDEO="audiovideo";var T=function(){function n(t){var s;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((s={})[D.AUDIO]=null,s[D.VIDEO]=null,s[D.AUDIOVIDEO]=null,s),this.baseurl=t}return n.prototype.setByteRange=function(t,s){var o=t.split("@",2),i=[];o.length===1?i[0]=s?s.byteRangeEndOffset:0:i[0]=parseInt(o[1]),i[1]=parseInt(o[0])+i[0],this._byteRange=i},b(n,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(R.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(t){this._url=t}}]),n}(),u=function(n){function t(o,i){var d;return(d=n.call(this,i)||this)._decryptdata=null,d.rawProgramDateTime=null,d.programDateTime=null,d.tagList=[],d.duration=0,d.sn=0,d.levelkey=void 0,d.type=void 0,d.loader=null,d.level=-1,d.cc=0,d.startPTS=void 0,d.endPTS=void 0,d.appendedPTS=void 0,d.startDTS=void 0,d.endDTS=void 0,d.start=0,d.deltaPTS=void 0,d.maxStartPTS=void 0,d.minEndPTS=void 0,d.stats=new l.LoadStats,d.urlId=0,d.data=void 0,d.bitrateTest=!1,d.title=null,d.initSegment=null,d.type=o,d}E(t,n);var s=t.prototype;return s.createInitializationVector=function(o){for(var i=new Uint8Array(16),d=12;d<16;d++)i[d]=o>>8*(15-d)&255;return i},s.setDecryptDataFromLevelKey=function(o,i){var d=o;return(o==null?void 0:o.method)==="AES-128"&&o.uri&&!o.iv&&((d=_.LevelKey.fromURI(o.uri)).method=o.method,d.iv=this.createInitializationVector(i),d.keyFormat="identity"),d},s.setElementaryStreamInfo=function(o,i,d,m,p,y){y===void 0&&(y=!1);var r=this.elementaryStreams,a=r[o];a?(a.startPTS=Math.min(a.startPTS,i),a.endPTS=Math.max(a.endPTS,d),a.startDTS=Math.min(a.startDTS,m),a.endDTS=Math.max(a.endDTS,p)):r[o]={startPTS:i,endPTS:d,startDTS:m,endDTS:p,partial:y}},s.clearElementaryStreamInfo=function(){var o=this.elementaryStreams;o[D.AUDIO]=null,o[D.VIDEO]=null,o[D.AUDIOVIDEO]=null},b(t,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var o=this.sn;typeof o!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&w.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),o=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,o)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!Object(k.isFiniteNumber)(this.programDateTime))return null;var o=Object(k.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*o}},{key:"encrypted",get:function(){var o;return!((o=this.decryptdata)===null||o===void 0||!o.keyFormat||!this.decryptdata.uri)}}]),t}(T),e=function(n){function t(s,o,i,d,m){var p;(p=n.call(this,i)||this).fragOffset=0,p.duration=0,p.gap=!1,p.independent=!1,p.relurl=void 0,p.fragment=void 0,p.index=void 0,p.stats=new l.LoadStats,p.duration=s.decimalFloatingPoint("DURATION"),p.gap=s.bool("GAP"),p.independent=s.bool("INDEPENDENT"),p.relurl=s.enumeratedString("URI"),p.fragment=o,p.index=d;var y=s.enumeratedString("BYTERANGE");return y&&p.setByteRange(y,m),m&&(p.fragOffset=m.fragOffset+m.duration),p}return E(t,n),b(t,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var s=this.elementaryStreams;return!!(s.audio||s.video||s.audiovideo)}}]),t}(T)},"./src/loader/key-loader.ts":function(F,I,v){v.r(I),v.d(I,"default",function(){return R});var D=v("./src/events.ts"),h=v("./src/errors.ts"),k=v("./src/utils/logger.ts"),R=function(){function w(l){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=l,this._registerListeners()}var _=w.prototype;return _._registerListeners=function(){this.hls.on(D.Events.KEY_LOADING,this.onKeyLoading,this)},_._unregisterListeners=function(){this.hls.off(D.Events.KEY_LOADING,this.onKeyLoading)},_.destroy=function(){for(var l in this._unregisterListeners(),this.loaders){var E=this.loaders[l];E&&E.destroy()}this.loaders={}},_.onKeyLoading=function(l,E){var f=E.frag,g=f.type,b=this.loaders[g];if(f.decryptdata){var T=f.decryptdata.uri;if(T!==this.decrypturl||this.decryptkey===null){var u=this.hls.config;if(b&&(k.logger.warn("abort previous key loader for type:"+g),b.abort()),!T)return void k.logger.warn("key uri is falsy");var e=u.loader,n=f.loader=this.loaders[g]=new e(u);this.decrypturl=T,this.decryptkey=null;var t={url:T,frag:f,responseType:"arraybuffer"},s={timeout:u.fragLoadingTimeOut,maxRetry:0,retryDelay:u.fragLoadingRetryDelay,maxRetryDelay:u.fragLoadingMaxRetryTimeout,highWaterMark:0},o={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};n.load(t,s,o)}else this.decryptkey&&(f.decryptdata.key=this.decryptkey,this.hls.trigger(D.Events.KEY_LOADED,{frag:f}))}else k.logger.warn("Missing decryption data on fragment in onKeyLoading")},_.loadsuccess=function(l,E,f){var g=f.frag;g.decryptdata?(this.decryptkey=g.decryptdata.key=new Uint8Array(l.data),g.loader=null,delete this.loaders[g.type],this.hls.trigger(D.Events.KEY_LOADED,{frag:g})):k.logger.error("after key load, decryptdata unset")},_.loaderror=function(l,E){var f=E.frag,g=f.loader;g&&g.abort(),delete this.loaders[f.type],this.hls.trigger(D.Events.ERROR,{type:h.ErrorTypes.NETWORK_ERROR,details:h.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:f,response:l})},_.loadtimeout=function(l,E){var f=E.frag,g=f.loader;g&&g.abort(),delete this.loaders[f.type],this.hls.trigger(D.Events.ERROR,{type:h.ErrorTypes.NETWORK_ERROR,details:h.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:f})},w}()},"./src/loader/level-details.ts":function(F,I,v){v.r(I),v.d(I,"LevelDetails",function(){return k});var D=v("./src/polyfills/number.ts");function h(R,w){for(var _=0;_<w.length;_++){var l=w[_];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(R,l.key,l)}}var k=function(){function R(l){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.url=l}var w,_;return R.prototype.reloaded=function(l){if(!l)return this.advanced=!0,void(this.updated=!0);var E=this.lastPartSn-l.lastPartSn,f=this.lastPartIndex-l.lastPartIndex;this.updated=this.endSN!==l.endSN||!!f||!!E,this.advanced=this.endSN>l.endSN||E>0||E===0&&f>0,this.updated||this.advanced?this.misses=Math.floor(.6*l.misses):this.misses=l.misses+1,this.availabilityDelay=l.availabilityDelay},w=R,(_=[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&Object(D.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var l=this.driftEndTime-this.driftStartTime;return l>0?1e3*(this.driftEnd-this.driftStart)/l:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var l;return(l=this.partList)!==null&&l!==void 0&&l.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var l;return(l=this.fragments)!==null&&l!==void 0&&l.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var l;return(l=this.partList)!==null&&l!==void 0&&l.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var l;return(l=this.partList)!==null&&l!==void 0&&l.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}])&&h(w.prototype,_),R}()},"./src/loader/level-key.ts":function(F,I,v){v.r(I),v.d(I,"LevelKey",function(){return k});var D=v("./node_modules/url-toolkit/src/url-toolkit.js");function h(R,w){for(var _=0;_<w.length;_++){var l=w[_];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(R,l.key,l)}}var k=function(){function R(l,E){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,this._uri=E?Object(D.buildAbsoluteURL)(l,E,{alwaysNormalize:!0}):l}var w,_;return R.fromURL=function(l,E){return new R(l,E)},R.fromURI=function(l){return new R(l)},w=R,(_=[{key:"uri",get:function(){return this._uri}}])&&h(w.prototype,_),R}()},"./src/loader/load-stats.ts":function(F,I,v){v.r(I),v.d(I,"LoadStats",function(){return D});var D=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(F,I,v){v.r(I),v.d(I,"default",function(){return e});var D=v("./src/polyfills/number.ts"),h=v("./node_modules/url-toolkit/src/url-toolkit.js"),k=v("./src/loader/fragment.ts"),R=v("./src/loader/level-details.ts"),w=v("./src/loader/level-key.ts"),_=v("./src/utils/attr-list.ts"),l=v("./src/utils/logger.ts"),E=v("./src/utils/codecs.ts"),f=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,g=/#EXT-X-MEDIA:(.*)/g,b=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),T=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(PLAYLIST-TYPE):(.+)/.source,/#EXT-X-(MEDIA-SEQUENCE): *(\d+)/.source,/#EXT-X-(SKIP):(.+)/.source,/#EXT-X-(TARGETDURATION): *(\d+)/.source,/#EXT-X-(KEY):(.+)/.source,/#EXT-X-(START):(.+)/.source,/#EXT-X-(ENDLIST)/.source,/#EXT-X-(DISCONTINUITY-SEQ)UENCE: *(\d+)/.source,/#EXT-X-(DIS)CONTINUITY/.source,/#EXT-X-(VERSION):(\d+)/.source,/#EXT-X-(MAP):(.+)/.source,/#EXT-X-(SERVER-CONTROL):(.+)/.source,/#EXT-X-(PART-INF):(.+)/.source,/#EXT-X-(GAP)/.source,/#EXT-X-(BITRATE):\s*(\d+)/.source,/#EXT-X-(PART):(.+)/.source,/#EXT-X-(PRELOAD-HINT):(.+)/.source,/#EXT-X-(RENDITION-REPORT):(.+)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),u=/\.(mp4|m4s|m4v|m4a)$/i,e=function(){function o(){}return o.findGroup=function(i,d){for(var m=0;m<i.length;m++){var p=i[m];if(p.id===d)return p}},o.convertAVC1ToAVCOTI=function(i){var d=i.split(".");if(d.length>2){var m=d.shift()+".";return m+=parseInt(d.shift()).toString(16),m+=("000"+parseInt(d.shift()).toString(16)).substr(-4)}return i},o.resolve=function(i,d){return h.buildAbsoluteURL(d,i,{alwaysNormalize:!0})},o.parseMasterPlaylist=function(i,d){var m,p=[],y={},r=!1;for(f.lastIndex=0;(m=f.exec(i))!=null;)if(m[1]){var a=new _.AttrList(m[1]),c={attrs:a,bitrate:a.decimalInteger("AVERAGE-BANDWIDTH")||a.decimalInteger("BANDWIDTH"),name:a.NAME,url:o.resolve(m[2],d)},L=a.decimalResolution("RESOLUTION");L&&(c.width=L.width,c.height=L.height),n((a.CODECS||"").split(/[ ,]+/).filter(function(A){return A}),c),c.videoCodec&&c.videoCodec.indexOf("avc1")!==-1&&(c.videoCodec=o.convertAVC1ToAVCOTI(c.videoCodec)),p.push(c)}else if(m[3]){var S=new _.AttrList(m[3]);S["DATA-ID"]&&(r=!0,y[S["DATA-ID"]]=S)}return{levels:p,sessionData:r?y:null}},o.parseMasterPlaylistMedia=function(i,d,m,p){var y;p===void 0&&(p=[]);var r=[],a=0;for(g.lastIndex=0;(y=g.exec(i))!==null;){var c=new _.AttrList(y[1]);if(c.TYPE===m){var L={attrs:c,bitrate:0,id:a++,groupId:c["GROUP-ID"],instreamId:c["INSTREAM-ID"],name:c.NAME||c.LANGUAGE||"",type:m,default:c.bool("DEFAULT"),autoselect:c.bool("AUTOSELECT"),forced:c.bool("FORCED"),lang:c.LANGUAGE,url:c.URI?o.resolve(c.URI,d):""};if(p.length){var S=o.findGroup(p,L.groupId)||p[0];t(L,S,"audioCodec"),t(L,S,"textCodec")}r.push(L)}}return r},o.parseLevelPlaylist=function(i,d,m,p,y){var r,a,c,L=new R.LevelDetails(d),S=L.fragments,A=null,x=0,C=0,O=0,P=0,M=null,N=new k.Fragment(p,d),B=-1,U=!1;for(b.lastIndex=0,L.m3u8=i;(r=b.exec(i))!==null;){U&&(U=!1,(N=new k.Fragment(p,d)).start=O,N.sn=x,N.cc=P,N.level=m,A&&(N.initSegment=A,N.rawProgramDateTime=A.rawProgramDateTime));var G=r[1];if(G){N.duration=parseFloat(G);var z=(" "+r[2]).slice(1);N.title=z||null,N.tagList.push(z?["INF",G,z]:["INF",G])}else if(r[3])Object(D.isFiniteNumber)(N.duration)&&(N.start=O,c&&(N.levelkey=c),N.sn=x,N.level=m,N.cc=P,N.urlId=y,S.push(N),N.relurl=(" "+r[3]).slice(1),s(N,M),M=N,O+=N.duration,x++,C=0,U=!0);else if(r[4]){var Y=(" "+r[4]).slice(1);M?N.setByteRange(Y,M):N.setByteRange(Y)}else if(r[5])N.rawProgramDateTime=(" "+r[5]).slice(1),N.tagList.push(["PROGRAM-DATE-TIME",N.rawProgramDateTime]),B===-1&&(B=S.length);else{if(!(r=r[0].match(T))){l.logger.warn("No matches on slow regex match for level playlist!");continue}for(a=1;a<r.length&&r[a]===void 0;a++);var X=(" "+r[a]).slice(1),$=(" "+r[a+1]).slice(1),Z=r[a+2]?(" "+r[a+2]).slice(1):"";switch(X){case"PLAYLIST-TYPE":L.type=$.toUpperCase();break;case"MEDIA-SEQUENCE":x=L.startSN=parseInt($);break;case"SKIP":var ue=new _.AttrList($),de=ue.decimalInteger("SKIPPED-SEGMENTS");if(Object(D.isFiniteNumber)(de)){L.skippedSegments=de;for(var ve=de;ve--;)S.unshift(null);x+=de}var te=ue.enumeratedString("RECENTLY-REMOVED-DATERANGES");te&&(L.recentlyRemovedDateranges=te.split("	"));break;case"TARGETDURATION":L.targetduration=parseFloat($);break;case"VERSION":L.version=parseInt($);break;case"EXTM3U":break;case"ENDLIST":L.live=!1;break;case"#":($||Z)&&N.tagList.push(Z?[$,Z]:[$]);break;case"DIS":P++;case"GAP":N.tagList.push([X]);break;case"BITRATE":N.tagList.push([X,$]);break;case"DISCONTINUITY-SEQ":P=parseInt($);break;case"KEY":var fe,ae=new _.AttrList($),oe=ae.enumeratedString("METHOD"),me=ae.URI,ge=ae.hexadecimalInteger("IV"),Se=ae.enumeratedString("KEYFORMATVERSIONS"),Te=ae.enumeratedString("KEYID"),_e=(fe=ae.enumeratedString("KEYFORMAT"))!=null?fe:"identity";if(["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"].indexOf(_e)>-1){l.logger.warn("Keyformat "+_e+" is not supported from the manifest");continue}if(_e!=="identity")continue;oe&&(c=w.LevelKey.fromURL(d,me),me&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(oe)>=0&&(c.method=oe,c.keyFormat=_e,Te&&(c.keyID=Te),Se&&(c.keyFormatVersions=Se),c.iv=ge));break;case"START":var Re=new _.AttrList($).decimalFloatingPoint("TIME-OFFSET");Object(D.isFiniteNumber)(Re)&&(L.startTimeOffset=Re);break;case"MAP":var H=new _.AttrList($);N.relurl=H.URI,H.BYTERANGE&&N.setByteRange(H.BYTERANGE),N.level=m,N.sn="initSegment",c&&(N.levelkey=c),N.initSegment=null,A=N,U=!0;break;case"SERVER-CONTROL":var ee=new _.AttrList($);L.canBlockReload=ee.bool("CAN-BLOCK-RELOAD"),L.canSkipUntil=ee.optionalFloat("CAN-SKIP-UNTIL",0),L.canSkipDateRanges=L.canSkipUntil>0&&ee.bool("CAN-SKIP-DATERANGES"),L.partHoldBack=ee.optionalFloat("PART-HOLD-BACK",0),L.holdBack=ee.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var Ee=new _.AttrList($);L.partTarget=Ee.decimalFloatingPoint("PART-TARGET");break;case"PART":var ke=L.partList;ke||(ke=L.partList=[]);var Pe=C>0?ke[ke.length-1]:void 0,We=C++,qe=new k.Part(new _.AttrList($),N,d,We,Pe);ke.push(qe),N.duration+=qe.duration;break;case"PRELOAD-HINT":var Ue=new _.AttrList($);L.preloadHint=Ue;break;case"RENDITION-REPORT":var Xe=new _.AttrList($);L.renditionReports=L.renditionReports||[],L.renditionReports.push(Xe);break;default:l.logger.warn("line parsed but not handled: "+r)}}}M&&!M.relurl?(S.pop(),O-=M.duration,L.partList&&(L.fragmentHint=M)):L.partList&&(s(N,M),N.cc=P,L.fragmentHint=N);var ze=S.length,K=S[0],re=S[ze-1];if((O+=L.skippedSegments*L.targetduration)>0&&ze&&re){L.averagetargetduration=O/ze;var ce=re.sn;L.endSN=ce!=="initSegment"?ce:0,K&&(L.startCC=K.cc,K.initSegment||L.fragments.every(function(he){return he.relurl&&(ye=he.relurl,u.test((we=(Oe=h.parseURL(ye))===null||Oe===void 0?void 0:Oe.path)!=null?we:""));var ye,we,Oe})&&(l.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(N=new k.Fragment(p,d)).relurl=re.relurl,N.level=m,N.sn="initSegment",K.initSegment=N,L.needSidxRanges=!0))}else L.endSN=0,L.startCC=0;return L.fragmentHint&&(O+=L.fragmentHint.duration),L.totalduration=O,L.endCC=P,B>0&&function(he,ye){for(var we=he[ye],Oe=ye;Oe--;){var Ge=he[Oe];if(!Ge)return;Ge.programDateTime=we.programDateTime-1e3*Ge.duration,we=Ge}}(S,B),L},o}();function n(o,i){["video","audio","text"].forEach(function(d){var m=o.filter(function(y){return Object(E.isCodecType)(y,d)});if(m.length){var p=m.filter(function(y){return y.lastIndexOf("avc1",0)===0||y.lastIndexOf("mp4a",0)===0});i[d+"Codec"]=p.length>0?p[0]:m[0],o=o.filter(function(y){return m.indexOf(y)===-1})}}),i.unknownCodecs=o}function t(o,i,d){var m=i[d];m&&(o[d]=m)}function s(o,i){o.rawProgramDateTime?o.programDateTime=Date.parse(o.rawProgramDateTime):i!=null&&i.programDateTime&&(o.programDateTime=i.endProgramDateTime),Object(D.isFiniteNumber)(o.programDateTime)||(o.programDateTime=null,o.rawProgramDateTime=null)}},"./src/loader/playlist-loader.ts":function(F,I,v){v.r(I);var D=v("./src/polyfills/number.ts"),h=v("./src/events.ts"),k=v("./src/errors.ts"),R=v("./src/utils/logger.ts"),w=v("./src/utils/mp4-tools.ts"),_=v("./src/loader/m3u8-parser.ts"),l=v("./src/types/loader.ts"),E=v("./src/utils/attr-list.ts");function f(b,T){var u=b.url;return u!==void 0&&u.indexOf("data:")!==0||(u=T.url),u}var g=function(){function b(u){this.hls=void 0,this.loaders=Object.create(null),this.hls=u,this.registerListeners()}var T=b.prototype;return T.registerListeners=function(){var u=this.hls;u.on(h.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.on(h.Events.LEVEL_LOADING,this.onLevelLoading,this),u.on(h.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),u.on(h.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},T.unregisterListeners=function(){var u=this.hls;u.off(h.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.off(h.Events.LEVEL_LOADING,this.onLevelLoading,this),u.off(h.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),u.off(h.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},T.createInternalLoader=function(u){var e=this.hls.config,n=e.pLoader,t=e.loader,s=new(n||t)(e);return u.loader=s,this.loaders[u.type]=s,s},T.getInternalLoader=function(u){return this.loaders[u.type]},T.resetInternalLoader=function(u){this.loaders[u]&&delete this.loaders[u]},T.destroyInternalLoaders=function(){for(var u in this.loaders){var e=this.loaders[u];e&&e.destroy(),this.resetInternalLoader(u)}},T.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},T.onManifestLoading=function(u,e){var n=e.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:l.PlaylistContextType.MANIFEST,url:n,deliveryDirectives:null})},T.onLevelLoading=function(u,e){var n=e.id,t=e.level,s=e.url,o=e.deliveryDirectives;this.load({id:n,groupId:null,level:t,responseType:"text",type:l.PlaylistContextType.LEVEL,url:s,deliveryDirectives:o})},T.onAudioTrackLoading=function(u,e){var n=e.id,t=e.groupId,s=e.url,o=e.deliveryDirectives;this.load({id:n,groupId:t,level:null,responseType:"text",type:l.PlaylistContextType.AUDIO_TRACK,url:s,deliveryDirectives:o})},T.onSubtitleTrackLoading=function(u,e){var n=e.id,t=e.groupId,s=e.url,o=e.deliveryDirectives;this.load({id:n,groupId:t,level:null,responseType:"text",type:l.PlaylistContextType.SUBTITLE_TRACK,url:s,deliveryDirectives:o})},T.load=function(u){var e,n,t,s,o,i,d=this.hls.config,m=this.getInternalLoader(u);if(m){var p=m.context;if(p&&p.url===u.url)return void R.logger.trace("[playlist-loader]: playlist request ongoing");R.logger.log("[playlist-loader]: aborting previous loader for type: "+u.type),m.abort()}switch(u.type){case l.PlaylistContextType.MANIFEST:n=d.manifestLoadingMaxRetry,t=d.manifestLoadingTimeOut,s=d.manifestLoadingRetryDelay,o=d.manifestLoadingMaxRetryTimeout;break;case l.PlaylistContextType.LEVEL:case l.PlaylistContextType.AUDIO_TRACK:case l.PlaylistContextType.SUBTITLE_TRACK:n=0,t=d.levelLoadingTimeOut;break;default:n=d.levelLoadingMaxRetry,t=d.levelLoadingTimeOut,s=d.levelLoadingRetryDelay,o=d.levelLoadingMaxRetryTimeout}if(m=this.createInternalLoader(u),(e=u.deliveryDirectives)!==null&&e!==void 0&&e.part&&(u.type===l.PlaylistContextType.LEVEL&&u.level!==null?i=this.hls.levels[u.level].details:u.type===l.PlaylistContextType.AUDIO_TRACK&&u.id!==null?i=this.hls.audioTracks[u.id].details:u.type===l.PlaylistContextType.SUBTITLE_TRACK&&u.id!==null&&(i=this.hls.subtitleTracks[u.id].details),i)){var y=i.partTarget,r=i.targetduration;y&&r&&(t=Math.min(1e3*Math.max(3*y,.8*r),t))}var a={timeout:t,maxRetry:n,retryDelay:s,maxRetryDelay:o,highWaterMark:0},c={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};m.load(u,a,c)},T.loadsuccess=function(u,e,n,t){if(t===void 0&&(t=null),n.isSidxRequest)return this.handleSidxRequest(u,n),void this.handlePlaylistLoaded(u,e,n,t);this.resetInternalLoader(n.type);var s=u.data;s.indexOf("#EXTM3U")===0?(e.parsing.start=performance.now(),s.indexOf("#EXTINF:")>0||s.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(u,e,n,t):this.handleMasterPlaylist(u,e,n,t)):this.handleManifestParsingError(u,n,"no EXTM3U delimiter",t)},T.loaderror=function(u,e,n){n===void 0&&(n=null),this.handleNetworkError(e,n,!1,u)},T.loadtimeout=function(u,e,n){n===void 0&&(n=null),this.handleNetworkError(e,n,!0)},T.handleMasterPlaylist=function(u,e,n,t){var s=this.hls,o=u.data,i=f(u,n),d=_.default.parseMasterPlaylist(o,i),m=d.levels,p=d.sessionData;if(m.length){var y=m.map(function(S){return{id:S.attrs.AUDIO,audioCodec:S.audioCodec}}),r=m.map(function(S){return{id:S.attrs.SUBTITLES,textCodec:S.textCodec}}),a=_.default.parseMasterPlaylistMedia(o,i,"AUDIO",y),c=_.default.parseMasterPlaylistMedia(o,i,"SUBTITLES",r),L=_.default.parseMasterPlaylistMedia(o,i,"CLOSED-CAPTIONS");a.length&&(a.some(function(S){return!S.url})||!m[0].audioCodec||m[0].attrs.AUDIO||(R.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),a.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new E.AttrList({}),bitrate:0,url:""}))),s.trigger(h.Events.MANIFEST_LOADED,{levels:m,audioTracks:a,subtitles:c,captions:L,url:i,stats:e,networkDetails:t,sessionData:p})}else this.handleManifestParsingError(u,n,"no level found in manifest",t)},T.handleTrackOrLevelPlaylist=function(u,e,n,t){var s=this.hls,o=n.id,i=n.level,d=n.type,m=f(u,n),p=Object(D.isFiniteNumber)(o)?o:0,y=Object(D.isFiniteNumber)(i)?i:p,r=function(A){switch(A.type){case l.PlaylistContextType.AUDIO_TRACK:return l.PlaylistLevelType.AUDIO;case l.PlaylistContextType.SUBTITLE_TRACK:return l.PlaylistLevelType.SUBTITLE;default:return l.PlaylistLevelType.MAIN}}(n),a=_.default.parseLevelPlaylist(u.data,m,y,r,p);if(a.fragments.length){if(d===l.PlaylistContextType.MANIFEST){var c={attrs:new E.AttrList({}),bitrate:0,details:a,name:"",url:m};s.trigger(h.Events.MANIFEST_LOADED,{levels:[c],audioTracks:[],url:m,stats:e,networkDetails:t,sessionData:null})}if(e.parsing.end=performance.now(),a.needSidxRanges){var L,S=(L=a.fragments[0].initSegment)===null||L===void 0?void 0:L.url;this.load({url:S,isSidxRequest:!0,type:d,level:i,levelDetails:a,id:o,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null})}else n.levelDetails=a,this.handlePlaylistLoaded(u,e,n,t)}else s.trigger(h.Events.ERROR,{type:k.ErrorTypes.NETWORK_ERROR,details:k.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:m,reason:"no fragments found in level",level:typeof n.level=="number"?n.level:void 0})},T.handleSidxRequest=function(u,e){var n=Object(w.parseSegmentIndex)(new Uint8Array(u.data));if(n){var t=n.references,s=e.levelDetails;t.forEach(function(o,i){var d=o.info,m=s.fragments[i];m.byteRange.length===0&&m.setByteRange(String(1+d.end-d.start)+"@"+String(d.start)),m.initSegment&&m.initSegment.setByteRange(String(n.moovEndOffset)+"@0")})}},T.handleManifestParsingError=function(u,e,n,t){this.hls.trigger(h.Events.ERROR,{type:k.ErrorTypes.NETWORK_ERROR,details:k.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:e.type===l.PlaylistContextType.MANIFEST,url:u.url,reason:n,response:u,context:e,networkDetails:t})},T.handleNetworkError=function(u,e,n,t){n===void 0&&(n=!1),R.logger.warn("[playlist-loader]: A network "+(n?"timeout":"error")+" occurred while loading "+u.type+" level: "+u.level+" id: "+u.id+' group-id: "'+u.groupId+'"');var s=k.ErrorDetails.UNKNOWN,o=!1,i=this.getInternalLoader(u);switch(u.type){case l.PlaylistContextType.MANIFEST:s=n?k.ErrorDetails.MANIFEST_LOAD_TIMEOUT:k.ErrorDetails.MANIFEST_LOAD_ERROR,o=!0;break;case l.PlaylistContextType.LEVEL:s=n?k.ErrorDetails.LEVEL_LOAD_TIMEOUT:k.ErrorDetails.LEVEL_LOAD_ERROR,o=!1;break;case l.PlaylistContextType.AUDIO_TRACK:s=n?k.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:k.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,o=!1;break;case l.PlaylistContextType.SUBTITLE_TRACK:s=n?k.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:k.ErrorDetails.SUBTITLE_LOAD_ERROR,o=!1}i&&this.resetInternalLoader(u.type);var d={type:k.ErrorTypes.NETWORK_ERROR,details:s,fatal:o,url:u.url,loader:i,context:u,networkDetails:e};t&&(d.response=t),this.hls.trigger(h.Events.ERROR,d)},T.handlePlaylistLoaded=function(u,e,n,t){var s=n.type,o=n.level,i=n.id,d=n.groupId,m=n.loader,p=n.levelDetails,y=n.deliveryDirectives;if(p!=null&&p.targetduration){if(m)switch(p.live&&(m.getCacheAge&&(p.ageHeader=m.getCacheAge()||0),m.getCacheAge&&!isNaN(p.ageHeader)||(p.ageHeader=0)),s){case l.PlaylistContextType.MANIFEST:case l.PlaylistContextType.LEVEL:this.hls.trigger(h.Events.LEVEL_LOADED,{details:p,level:o||0,id:i||0,stats:e,networkDetails:t,deliveryDirectives:y});break;case l.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(h.Events.AUDIO_TRACK_LOADED,{details:p,id:i||0,groupId:d||"",stats:e,networkDetails:t,deliveryDirectives:y});break;case l.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(h.Events.SUBTITLE_TRACK_LOADED,{details:p,id:i||0,groupId:d||"",stats:e,networkDetails:t,deliveryDirectives:y})}}else this.handleManifestParsingError(u,n,"invalid target duration",t)},b}();I.default=g},"./src/polyfills/number.ts":function(F,I,v){v.r(I),v.d(I,"isFiniteNumber",function(){return D}),v.d(I,"MAX_SAFE_INTEGER",function(){return h});var D=Number.isFinite||function(k){return typeof k=="number"&&isFinite(k)},h=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(F,I,v){v.r(I);var D=function(){function h(){}return h.getSilentFrame=function(k,R){switch(k){case"mp4a.40.2":if(R===1)return new Uint8Array([0,200,0,128,35,128]);if(R===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(R===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(R===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(R===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(R===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(R===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(R===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(R===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},h}();I.default=D},"./src/remux/mp4-generator.ts":function(F,I,v){v.r(I);var D=Math.pow(2,32)-1,h=function(){function k(){}return k.init=function(){var R;for(R in k.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},k.types)k.types.hasOwnProperty(R)&&(k.types[R]=[R.charCodeAt(0),R.charCodeAt(1),R.charCodeAt(2),R.charCodeAt(3)]);var w=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),_=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);k.HDLR_TYPES={video:w,audio:_};var l=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),E=new Uint8Array([0,0,0,0,0,0,0,0]);k.STTS=k.STSC=k.STCO=E,k.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),k.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),k.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),k.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var f=new Uint8Array([105,115,111,109]),g=new Uint8Array([97,118,99,49]),b=new Uint8Array([0,0,0,1]);k.FTYP=k.box(k.types.ftyp,f,b,f,g),k.DINF=k.box(k.types.dinf,k.box(k.types.dref,l))},k.box=function(R){for(var w=8,_=arguments.length,l=new Array(_>1?_-1:0),E=1;E<_;E++)l[E-1]=arguments[E];for(var f=l.length,g=f;f--;)w+=l[f].byteLength;var b=new Uint8Array(w);for(b[0]=w>>24&255,b[1]=w>>16&255,b[2]=w>>8&255,b[3]=255&w,b.set(R,4),f=0,w=8;f<g;f++)b.set(l[f],w),w+=l[f].byteLength;return b},k.hdlr=function(R){return k.box(k.types.hdlr,k.HDLR_TYPES[R])},k.mdat=function(R){return k.box(k.types.mdat,R)},k.mdhd=function(R,w){w*=R;var _=Math.floor(w/(D+1)),l=Math.floor(w%(D+1));return k.box(k.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,R>>24&255,R>>16&255,R>>8&255,255&R,_>>24,_>>16&255,_>>8&255,255&_,l>>24,l>>16&255,l>>8&255,255&l,85,196,0,0]))},k.mdia=function(R){return k.box(k.types.mdia,k.mdhd(R.timescale,R.duration),k.hdlr(R.type),k.minf(R))},k.mfhd=function(R){return k.box(k.types.mfhd,new Uint8Array([0,0,0,0,R>>24,R>>16&255,R>>8&255,255&R]))},k.minf=function(R){return R.type==="audio"?k.box(k.types.minf,k.box(k.types.smhd,k.SMHD),k.DINF,k.stbl(R)):k.box(k.types.minf,k.box(k.types.vmhd,k.VMHD),k.DINF,k.stbl(R))},k.moof=function(R,w,_){return k.box(k.types.moof,k.mfhd(R),k.traf(_,w))},k.moov=function(R){for(var w=R.length,_=[];w--;)_[w]=k.trak(R[w]);return k.box.apply(null,[k.types.moov,k.mvhd(R[0].timescale,R[0].duration)].concat(_).concat(k.mvex(R)))},k.mvex=function(R){for(var w=R.length,_=[];w--;)_[w]=k.trex(R[w]);return k.box.apply(null,[k.types.mvex].concat(_))},k.mvhd=function(R,w){w*=R;var _=Math.floor(w/(D+1)),l=Math.floor(w%(D+1)),E=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,R>>24&255,R>>16&255,R>>8&255,255&R,_>>24,_>>16&255,_>>8&255,255&_,l>>24,l>>16&255,l>>8&255,255&l,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return k.box(k.types.mvhd,E)},k.sdtp=function(R){var w,_,l=R.samples||[],E=new Uint8Array(4+l.length);for(w=0;w<l.length;w++)_=l[w].flags,E[w+4]=_.dependsOn<<4|_.isDependedOn<<2|_.hasRedundancy;return k.box(k.types.sdtp,E)},k.stbl=function(R){return k.box(k.types.stbl,k.stsd(R),k.box(k.types.stts,k.STTS),k.box(k.types.stsc,k.STSC),k.box(k.types.stsz,k.STSZ),k.box(k.types.stco,k.STCO))},k.avc1=function(R){var w,_,l,E=[],f=[];for(w=0;w<R.sps.length;w++)l=(_=R.sps[w]).byteLength,E.push(l>>>8&255),E.push(255&l),E=E.concat(Array.prototype.slice.call(_));for(w=0;w<R.pps.length;w++)l=(_=R.pps[w]).byteLength,f.push(l>>>8&255),f.push(255&l),f=f.concat(Array.prototype.slice.call(_));var g=k.box(k.types.avcC,new Uint8Array([1,E[3],E[4],E[5],255,224|R.sps.length].concat(E).concat([R.pps.length]).concat(f))),b=R.width,T=R.height,u=R.pixelRatio[0],e=R.pixelRatio[1];return k.box(k.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,b>>8&255,255&b,T>>8&255,255&T,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),g,k.box(k.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),k.box(k.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,255&u,e>>24,e>>16&255,e>>8&255,255&e])))},k.esds=function(R){var w=R.config.length;return new Uint8Array([0,0,0,0,3,23+w,0,1,0,4,15+w,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([w]).concat(R.config).concat([6,1,2]))},k.mp4a=function(R){var w=R.samplerate;return k.box(k.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,R.channelCount,0,16,0,0,0,0,w>>8&255,255&w,0,0]),k.box(k.types.esds,k.esds(R)))},k.mp3=function(R){var w=R.samplerate;return k.box(k.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,R.channelCount,0,16,0,0,0,0,w>>8&255,255&w,0,0]))},k.stsd=function(R){return R.type==="audio"?R.isAAC||R.codec!=="mp3"?k.box(k.types.stsd,k.STSD,k.mp4a(R)):k.box(k.types.stsd,k.STSD,k.mp3(R)):k.box(k.types.stsd,k.STSD,k.avc1(R))},k.tkhd=function(R){var w=R.id,_=R.duration*R.timescale,l=R.width,E=R.height,f=Math.floor(_/(D+1)),g=Math.floor(_%(D+1));return k.box(k.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,w>>24&255,w>>16&255,w>>8&255,255&w,0,0,0,0,f>>24,f>>16&255,f>>8&255,255&f,g>>24,g>>16&255,g>>8&255,255&g,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,l>>8&255,255&l,0,0,E>>8&255,255&E,0,0]))},k.traf=function(R,w){var _=k.sdtp(R),l=R.id,E=Math.floor(w/(D+1)),f=Math.floor(w%(D+1));return k.box(k.types.traf,k.box(k.types.tfhd,new Uint8Array([0,0,0,0,l>>24,l>>16&255,l>>8&255,255&l])),k.box(k.types.tfdt,new Uint8Array([1,0,0,0,E>>24,E>>16&255,E>>8&255,255&E,f>>24,f>>16&255,f>>8&255,255&f])),k.trun(R,_.length+16+20+8+16+8+8),_)},k.trak=function(R){return R.duration=R.duration||4294967295,k.box(k.types.trak,k.tkhd(R),k.mdia(R))},k.trex=function(R){var w=R.id;return k.box(k.types.trex,new Uint8Array([0,0,0,0,w>>24,w>>16&255,w>>8&255,255&w,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},k.trun=function(R,w){var _,l,E,f,g,b,T=R.samples||[],u=T.length,e=12+16*u,n=new Uint8Array(e);for(w+=8+e,n.set([0,0,15,1,u>>>24&255,u>>>16&255,u>>>8&255,255&u,w>>>24&255,w>>>16&255,w>>>8&255,255&w],0),_=0;_<u;_++)E=(l=T[_]).duration,f=l.size,g=l.flags,b=l.cts,n.set([E>>>24&255,E>>>16&255,E>>>8&255,255&E,f>>>24&255,f>>>16&255,f>>>8&255,255&f,g.isLeading<<2|g.dependsOn,g.isDependedOn<<6|g.hasRedundancy<<4|g.paddingValue<<1|g.isNonSync,61440&g.degradPrio,15&g.degradPrio,b>>>24&255,b>>>16&255,b>>>8&255,255&b],12+16*_);return k.box(k.types.trun,n)},k.initSegment=function(R){k.types||k.init();var w=k.moov(R),_=new Uint8Array(k.FTYP.byteLength+w.byteLength);return _.set(k.FTYP),_.set(w,k.FTYP.byteLength),_},k}();h.types=void 0,h.HDLR_TYPES=void 0,h.STTS=void 0,h.STSC=void 0,h.STCO=void 0,h.STSZ=void 0,h.VMHD=void 0,h.SMHD=void 0,h.STSD=void 0,h.FTYP=void 0,h.DINF=void 0,I.default=h},"./src/remux/mp4-remuxer.ts":function(F,I,v){v.r(I),v.d(I,"default",function(){return u}),v.d(I,"normalizePts",function(){return e});var D=v("./src/polyfills/number.ts"),h=v("./src/remux/aac-helper.ts"),k=v("./src/remux/mp4-generator.ts"),R=v("./src/events.ts"),w=v("./src/errors.ts"),_=v("./src/utils/logger.ts"),l=v("./src/types/loader.ts"),E=v("./src/utils/timescale-conversion.ts");function f(){return(f=Object.assign||function(s){for(var o=1;o<arguments.length;o++){var i=arguments[o];for(var d in i)Object.prototype.hasOwnProperty.call(i,d)&&(s[d]=i[d])}return s}).apply(this,arguments)}var g=null,b=null,T=!1,u=function(){function s(i,d,m,p){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=i,this.config=d,this.typeSupported=m,this.ISGenerated=!1,g===null){var y=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);g=y?parseInt(y[1]):0}if(b===null){var r=navigator.userAgent.match(/Safari\/(\d+)/i);b=r?parseInt(r[1]):0}T=!!g&&g<75||!!b&&b<600}var o=s.prototype;return o.destroy=function(){},o.resetTimeStamp=function(i){_.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=i},o.resetNextTimestamp=function(){_.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},o.resetInitSegment=function(){_.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},o.getVideoStartPts=function(i){var d=!1,m=i.reduce(function(p,y){var r=y.pts-p;return r<-4294967296?(d=!0,e(p,y.pts)):r>0?p:y.pts},i[0].pts);return d&&_.logger.debug("PTS rollover detected"),m},o.remux=function(i,d,m,p,y,r,a,c){var L,S,A,x,C,O,P=y,M=y,N=i.pid>-1,B=d.pid>-1,U=d.samples.length,G=i.samples.length>0,z=U>1;if((!N||G)&&(!B||z)||this.ISGenerated||a){this.ISGenerated||(A=this.generateIS(i,d,y));var Y=this.isVideoContiguous,X=-1;if(z&&(X=function(ve){for(var te=0;te<ve.length;te++)if(ve[te].key)return te;return-1}(d.samples),!Y&&this.config.forceKeyFrameOnDiscontinuity))if(O=!0,X>0){_.logger.warn("[mp4-remuxer]: Dropped "+X+" out of "+U+" video samples due to a missing keyframe");var $=this.getVideoStartPts(d.samples);d.samples=d.samples.slice(X),d.dropped+=X,M+=(d.samples[0].pts-$)/(d.timescale||9e4)}else X===-1&&(_.logger.warn("[mp4-remuxer]: No keyframe found out of "+U+" video samples"),O=!1);if(this.ISGenerated){if(G&&z){var Z=this.getVideoStartPts(d.samples),ue=(e(i.samples[0].pts,Z)-Z)/d.inputTimeScale;P+=Math.max(0,ue),M+=Math.max(0,-ue)}if(G){if(i.samplerate||(_.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),A=this.generateIS(i,d,y)),S=this.remuxAudio(i,P,this.isAudioContiguous,r,B||z||c===l.PlaylistLevelType.AUDIO?M:void 0),z){var de=S?S.endPTS-S.startPTS:0;d.inputTimeScale||(_.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),A=this.generateIS(i,d,y)),L=this.remuxVideo(d,M,Y,de)}}else z&&(L=this.remuxVideo(d,M,Y,0));L&&(L.firstKeyFrame=X,L.independent=X!==-1)}}return this.ISGenerated&&(m.samples.length&&(C=this.remuxID3(m,y)),p.samples.length&&(x=this.remuxText(p,y))),{audio:S,video:L,initSegment:A,independent:O,text:x,id3:C}},o.generateIS=function(i,d,m){var p,y,r,a=i.samples,c=d.samples,L=this.typeSupported,S={},A=!Object(D.isFiniteNumber)(this._initPTS),x="audio/mp4";if(A&&(p=y=1/0),i.config&&a.length&&(i.timescale=i.samplerate,i.isAAC||(L.mpeg?(x="audio/mpeg",i.codec=""):L.mp3&&(i.codec="mp3")),S.audio={id:"audio",container:x,codec:i.codec,initSegment:!i.isAAC&&L.mpeg?new Uint8Array(0):k.default.initSegment([i]),metadata:{channelCount:i.channelCount}},A&&(r=i.inputTimeScale,p=y=a[0].pts-Math.round(r*m))),d.sps&&d.pps&&c.length&&(d.timescale=d.inputTimeScale,S.video={id:"main",container:"video/mp4",codec:d.codec,initSegment:k.default.initSegment([d]),metadata:{width:d.width,height:d.height}},A)){r=d.inputTimeScale;var C=this.getVideoStartPts(c),O=Math.round(r*m);y=Math.min(y,e(c[0].dts,C)-O),p=Math.min(p,C-O)}if(Object.keys(S).length)return this.ISGenerated=!0,A&&(this._initPTS=p,this._initDTS=y),{tracks:S,initPTS:p,timescale:r}},o.remuxVideo=function(i,d,m,p){var y,r,a,c=i.inputTimeScale,L=i.samples,S=[],A=L.length,x=this._initPTS,C=this.nextAvcDts,O=8,P=Number.POSITIVE_INFINITY,M=Number.NEGATIVE_INFINITY,N=0,B=!1;m&&C!==null||(C=d*c-(L[0].pts-e(L[0].dts,L[0].pts)));for(var U=0;U<A;U++){var G=L[U];G.pts=e(G.pts-x,C),G.dts=e(G.dts-x,C),G.dts>G.pts&&(N=Math.max(Math.min(N,G.pts-G.dts),-18e3)),G.dts<L[U>0?U-1:U].dts&&(B=!0)}B&&L.sort(function(Oe,Ge){var dr=Oe.dts-Ge.dts,cr=Oe.pts-Ge.pts;return dr||cr}),r=L[0].dts,a=L[L.length-1].dts;var z=Math.round((a-r)/(A-1));if(N<0){if(N<-2*z){_.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(E.toMsFromMpegTsClock)(-z,!0)+" ms");for(var Y=N,X=0;X<A;X++)L[X].dts=Y=Math.max(Y,L[X].pts-z),L[X].pts=Math.max(Y,L[X].pts)}else{_.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(E.toMsFromMpegTsClock)(N,!0)+" ms to overcome this issue");for(var $=0;$<A;$++)L[$].dts=L[$].dts+N}r=L[0].dts}if(m){var Z=r-C,ue=Z>z;if(ue||Z<-1){ue?_.logger.warn("AVC: "+Object(E.toMsFromMpegTsClock)(Z,!0)+" ms ("+Z+"dts) hole between fragments detected, filling it"):_.logger.warn("AVC: "+Object(E.toMsFromMpegTsClock)(-Z,!0)+" ms ("+Z+"dts) overlapping between fragments detected"),r=C;var de=L[0].pts-Z;L[0].dts=r,L[0].pts=de,_.logger.log("Video: First PTS/DTS adjusted: "+Object(E.toMsFromMpegTsClock)(de,!0)+"/"+Object(E.toMsFromMpegTsClock)(r,!0)+", delta: "+Object(E.toMsFromMpegTsClock)(Z,!0)+" ms")}}T&&(r=Math.max(0,r));for(var ve=0,te=0,fe=0;fe<A;fe++){for(var ae=L[fe],oe=ae.units,me=oe.length,ge=0,Se=0;Se<me;Se++)ge+=oe[Se].data.length;te+=ge,ve+=me,ae.length=ge,ae.dts=Math.max(ae.dts,r),ae.pts=Math.max(ae.pts,ae.dts,0),P=Math.min(ae.pts,P),M=Math.max(ae.pts,M)}a=L[A-1].dts;var Te,_e=te+4*ve+8;try{Te=new Uint8Array(_e)}catch{return void this.observer.emit(R.Events.ERROR,R.Events.ERROR,{type:w.ErrorTypes.MUX_ERROR,details:w.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:_e,reason:"fail allocating video mdat "+_e})}var Re=new DataView(Te.buffer);Re.setUint32(0,_e),Te.set(k.default.types.mdat,4);for(var H=0;H<A;H++){for(var ee=L[H],Ee=ee.units,ke=0,Pe=0,We=Ee.length;Pe<We;Pe++){var qe=Ee[Pe],Ue=qe.data,Xe=qe.data.byteLength;Re.setUint32(O,Xe),O+=4,Te.set(Ue,O),O+=Xe,ke+=4+Xe}if(H<A-1)y=L[H+1].dts-ee.dts;else{var ze=this.config,K=ee.dts-L[H>0?H-1:H].dts;if(ze.stretchShortVideoTrack&&this.nextAudioPts!==null){var re=Math.floor(ze.maxBufferHole*c),ce=(p?P+p*c:this.nextAudioPts)-ee.pts;ce>re?((y=ce-K)<0&&(y=K),_.logger.log("[mp4-remuxer]: It is approximately "+ce/90+" ms to the next segment; using duration "+y/90+" ms for the last video frame.")):y=K}else y=K}var he=Math.round(ee.pts-ee.dts);S.push(new n(ee.key,y,ke,he))}if(S.length&&g&&g<70){var ye=S[0].flags;ye.dependsOn=2,ye.isNonSync=0}console.assert(y!==void 0,"mp4SampleDuration must be computed"),this.nextAvcDts=C=a+y,this.isVideoContiguous=!0;var we={data1:k.default.moof(i.sequenceNumber++,r,f({},i,{samples:S})),data2:Te,startPTS:P/c,endPTS:(M+y)/c,startDTS:r/c,endDTS:C/c,type:"video",hasAudio:!1,hasVideo:!0,nb:S.length,dropped:i.dropped};return i.samples=[],i.dropped=0,console.assert(Te.length,"MDAT length must not be zero"),we},o.remuxAudio=function(i,d,m,p,y){var r=i.inputTimeScale,a=r/(i.samplerate?i.samplerate:r),c=i.isAAC?1024:1152,L=c*a,S=this._initPTS,A=!i.isAAC&&this.typeSupported.mpeg,x=[],C=i.samples,O=A?0:8,P=this.nextAudioPts||-1,M=d*r;if(this.isAudioContiguous=m=m||C.length&&P>0&&(p&&Math.abs(M-P)<9e3||Math.abs(e(C[0].pts-S,M)-P)<20*L),C.forEach(function(Ue){Ue.pts=e(Ue.pts-S,M)}),!m||P<0){if(!(C=C.filter(function(Ue){return Ue.pts>=0})).length)return;P=y===0?0:p?Math.max(0,M):C[0].pts}if(i.isAAC)for(var N=y!==void 0,B=this.config.maxAudioFramesDrift,U=0,G=P;U<C.length;U++){var z=C[U],Y=z.pts,X=Y-G,$=Math.abs(1e3*X/r);if(X<=-B*L&&N)U===0&&(_.logger.warn("Audio frame @ "+(Y/r).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*X/r)+" ms."),this.nextAudioPts=P=G=Y);else if(X>=B*L&&$<1e4&&N){var Z=Math.round(X/L);(G=Y-Z*L)<0&&(Z--,G+=L),U===0&&(this.nextAudioPts=P=G),_.logger.warn("[mp4-remuxer]: Injecting "+Z+" audio frame @ "+(G/r).toFixed(3)+"s due to "+Math.round(1e3*X/r)+" ms gap.");for(var ue=0;ue<Z;ue++){var de=Math.max(G,0),ve=h.default.getSilentFrame(i.manifestCodec||i.codec,i.channelCount);ve||(_.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),ve=z.unit.subarray()),C.splice(U,0,{unit:ve,pts:de}),G+=L,U++}}z.pts=G,G+=L}for(var te,fe=null,ae=null,oe=0,me=C.length;me--;)oe+=C[me].unit.byteLength;for(var ge=0,Se=C.length;ge<Se;ge++){var Te=C[ge],_e=Te.unit,Re=Te.pts;if(ae!==null)x[ge-1].duration=Math.round((Re-ae)/a);else{if(m&&i.isAAC&&(Re=P),fe=Re,!(oe>0))return;oe+=O;try{te=new Uint8Array(oe)}catch{return void this.observer.emit(R.Events.ERROR,R.Events.ERROR,{type:w.ErrorTypes.MUX_ERROR,details:w.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:oe,reason:"fail allocating audio mdat "+oe})}A||(new DataView(te.buffer).setUint32(0,oe),te.set(k.default.types.mdat,4))}te.set(_e,O);var H=_e.byteLength;O+=H,x.push(new n(!0,c,H,0)),ae=Re}var ee=x.length;if(ee){var Ee=x[x.length-1];this.nextAudioPts=P=ae+a*Ee.duration;var ke=A?new Uint8Array(0):k.default.moof(i.sequenceNumber++,fe/a,f({},i,{samples:x}));i.samples=[];var Pe=fe/r,We=P/r,qe={data1:ke,data2:te,startPTS:Pe,endPTS:We,startDTS:Pe,endDTS:We,type:"audio",hasAudio:!0,hasVideo:!1,nb:ee};return this.isAudioContiguous=!0,console.assert(te.length,"MDAT length must not be zero"),qe}},o.remuxEmptyAudio=function(i,d,m,p){var y=i.inputTimeScale,r=y/(i.samplerate?i.samplerate:y),a=this.nextAudioPts,c=(a!==null?a:p.startDTS*y)+this._initDTS,L=p.endDTS*y+this._initDTS,S=1024*r,A=Math.ceil((L-c)/S),x=h.default.getSilentFrame(i.manifestCodec||i.codec,i.channelCount);if(_.logger.warn("[mp4-remuxer]: remux empty Audio"),x){for(var C=[],O=0;O<A;O++){var P=c+O*S;C.push({unit:x,pts:P,dts:P})}return i.samples=C,this.remuxAudio(i,d,m,!1)}_.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},o.remuxID3=function(i,d){var m=i.samples.length;if(m){for(var p=i.inputTimeScale,y=this._initPTS,r=this._initDTS,a=0;a<m;a++){var c=i.samples[a];c.pts=e(c.pts-y,d*p)/p,c.dts=e(c.dts-r,d*p)/p}var L=i.samples;return i.samples=[],{samples:L}}},o.remuxText=function(i,d){var m=i.samples.length;if(m){for(var p=i.inputTimeScale,y=this._initPTS,r=0;r<m;r++){var a=i.samples[r];a.pts=e(a.pts-y,d*p)/p}i.samples.sort(function(L,S){return L.pts-S.pts});var c=i.samples;return i.samples=[],{samples:c}}},s}();function e(s,o){var i;if(o===null)return s;for(i=o<s?-8589934592:8589934592;Math.abs(s-o)>4294967296;)s+=i;return s}var n=function(s,o,i,d){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=o,this.size=i,this.cts=d,this.flags=new t(s)},t=function(s){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=s?2:1,this.isNonSync=s?0:1}},"./src/remux/passthrough-remuxer.ts":function(F,I,v){v.r(I);var D=v("./src/polyfills/number.ts"),h=v("./src/utils/mp4-tools.ts"),k=v("./src/loader/fragment.ts"),R=v("./src/utils/logger.ts"),w=function(){function E(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var f=E.prototype;return f.destroy=function(){},f.resetTimeStamp=function(g){this.initPTS=g,this.lastEndDTS=null},f.resetNextTimestamp=function(){this.lastEndDTS=null},f.resetInitSegment=function(g,b,T){this.audioCodec=b,this.videoCodec=T,this.generateInitSegment(g),this.emitInitSegment=!0},f.generateInitSegment=function(g){var b=this.audioCodec,T=this.videoCodec;if(!g||!g.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var u=this.initData=Object(h.parseInitSegment)(g);b||(b=l(u.audio,k.ElementaryStreamTypes.AUDIO)),T||(T=l(u.video,k.ElementaryStreamTypes.VIDEO));var e={};u.audio&&u.video?e.audiovideo={container:"video/mp4",codec:b+","+T,initSegment:g,id:"main"}:u.audio?e.audio={container:"audio/mp4",codec:b,initSegment:g,id:"audio"}:u.video?e.video={container:"video/mp4",codec:T,initSegment:g,id:"main"}:R.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=e},f.remux=function(g,b,T,u,e){var n=this.initPTS,t=this.lastEndDTS,s={audio:void 0,video:void 0,text:u,id3:T,initSegment:void 0};Object(D.isFiniteNumber)(t)||(t=this.lastEndDTS=e||0);var o=b.samples;if(!o||!o.length)return s;var i={initPTS:void 0,timescale:1},d=this.initData;if(d&&d.length||(this.generateInitSegment(o),d=this.initData),!d||!d.length)return R.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),s;this.emitInitSegment&&(i.tracks=this.initTracks,this.emitInitSegment=!1),Object(D.isFiniteNumber)(n)||(this.initPTS=i.initPTS=n=_(d,o,t));var m=Object(h.getDuration)(o,d),p=t,y=m+p;Object(h.offsetStartDTS)(d,o,n),m>0?this.lastEndDTS=y:(R.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var r=!!d.audio,a=!!d.video,c="";r&&(c+="audio"),a&&(c+="video");var L={data1:o,startPTS:p,startDTS:p,endPTS:y,endDTS:y,type:c,hasAudio:r,hasVideo:a,nb:1,dropped:0};return s.audio=L.type==="audio"?L:void 0,s.video=L.type!=="audio"?L:void 0,s.text=u,s.id3=T,s.initSegment=i,s},E}(),_=function(E,f,g){return Object(h.getStartDTS)(E,f)-g};function l(E,f){var g=E==null?void 0:E.codec;return g&&g.length>4?g:g==="hvc1"?"hvc1.1.c.L120.90":g==="av01"?"av01.0.04M.08":g==="avc1"||f===k.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}I.default=w},"./src/task-loop.ts":function(F,I,v){v.r(I),v.d(I,"default",function(){return D});var D=function(){function h(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var k=h.prototype;return k.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},k.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},k.onHandlerDestroyed=function(){},k.hasInterval=function(){return!!this._tickInterval},k.hasNextTick=function(){return!!this._tickTimer},k.setInterval=function(R){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,R),!0)},k.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},k.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},k.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},k.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},k.doTick=function(){},h}()},"./src/types/level.ts":function(F,I,v){function D(l,E){for(var f=0;f<E.length;f++){var g=E[f];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(l,g.key,g)}}var h,k;function R(l,E){var f=l.canSkipUntil,g=l.canSkipDateRanges,b=l.endSN;return f&&(E!==void 0?E-b:0)<f?g?h.v2:h.Yes:h.No}v.r(I),v.d(I,"HlsSkip",function(){return h}),v.d(I,"getSkipValue",function(){return R}),v.d(I,"HlsUrlParameters",function(){return w}),v.d(I,"Level",function(){return _}),(k=h||(h={})).No="",k.Yes="YES",k.v2="v2";var w=function(){function l(E,f,g){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=E,this.part=f,this.skip=g}return l.prototype.addDirectives=function(E){var f=new self.URL(E);return this.msn!==void 0&&f.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&f.searchParams.set("_HLS_part",this.part.toString()),this.skip&&f.searchParams.set("_HLS_skip",this.skip),f.toString()},l}(),_=function(){function l(g){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[g.url],this.attrs=g.attrs,this.bitrate=g.bitrate,g.details&&(this.details=g.details),this.id=g.id||0,this.name=g.name,this.width=g.width||0,this.height=g.height||0,this.audioCodec=g.audioCodec,this.videoCodec=g.videoCodec,this.unknownCodecs=g.unknownCodecs,this.codecSet=[g.videoCodec,g.audioCodec].filter(function(b){return b}).join(",").replace(/\.[^.,]+/g,"")}var E,f;return E=l,(f=[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(g){var b=g%this.url.length;this._urlId!==b&&(this.details=void 0,this._urlId=b)}}])&&D(E.prototype,f),l}()},"./src/types/loader.ts":function(F,I,v){var D,h,k,R;v.r(I),v.d(I,"PlaylistContextType",function(){return D}),v.d(I,"PlaylistLevelType",function(){return k}),(h=D||(D={})).MANIFEST="manifest",h.LEVEL="level",h.AUDIO_TRACK="audioTrack",h.SUBTITLE_TRACK="subtitleTrack",(R=k||(k={})).MAIN="main",R.AUDIO="audio",R.SUBTITLE="subtitle"},"./src/types/transmuxer.ts":function(F,I,v){v.r(I),v.d(I,"ChunkMetadata",function(){return D});var D=function(h,k,R,w,_,l){w===void 0&&(w=0),_===void 0&&(_=-1),l===void 0&&(l=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=h,this.sn=k,this.id=R,this.size=w,this.part=_,this.partial=l}},"./src/utils/attr-list.ts":function(F,I,v){v.r(I),v.d(I,"AttrList",function(){return k});var D=/^(\d+)x(\d+)$/,h=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,k=function(){function R(_){for(var l in typeof _=="string"&&(_=R.parseAttrList(_)),_)_.hasOwnProperty(l)&&(this[l]=_[l])}var w=R.prototype;return w.decimalInteger=function(_){var l=parseInt(this[_],10);return l>Number.MAX_SAFE_INTEGER?1/0:l},w.hexadecimalInteger=function(_){if(this[_]){var l=(this[_]||"0x").slice(2);l=(1&l.length?"0":"")+l;for(var E=new Uint8Array(l.length/2),f=0;f<l.length/2;f++)E[f]=parseInt(l.slice(2*f,2*f+2),16);return E}return null},w.hexadecimalIntegerAsNumber=function(_){var l=parseInt(this[_],16);return l>Number.MAX_SAFE_INTEGER?1/0:l},w.decimalFloatingPoint=function(_){return parseFloat(this[_])},w.optionalFloat=function(_,l){var E=this[_];return E?parseFloat(E):l},w.enumeratedString=function(_){return this[_]},w.bool=function(_){return this[_]==="YES"},w.decimalResolution=function(_){var l=D.exec(this[_]);if(l!==null)return{width:parseInt(l[1],10),height:parseInt(l[2],10)}},R.parseAttrList=function(_){var l,E={};for(h.lastIndex=0;(l=h.exec(_))!==null;){var f=l[2];f.indexOf('"')===0&&f.lastIndexOf('"')===f.length-1&&(f=f.slice(1,-1)),E[l[1]]=f}return E},R}()},"./src/utils/binary-search.ts":function(F,I,v){v.r(I),I.default={search:function(D,h){for(var k=0,R=D.length-1,w=null,_=null;k<=R;){var l=h(_=D[w=(k+R)/2|0]);if(l>0)k=w+1;else{if(!(l<0))return _;R=w-1}}return null}}},"./src/utils/buffer-helper.ts":function(F,I,v){v.r(I),v.d(I,"BufferHelper",function(){return k});var D=v("./src/utils/logger.ts"),h={length:0,start:function(){return 0},end:function(){return 0}},k=function(){function R(){}return R.isBuffered=function(w,_){try{if(w){for(var l=R.getBuffered(w),E=0;E<l.length;E++)if(_>=l.start(E)&&_<=l.end(E))return!0}}catch{}return!1},R.bufferInfo=function(w,_,l){try{if(w){var E,f=R.getBuffered(w),g=[];for(E=0;E<f.length;E++)g.push({start:f.start(E),end:f.end(E)});return this.bufferedInfo(g,_,l)}}catch{}return{len:0,start:_,end:_,nextStart:void 0}},R.bufferedInfo=function(w,_,l){_=Math.max(0,_),w.sort(function(i,d){var m=i.start-d.start;return m||d.end-i.end});var E=[];if(l)for(var f=0;f<w.length;f++){var g=E.length;if(g){var b=E[g-1].end;w[f].start-b<l?w[f].end>b&&(E[g-1].end=w[f].end):E.push(w[f])}else E.push(w[f])}else E=w;for(var T,u=0,e=_,n=_,t=0;t<E.length;t++){var s=E[t].start,o=E[t].end;if(_+l>=s&&_<o)e=s,u=(n=o)-_;else if(_+l<s){T=s;break}}return{len:u,start:e||0,end:n||0,nextStart:T}},R.getBuffered=function(w){try{return w.buffered}catch(_){return D.logger.log("failed to get media.buffered",_),h}},R}()},"./src/utils/cea-608-parser.ts":function(F,I,v){v.r(I),v.d(I,"Row",function(){return s}),v.d(I,"CaptionScreen",function(){return o});var D,h,k=v("./src/utils/logger.ts"),R={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},w=function(y){var r=y;return R.hasOwnProperty(y)&&(r=R[y]),String.fromCharCode(r)},_=15,l=100,E={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},f={17:2,18:4,21:6,22:8,23:10,19:13,20:15},g={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},b={25:2,26:4,29:6,30:8,31:10,27:13,28:15},T=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];(h=D||(D={}))[h.ERROR=0]="ERROR",h[h.TEXT=1]="TEXT",h[h.WARNING=2]="WARNING",h[h.INFO=2]="INFO",h[h.DEBUG=3]="DEBUG",h[h.DATA=3]="DATA";var u=function(){function y(){this.time=null,this.verboseLevel=D.ERROR}return y.prototype.log=function(r,a){this.verboseLevel>=r&&k.logger.log(this.time+" ["+r+"] "+a)},y}(),e=function(y){for(var r=[],a=0;a<y.length;a++)r.push(y[a].toString(16));return r},n=function(){function y(a,c,L,S,A){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=a||"white",this.underline=c||!1,this.italics=L||!1,this.background=S||"black",this.flash=A||!1}var r=y.prototype;return r.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},r.setStyles=function(a){for(var c=["foreground","underline","italics","background","flash"],L=0;L<c.length;L++){var S=c[L];a.hasOwnProperty(S)&&(this[S]=a[S])}},r.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},r.equals=function(a){return this.foreground===a.foreground&&this.underline===a.underline&&this.italics===a.italics&&this.background===a.background&&this.flash===a.flash},r.copy=function(a){this.foreground=a.foreground,this.underline=a.underline,this.italics=a.italics,this.background=a.background,this.flash=a.flash},r.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},y}(),t=function(){function y(a,c,L,S,A,x){this.uchar=void 0,this.penState=void 0,this.uchar=a||" ",this.penState=new n(c,L,S,A,x)}var r=y.prototype;return r.reset=function(){this.uchar=" ",this.penState.reset()},r.setChar=function(a,c){this.uchar=a,this.penState.copy(c)},r.setPenState=function(a){this.penState.copy(a)},r.equals=function(a){return this.uchar===a.uchar&&this.penState.equals(a.penState)},r.copy=function(a){this.uchar=a.uchar,this.penState.copy(a.penState)},r.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},y}(),s=function(){function y(a){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var c=0;c<l;c++)this.chars.push(new t);this.logger=a,this.pos=0,this.currPenState=new n}var r=y.prototype;return r.equals=function(a){for(var c=!0,L=0;L<l;L++)if(!this.chars[L].equals(a.chars[L])){c=!1;break}return c},r.copy=function(a){for(var c=0;c<l;c++)this.chars[c].copy(a.chars[c])},r.isEmpty=function(){for(var a=!0,c=0;c<l;c++)if(!this.chars[c].isEmpty()){a=!1;break}return a},r.setCursor=function(a){this.pos!==a&&(this.pos=a),this.pos<0?(this.logger.log(D.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>l&&(this.logger.log(D.DEBUG,"Too large cursor position "+this.pos),this.pos=l)},r.moveCursor=function(a){var c=this.pos+a;if(a>1)for(var L=this.pos+1;L<c+1;L++)this.chars[L].setPenState(this.currPenState);this.setCursor(c)},r.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},r.insertChar=function(a){a>=144&&this.backSpace();var c=w(a);this.pos>=l?this.logger.log(D.ERROR,"Cannot insert "+a.toString(16)+" ("+c+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(c,this.currPenState),this.moveCursor(1))},r.clearFromPos=function(a){var c;for(c=a;c<l;c++)this.chars[c].reset()},r.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},r.clearToEndOfRow=function(){this.clearFromPos(this.pos)},r.getTextString=function(){for(var a=[],c=!0,L=0;L<l;L++){var S=this.chars[L].uchar;S!==" "&&(c=!1),a.push(S)}return c?"":a.join("")},r.setPenStyles=function(a){this.currPenState.setStyles(a),this.chars[this.pos].setPenState(this.currPenState)},y}(),o=function(){function y(a){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var c=0;c<_;c++)this.rows.push(new s(a));this.logger=a,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var r=y.prototype;return r.reset=function(){for(var a=0;a<_;a++)this.rows[a].clear();this.currRow=14},r.equals=function(a){for(var c=!0,L=0;L<_;L++)if(!this.rows[L].equals(a.rows[L])){c=!1;break}return c},r.copy=function(a){for(var c=0;c<_;c++)this.rows[c].copy(a.rows[c])},r.isEmpty=function(){for(var a=!0,c=0;c<_;c++)if(!this.rows[c].isEmpty()){a=!1;break}return a},r.backSpace=function(){this.rows[this.currRow].backSpace()},r.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},r.insertChar=function(a){this.rows[this.currRow].insertChar(a)},r.setPen=function(a){this.rows[this.currRow].setPenStyles(a)},r.moveCursor=function(a){this.rows[this.currRow].moveCursor(a)},r.setCursor=function(a){this.logger.log(D.INFO,"setCursor: "+a),this.rows[this.currRow].setCursor(a)},r.setPAC=function(a){this.logger.log(D.INFO,"pacData = "+JSON.stringify(a));var c=a.row-1;if(this.nrRollUpRows&&c<this.nrRollUpRows-1&&(c=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==c){for(var L=0;L<_;L++)this.rows[L].clear();var S=this.currRow+1-this.nrRollUpRows,A=this.lastOutputScreen;if(A){var x=A.rows[S].cueStartTime,C=this.logger.time;if(x&&C!==null&&x<C)for(var O=0;O<this.nrRollUpRows;O++)this.rows[c-this.nrRollUpRows+O+1].copy(A.rows[S+O])}}this.currRow=c;var P=this.rows[this.currRow];if(a.indent!==null){var M=a.indent,N=Math.max(M-1,0);P.setCursor(a.indent),a.color=P.chars[N].penState.foreground}var B={foreground:a.color,underline:a.underline,italics:a.italics,background:"black",flash:!1};this.setPen(B)},r.setBkgData=function(a){this.logger.log(D.INFO,"bkgData = "+JSON.stringify(a)),this.backSpace(),this.setPen(a),this.insertChar(32)},r.setRollUpRows=function(a){this.nrRollUpRows=a},r.rollUp=function(){if(this.nrRollUpRows!==null){this.logger.log(D.TEXT,this.getDisplayText());var a=this.currRow+1-this.nrRollUpRows,c=this.rows.splice(a,1)[0];c.clear(),this.rows.splice(this.currRow,0,c),this.logger.log(D.INFO,"Rolling up")}else this.logger.log(D.DEBUG,"roll_up but nrRollUpRows not set yet")},r.getDisplayText=function(a){a=a||!1;for(var c=[],L="",S=-1,A=0;A<_;A++){var x=this.rows[A].getTextString();x&&(S=A+1,a?c.push("Row "+S+": '"+x+"'"):c.push(x.trim()))}return c.length>0&&(L=a?"["+c.join(" | ")+"]":c.join(`
`)),L},r.getTextAndFormat=function(){return this.rows},y}(),i=function(){function y(a,c,L){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=a,this.outputFilter=c,this.mode=null,this.verbose=0,this.displayedMemory=new o(L),this.nonDisplayedMemory=new o(L),this.lastOutputScreen=new o(L),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=L}var r=y.prototype;return r.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},r.getHandler=function(){return this.outputFilter},r.setHandler=function(a){this.outputFilter=a},r.setPAC=function(a){this.writeScreen.setPAC(a)},r.setBkgData=function(a){this.writeScreen.setBkgData(a)},r.setMode=function(a){a!==this.mode&&(this.mode=a,this.logger.log(D.INFO,"MODE="+a),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=a)},r.insertChars=function(a){for(var c=0;c<a.length;c++)this.writeScreen.insertChar(a[c]);var L=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(D.INFO,L+": "+this.writeScreen.getDisplayText(!0)),this.mode!=="MODE_PAINT-ON"&&this.mode!=="MODE_ROLL-UP"||(this.logger.log(D.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},r.ccRCL=function(){this.logger.log(D.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},r.ccBS=function(){this.logger.log(D.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},r.ccAOF=function(){},r.ccAON=function(){},r.ccDER=function(){this.logger.log(D.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},r.ccRU=function(a){this.logger.log(D.INFO,"RU("+a+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(a)},r.ccFON=function(){this.logger.log(D.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},r.ccRDC=function(){this.logger.log(D.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},r.ccTR=function(){this.logger.log(D.INFO,"TR"),this.setMode("MODE_TEXT")},r.ccRTD=function(){this.logger.log(D.INFO,"RTD"),this.setMode("MODE_TEXT")},r.ccEDM=function(){this.logger.log(D.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},r.ccCR=function(){this.logger.log(D.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},r.ccENM=function(){this.logger.log(D.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},r.ccEOC=function(){if(this.logger.log(D.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var a=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=a,this.writeScreen=this.nonDisplayedMemory,this.logger.log(D.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},r.ccTO=function(a){this.logger.log(D.INFO,"TO("+a+") - Tab Offset"),this.writeScreen.moveCursor(a)},r.ccMIDROW=function(a){var c={flash:!1};if(c.underline=a%2==1,c.italics=a>=46,c.italics)c.foreground="white";else{var L=Math.floor(a/2)-16;c.foreground=["white","green","blue","cyan","red","yellow","magenta"][L]}this.logger.log(D.INFO,"MIDROW: "+JSON.stringify(c)),this.writeScreen.setPen(c)},r.outputDataUpdate=function(a){a===void 0&&(a=!1);var c=this.logger.time;c!==null&&this.outputFilter&&(this.cueStartTime!==null||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,c,this.lastOutputScreen),a&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:c):this.cueStartTime=c,this.lastOutputScreen.copy(this.displayedMemory))},r.cueSplitAtTime=function(a){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,a,this.displayedMemory),this.cueStartTime=a))},y}(),d=function(){function y(a,c,L){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var S=new u;this.channels=[null,new i(a,c,S),new i(a+1,L,S)],this.cmdHistory={a:null,b:null},this.logger=S}var r=y.prototype;return r.getHandler=function(a){return this.channels[a].getHandler()},r.setHandler=function(a,c){this.channels[a].setHandler(c)},r.addData=function(a,c){var L,S,A,x=!1;this.logger.time=a;for(var C=0;C<c.length;C+=2)if(S=127&c[C],A=127&c[C+1],S!==0||A!==0){if(this.logger.log(D.DATA,"["+e([c[C],c[C+1]])+"] -> ("+e([S,A])+")"),(L=this.parseCmd(S,A))||(L=this.parseMidrow(S,A)),L||(L=this.parsePAC(S,A)),L||(L=this.parseBackgroundAttributes(S,A)),!L&&(x=this.parseChars(S,A))){var O=this.currentChannel;O&&O>0?this.channels[O].insertChars(x):this.logger.log(D.WARNING,"No channel found yet. TEXT-MODE?")}L||x||this.logger.log(D.WARNING,"Couldn't parse cleaned data "+e([S,A])+" orig: "+e([c[C],c[C+1]]))}},r.parseCmd=function(a,c){var L=this.cmdHistory;if(!((a===20||a===28||a===21||a===29)&&c>=32&&c<=47||(a===23||a===31)&&c>=33&&c<=35))return!1;if(p(a,c,L))return m(null,null,L),this.logger.log(D.DEBUG,"Repeated command ("+e([a,c])+") is dropped"),!0;var S=a===20||a===21||a===23?1:2,A=this.channels[S];return a===20||a===21||a===28||a===29?c===32?A.ccRCL():c===33?A.ccBS():c===34?A.ccAOF():c===35?A.ccAON():c===36?A.ccDER():c===37?A.ccRU(2):c===38?A.ccRU(3):c===39?A.ccRU(4):c===40?A.ccFON():c===41?A.ccRDC():c===42?A.ccTR():c===43?A.ccRTD():c===44?A.ccEDM():c===45?A.ccCR():c===46?A.ccENM():c===47&&A.ccEOC():A.ccTO(c-32),m(a,c,L),this.currentChannel=S,!0},r.parseMidrow=function(a,c){var L=0;if((a===17||a===25)&&c>=32&&c<=47){if((L=a===17?1:2)!==this.currentChannel)return this.logger.log(D.ERROR,"Mismatch channel in midrow parsing"),!1;var S=this.channels[L];return!!S&&(S.ccMIDROW(c),this.logger.log(D.DEBUG,"MIDROW ("+e([a,c])+")"),!0)}return!1},r.parsePAC=function(a,c){var L,S=this.cmdHistory;if(!((a>=17&&a<=23||a>=25&&a<=31)&&c>=64&&c<=127||(a===16||a===24)&&c>=64&&c<=95))return!1;if(p(a,c,S))return m(null,null,S),!0;var A=a<=23?1:2;L=c>=64&&c<=95?A===1?E[a]:g[a]:A===1?f[a]:b[a];var x=this.channels[A];return!!x&&(x.setPAC(this.interpretPAC(L,c)),m(a,c,S),this.currentChannel=A,!0)},r.interpretPAC=function(a,c){var L,S={color:null,italics:!1,indent:null,underline:!1,row:a};return L=c>95?c-96:c-64,S.underline=(1&L)==1,L<=13?S.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(L/2)]:L<=15?(S.italics=!0,S.color="white"):S.indent=4*Math.floor((L-16)/2),S},r.parseChars=function(a,c){var L,S,A=null,x=null;if(a>=25?(L=2,x=a-8):(L=1,x=a),x>=17&&x<=19?(S=x===17?c+80:x===18?c+112:c+144,this.logger.log(D.INFO,"Special char '"+w(S)+"' in channel "+L),A=[S]):a>=32&&a<=127&&(A=c===0?[a]:[a,c]),A){var C=e(A);this.logger.log(D.DEBUG,"Char codes =  "+C.join(",")),m(a,c,this.cmdHistory)}return A},r.parseBackgroundAttributes=function(a,c){var L;if(!((a===16||a===24)&&c>=32&&c<=47||(a===23||a===31)&&c>=45&&c<=47))return!1;var S={};a===16||a===24?(L=Math.floor((c-32)/2),S.background=T[L],c%2==1&&(S.background=S.background+"_semi")):c===45?S.background="transparent":(S.foreground="black",c===47&&(S.underline=!0));var A=a<=23?1:2;return this.channels[A].setBkgData(S),m(a,c,this.cmdHistory),!0},r.reset=function(){for(var a=0;a<Object.keys(this.channels).length;a++){var c=this.channels[a];c&&c.reset()}this.cmdHistory={a:null,b:null}},r.cueSplitAtTime=function(a){for(var c=0;c<this.channels.length;c++){var L=this.channels[c];L&&L.cueSplitAtTime(a)}},y}();function m(y,r,a){a.a=y,a.b=r}function p(y,r,a){return a.a===y&&a.b===r}I.default=d},"./src/utils/codecs.ts":function(F,I,v){v.r(I),v.d(I,"isCodecType",function(){return h}),v.d(I,"isCodecSupportedInMp4",function(){return k});var D={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function h(R,w){var _=D[w];return!!_&&_[R.slice(0,4)]===!0}function k(R,w){return MediaSource.isTypeSupported((w||"video")+'/mp4;codecs="'+R+'"')}},"./src/utils/cues.ts":function(F,I,v){v.r(I);var D=v("./src/utils/vttparser.ts"),h=v("./src/utils/webvtt-parser.ts"),k=v("./src/utils/texttrack-utils.ts"),R=/\s/,w={newCue:function(_,l,E,f){for(var g,b,T,u,e,n=[],t=self.VTTCue||self.TextTrackCue,s=0;s<f.rows.length;s++)if(T=!0,u=0,e="",!(g=f.rows[s]).isEmpty()){for(var o=0;o<g.chars.length;o++)R.test(g.chars[o].uchar)&&T?u++:(e+=g.chars[o].uchar,T=!1);g.cueStartTime=l,l===E&&(E+=1e-4),u>=16?u--:u++;var i=Object(D.fixLineBreaks)(e.trim()),d=Object(h.generateCueId)(l,E,i);_&&_.cues&&_.cues.getCueById(d)||((b=new t(l,E,i)).id=d,b.line=s+1,b.align="left",b.position=10+Math.min(80,10*Math.floor(8*u/32)),n.push(b))}return _&&n.length&&(n.sort(function(m,p){return m.line==="auto"||p.line==="auto"?0:m.line>8&&p.line>8?p.line-m.line:m.line-p.line}),n.forEach(function(m){return Object(k.addCueToTrack)(_,m)})),n}};I.default=w},"./src/utils/discontinuities.ts":function(F,I,v){v.r(I),v.d(I,"findFirstFragWithCC",function(){return R}),v.d(I,"shouldAlignOnDiscontinuities",function(){return w}),v.d(I,"findDiscontinuousReferenceFrag",function(){return _}),v.d(I,"adjustSlidingStart",function(){return E}),v.d(I,"alignStream",function(){return f}),v.d(I,"alignPDT",function(){return g});var D=v("./src/polyfills/number.ts"),h=v("./src/utils/logger.ts"),k=v("./src/controller/level-helper.ts");function R(b,T){for(var u=null,e=0,n=b.length;e<n;e++){var t=b[e];if(t&&t.cc===T){u=t;break}}return u}function w(b,T,u){return!(!T.details||!(u.endCC>u.startCC||b&&b.cc<u.startCC))}function _(b,T){var u=b.fragments,e=T.fragments;if(e.length&&u.length){var n=R(u,e[0].cc);if(n&&(!n||n.startPTS))return n;h.logger.log("No frag in previous level to align on")}else h.logger.log("No fragments to align")}function l(b,T){if(b){var u=b.start+T;b.start=b.startPTS=u,b.endPTS=u+b.duration}}function E(b,T){for(var u=T.fragments,e=0,n=u.length;e<n;e++)l(u[e],b);T.fragmentHint&&l(T.fragmentHint,b),T.alignedSliding=!0}function f(b,T,u){T&&(function(e,n,t){if(w(e,t,n)){var s=_(t.details,n);s&&Object(D.isFiniteNumber)(s.start)&&(h.logger.log("Adjusting PTS using last level due to CC increase within current level "+n.url),E(s.start,n))}}(b,u,T),!u.alignedSliding&&T.details&&g(u,T.details),u.alignedSliding||!T.details||u.skippedSegments||Object(k.adjustSliding)(T.details,u))}function g(b,T){if(T.fragments.length&&b.hasProgramDateTime&&T.hasProgramDateTime){var u=T.fragments[0].programDateTime,e=b.fragments[0].programDateTime,n=(e-u)/1e3+T.fragments[0].start;n&&Object(D.isFiniteNumber)(n)&&(h.logger.log("Adjusting PTS using programDateTime delta "+(e-u)+"ms, sliding:"+n.toFixed(3)+" "+b.url+" "),E(n,b))}}},"./src/utils/ewma-bandwidth-estimator.ts":function(F,I,v){v.r(I);var D=v("./src/utils/ewma.ts"),h=function(){function k(w,_,l){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=l,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new D.default(w),this.fast_=new D.default(_)}var R=k.prototype;return R.update=function(w,_){var l=this.slow_,E=this.fast_;this.slow_.halfLife!==w&&(this.slow_=new D.default(w,l.getEstimate(),l.getTotalWeight())),this.fast_.halfLife!==_&&(this.fast_=new D.default(_,E.getEstimate(),E.getTotalWeight()))},R.sample=function(w,_){var l=(w=Math.max(w,this.minDelayMs_))/1e3,E=8*_/l;this.fast_.sample(l,E),this.slow_.sample(l,E)},R.canEstimate=function(){var w=this.fast_;return w&&w.getTotalWeight()>=this.minWeight_},R.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},R.destroy=function(){},k}();I.default=h},"./src/utils/ewma.ts":function(F,I,v){v.r(I);var D=function(){function h(R,w,_){w===void 0&&(w=0),_===void 0&&(_=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=R,this.alpha_=R?Math.exp(Math.log(.5)/R):0,this.estimate_=w,this.totalWeight_=_}var k=h.prototype;return k.sample=function(R,w){var _=Math.pow(this.alpha_,R);this.estimate_=w*(1-_)+_*this.estimate_,this.totalWeight_+=R},k.getTotalWeight=function(){return this.totalWeight_},k.getEstimate=function(){if(this.alpha_){var R=1-Math.pow(this.alpha_,this.totalWeight_);if(R)return this.estimate_/R}return this.estimate_},h}();I.default=D},"./src/utils/fetch-loader.ts":function(F,I,v){v.r(I),v.d(I,"fetchSupported",function(){return f});var D=v("./src/polyfills/number.ts"),h=v("./src/loader/load-stats.ts"),k=v("./src/demux/chunk-cache.ts");function R(u){var e=typeof Map=="function"?new Map:void 0;return(R=function(n){if(n===null||(t=n,Function.toString.call(t).indexOf("[native code]")===-1))return n;var t;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(e!==void 0){if(e.has(n))return e.get(n);e.set(n,s)}function s(){return w(n,arguments,E(this).constructor)}return s.prototype=Object.create(n.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),l(s,n)})(u)}function w(u,e,n){return(w=_()?Reflect.construct:function(t,s,o){var i=[null];i.push.apply(i,s);var d=new(Function.bind.apply(t,i));return o&&l(d,o.prototype),d}).apply(null,arguments)}function _(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function l(u,e){return(l=Object.setPrototypeOf||function(n,t){return n.__proto__=t,n})(u,e)}function E(u){return(E=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(u)}function f(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var g=function(){function u(n){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=n.fetchSetup||b,this.controller=new self.AbortController,this.stats=new h.LoadStats}var e=u.prototype;return e.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},e.abortInternal=function(){var n=this.response;n&&n.ok||(this.stats.aborted=!0,this.controller.abort())},e.abort=function(){var n;this.abortInternal(),(n=this.callbacks)!==null&&n!==void 0&&n.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},e.load=function(n,t,s){var o=this,i=this.stats;if(i.loading.start)throw new Error("Loader can only be used once.");i.loading.start=self.performance.now();var d=function(r,a){var c={method:"GET",mode:"cors",credentials:"same-origin",signal:a};return r.rangeEnd&&(c.headers=new self.Headers({Range:"bytes="+r.rangeStart+"-"+String(r.rangeEnd-1)})),c}(n,this.controller.signal),m=s.onProgress,p=n.responseType==="arraybuffer",y=p?"byteLength":"length";this.context=n,this.config=t,this.callbacks=s,this.request=this.fetchSetup(n,d),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){o.abortInternal(),s.onTimeout(i,n,o.response)},t.timeout),self.fetch(this.request).then(function(r){if(o.response=o.loader=r,!r.ok){var a=r.status,c=r.statusText;throw new T(c||"fetch, bad network response",a,r)}return i.loading.first=Math.max(self.performance.now(),i.loading.start),i.total=parseInt(r.headers.get("Content-Length")||"0"),m&&Object(D.isFiniteNumber)(t.highWaterMark)?o.loadProgressively(r,i,n,t.highWaterMark,m):p?r.arrayBuffer():r.text()}).then(function(r){var a=o.response;self.clearTimeout(o.requestTimeout),i.loading.end=Math.max(self.performance.now(),i.loading.first),i.loaded=i.total=r[y];var c={url:a.url,data:r};m&&!Object(D.isFiniteNumber)(t.highWaterMark)&&m(i,n,r,a),s.onSuccess(c,i,n,a)}).catch(function(r){if(self.clearTimeout(o.requestTimeout),!i.aborted){var a=r.code||0;s.onError({code:a,text:r.message},n,r.details)}})},e.getCacheAge=function(){var n=null;if(this.response){var t=this.response.headers.get("age");n=t?parseFloat(t):null}return n},e.loadProgressively=function(n,t,s,o,i){o===void 0&&(o=0);var d=new k.default,m=n.body.getReader();return function p(){return m.read().then(function(y){if(y.done)return d.dataLength&&i(t,s,d.flush(),n),Promise.resolve(new ArrayBuffer(0));var r=y.value,a=r.length;return t.loaded+=a,a<o||d.dataLength?(d.push(r),d.dataLength>=o&&i(t,s,d.flush(),n)):i(t,s,r,n),p()}).catch(function(){return Promise.reject()})}()},u}();function b(u,e){return new self.Request(u.url,e)}var T=function(u){var e,n;function t(s,o,i){var d;return(d=u.call(this,s)||this).code=void 0,d.details=void 0,d.code=o,d.details=i,d}return n=u,(e=t).prototype=Object.create(n.prototype),e.prototype.constructor=e,l(e,n),t}(R(Error));I.default=g},"./src/utils/imsc1-ttml-parser.ts":function(F,I,v){v.r(I),v.d(I,"IMSC1_CODEC",function(){return E}),v.d(I,"parseIMSC1",function(){return T});var D=v("./src/utils/mp4-tools.ts"),h=v("./src/utils/vttparser.ts"),k=v("./src/utils/vttcue.ts"),R=v("./src/demux/id3.ts"),w=v("./src/utils/timescale-conversion.ts"),_=v("./src/utils/webvtt-parser.ts");function l(){return(l=Object.assign||function(i){for(var d=1;d<arguments.length;d++){var m=arguments[d];for(var p in m)Object.prototype.hasOwnProperty.call(m,p)&&(i[p]=m[p])}return i}).apply(this,arguments)}var E="stpp.ttml.im1t",f=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,g=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,b={left:"start",center:"center",right:"end",start:"start",end:"end"};function T(i,d,m,p,y){var r=Object(D.findBox)(new Uint8Array(i),["mdat"]);if(r.length!==0){var a=r[0],c=Object(R.utf8ArrayToStr)(new Uint8Array(i,a.start,a.end-a.start)),L=Object(w.toTimescaleFromScale)(d,1,m);try{p(function(S,A){var x=new DOMParser().parseFromString(S,"text/xml").getElementsByTagName("tt")[0];if(!x)throw new Error("Invalid ttml");var C={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},O=Object.keys(C).reduce(function(U,G){return U[G]=x.getAttribute("ttp:"+G)||C[G],U},{}),P=x.getAttribute("xml:space")!=="preserve",M=e(u(x,"styling","style")),N=e(u(x,"layout","region")),B=u(x,"body","[begin]");return[].map.call(B,function(U){var G=n(U,P);if(!G||!U.hasAttribute("begin"))return null;var z=o(U.getAttribute("begin"),O),Y=o(U.getAttribute("dur"),O),X=o(U.getAttribute("end"),O);if(z===null)throw s(U);if(X===null){if(Y===null)throw s(U);X=z+Y}var $=new k.default(z-A,X-A,G);$.id=Object(_.generateCueId)($.startTime,$.endTime,$.text);var Z=N[U.getAttribute("region")],ue=M[U.getAttribute("style")];$.position=10,$.size=80;var de=function(fe,ae){var oe="http://www.w3.org/ns/ttml#styling";return["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce(function(me,ge){var Se=t(ae,oe,ge)||t(fe,oe,ge);return Se&&(me[ge]=Se),me},{})}(Z,ue),ve=de.textAlign;if(ve){var te=b[ve];te&&($.lineAlign=te),$.align=ve}return l($,de),$}).filter(function(U){return U!==null})}(c,L))}catch(S){y(S)}}else y(new Error("Could not parse IMSC1 mdat"))}function u(i,d,m){var p=i.getElementsByTagName(d)[0];return p?[].slice.call(p.querySelectorAll(m)):[]}function e(i){return i.reduce(function(d,m){var p=m.getAttribute("xml:id");return p&&(d[p]=m),d},{})}function n(i,d){return[].slice.call(i.childNodes).reduce(function(m,p,y){var r;return p.nodeName==="br"&&y?m+`
`:(r=p.childNodes)!==null&&r!==void 0&&r.length?n(p,d):d?m+p.textContent.trim().replace(/\s+/g," "):m+p.textContent},"")}function t(i,d,m){return i.hasAttributeNS(d,m)?i.getAttributeNS(d,m):null}function s(i){return new Error("Could not parse ttml timestamp "+i)}function o(i,d){if(!i)return null;var m=Object(h.parseTimeStamp)(i);return m===null&&(f.test(i)?m=function(p,y){var r=f.exec(p),a=(0|r[4])+(0|r[5])/y.subFrameRate;return 3600*(0|r[1])+60*(0|r[2])+(0|r[3])+a/y.frameRate}(i,d):g.test(i)&&(m=function(p,y){var r=g.exec(p),a=Number(r[1]);switch(r[2]){case"h":return 3600*a;case"m":return 60*a;case"ms":return 1e3*a;case"f":return a/y.frameRate;case"t":return a/y.tickRate}return a}(i,d))),m}},"./src/utils/logger.ts":function(F,I,v){v.r(I),v.d(I,"enableLogs",function(){return w}),v.d(I,"logger",function(){return _});var D=function(){},h={trace:D,debug:D,log:D,warn:D,info:D,error:D},k=h;function R(l){var E=self.console[l];return E?E.bind(self.console,"["+l+"] >"):D}function w(l){if(self.console&&l===!0||typeof l=="object"){(function(E){for(var f=arguments.length,g=new Array(f>1?f-1:0),b=1;b<f;b++)g[b-1]=arguments[b];g.forEach(function(T){k[T]=E[T]?E[T].bind(E):R(T)})})(l,"debug","log","info","warn","error");try{k.log()}catch{k=h}}else k=h}var _=h},"./src/utils/mediakeys-helper.ts":function(F,I,v){var D,h;v.r(I),v.d(I,"KeySystems",function(){return D}),v.d(I,"requestMediaKeySystemAccess",function(){return k}),(h=D||(D={})).WIDEVINE="com.widevine.alpha",h.PLAYREADY="com.microsoft.playready";var k=typeof self!="undefined"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null},"./src/utils/mediasource-helper.ts":function(F,I,v){function D(){return self.MediaSource||self.WebKitMediaSource}v.r(I),v.d(I,"getMediaSource",function(){return D})},"./src/utils/mp4-tools.ts":function(F,I,v){v.r(I),v.d(I,"bin2str",function(){return w}),v.d(I,"readUint16",function(){return _}),v.d(I,"readUint32",function(){return l}),v.d(I,"writeUint32",function(){return E}),v.d(I,"findBox",function(){return f}),v.d(I,"parseSegmentIndex",function(){return g}),v.d(I,"parseInitSegment",function(){return b}),v.d(I,"getStartDTS",function(){return T}),v.d(I,"getDuration",function(){return u}),v.d(I,"computeRawDurationFromSamples",function(){return e}),v.d(I,"offsetStartDTS",function(){return n}),v.d(I,"segmentValidRange",function(){return t}),v.d(I,"appendUint8Array",function(){return s});var D=v("./src/utils/typed-array.ts"),h=v("./src/loader/fragment.ts"),k=Math.pow(2,32)-1,R=[].push;function w(o){return String.fromCharCode.apply(null,o)}function _(o,i){"data"in o&&(i+=o.start,o=o.data);var d=o[i]<<8|o[i+1];return d<0?65536+d:d}function l(o,i){"data"in o&&(i+=o.start,o=o.data);var d=o[i]<<24|o[i+1]<<16|o[i+2]<<8|o[i+3];return d<0?4294967296+d:d}function E(o,i,d){"data"in o&&(i+=o.start,o=o.data),o[i]=d>>24,o[i+1]=d>>16&255,o[i+2]=d>>8&255,o[i+3]=255&d}function f(o,i){var d,m,p,y=[];if(!i.length)return y;"data"in o?(d=o.data,m=o.start,p=o.end):(m=0,p=(d=o).byteLength);for(var r=m;r<p;){var a=l(d,r),c=a>1?r+a:p;if(w(d.subarray(r+4,r+8))===i[0])if(i.length===1)y.push({data:d,start:r+8,end:c});else{var L=f({data:d,start:r+8,end:c},i.slice(1));L.length&&R.apply(y,L)}r=c}return y}function g(o){var i=f(o,["moov"])[0],d=i?i.end:null,m=f(o,["sidx"]);if(!m||!m[0])return null;var p=[],y=m[0],r=y.data[0],a=r===0?8:16,c=l(y,a);a+=4,a+=r===0?8:16,a+=2;var L=y.end+0,S=_(y,a);a+=2;for(var A=0;A<S;A++){var x=a,C=l(y,x);x+=4;var O=2147483647&C;if((2147483648&C)>>>31==1)return console.warn("SIDX has hierarchical references (not supported)"),null;var P=l(y,x);x+=4,p.push({referenceSize:O,subsegmentDuration:P,info:{duration:P/c,start:L,end:L+O-1}}),L+=O,a=x+=4}return{earliestPresentationTime:0,timescale:c,version:r,referencesCount:S,references:p,moovEndOffset:d}}function b(o){for(var i=[],d=f(o,["moov","trak"]),m=0;m<d.length;m++){var p=d[m],y=f(p,["tkhd"])[0];if(y){var r=y.data[y.start],a=r===0?12:20,c=l(y,a),L=f(p,["mdia","mdhd"])[0];if(L){var S=l(L,a=(r=L.data[L.start])===0?12:20),A=f(p,["mdia","hdlr"])[0];if(A){var x=w(A.data.subarray(A.start+8,A.start+12)),C={soun:h.ElementaryStreamTypes.AUDIO,vide:h.ElementaryStreamTypes.VIDEO}[x];if(C){var O=f(p,["mdia","minf","stbl","stsd"])[0],P=void 0;O&&(P=w(O.data.subarray(O.start+12,O.start+16))),i[c]={timescale:S,type:C},i[C]={timescale:S,id:c,codec:P}}}}}}return f(o,["moov","mvex","trex"]).forEach(function(M){var N=l(M,4),B=i[N];B&&(B.default={duration:l(M,12),flags:l(M,20)})}),i}function T(o,i){return f(i,["moof","traf"]).reduce(function(d,m){var p=f(m,["tfdt"])[0],y=p.data[p.start],r=f(m,["tfhd"]).reduce(function(a,c){var L=l(c,4),S=o[L];if(S){var A=l(p,4);y===1&&(A*=Math.pow(2,32),A+=l(p,8));var x=A/(S.timescale||9e4);if(isFinite(x)&&(a===null||x<a))return x}return a},null);return r!==null&&isFinite(r)&&(d===null||r<d)?r:d},null)||0}function u(o,i){for(var d=0,m=0,p=0,y=f(o,["moof","traf"]),r=0;r<y.length;r++){var a=y[r],c=f(a,["tfhd"])[0],L=i[l(c,4)];if(L){var S=L.default,A=l(c,0)|(S==null?void 0:S.flags),x=S==null?void 0:S.duration;8&A&&(x=l(c,2&A?12:8));for(var C=L.timescale||9e4,O=f(a,["trun"]),P=0;P<O.length;P++)d=x?x*l(O[P],4):e(O[P]),L.type===h.ElementaryStreamTypes.VIDEO?m+=d/C:L.type===h.ElementaryStreamTypes.AUDIO&&(p+=d/C)}}if(m===0&&p===0){var M=g(o);if(M!=null&&M.references)return M.references.reduce(function(N,B){return N+B.info.duration||0},0)}return m||p}function e(o){var i=l(o,0),d=8;1&i&&(d+=4),4&i&&(d+=4);for(var m=0,p=l(o,4),y=0;y<p;y++)256&i&&(m+=l(o,d),d+=4),512&i&&(d+=4),1024&i&&(d+=4),2048&i&&(d+=4);return m}function n(o,i,d){f(i,["moof","traf"]).forEach(function(m){f(m,["tfhd"]).forEach(function(p){var y=l(p,4),r=o[y];if(r){var a=r.timescale||9e4;f(m,["tfdt"]).forEach(function(c){var L=c.data[c.start],S=l(c,4);if(L===0)E(c,4,S-d*a);else{S*=Math.pow(2,32),S+=l(c,8),S-=d*a,S=Math.max(S,0);var A=Math.floor(S/(k+1)),x=Math.floor(S%(k+1));E(c,4,A),E(c,8,x)}})}})})}function t(o){var i={valid:null,remainder:null},d=f(o,["moof"]);if(!d)return i;if(d.length<2)return i.remainder=o,i;var m=d[d.length-1];return i.valid=Object(D.sliceUint8)(o,0,m.start-8),i.remainder=Object(D.sliceUint8)(o,m.start-8),i}function s(o,i){var d=new Uint8Array(o.length+i.length);return d.set(o),d.set(i,o.length),d}},"./src/utils/output-filter.ts":function(F,I,v){v.r(I),v.d(I,"default",function(){return D});var D=function(){function h(R,w){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=R,this.trackName=w}var k=h.prototype;return k.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},k.newCue=function(R,w,_){(this.startTime===null||this.startTime>R)&&(this.startTime=R),this.endTime=w,this.screen=_,this.timelineController.createCaptionsTrack(this.trackName)},k.reset=function(){this.cueRanges=[]},h}()},"./src/utils/texttrack-utils.ts":function(F,I,v){v.r(I),v.d(I,"sendAddTrackEvent",function(){return h}),v.d(I,"addCueToTrack",function(){return k}),v.d(I,"clearCurrentCues",function(){return R}),v.d(I,"removeCuesInRange",function(){return w}),v.d(I,"getCuesInRange",function(){return _});var D=v("./src/utils/logger.ts");function h(l,E){var f;try{f=new Event("addtrack")}catch{(f=document.createEvent("Event")).initEvent("addtrack",!1,!1)}f.track=l,E.dispatchEvent(f)}function k(l,E){var f=l.mode;if(f==="disabled"&&(l.mode="hidden"),l.cues&&!l.cues.getCueById(E.id))try{if(l.addCue(E),!l.cues.getCueById(E.id))throw new Error("addCue is failed for: "+E)}catch(b){D.logger.debug("[texttrack-utils]: "+b);var g=new self.TextTrackCue(E.startTime,E.endTime,E.text);g.id=E.id,l.addCue(g)}f==="disabled"&&(l.mode=f)}function R(l){var E=l.mode;if(E==="disabled"&&(l.mode="hidden"),l.cues)for(var f=l.cues.length;f--;)l.removeCue(l.cues[f]);E==="disabled"&&(l.mode=E)}function w(l,E,f){var g=l.mode;if(g==="disabled"&&(l.mode="hidden"),l.cues&&l.cues.length>0)for(var b=_(l.cues,E,f),T=0;T<b.length;T++)l.removeCue(b[T]);g==="disabled"&&(l.mode=g)}function _(l,E,f){var g=[],b=function(n,t){if(t<n[0].startTime)return 0;var s=n.length-1;if(t>n[s].endTime)return-1;for(var o=0,i=s;o<=i;){var d=Math.floor((i+o)/2);if(t<n[d].startTime)i=d-1;else{if(!(t>n[d].startTime&&o<s))return d;o=d+1}}return n[o].startTime-t<t-n[i].startTime?o:i}(l,E);if(b>-1)for(var T=b,u=l.length;T<u;T++){var e=l[T];if(e.startTime>=E&&e.endTime<=f)g.push(e);else if(e.startTime>f)return g}return g}},"./src/utils/time-ranges.ts":function(F,I,v){v.r(I),I.default={toString:function(D){for(var h="",k=D.length,R=0;R<k;R++)h+="["+D.start(R).toFixed(3)+","+D.end(R).toFixed(3)+"]";return h}}},"./src/utils/timescale-conversion.ts":function(F,I,v){function D(w,_,l,E){l===void 0&&(l=1),E===void 0&&(E=!1);var f=w*_*l;return E?Math.round(f):f}function h(w,_,l,E){return l===void 0&&(l=1),E===void 0&&(E=!1),D(w,_,1/l,E)}function k(w,_){return _===void 0&&(_=!1),D(w,1e3,1/9e4,_)}function R(w,_){return _===void 0&&(_=1),D(w,9e4,1/_)}v.r(I),v.d(I,"toTimescaleFromBase",function(){return D}),v.d(I,"toTimescaleFromScale",function(){return h}),v.d(I,"toMsFromMpegTsClock",function(){return k}),v.d(I,"toMpegTsClockFromTimescale",function(){return R})},"./src/utils/typed-array.ts":function(F,I,v){function D(h,k,R){return Uint8Array.prototype.slice?h.slice(k,R):new Uint8Array(Array.prototype.slice.call(h,k,R))}v.r(I),v.d(I,"sliceUint8",function(){return D})},"./src/utils/vttcue.ts":function(F,I,v){v.r(I),I.default=function(){if(typeof self!="undefined"&&self.VTTCue)return self.VTTCue;var D=["","lr","rl"],h=["start","middle","end","left","right"];function k(l,E){if(typeof E!="string"||!Array.isArray(l))return!1;var f=E.toLowerCase();return!!~l.indexOf(f)&&f}function R(l){return k(h,l)}function w(l){for(var E=arguments.length,f=new Array(E>1?E-1:0),g=1;g<E;g++)f[g-1]=arguments[g];for(var b=1;b<arguments.length;b++){var T=arguments[b];for(var u in T)l[u]=T[u]}return l}function _(l,E,f){var g=this,b={enumerable:!0};g.hasBeenReset=!1;var T="",u=!1,e=l,n=E,t=f,s=null,o="",i=!0,d="auto",m="start",p=50,y="middle",r=50,a="middle";Object.defineProperty(g,"id",w({},b,{get:function(){return T},set:function(c){T=""+c}})),Object.defineProperty(g,"pauseOnExit",w({},b,{get:function(){return u},set:function(c){u=!!c}})),Object.defineProperty(g,"startTime",w({},b,{get:function(){return e},set:function(c){if(typeof c!="number")throw new TypeError("Start time must be set to a number.");e=c,this.hasBeenReset=!0}})),Object.defineProperty(g,"endTime",w({},b,{get:function(){return n},set:function(c){if(typeof c!="number")throw new TypeError("End time must be set to a number.");n=c,this.hasBeenReset=!0}})),Object.defineProperty(g,"text",w({},b,{get:function(){return t},set:function(c){t=""+c,this.hasBeenReset=!0}})),Object.defineProperty(g,"region",w({},b,{get:function(){return s},set:function(c){s=c,this.hasBeenReset=!0}})),Object.defineProperty(g,"vertical",w({},b,{get:function(){return o},set:function(c){var L=function(S){return k(D,S)}(c);if(L===!1)throw new SyntaxError("An invalid or illegal string was specified.");o=L,this.hasBeenReset=!0}})),Object.defineProperty(g,"snapToLines",w({},b,{get:function(){return i},set:function(c){i=!!c,this.hasBeenReset=!0}})),Object.defineProperty(g,"line",w({},b,{get:function(){return d},set:function(c){if(typeof c!="number"&&c!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");d=c,this.hasBeenReset=!0}})),Object.defineProperty(g,"lineAlign",w({},b,{get:function(){return m},set:function(c){var L=R(c);if(!L)throw new SyntaxError("An invalid or illegal string was specified.");m=L,this.hasBeenReset=!0}})),Object.defineProperty(g,"position",w({},b,{get:function(){return p},set:function(c){if(c<0||c>100)throw new Error("Position must be between 0 and 100.");p=c,this.hasBeenReset=!0}})),Object.defineProperty(g,"positionAlign",w({},b,{get:function(){return y},set:function(c){var L=R(c);if(!L)throw new SyntaxError("An invalid or illegal string was specified.");y=L,this.hasBeenReset=!0}})),Object.defineProperty(g,"size",w({},b,{get:function(){return r},set:function(c){if(c<0||c>100)throw new Error("Size must be between 0 and 100.");r=c,this.hasBeenReset=!0}})),Object.defineProperty(g,"align",w({},b,{get:function(){return a},set:function(c){var L=R(c);if(!L)throw new SyntaxError("An invalid or illegal string was specified.");a=L,this.hasBeenReset=!0}})),g.displayState=void 0}return _.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},_}()},"./src/utils/vttparser.ts":function(F,I,v){v.r(I),v.d(I,"parseTimeStamp",function(){return k}),v.d(I,"fixLineBreaks",function(){return f}),v.d(I,"VTTParser",function(){return g});var D=v("./src/utils/vttcue.ts"),h=function(){function b(){}return b.prototype.decode=function(T,u){if(!T)return"";if(typeof T!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(T))},b}();function k(b){function T(e,n,t,s){return 3600*(0|e)+60*(0|n)+(0|t)+parseFloat(s||0)}var u=b.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return u?parseFloat(u[2])>59?T(u[2],u[3],0,u[4]):T(u[1],u[2],u[3],u[4]):null}var R=function(){function b(){this.values=Object.create(null)}var T=b.prototype;return T.set=function(u,e){this.get(u)||e===""||(this.values[u]=e)},T.get=function(u,e,n){return n?this.has(u)?this.values[u]:e[n]:this.has(u)?this.values[u]:e},T.has=function(u){return u in this.values},T.alt=function(u,e,n){for(var t=0;t<n.length;++t)if(e===n[t]){this.set(u,e);break}},T.integer=function(u,e){/^-?\d+$/.test(e)&&this.set(u,parseInt(e,10))},T.percent=function(u,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){var n=parseFloat(e);if(n>=0&&n<=100)return this.set(u,n),!0}return!1},b}();function w(b,T,u,e){var n=e?b.split(e):[b];for(var t in n)if(typeof n[t]=="string"){var s=n[t].split(u);s.length===2&&T(s[0],s[1])}}var _=new D.default(0,0,""),l=_.align==="middle"?"middle":"center";function E(b,T,u){var e=b;function n(){var s=k(b);if(s===null)throw new Error("Malformed timestamp: "+e);return b=b.replace(/^[^\sa-zA-Z-]+/,""),s}function t(){b=b.replace(/^\s+/,"")}if(t(),T.startTime=n(),t(),b.substr(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+e);b=b.substr(3),t(),T.endTime=n(),t(),function(s,o){var i=new R;w(s,function(p,y){var r;switch(p){case"region":for(var a=u.length-1;a>=0;a--)if(u[a].id===y){i.set(p,u[a].region);break}break;case"vertical":i.alt(p,y,["rl","lr"]);break;case"line":r=y.split(","),i.integer(p,r[0]),i.percent(p,r[0])&&i.set("snapToLines",!1),i.alt(p,r[0],["auto"]),r.length===2&&i.alt("lineAlign",r[1],["start",l,"end"]);break;case"position":r=y.split(","),i.percent(p,r[0]),r.length===2&&i.alt("positionAlign",r[1],["start",l,"end","line-left","line-right","auto"]);break;case"size":i.percent(p,y);break;case"align":i.alt(p,y,["start",l,"end","left","right"])}},/:/,/\s/),o.region=i.get("region",null),o.vertical=i.get("vertical","");var d=i.get("line","auto");d==="auto"&&_.line===-1&&(d=-1),o.line=d,o.lineAlign=i.get("lineAlign","start"),o.snapToLines=i.get("snapToLines",!0),o.size=i.get("size",100),o.align=i.get("align",l);var m=i.get("position","auto");m==="auto"&&_.position===50&&(m=o.align==="start"||o.align==="left"?0:o.align==="end"||o.align==="right"?100:50),o.position=m}(b,T)}function f(b){return b.replace(/<br(?: \/)?>/gi,`
`)}var g=function(){function b(){this.state="INITIAL",this.buffer="",this.decoder=new h,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var T=b.prototype;return T.parse=function(u){var e=this;function n(){var d=e.buffer,m=0;for(d=f(d);m<d.length&&d[m]!=="\r"&&d[m]!==`
`;)++m;var p=d.substr(0,m);return d[m]==="\r"&&++m,d[m]===`
`&&++m,e.buffer=d.substr(m),p}u&&(e.buffer+=e.decoder.decode(u,{stream:!0}));try{var t="";if(e.state==="INITIAL"){if(!/\r\n|\n/.test(e.buffer))return this;var s=(t=n()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!s||!s[0])throw new Error("Malformed WebVTT signature.");e.state="HEADER"}for(var o=!1;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(o?o=!1:t=n(),e.state){case"HEADER":/:/.test(t)?w(t,function(d,m){},/:/):t||(e.state="ID");continue;case"NOTE":t||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(t)){e.state="NOTE";break}if(!t)continue;if(e.cue=new D.default(0,0,""),e.state="CUE",t.indexOf("-->")===-1){e.cue.id=t;continue}case"CUE":if(!e.cue){e.state="BADCUE";continue}try{E(t,e.cue,e.regionList)}catch{e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":var i=t.indexOf("-->")!==-1;if(!t||i&&(o=!0)){e.oncue&&e.cue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}if(e.cue===null)continue;e.cue.text&&(e.cue.text+=`
`),e.cue.text+=t;continue;case"BADCUE":t||(e.state="ID")}}}catch{e.state==="CUETEXT"&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state=e.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},T.flush=function(){var u=this;try{if((u.cue||u.state==="HEADER")&&(u.buffer+=`

`,u.parse()),u.state==="INITIAL"||u.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(e){u.onparsingerror&&u.onparsingerror(e)}return u.onflush&&u.onflush(),this},b}()},"./src/utils/webvtt-parser.ts":function(F,I,v){v.r(I),v.d(I,"generateCueId",function(){return f}),v.d(I,"parseWebVTT",function(){return g});var D=v("./src/polyfills/number.ts"),h=v("./src/utils/vttparser.ts"),k=v("./src/demux/id3.ts"),R=v("./src/utils/timescale-conversion.ts"),w=v("./src/remux/mp4-remuxer.ts"),_=/\r\n|\n\r|\n|\r/g,l=function(b,T,u){return u===void 0&&(u=0),b.substr(u,T.length)===T},E=function(b){for(var T=5381,u=b.length;u;)T=33*T^b.charCodeAt(--u);return(T>>>0).toString()};function f(b,T,u){return E(b.toString())+E(T.toString())+E(u)}function g(b,T,u,e,n,t,s,o){var i,d=new h.VTTParser,m=Object(k.utf8ArrayToStr)(new Uint8Array(b)).trim().replace(_,`
`).split(`
`),p=[],y=Object(R.toMpegTsClockFromTimescale)(T,u),r="00:00.000",a=0,c=0,L=!0,S=!1;d.oncue=function(A){var x=e[n],C=e.ccOffset,O=(a-y)/9e4;if(x!=null&&x.new&&(c!==void 0?C=e.ccOffset=x.start:function(B,U,G){var z=B[U],Y=B[z.prevCC];if(!Y||!Y.new&&z.new)return B.ccOffset=B.presentationOffset=z.start,void(z.new=!1);for(;(X=Y)!==null&&X!==void 0&&X.new;){var X;B.ccOffset+=z.start-Y.start,z.new=!1,Y=B[(z=Y).prevCC]}B.presentationOffset=G}(e,n,O)),O&&(C=O-e.presentationOffset),S){var P=A.endTime-A.startTime,M=Object(w.normalizePts)(9e4*(A.startTime+C-c),9e4*t)/9e4;A.startTime=M,A.endTime=M+P}var N=A.text.trim();A.text=decodeURIComponent(encodeURIComponent(N)),A.id||(A.id=f(A.startTime,A.endTime,N)),A.endTime>0&&p.push(A)},d.onparsingerror=function(A){i=A},d.onflush=function(){i?o(i):s(p)},m.forEach(function(A){if(L){if(l(A,"X-TIMESTAMP-MAP=")){L=!1,S=!0,A.substr(16).split(",").forEach(function(x){l(x,"LOCAL:")?r=x.substr(6):l(x,"MPEGTS:")&&(a=parseInt(x.substr(7)))});try{c=function(x){var C=parseInt(x.substr(-3)),O=parseInt(x.substr(-6,2)),P=parseInt(x.substr(-9,2)),M=x.length>9?parseInt(x.substr(0,x.indexOf(":"))):0;if(!(Object(D.isFiniteNumber)(C)&&Object(D.isFiniteNumber)(O)&&Object(D.isFiniteNumber)(P)&&Object(D.isFiniteNumber)(M)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+x);return C+=1e3*O,(C+=6e4*P)+36e5*M}(r)/1e3}catch(x){S=!1,i=x}return}A===""&&(L=!1)}d.parse(A+`
`)}),d.flush()}},"./src/utils/xhr-loader.ts":function(F,I,v){v.r(I);var D=v("./src/utils/logger.ts"),h=v("./src/loader/load-stats.ts"),k=/^age:\s*[\d.]+\s*$/m,R=function(){function w(l){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=l?l.xhrSetup:null,this.stats=new h.LoadStats,this.retryDelay=0}var _=w.prototype;return _.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},_.abortInternal=function(){var l=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),l&&(l.onreadystatechange=null,l.onprogress=null,l.readyState!==4&&(this.stats.aborted=!0,l.abort()))},_.abort=function(){var l;this.abortInternal(),(l=this.callbacks)!==null&&l!==void 0&&l.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},_.load=function(l,E,f){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=l,this.config=E,this.callbacks=f,this.retryDelay=E.retryDelay,this.loadInternal()},_.loadInternal=function(){var l=this.config,E=this.context;if(l){var f=this.loader=new self.XMLHttpRequest,g=this.stats;g.loading.first=0,g.loaded=0;var b=this.xhrSetup;try{if(b)try{b(f,E.url)}catch{f.open("GET",E.url,!0),b(f,E.url)}f.readyState||f.open("GET",E.url,!0)}catch(T){return void this.callbacks.onError({code:f.status,text:T.message},E,f)}E.rangeEnd&&f.setRequestHeader("Range","bytes="+E.rangeStart+"-"+(E.rangeEnd-1)),f.onreadystatechange=this.readystatechange.bind(this),f.onprogress=this.loadprogress.bind(this),f.responseType=E.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),l.timeout),f.send()}},_.readystatechange=function(){var l=this.context,E=this.loader,f=this.stats;if(l&&E){var g=E.readyState,b=this.config;if(!f.aborted&&g>=2)if(self.clearTimeout(this.requestTimeout),f.loading.first===0&&(f.loading.first=Math.max(self.performance.now(),f.loading.start)),g===4){E.onreadystatechange=null,E.onprogress=null;var T=E.status;if(T>=200&&T<300){var u,e;if(f.loading.end=Math.max(self.performance.now(),f.loading.first),e=l.responseType==="arraybuffer"?(u=E.response).byteLength:(u=E.responseText).length,f.loaded=f.total=e,!this.callbacks)return;var n=this.callbacks.onProgress;if(n&&n(f,l,u,E),!this.callbacks)return;var t={url:E.responseURL,data:u};this.callbacks.onSuccess(t,f,l,E)}else f.retry>=b.maxRetry||T>=400&&T<499?(D.logger.error(T+" while loading "+l.url),this.callbacks.onError({code:T,text:E.statusText},l,E)):(D.logger.warn(T+" while loading "+l.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,b.maxRetryDelay),f.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),b.timeout)}},_.loadtimeout=function(){D.logger.warn("timeout while loading "+this.context.url);var l=this.callbacks;l&&(this.abortInternal(),l.onTimeout(this.stats,this.context,this.loader))},_.loadprogress=function(l){var E=this.stats;E.loaded=l.loaded,l.lengthComputable&&(E.total=l.total)},_.getCacheAge=function(){var l=null;if(this.loader&&k.test(this.loader.getAllResponseHeaders())){var E=this.loader.getResponseHeader("age");l=E?parseFloat(E):null}return l},w}();I.default=R}}).default);var Tt=li(sr.exports);const ui={name:"d-icon"},je=Object.assign(ui,{props:{icon:String,size:[Number,String]},setup:function(F){const I=F,v=j(()=>({fontSize:/^\d+$/.test(I.size)?I.size+"px":I.size}));return(D,h)=>(J(),ie("i",{class:Ze(["d-icon iconfont",F.icon]),style:Je(q(v))},null,6))}});je.__scopeId="data-v-0c690e66";tt("data-v-4cb76d59");const di={class:"d-player-top"},ci={class:"top-title"},fi={class:"top-title"};rt();const hi={props:{title:{default:""}},setup(F){Date.prototype.format=function(D){let h={"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds()};for(var k in h)new RegExp("("+k+")").test(D)&&(D=D.replace(RegExp.$1,RegExp.$1.length==1?h[k]:("00"+h[k]).substr((""+h[k]).length)));return D};let I=se("00:00:00");I.value=new Date().format("hh:mm:ss");let v=null;return v=setInterval(()=>{I.value=new Date().format("hh:mm:ss")},1e3),wt(()=>{clearInterval(v)}),(D,h)=>(J(),ie("div",di,[V("p",ci,le(F.title||""),1),V("p",fi,le(q(I)),1)]))},__scopeId:"data-v-4cb76d59"};tt("data-v-ac2469ec");const vi={class:"d-status"},gi={class:"d-flex-center"},pi={class:"d-flex-center"},mi=De("5X\u901F\u64AD\u653E\u4E2D ");rt();var or=at({props:["state"],setup:F=>(I,v)=>Le((J(),ie("div",vi,[Le(V("li",gi,[W(je,{size:"18",class:"d-status-icon",icon:"icon-volume-"+(F.state.volume==0?"mute":F.state.volume>.5?"up":"down")},null,8,["icon"]),De(" "+le(~~(100*F.state.volume))+"% ",1)],512),[[xe,F.state.handleType=="volume"]]),Le(V("li",pi,[W(je,{size:"12",icon:"icon-play"}),W(je,{size:"12",icon:"icon-play",style:{"margin-right":"5px"}}),mi],512),[[xe,F.state.handleType=="playbackRate"||F.state.isMultiplesPlay]])],512)),[[xe,F.state.handleType||F.state.isMultiplesPlay]])});or.__scopeId="data-v-ac2469ec",tt("data-v-385f7870");const yi=["checked","true-value","false-value"],Ti=V("span",{class:"d-switch_action"},null,-1);rt();var ht=at({props:{modelValue:{type:[Number,String,Boolean]},width:{type:String,default:"40px"},trueValue:{type:[Number,String,Boolean],default:!0},falseValue:{type:[Number,String,Boolean],default:!0},activeColor:{type:[String],default:"#409EFF"}},emits:["update:modelValue","change"],setup(F,{emit:I}){const v=F;Ct(R=>({"014e5dc0":F.width,e4e32852:F.activeColor}));const D=se(null),h=j(()=>v.modelValue===v.trueValue),k=()=>{vt(()=>{const R=D.value.checked;I("update:modelValue",R),I("change",R)})};return(R,w)=>(J(),ie("div",{class:Ze(["d-switch",{"is-checked":q(h)}])},[V("input",{class:"d-switch__input",ref:D,type:"checkbox",checked:q(h),onChange:k,"true-value":F.trueValue,"false-value":F.falseValue},null,40,yi),Ti],2))}});ht.__scopeId="data-v-385f7870",tt("data-v-b2384226");const Ei={key:0},bi=V("i",{class:"rotating iconfont icon-loading f50"},null,-1),Si=[V("i",{class:"rotating iconfont icon-loading f50"},null,-1),V("p",null,"\u6B63\u5728\u7F13\u51B2...",-1)],Li=[V("i",{class:"iconfont icon-replay f24 mr5"},null,-1),De("\u91CD\u65B0\u64AD\u653E ")],ki=[V("i",{class:"iconfont icon-replay f24 mr5"},null,-1),De("\u8BF7\u6C42\u9519\u8BEF ")];rt();var lr=at({props:{loadType:String,text:{type:String,default:""}},setup(F){const I=F,{proxy:v}=Ke(),D=["loadstart","waiting","ended","error","stalled"],h=()=>{v.$parent.play()},k=j(()=>{let R="background: rgba(0, 0, 0, .1);z-index:1";return I.loadType=="loadstart"&&(R="background: rgba(0, 0, 0, 1);;z-index:3"),R});return(R,w)=>Le((J(),ie("div",{class:"d-loading",style:Je(q(k))},[V("div",null,[F.loadType=="loadstart"?(J(),ie("span",Ei,[bi,V("p",null,le(F.text),1)])):be("",!0),Le(V("span",null,Si,512),[[xe,F.loadType=="waiting"]]),Le(V("span",null,[V("p",{onClick:h,class:"d-flex-x d-pointer"},Li)],512),[[xe,F.loadType=="ended"]]),Le(V("span",null,[V("p",{onClick:h,class:"d-flex-x d-pointer"},ki)],512),[[xe,F.loadType=="error"||F.loadType=="stalled"]])])],4)),[[xe,D.includes(F.loadType)]])}});lr.__scopeId="data-v-b2384226";const et=function(F,I,v,D=!1){F&&I&&v&&F.addEventListener(I,v,D)},Me=function(F,I,v,D=!1){F&&I&&v&&F.removeEventListener(I,v,D)};tt("data-v-5a794390");const Ai=["onMousedown"];rt();var it=at(Dt(At({},{name:"DSlider"}),{props:{modelValue:{required:!0,type:Number,default:0},disabled:{type:Boolean,default:!1},vertical:{type:Boolean,default:!1},hover:{type:Boolean,default:!0},hoverText:{type:String,default:""},preload:{type:Number,default:0},size:{type:String,default:"10px"}},emits:["update:modelValue","change","onMousemove"],setup:function(F,{emit:I}){const v=F;Ct(e=>({"5242b67b":F.size}));const D=se(null),h=se(null),k=He({dragging:!1,hoverPosition:0,hoverTipsLeft:"50%"}),R=j(()=>{let e=v.modelValue<0?0:v.modelValue>1?1:v.modelValue;return v.vertical?`height:${100*e}%`:`width:${100*e}%`}),w=j(()=>{let e=v.preload<0?0:v.preload>1?1:v.preload;return v.vertical?`height:${100*e}%`:`width:${100*e}%`}),_=j(()=>{let e=k.hoverPosition<0?0:k.hoverPosition>1?1:k.hoverPosition;return v.vertical?`bottom:${100*e}%`:`left:${100*e}%`}),l=e=>{e.preventDefault()},E=e=>{v.disabled||(e.preventDefault(),k.dragging=!0,g(e),et(window,"mousemove",T),et(window,"touchmove",T),et(window,"mouseup",u),et(window,"touchend",u))},f=e=>{if(!v.hover)return;let n=b(e);if(I("onMousemove",e,n),k.hoverPosition=n,v.vertical)return;let t=D.value,s=h.value.clientWidth/2,o=e.clientX-t.getBoundingClientRect().left;o<s?k.hoverTipsLeft=s-o+"px":t.clientWidth-o<s?k.hoverTipsLeft=t.clientWidth-o-s+"px":k.hoverTipsLeft="50%"},g=e=>{let n=b(e);I("update:modelValue",n),I("change",e,n)},b=e=>{let n=D.value,t=0;if(v.vertical){let s=n.clientHeight;t=(n.getBoundingClientRect().bottom-e.clientY)/s}else t=(e.clientX-n.getBoundingClientRect().left)/n.clientWidth;return t<0?0:t>1?1:t},T=e=>{g(e)},u=e=>{k.dragging&&(Me(window,"mousemove",T),Me(window,"touchmove",T),Me(window,"mouseup",u),Me(window,"touchend",u),Me(window,"contextmenu",u),setTimeout(()=>{k.dragging=!1},0))};return(e,n)=>(J(),ie("div",{ref:D,class:Ze(["d-slider",{"is-vertical":v.vertical}]),onMousedown:Qe(E,["stop"]),onContextmenu:l},[V("div",{class:"d-slider__runway",onMousemove:f},[Le(V("div",{class:"d-slider__cursor",style:Je(q(_))},[Le(V("div",{class:"d-slider__tips",ref:h,style:Je({left:q(k).hoverTipsLeft})},le(v.hoverText),5),[[xe,v.hoverText]])],4),[[xe,v.hover]]),V("div",{class:"d-slider__preload",style:Je(q(w))},null,4),V("div",{class:"d-slider__bar",style:Je(q(R))},null,4)],32)],42,Ai))}}));it.__scopeId="data-v-5a794390";tt("data-v-570fa0d1");const Di={key:0,class:"d-player-dialog"},_i={class:"d-player-dialog-body"},Ri={class:"d-player-dialog-title"},wi={class:"d-player-hotkey-panel"},Ci={class:"d-player-filter-panel"},Ii={class:"d-player-filter-panel-item"},xi=V("span",null,"\u9971\u548C\u5EA6",-1),Oi={class:"d-player-filter-panel-item"},Pi=V("span",null,"\u4EAE\u5EA6",-1),Fi={class:"d-player-filter-panel-item"},Mi=V("span",null,"\u5BF9\u6BD4\u5EA6",-1),Ni={key:0,class:"d-player-contextmenu"},Bi=["dplayerKeyCode"],Ui=V("input",{class:"d-player-copyText"},null,-1);rt();var ur=at({setup(F){const I=He({show:!1,dialogType:"",dialogTitle:"",version:"1.3.1-beta.6",mouseX:0,mouseY:0}),v=[{label:"\u89C6\u9891\u8272\u5F69\u8C03\u6574",key:"filter"},{label:"\u5FEB\u6377\u952E\u8BF4\u660E",key:"hotkey"},{label:"\u590D\u5236\u89C6\u9891\u7F51\u5740",key:"copy"},{label:"\u7248\u672C\uFF1A1.3.1-beta.6",key:"version"}],D=[{key:"Space",label:"\u64AD\u653E/\u6682\u505C"},{key:"\u2192",label:"\u5355\u6B21\u5FEB\u8FDB10s\uFF0C\u957F\u63095\u500D\u901F\u64AD\u653E"},{key:"\u2190",label:"\u5FEB\u90005s"},{key:"\u2191",label:"\u97F3\u91CF\u589E\u52A010%"},{key:"\u2193",label:"\u97F3\u91CF\u589E\u52A0\u964D\u4F4E10%"},{key:"Esc",label:"\u9000\u51FA\u5168\u5C4F/\u9000\u51FA\u7F51\u9875\u5168\u5C4F"},{key:"F",label:"\u5168\u5C4F/\u9000\u51FA\u5168\u5C4F"}],h=He({saturate:.392,brightness:.392,contrast:.392}),k=j(()=>({left:I.mouseX+"px",top:I.mouseY+"px"}));pe(h,E=>{let f=document.querySelector("#dPlayerVideo"),g=(2.55*E.saturate).toFixed(2),b=(2.55*E.brightness).toFixed(2),T=(2.55*E.contrast).toFixed(2);f.style.filter=`saturate(${g}) brightness(${b}) contrast(${T})`});const R=()=>{h.saturate=.392,h.brightness=.392,h.contrast=.392},w=E=>{E.key=="Escape"&&l(0)},_=E=>{E.preventDefault(),et(window,"keydown",w),et(window,"click",l);let f=document.querySelector("#refPlayerWrap"),g=f.clientWidth;f.clientHeight,I.mouseX=E.clientX-f.getBoundingClientRect().left,g-I.mouseX<130&&(I.mouseX=I.mouseX+(g-I.mouseX-130)),I.mouseY=E.clientY-f.getBoundingClientRect().top,I.show=!0},l=E=>{let f=E.path[0].tagName=="LI",g=E.path[0].attributes.dplayerKeyCode&&E.path[0].attributes.dplayerKeyCode.value,b=v.map(T=>T.key);if(f&&b.includes(g))if(I.dialogTitle=E.path[0].innerText,I.dialogType=g,g=="copy"){let T=document.querySelector(".d-player-copyText");T.value=window.location.href,T.select(),document.execCommand("copy"),I.dialogType=""}else g=="version"&&(I.dialogType="");I.show=!1,Me(window,"keydown",w),Me(window,"click",l)};return Rt(()=>{let E=document.querySelector("#refPlayerWrap");Me(window,"keydown",w),Me(window,"click",l),Me(E,"contextmenu",_),et(E,"contextmenu",_)}),wt(()=>{let E=document.querySelector("#refPlayerWrap");Me(window,"keydown",w),Me(window,"click",l),Me(E,"contextmenu",_)}),(E,f)=>(J(),ie("div",null,[W(Lt,{name:"d-fade-in"},{default:Q(()=>[q(I).dialogType?(J(),ie("div",Di,[V("div",_i,[V("h5",Ri,[De(le(q(I).dialogTitle)+" ",1),V("i",{onClick:f[0]||(f[0]=g=>q(I).dialogType=!1),class:"icon icon-close"},"X")]),Le(V("ul",wi,[(J(),ie(Fe,null,Be(D,g=>V("li",{class:"d-player-hotkey-panel-item",key:g.key},[V("span",null,le(g.key),1),V("span",null,le(g.label),1)])),64))],512),[[xe,q(I).dialogType=="hotkey"]]),Le(V("ul",Ci,[V("li",Ii,[xi,W(it,{class:"filter-panel-slider",size:"5px",modelValue:q(h).saturate,"onUpdate:modelValue":f[1]||(f[1]=g=>q(h).saturate=g)},null,8,["modelValue"]),V("span",null,le(Math.round(255*q(h).saturate)),1)]),V("li",Oi,[Pi,W(it,{class:"filter-panel-slider",size:"5px",modelValue:q(h).brightness,"onUpdate:modelValue":f[2]||(f[2]=g=>q(h).brightness=g)},null,8,["modelValue"]),V("span",null,le(Math.round(255*q(h).brightness)),1)]),V("li",Fi,[Mi,W(it,{class:"filter-panel-slider",size:"5px",modelValue:q(h).contrast,"onUpdate:modelValue":f[3]||(f[3]=g=>q(h).contrast=g)},null,8,["modelValue"]),V("span",null,le(Math.round(255*q(h).contrast)),1)]),V("span",{onClick:R,title:"\u91CD\u7F6E","aria-label":"\u91CD\u7F6E",class:"d-player-filter-reset"},"\u91CD\u7F6E")],512),[[xe,q(I).dialogType=="filter"]])])])):be("",!0)]),_:1}),q(I).show?(J(),ie("div",Ni,[V("ul",{class:"d-player-contextmenu-body",style:Je(q(k))},[(J(),ie(Fe,null,Be(v,g=>V("li",{dplayerKeyCode:g.key,key:g.key},le(g.label),9,Bi)),64))],4),Ui])):be("",!0)]))}});ur.__scopeId="data-v-570fa0d1";const Et=F=>{let I=~~(F/3600),v=~~(F%3600/60),D=~~(F%60);return I=I<10?"0"+I:I,v=v<10?"0"+v:v,D=D<10?"0"+D:D,`${I}:${v}:${D}`},ot="ontouchstart"in window,rr=["loadstart","play","pause","playing","seeking","seeked","waiting","durationchange","progress","canplay","timeupdate","ended","error","stalled"],Gi={width:{type:String,default:"800px"},height:{type:String,default:"450px"},color:{type:String,default:"#409eff"},src:{required:!0,type:String,default:""},title:{type:String,default:""},type:{type:String,default:"video/mp4"},poster:{type:String,default:""},webFullScreen:{type:Boolean,default:!1},speed:{type:Boolean,default:!0},currentTime:{type:Number,default:0},playsinline:{type:Boolean,default:!1},muted:{type:Boolean,default:!1},speedRate:{type:Array,default:()=>["2.0","1.5","1.25","1.0","0.75","0.5"]},autoPlay:{type:Boolean,default:!1},loop:{type:Boolean,default:!1},mirror:{type:Boolean,default:!1},ligthOff:{type:Boolean,default:!1},volume:{type:[String,Number],default:.3},control:{type:Boolean,default:!0},controlBtns:{type:Array,default:["audioTrack","quality","speedRate","volume","setting","pip","pageFullScreen","fullScreen"]},preload:{type:String,default:"auto"}};tt("data-v-01791e9e");const ji={class:"d-player-video",id:"dPlayerVideo"},Ki=["controls","webkit-playsinline","playsinline","volume","muted","loop","preload","src","poster"],Vi={class:"d-player-lightoff"},Hi={key:1,class:"d-player-state"},qi={class:"d-play-btn"},Wi=["onKeyup","onKeydown"],zi={class:"d-control-progress"},Yi={class:"d-tool-bar"},$i={key:0,class:"d-tool-item d-tool-time audioTrack-btn"},Xi=V("span",{style:{margin:"0 3px"}},"/",-1),Qi={class:"total-time"},Zi={class:"d-tool-bar"},Ji={key:0,class:"d-tool-item quality-btn"},en={class:"d-tool-item-main"},tn={class:"speed-main",style:{"text-align":"center"}},rn=["onClick"],nn={key:1,class:"d-tool-item speedRate-btn"},an={class:"d-tool-item-main"},sn={class:"speed-main"},on=["onClick"],ln={key:2,class:"d-tool-item volume-btn"},un={class:"d-tool-item-main volume-box",style:{width:"52px"}},dn={class:"volume-text-size"},cn={key:3,class:"d-tool-item setting-btn"},fn={class:"d-tool-item-main"},hn={class:"speed-main"},vn=De(" \u955C\u50CF\u753B\u9762 "),gn=De(" \u5FAA\u73AF\u64AD\u653E "),pn=De(" \u5173\u706F\u6A21\u5F0F "),mn=V("div",{class:"d-tool-item-main"},"\u753B\u4E2D\u753B",-1),yn=V("div",{class:"d-tool-item-main"},"\u7F51\u9875\u5168\u5C4F",-1),Tn=V("div",{class:"d-tool-item-main"},"\u5168\u5C4F",-1);rt();var nt=at(Dt(At({},{name:"vue3VideoPlay",inheritAttrs:!1}),{props:Gi,emits:[...rr,"mirrorChange","loopChange","lightOffChange"],setup:function(F,{expose:I,emit:v}){const D=F;Ct(C=>({"51d4439c":q(b),"77e758a6":C.width,b8a1afc0:C.height}));const h=new Tt({fragLoadingTimeOut:2e3}),k=se(null),R=se(null),w=se(null),_=se(null),l=He(Dt(At({dVideo:null},D),{muted:D.muted,playBtnState:D.autoPlay?"pause":"play",loadStateType:"loadstart",fullScreen:!1,handleType:"",currentTime:"00:00:00",preloadBar:0,totalTime:"00:00:00",isVideoHovering:!0,speedActive:"1.0",playProgress:0,isMultiplesPlay:!1,longPressTimeout:null,progressCursorTime:"00:00:00",qualityLevels:[],currentLevel:0})),E=(...C)=>O=>C.reverse().reduce((P,M)=>M(P),O),f=rr.reduce((C,O)=>{var P;return C[`on${P=O,P.charAt(0).toUpperCase()+P.slice(1)}`]=M=>{l.loadStateType=O,v(O,M)},C},{});f.onCanplay=E(f.onCanplay,()=>{l.playBtnState!="play"&&l.dVideo.play(),l.autoPlay&&(l.dVideo.play(),l.playBtnState="pause")}),f.onEnded=E(f.onEnded,()=>{l.playBtnState="replay"}),f.onDurationchange=C=>{v("durationchange",C),D.currentTime!=0&&(l.dVideo.currentTime=D.currentTime),f.onTimeupdate(C)},f.onProgress=C=>{console.log("\u7F13\u51B2\u4E2D..."),v("progress",C);let O=C.target.duration,P=C.target.buffered,M=C.target.buffered.length&&C.target.buffered.end(P-1);l.preloadBar=M/O},f.onTimeupdate=C=>{v("timeupdate",C);let O=C.duration||C.target.duration||0,P=C.currentTime||C.target.currentTime;l.playProgress=P/O,l.currentTime=Et(P),l.totalTime=Et(O)},f.onError=E(f.onError,()=>{l.playBtnState="replay"});let g=Cr();for(let C in g)f[C]=g[C];const b=(T=l.color,`${parseInt("0x"+T.slice(1,3))},${parseInt("0x"+T.slice(3,5))},${parseInt("0x"+T.slice(5,7))}`);var T;const u=tr(500,()=>{l.handleType=""}),e=C=>{C.preventDefault(),C.code=="ArrowUp"?l.volume=l.volume+.1>1?1:l.volume+.1:l.volume=l.volume-.1<0?0:l.volume-.1,l.muted=!1,l.handleType="volume",u()},n=C=>{D.speed&&(l.dVideo.currentTime=l.dVideo.currentTime<10?.1:l.dVideo.currentTime-10,f.onTimeupdate(l.dVideo),o())},t=C=>{C.preventDefault();let O=C.type;if(C.key=="ArrowRight"){if(o(),O=="keyup"){if(clearTimeout(l.longPressTimeout),!D.speed&&!l.longPressTimeout)return;l.isMultiplesPlay?(l.dVideo.playbackRate=l.speedActive,l.isMultiplesPlay=!1):(l.dVideo.currentTime=l.dVideo.currentTime+10,f.onTimeupdate(l.dVideo))}else if(O=="keydown"){if(!D.speed)return;l.isMultiplesPlay&&clearTimeout(l.longPressTimeout),l.longPressTimeout=setTimeout(()=>{l.isMultiplesPlay=!0,l.dVideo.playbackRate=5,l.handleType="playbackRate",u()},500)}}},s=()=>{ot||_.value.focus()},o=()=>{l.loadStateType="play",l.dVideo.play().catch(()=>{setTimeout(()=>{l.playBtnState="replay",l.loadStateType="error"},500)}),l.playBtnState="pause"},i=()=>{l.dVideo.pause(),l.playBtnState="play"},d=C=>{C&&C.preventDefault(),l.playBtnState=="play"||l.playBtnState=="replay"?o():l.playBtnState=="pause"&&i()},m=()=>{l.muted=!l.muted,l.volume==0&&(l.volume=.05)},p=(C,O)=>{let P=l.dVideo.duration||l.dVideo.target.duration;l.dVideo.currentTime=P*O,l.playBtnState=="play"&&(l.dVideo.play(),l.playBtnState="pause")},y=(C,O)=>{l.progressCursorTime=Et(l.dVideo.duration*O)},r=tr(2500,()=>{l.isVideoHovering=!1}),a=C=>{l.isVideoHovering=!0,r()},c=C=>{v("mirrorChange",C,l.dVideo)},L=C=>{v("loopChange",C,l.dVideo)},S=C=>{v("lightOffChange",C,l.dVideo)},A=()=>{var C;C=l.dVideo,document.pictureInPictureElement?document.exitPictureInPicture().catch(O=>{console.log(O,"Video failed to leave Picture-in-Picture mode.")}):C.requestPictureInPicture().catch(O=>{console.log(O,"Video failed to enter Picture-in-Picture mode.")})},x=()=>{l.fullScreen=(C=>{let O=document,P=O.webkitIsFullScreen||O.fullscreen;return P?(document.exitFullscreen||O.webkitExitFullScreen).call(O):(C.requestFullscreen||C.webkitRequestFullScreen).call(C),!P})(k.value)};return pe(()=>D.src,()=>{vt(()=>{l.dVideo.canPlayType(D.type)||l.dVideo.canPlayType("application/vnd.apple.mpegurl")?l.muted=D.autoPlay:Tt.isSupported()&&(h.detachMedia(),h.attachMedia(l.dVideo),h.on(Tt.Events.MEDIA_ATTACHED,()=>{h.loadSource(D.src),h.on("hlsManifestParsed",(C,O)=>{console.log(O),l.currentLevel=O.level,l.qualityLevels=O.levels||[]})}),h.on("hlsLevelSwitching",(C,O)=>{console.log(O),console.log("LEVEL_SWITCHING")}),h.on("hlsLevelSwitched",(C,O)=>{l.currentLevel=O.level,console.log("LEVEL_SWITCHED")}))})},{immediate:!0}),Rt(()=>{l.dVideo=R,s()}),I({play:o,pause:i,togglePlay:d}),(C,O)=>(J(),ie("div",{ref:k,id:"refPlayerWrap",class:Ze(["d-player-wrap",{"web-full-screen":q(l).webFullScreen,"is-lightoff":q(l).lightOff,"d-player-wrap-hover":q(l).playBtnState=="play"||q(l).isVideoHovering}]),onMousemove:a},[V("div",ji,[V("video",kt({ref:R,class:["d-player-video-main",{"video-mirror":q(l).mirror}],id:"dPlayerVideoMain",controls:!(!q(ot)||!q(l).speed),"webkit-playsinline":D.playsinline,playsinline:D.playsinline},q(f),{volume:q(l).volume,muted:q(l).muted,loop:q(l).loop,preload:C.preload,width:"100%",height:"100%",src:D.src,poster:D.poster}),"\u60A8\u7684\u6D4F\u89C8\u5668\u4E0D\u652F\u6301Video\u6807\u7B7E\u3002",16,Ki)]),W(Lt,{name:"d-fade-in"},{default:Q(()=>[Le(V("div",Vi,null,512),[[xe,q(l).lightOff]])]),_:1}),q(l).fullScreen?(J(),Ce(hi,{key:0,title:D.title},null,8,["title"])):be("",!0),q(ot)?be("",!0):(J(),ie("div",Hi,[W(Lt,{name:"d-scale-out"},{default:Q(()=>[Le(V("div",qi,[W(je,{icon:"icon-play",size:40})],512),[[xe,q(l).playBtnState=="play"]])]),_:1}),W(or,{state:q(l)},null,8,["state"])])),q(ot)?be("",!0):(J(),ie("input",{key:2,type:"input",readonly:"readonly",ref:_,onDblclick:x,onKeyup:[st(x,["f"]),O[0]||(O[0]=st(P=>q(l).webFullScreen=!1,["esc"])),t],onClick:d,onKeydown:[st(d,["space"]),st(n,["arrow-left"]),st(e,["arrow-up","arrow-down"]),t],class:"d-player-input",maxlength:"0"},null,40,Wi)),W(lr,{loadType:q(l).loadStateType},null,8,["loadType"]),W(ur),!q(ot)&&q(l).control?(J(),ie("div",{key:3,class:"d-player-control",ref:w},[V("div",zi,[W(it,{class:"d-progress-bar",onOnMousemove:y,onChange:p,disabled:!q(l).speed,hoverText:q(l).progressCursorTime,modelValue:q(l).playProgress,"onUpdate:modelValue":O[1]||(O[1]=P=>q(l).playProgress=P),preload:q(l).preloadBar},null,8,["disabled","hoverText","modelValue","preload"])]),V("div",{class:"d-control-tool",onClick:s},[V("div",Yi,[V("div",{class:"d-tool-item",onClick:d},[W(je,{size:"24",icon:`icon-${q(l).playBtnState}`},null,8,["icon"])]),D.controlBtns.includes("audioTrack")?(J(),ie("div",$i,[V("span",null,le(q(l).currentTime),1),Xi,V("span",Qi,le(q(l).totalTime),1)])):be("",!0)]),V("div",Zi,[q(l).qualityLevels.length&&D.controlBtns.includes("quality")?(J(),ie("div",Ji,[De(le(q(l).qualityLevels.length&&(q(l).qualityLevels[q(l).currentLevel]||{}).height)+"P ",1),V("div",en,[V("ul",tn,[(J(!0),ie(Fe,null,Be(q(l).qualityLevels,(P,M)=>(J(),ie("li",{class:Ze({"speed-active":q(l).currentLevel==M}),onClick:N=>((B,U)=>{h.currentLevel=U,l.currentLevel=U})(0,M),key:P},le(P.height)+"P",11,rn))),128))])])])):be("",!0),D.controlBtns.includes("speedRate")?(J(),ie("div",nn,[De(le(q(l).speedActive=="1.0"?"\u500D\u901F":q(l).speedActive+"x")+" ",1),V("div",an,[V("ul",sn,[(J(!0),ie(Fe,null,Be(q(l).speedRate,P=>(J(),ie("li",{class:Ze({"speed-active":q(l).speedActive==P}),onClick:M=>(N=>{l.speedActive=N,l.dVideo.playbackRate=N})(P),key:P},le(P)+"x",11,on))),128))])])])):be("",!0),D.controlBtns.includes("volume")?(J(),ie("div",ln,[V("div",un,[V("div",{class:Ze(["volume-main",{"is-muted":q(l).muted}])},[V("span",dn,le(q(l).muted?0:~~(100*q(l).volume))+"%",1),W(it,{onChange:O[2]||(O[2]=P=>q(l).muted=!1),hover:!1,size:"5px",vertical:!0,modelValue:q(l).volume,"onUpdate:modelValue":O[3]||(O[3]=P=>q(l).volume=P)},null,8,["modelValue"])],2)]),V("span",{onClick:m,style:{display:"flex"}},[W(je,{size:"20",icon:"icon-volume-"+(q(l).volume==0||q(l).muted?"mute":q(l).volume>.5?"up":"down")},null,8,["icon"])])])):be("",!0),D.controlBtns.includes("setting")?(J(),ie("div",cn,[W(je,{size:"20",class:"rotateHover",icon:"icon-settings"}),V("div",fn,[V("ul",hn,[V("li",null,[vn,W(ht,{onChange:c,modelValue:q(l).mirror,"onUpdate:modelValue":O[4]||(O[4]=P=>q(l).mirror=P)},null,8,["modelValue"])]),V("li",null,[gn,W(ht,{onChange:L,modelValue:q(l).loop,"onUpdate:modelValue":O[5]||(O[5]=P=>q(l).loop=P)},null,8,["modelValue"])]),V("li",null,[pn,W(ht,{onChange:S,modelValue:q(l).lightOff,"onUpdate:modelValue":O[6]||(O[6]=P=>q(l).lightOff=P)},null,8,["modelValue"])])])])])):be("",!0),D.controlBtns.includes("pip")?(J(),ie("div",{key:4,class:"d-tool-item pip-btn",onClick:A},[W(je,{size:"20",icon:"icon-pip"}),mn])):be("",!0),D.controlBtns.includes("pageFullScreen")?(J(),ie("div",{key:5,class:"d-tool-item pip-btn",onClick:O[7]||(O[7]=P=>q(l).webFullScreen=!q(l).webFullScreen)},[W(je,{size:"20",icon:"icon-web-screen"}),yn])):be("",!0),D.controlBtns.includes("fullScreen")?(J(),ie("div",{key:6,class:"d-tool-item fullScreen-btn",onClick:x},[Tn,W(je,{size:"20",icon:"icon-screen"})])):be("",!0)])])],512)):be("",!0)],34))}}));function En(F){F.component(nt.name,nt)}nt.__scopeId="data-v-01791e9e",nt.install=En;const bn={style:{display:"flex","flex-direction":"row"}},Sn={style:{width:"200px","max-height":"50vh"}},Ln={style:{display:"flex","flex-direction":"row","justify-content":"flex-start"}},kn={key:2},An=["onClick"],Dn={style:{overflow:"auto","background-color":"rgba(0, 0, 0, 0.4)"}},_n={class:"row justify-center"},Rn={style:{padding:"0",margin:"0","background-color":"rgba(0, 0, 0, 0)",display:"flex","flex-direction":"row","justify-content":"space-between",width:"100%"}},wn=["onClick"],Cn=["onClick"],In=["onClick"],xn={class:"text-subtitle2",style:{overflow:"auto",padding:"0"}},On={style:{color:"#0e4a2e"}},Pn={class:"row justify-between",style:{"background-color":"rgba(0, 0, 0, 0.8)","white-space":"nowrap","text-overflow":"ellipsis",overflow:"hidden"}},Fn={class:"q-mr-sm",style:{"-webkit-app-region":"drag",color:"rgb(213, 90, 90)","font-weight":"550","font-size":"medium",overflow:"hidden"}},Mn={style:{overflow:"auto","background-color":"rgba(0, 0, 0, 0.4)"}},Nn={class:"row justify-center"},Bn={style:{padding:"0",margin:"0","background-color":"rgba(0, 0, 0, 0)",display:"flex","flex-direction":"row","justify-content":"space-between",width:"100%"}},Un=["onClick"],Gn=["onClick"],jn=["onClick"],Kn={class:"text-subtitle2",style:{overflow:"auto",padding:"0"}},Vn={style:{color:"#0e4a2e"}},Hn={style:{width:"200px","max-height":"50vh"}},qn={key:2},Wn=["onClick"],zn={__name:"PlayingVideo",props:{mode:{type:String,default:"drawer"}},emits:["close"],setup(F,{expose:I,emit:v}){var r,a,c,L;const D=F,h=Br(),k=Ur(),R=se(null),{replace:w}=xr(),_=j(()=>h.platform.is.mobile),l=se(!0),E=se(380),f=He({playList:[],queryParam:{SortType:"desc"},showMore:!1,settingInfo:{},currentTime:1,playing:{}});Kt(["ArrowLeft"],()=>{i(-10)}),Kt(["ArrowRight"],()=>{i(60)});const g=async S=>{await jr(S),await Kr(),await m()},b=j(()=>k.getSuggestions),T=j(()=>k.drawerRight);pe(T,S=>{S&&m()});const u=S=>{f.playing=S,y.currentTime=1,y.src=Bt(S.Id),y.webFullScreen=!0;const A=document.querySelector(".topRef");A&&A.scrollTo(0,0),D.mode=="page"&&w(`/playing/${S.Id}`),setTimeout(()=>{R.value.play()},100),f.queryParam.Keyword||(f.queryParam.Keyword=S.Actress,m())},e=async()=>{const S=await Vr();f.settingInfo=S.data},n=()=>{y.src=null},t=()=>{k.drawerRight=!1},s=S=>{f.currentTime=S.target.currentTime},o=S=>{k.videoOptions.volume=S.target.volume,y.volume=S.target.volume},i=S=>{if(R.value){y.currentTime=f.currentTime+S;const A=y.src;y.src="",setTimeout(()=>{y.src=A},1)}},d=()=>{n(),D.mode=="drawer"?t():window.close(),v("close")},m=async()=>{const S=await Gr({...k.FileSearchParam,...f.queryParam,Page:1,PageSize:500});f.playList=[...S.Data],f.playing||(f.playing=f.playList[0],u(f.playing))},p=S=>{if(!!f.playList){for(let A=0;A<f.playList.length;A++)if(f.playList[A].Id===f.playing.Id)if(A==f.playList.length-1){u(f.playList[0]);return}else if(A+S<=0){u(f.playList[0]);return}else{u(f.playList[A+S]);return}}},y=He({width:"100%",height:"auto",color:"#ffffff",title:(r=f.playing)==null?void 0:r.Title,src:Bt(f.playing.Id),muted:!1,preload:"false",webFullScreen:!1,speedRate:["1.0","1.25","1.5","2.0"],autoPlay:!1,loop:!1,mirror:!1,ligthOff:!0,currentTime:1,volume:(a=k.videoOptions)==null?void 0:a.volume,control:(c=k.videoOptions)==null?void 0:c.control,controlBtns:(L=k.videoOptions)==null?void 0:L.controlBtns});return I({open:u,stop:n}),(S,A)=>(J(),ie(Fe,null,[D.mode!=="page"||_.value?(J(),Ce(Yt,{key:0,view:"lHh Lpr lFf",container:"",style:{height:"120vh"},class:"shadow-2 rounded-borders"},{default:Q(()=>[W(Vt,{style:{width:"100%"}},{default:Q(()=>[D.mode==="drawer"?(J(),Ce($r,{key:0,class:"row justify-between bg-black",style:{overflow:"hidden"}},{default:Q(()=>[De(le(f.playing.Title)+" ",1),W(Wr),W(Ae,{dense:"",flat:"",icon:"close",onClick:d},{default:Q(()=>[W(Ft,{class:"bg-white text-primary"},{default:Q(()=>[De("\u5173\u95ED")]),_:1})]),_:1})]),_:1})):be("",!0),W(dt,null,{default:Q(()=>{var x,C,O;return[Le(W(q(nt),kt({ref_key:"vue3VideoPlayRef",ref:R,id:"vue3VideoPlayRef",style:{"object-fit":"contain",width:"100%",height:"auto","max-height":"99vh"}},y,{onEnded:A[0]||(A[0]=P=>p(1)),onTimeupdate:s,onVolumeupdate:o}),null,16),[[xe,(x=f.playing)==null?void 0:x.Id]]),V("div",bn,[W(Ae,{size:"sm",flat:"",style:{color:"#59d89d"},label:(C=f.playing.Actress)==null?void 0:C.substring(0,8),onClick:A[1]||(A[1]=P=>{f.queryParam.Keyword=f.playing.Actress,m()})},null,8,["label"]),W(Ae,{size:"sm",flat:"",style:{color:"goldenrod"},label:(O=f.playing.Code)==null?void 0:O.substring(0,8),onClick:A[2]||(A[2]=P=>{f.queryParam.Keyword=f.playing.Code,m()})},null,8,["label"]),W(It,{modelValue:f.queryParam.Keyword,"onUpdate:modelValue":[A[3]||(A[3]=P=>f.queryParam.Keyword=P),m],dense:!0,clearable:""},{prepend:Q(()=>[W(ct,{name:"ti-list",class:"cursor-pointer"},{default:Q(()=>[W($t,null,{default:Q(()=>[V("div",Sn,[W(qt,null,{default:Q(()=>[(J(!0),ie(Fe,null,Be(b.value,P=>Le((J(),Ce(Mt,{clickable:"",key:P,onClick:M=>{f.queryParam.Keyword=P,m()}},{default:Q(()=>[W(Nt,null,{default:Q(()=>[W(Ht,null,{default:Q(()=>[De(le(P),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[xt]])),128))]),_:1})])]),_:1})]),_:1})]),append:Q(()=>[W(ct,{name:"ti-search",title:"\u641C",class:"cursor-pointer",onClick:m})]),_:1},8,["modelValue"])]),V("div",Ln,[W(Ut,{modelValue:f.queryParam.SortType,"onUpdate:modelValue":[A[4]||(A[4]=P=>f.queryParam.SortType=P),A[5]||(A[5]=P=>m())],"toggle-color":"primary",textColor:"primary",options:[{label:"\u6B63",value:"asc"},{label:"\u5012",value:"desc"}]},null,8,["modelValue"]),f.playlist?be("",!0):(J(),Ce(Ae,{key:0,size:"sm",color:"primary",label:"\u4E0A\u4E00\u4E2A",onClick:A[6]||(A[6]=P=>p(-1))})),f.playlist?be("",!0):(J(),Ce(Ae,{key:1,size:"sm",color:"primary",label:"\u4E0B\u4E00\u4E2A",onClick:A[7]||(A[7]=P=>p(1))})),W(Ae,{color:"orange",size:"sm",label:"\u66F4\u591A",onClick:A[8]||(A[8]=P=>{f.showMore=!f.showMore,e()})}),f.showMore?(J(),ie("span",kn,[(J(!0),ie(Fe,null,Be(f.settingInfo.Tags,P=>(J(),Ce(Ye,{square:"",color:"red","text-color":"white",key:P,style:{"margin-left":"0px",padding:"0 4px"}},{default:Q(()=>[V("span",{onClick:M=>{f.queryParam.Keyword=P,m()}},le(P),9,An)]),_:2},1024))),128))])):be("",!0)])]}),_:1})]),_:1}),W(zt,null,{default:Q(()=>[W(Xt,null,{default:Q(()=>[V("div",Dn,[V("div",_n,[(J(!0),ie(Fe,null,Be([...f.playList],x=>(J(),Ce(dt,{class:"q-ma-sm example-item",key:x.Id},{default:Q(()=>[W(Gt,{fit:"cover",easier:"",draggable:"",src:q(jt)(x.Id),class:"item-img",onClick:C=>u(x)},{default:Q(()=>[V("div",Rn,[V("div",{onClick:Qe(()=>{},["stop"]),style:{display:"flex","flex-direction":"column","justify-content":"flex-start",width:"fit-content"}},[W(Ae,{square:"",color:"red",size:"sm","text-color":"white",style:{"margin-left":"0px",padding:"0 4px"}},{default:Q(()=>[V("span",{onClick:C=>g(x.Id)},"\u5220\u9664",8,Cn)]),_:2},1024),(J(!0),ie(Fe,null,Be(x.Tags,C=>(J(),Ce(Ye,{square:"",color:"red","text-color":"white",key:C,style:{"margin-left":"0px",padding:"0 4px"}},{default:Q(()=>[V("span",{onClick:O=>{f.queryParam.Keyword=C,m()}},le(C),9,In)]),_:2},1024))),128))],8,wn),W(Ye,{onClick:Qe(()=>{},["stop"]),square:"",color:"green","text-color":"white",style:{width:"fit-content","margin-right":"0px",padding:"0 6px"}},{default:Q(()=>[V("span",null,le(x.MovieType),1)]),_:2},1032,["onClick"])])]),_:2},1032,["src","onClick"]),W(Ot,{style:{overflow:"auto",padding:"4px"}},{default:Q(()=>{var C;return[V("div",xn,[W(Ye,{onClick:Qe(()=>{},["stop"]),square:"",color:"green","text-color":"orange",style:{padding:"0px 4px"}},{default:Q(()=>[De(le(x.SizeStr),1)]),_:2},1032,["onClick"]),V("span",On,le((C=x.Title)==null?void 0:C.substring(0,20)),1)])]}),_:2},1024)]),_:2},1024))),128))])]),W(Pt,{position:"bottom-right","scroll-offset":150,offset:[18,18]},{default:Q(()=>[W(Ae,{fab:"",icon:"keyboard_arrow_up",color:"accent"})]),_:1})]),_:1})]),_:1})]),_:1})):be("",!0),D.mode==="page"&&!_.value?(J(),Ce(Yt,{key:1,view:"hhh Lpr Lfr",style:{width:"100%"},class:"shadow-2 rounded-borders"},{default:Q(()=>[W(Vt,{reveal:"",class:"bg-black"},{default:Q(()=>[W(zr,null,{default:Q(()=>[W(Hr,null,{default:Q(()=>[V("div",Pn,[V("span",Fn,le(f.playing.Title),1),W(Ae,{dense:"",flat:"",icon:"close",onClick:d},{default:Q(()=>[W(Ft,{class:"bg-white text-primary"},{default:Q(()=>[De("\u5173\u95ED")]),_:1})]),_:1})])]),_:1}),W(Ae,{flat:"",onClick:A[9]||(A[9]=x=>l.value=!l.value),round:"",dense:"",icon:"menu"})]),_:1})]),_:1}),W(Yr,{side:"right",modelValue:l.value,"onUpdate:modelValue":A[11]||(A[11]=x=>l.value=x),bordered:"",width:E.value,breakpoint:500,class:"bg-grey-3"},{default:Q(()=>[W(ri,{size:"sm",modelValue:E.value,"onUpdate:modelValue":A[10]||(A[10]=x=>E.value=x),min:380,max:740},null,8,["modelValue"]),W(Or,{class:"fit"},{default:Q(()=>[V("div",Mn,[V("div",Nn,[(J(!0),ie(Fe,null,Be([...f.playList],x=>(J(),Ce(dt,{class:"q-ma-sm example-item",key:x.Id},{default:Q(()=>[W(Gt,{fit:"cover",easier:"",draggable:"",src:q(jt)(x.Id),class:"item-img",onClick:C=>u(x)},{default:Q(()=>[V("div",Bn,[V("div",{onClick:Qe(()=>{},["stop"]),style:{display:"flex","flex-direction":"column","justify-content":"flex-start",width:"fit-content"}},[W(Ae,{square:"",color:"red",size:"sm","text-color":"white",style:{"margin-left":"0px",padding:"0 4px"}},{default:Q(()=>[V("span",{onClick:C=>g(x.Id)},"\u5220\u9664",8,Gn)]),_:2},1024),(J(!0),ie(Fe,null,Be(x.Tags,C=>(J(),Ce(Ye,{square:"",color:"red","text-color":"white",key:C,style:{"margin-left":"0px",padding:"0 4px"}},{default:Q(()=>[V("span",{onClick:O=>{f.queryParam.Keyword=C,m()}},le(C),9,jn)]),_:2},1024))),128))],8,Un),W(Ye,{onClick:Qe(()=>{},["stop"]),square:"",color:"green","text-color":"white",style:{width:"fit-content","margin-right":"0px",padding:"0 6px"}},{default:Q(()=>[V("span",null,le(x.MovieType),1)]),_:2},1032,["onClick"])])]),_:2},1032,["src","onClick"]),W(Ot,{style:{overflow:"auto",padding:"4px"}},{default:Q(()=>{var C;return[V("div",Kn,[W(Ye,{onClick:Qe(()=>{},["stop"]),square:"",color:"green","text-color":"orange",style:{padding:"0px 4px"}},{default:Q(()=>[De(le(x.SizeStr),1)]),_:2},1032,["onClick"]),V("span",Vn,le((C=x.Title)==null?void 0:C.substring(0,20)),1)])]}),_:2},1024)]),_:2},1024))),128))])])]),_:1})]),_:1},8,["modelValue","width"]),W(zt,{style:{width:"fit-content"}},{default:Q(()=>[W(Xt,null,{default:Q(()=>[W(dt,{class:"q-dialog-plugin",style:{width:"100%","max-height":"95vh","background-color":"rgba(0, 0, 0, 0.1)"}},{default:Q(()=>{var x;return[Le(W(q(nt),kt({ref_key:"vue3VideoPlayRef",ref:R,id:"vue3VideoPlayRef",style:{"object-fit":"contain",width:"100%",height:"auto","max-height":"99vh"}},y,{onEnded:A[12]||(A[12]=C=>p(1)),onTimeupdate:s,onVolumeupdate:o}),null,16),[[xe,(x=f.playing)==null?void 0:x.Id]]),W(Pr,{align:"left"},{default:Q(()=>{var C,O;return[V("div",null,[W(Ae,{flat:"",style:{color:"#59d89d"},label:(C=f.playing.Actress)==null?void 0:C.substring(0,8),onClick:A[13]||(A[13]=P=>{f.queryParam.Keyword=f.playing.Actress,m()})},null,8,["label"]),W(Ae,{flat:"",style:{color:"goldenrod"},label:(O=f.playing.Code)==null?void 0:O.substring(0,8),onClick:A[14]||(A[14]=P=>{f.queryParam.Keyword=f.playing.Code,m()})},null,8,["label"]),W(It,{modelValue:f.queryParam.Keyword,"onUpdate:modelValue":[A[15]||(A[15]=P=>f.queryParam.Keyword=P),m],dense:!0,clearable:""},{prepend:Q(()=>[W(ct,{name:"ti-list",class:"cursor-pointer"},{default:Q(()=>[W($t,null,{default:Q(()=>[V("div",Hn,[W(qt,null,{default:Q(()=>[(J(!0),ie(Fe,null,Be(b.value,P=>Le((J(),Ce(Mt,{clickable:"",key:P,onClick:M=>{f.queryParam.Keyword=P,m()}},{default:Q(()=>[W(Nt,null,{default:Q(()=>[W(Ht,null,{default:Q(()=>[De(le(P),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[xt]])),128))]),_:1})])]),_:1})]),_:1})]),append:Q(()=>[W(ct,{name:"ti-search",title:"\u641C",class:"cursor-pointer",onClick:m})]),_:1},8,["modelValue"])]),V("div",null,[W(Ut,{modelValue:f.queryParam.SortType,"onUpdate:modelValue":[A[16]||(A[16]=P=>f.queryParam.SortType=P),A[17]||(A[17]=P=>m())],"toggle-color":"primary",options:[{label:"\u6B63",value:"asc"},{label:"\u5012",value:"desc"}]},null,8,["modelValue"]),f.playlist?be("",!0):(J(),Ce(Ae,{key:0,color:"primary",label:"\u4E0A\u4E00\u4E2A",onClick:A[18]||(A[18]=P=>p(-1))})),f.playlist?be("",!0):(J(),Ce(Ae,{key:1,color:"primary",label:"\u4E0B\u4E00\u4E2A",onClick:A[19]||(A[19]=P=>p(1))})),W(Ae,{color:"orange",label:"\u66F4\u591A",onClick:A[20]||(A[20]=P=>{f.showMore=!f.showMore,e()})}),f.showMore?(J(),ie("span",qn,[(J(!0),ie(Fe,null,Be(f.settingInfo.Tags,P=>(J(),Ce(Ye,{square:"",color:"red","text-color":"white",key:P,style:{"margin-left":"0px",padding:"0 4px"}},{default:Q(()=>[V("span",{onClick:M=>{f.queryParam.Keyword=P,m()}},le(P),9,Wn)]),_:2},1024))),128))])):be("",!0)])]}),_:1})]}),_:1})]),_:1}),W(Pt,{position:"bottom"},{default:Q(()=>[W(Ae,{fab:"",icon:"keyboard_arrow_up",color:"red"})]),_:1})]),_:1})]),_:1})):be("",!0)],64))}};var ra=Ir(zn,[["__scopeId","data-v-81b5edee"]]);export{ra as P,Ht as Q,Yt as a,Vt as b,zr as c,Hr as d,Wr as e,Yr as f,qt as g,zt as h,Xt as i,$t as j};
