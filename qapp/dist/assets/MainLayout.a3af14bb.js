import{c as Pe,a as q,h as le,d as ct,i as At,e as xe,r as ee,w as oe,o as ht,f as ir,g as We,l as ft,j as vt,n as nr,k as ar,m as sr,p as or,q as lr,u as Ht,s as zt,t as ur,v as dr,x as cr,y as qt,z as Ee,A as _t,B as gt,C as hr,D as fr,E as vr,F as gr,G as pr,H as ut,I as Rt,J as mr,K as Wt,L as yr,M as Er,N as pt,O as Re,P as kt,Q as J,R as re,S as Ve,T as He,U as K,V as ye,W as Be,X as Ae,Y as V,Z as X,_ as ce,$ as Dt,a0 as me,a1 as de,a2 as St,a3 as Oe,a4 as Ne,a5 as Ye,a6 as Xe,a7 as ot,a8 as Tr,a9 as dt,aa as ze,ab as rt,ac as Sr,ad as br,ae as _e,af as Lr,ag as It,ah as Ar,ai as kr,aj as Dr,ak as _r}from"./index.a99383f0.js";import{Q as at}from"./QResizeObserver.3ce89f8a.js";import{Q as Yt,a as Rr}from"./QList.4c08310a.js";import{T as nt}from"./TouchPan.4180bc8b.js";import{b as Me,g as Ct,Q as Ir,a as Cr}from"./index.6a05b42c.js";import{Q as mt}from"./QChip.d7d9be6d.js";import{u as wr}from"./use-quasar.b0e80510.js";import{u as Xt}from"./System.90c0dcfd.js";import{S as xr}from"./searchAPI.cbac2bb4.js";import{G as Or}from"./settingAPI.66e22ac0.js";import{Q as Pr,a as Fr}from"./QItem.b69f9a83.js";import"./touch.3df10340.js";import"./selection.2b736806.js";import"./axios.6cee7fb0.js";var Mr=Pe({name:"QToolbarTitle",props:{shrink:Boolean},setup(P,{slots:C}){const f=q(()=>"q-toolbar__title ellipsis"+(P.shrink===!0?" col-shrink":""));return()=>le("div",{class:f.value},ct(C.default))}});const Nr=le("div",{class:"q-space"});var wt=Pe({name:"QSpace",setup(){return()=>Nr}}),Br=Pe({name:"QToolbar",props:{inset:Boolean},setup(P,{slots:C}){const f=q(()=>"q-toolbar row no-wrap items-center"+(P.inset===!0?" q-toolbar--inset":""));return()=>le("div",{class:f.value,role:"toolbar"},ct(C.default))}}),Ur=Pe({name:"QHeader",props:{modelValue:{type:Boolean,default:!0},reveal:Boolean,revealOffset:{type:Number,default:250},bordered:Boolean,elevated:Boolean,heightHint:{type:[String,Number],default:50}},emits:["reveal","focusin"],setup(P,{slots:C,emit:f}){const{proxy:{$q:R}}=We(),E=At(ft,xe);if(E===xe)return console.error("QHeader needs to be child of QLayout"),xe;const L=ee(parseInt(P.heightHint,10)),k=ee(!0),_=q(()=>P.reveal===!0||E.view.value.indexOf("H")>-1||R.platform.is.ios&&E.isContainer.value===!0),D=q(()=>{if(P.modelValue!==!0)return 0;if(_.value===!0)return k.value===!0?L.value:0;const e=L.value-E.scroll.value.position;return e>0?e:0}),o=q(()=>P.modelValue!==!0||_.value===!0&&k.value!==!0),S=q(()=>P.modelValue===!0&&o.value===!0&&P.reveal===!0),m=q(()=>"q-header q-layout__section--marginal "+(_.value===!0?"fixed":"absolute")+"-top"+(P.bordered===!0?" q-header--bordered":"")+(o.value===!0?" q-header--hidden":"")+(P.modelValue!==!0?" q-layout--prevent-focus":"")),h=q(()=>{const e=E.rows.value.top,s={};return e[0]==="l"&&E.left.space===!0&&(s[R.lang.rtl===!0?"right":"left"]=`${E.left.size}px`),e[2]==="r"&&E.right.space===!0&&(s[R.lang.rtl===!0?"left":"right"]=`${E.right.size}px`),s});function T(e,s){E.update("header",e,s)}function y(e,s){e.value!==s&&(e.value=s)}function d({height:e}){y(L,e),T("size",e)}function t(e){S.value===!0&&y(k,!0),f("focusin",e)}oe(()=>P.modelValue,e=>{T("space",e),y(k,!0),E.animate()}),oe(D,e=>{T("offset",e)}),oe(()=>P.reveal,e=>{e===!1&&y(k,P.modelValue)}),oe(k,e=>{E.animate(),f("reveal",e)}),oe(E.scroll,e=>{P.reveal===!0&&y(k,e.direction==="up"||e.position<=P.revealOffset||e.position-e.inflectionPoint<100)});const i={};return E.instances.header=i,P.modelValue===!0&&T("size",L.value),T("space",P.modelValue),T("offset",D.value),ht(()=>{E.instances.header===i&&(E.instances.header=void 0,T("size",0),T("offset",0),T("space",!1))}),()=>{const e=ir(C.default,[]);return P.elevated===!0&&e.push(le("div",{class:"q-layout__shadow absolute-full overflow-hidden no-pointer-events"})),e.push(le(at,{debounce:0,onResize:d})),le("header",{class:m.value,style:h.value,onFocusin:t},e)}}});const{passive:xt}=sr,Gr=["both","horizontal","vertical"];var $t=Pe({name:"QScrollObserver",props:{axis:{type:String,validator:P=>Gr.includes(P),default:"vertical"},debounce:[String,Number],scrollTarget:{default:void 0}},emits:["scroll"],setup(P,{emit:C}){const f={position:{top:0,left:0},direction:"down",directionChanged:!1,delta:{top:0,left:0},inflectionPoint:{top:0,left:0}};let R=null,E,L;oe(()=>P.scrollTarget,()=>{D(),_()});function k(){R!==null&&R();const m=Math.max(0,or(E)),h=lr(E),T={top:m-f.position.top,left:h-f.position.left};if(P.axis==="vertical"&&T.top===0||P.axis==="horizontal"&&T.left===0)return;const y=Math.abs(T.top)>=Math.abs(T.left)?T.top<0?"up":"down":T.left<0?"left":"right";f.position={top:m,left:h},f.directionChanged=f.direction!==y,f.delta=T,f.directionChanged===!0&&(f.direction=y,f.inflectionPoint=f.position),C("scroll",{...f})}function _(){E=ar(L,P.scrollTarget),E.addEventListener("scroll",o,xt),o(!0)}function D(){E!==void 0&&(E.removeEventListener("scroll",o,xt),E=void 0)}function o(m){if(m===!0||P.debounce===0||P.debounce==="0")k();else if(R===null){const[h,T]=P.debounce?[setTimeout(k,P.debounce),clearTimeout]:[requestAnimationFrame(k),cancelAnimationFrame];R=()=>{T(h),R=null}}}const{proxy:S}=We();return oe(()=>S.$q.lang.rtl,k),vt(()=>{L=S.$el.parentNode,_()}),ht(()=>{R!==null&&R(),D()}),Object.assign(S,{trigger:o,getPosition:()=>f}),nr}});const Ot=["vertical","horizontal"],yt={vertical:{offset:"offsetY",scroll:"scrollTop",dir:"down",dist:"y"},horizontal:{offset:"offsetX",scroll:"scrollLeft",dir:"right",dist:"x"}},Pt={prevent:!0,mouse:!0,mouseAllDir:!0},Ft=P=>P>=250?50:Math.ceil(P/5);var jr=Pe({name:"QScrollArea",props:{...Ht,thumbStyle:Object,verticalThumbStyle:Object,horizontalThumbStyle:Object,barStyle:[Array,String,Object],verticalBarStyle:[Array,String,Object],horizontalBarStyle:[Array,String,Object],contentStyle:[Array,String,Object],contentActiveStyle:[Array,String,Object],delay:{type:[String,Number],default:1e3},visible:{type:Boolean,default:null},tabindex:[String,Number],onScroll:Function},setup(P,{slots:C,emit:f}){const R=ee(!1),E=ee(!1),L=ee(!1),k={vertical:ee(0),horizontal:ee(0)},_={vertical:{ref:ee(null),position:ee(0),size:ee(0)},horizontal:{ref:ee(null),position:ee(0),size:ee(0)}},{proxy:D}=We(),o=zt(P,D.$q);let S=null,m;const h=ee(null),T=q(()=>"q-scrollarea"+(o.value===!0?" q-scrollarea--dark":""));_.vertical.percentage=q(()=>{const x=_.vertical.size.value-k.vertical.value;if(x<=0)return 0;const w=Me(_.vertical.position.value/x,0,1);return Math.round(w*1e4)/1e4}),_.vertical.thumbHidden=q(()=>(P.visible===null?L.value:P.visible)!==!0&&R.value===!1&&E.value===!1||_.vertical.size.value<=k.vertical.value+1),_.vertical.thumbStart=q(()=>_.vertical.percentage.value*(k.vertical.value-_.vertical.thumbSize.value)),_.vertical.thumbSize=q(()=>Math.round(Me(k.vertical.value*k.vertical.value/_.vertical.size.value,Ft(k.vertical.value),k.vertical.value))),_.vertical.style=q(()=>({...P.thumbStyle,...P.verticalThumbStyle,top:`${_.vertical.thumbStart.value}px`,height:`${_.vertical.thumbSize.value}px`})),_.vertical.thumbClass=q(()=>"q-scrollarea__thumb q-scrollarea__thumb--v absolute-right"+(_.vertical.thumbHidden.value===!0?" q-scrollarea__thumb--invisible":"")),_.vertical.barClass=q(()=>"q-scrollarea__bar q-scrollarea__bar--v absolute-right"+(_.vertical.thumbHidden.value===!0?" q-scrollarea__bar--invisible":"")),_.horizontal.percentage=q(()=>{const x=_.horizontal.size.value-k.horizontal.value;if(x<=0)return 0;const w=Me(Math.abs(_.horizontal.position.value)/x,0,1);return Math.round(w*1e4)/1e4}),_.horizontal.thumbHidden=q(()=>(P.visible===null?L.value:P.visible)!==!0&&R.value===!1&&E.value===!1||_.horizontal.size.value<=k.horizontal.value+1),_.horizontal.thumbStart=q(()=>_.horizontal.percentage.value*(k.horizontal.value-_.horizontal.thumbSize.value)),_.horizontal.thumbSize=q(()=>Math.round(Me(k.horizontal.value*k.horizontal.value/_.horizontal.size.value,Ft(k.horizontal.value),k.horizontal.value))),_.horizontal.style=q(()=>({...P.thumbStyle,...P.horizontalThumbStyle,[D.$q.lang.rtl===!0?"right":"left"]:`${_.horizontal.thumbStart.value}px`,width:`${_.horizontal.thumbSize.value}px`})),_.horizontal.thumbClass=q(()=>"q-scrollarea__thumb q-scrollarea__thumb--h absolute-bottom"+(_.horizontal.thumbHidden.value===!0?" q-scrollarea__thumb--invisible":"")),_.horizontal.barClass=q(()=>"q-scrollarea__bar q-scrollarea__bar--h absolute-bottom"+(_.horizontal.thumbHidden.value===!0?" q-scrollarea__bar--invisible":""));const y=q(()=>_.vertical.thumbHidden.value===!0&&_.horizontal.thumbHidden.value===!0?P.contentStyle:P.contentActiveStyle),d=[[nt,x=>{p(x,"vertical")},void 0,{vertical:!0,...Pt}]],t=[[nt,x=>{p(x,"horizontal")},void 0,{horizontal:!0,...Pt}]];function i(){const x={};return Ot.forEach(w=>{const O=_[w];x[w+"Position"]=O.position.value,x[w+"Percentage"]=O.percentage.value,x[w+"Size"]=O.size.value,x[w+"ContainerSize"]=k[w].value}),x}const e=ur(()=>{const x=i();x.ref=D,f("scroll",x)},0);function s(x,w,O){if(Ot.includes(x)===!1){console.error("[QScrollArea]: wrong first param of setScrollPosition (vertical/horizontal)");return}(x==="vertical"?_t:gt)(h.value,w,O)}function l({height:x,width:w}){let O=!1;k.vertical.value!==x&&(k.vertical.value=x,O=!0),k.horizontal.value!==w&&(k.horizontal.value=w,O=!0),O===!0&&a()}function n({position:x}){let w=!1;_.vertical.position.value!==x.top&&(_.vertical.position.value=x.top,w=!0),_.horizontal.position.value!==x.left&&(_.horizontal.position.value=x.left,w=!0),w===!0&&a()}function u({height:x,width:w}){_.horizontal.size.value!==w&&(_.horizontal.size.value=w,a()),_.vertical.size.value!==x&&(_.vertical.size.value=x,a())}function p(x,w){const O=_[w];if(x.isFirst===!0){if(O.thumbHidden.value===!0)return;m=O.position.value,E.value=!0}else if(E.value!==!0)return;x.isFinal===!0&&(E.value=!1);const F=yt[w],M=k[w].value,N=(O.size.value-M)/(M-O.thumbSize.value),B=x.distance[F.dist],U=m+(x.direction===F.dir?1:-1)*B*N;c(U,w)}function v(x,w){const O=_[w];if(O.thumbHidden.value!==!0){const F=x[yt[w].offset];if(F<O.thumbStart.value||F>O.thumbStart.value+O.thumbSize.value){const M=F-O.thumbSize.value/2;c(M/k[w].value*O.size.value,w)}O.ref.value!==null&&O.ref.value.dispatchEvent(new MouseEvent(x.type,x))}}function g(x){v(x,"vertical")}function r(x){v(x,"horizontal")}function a(){R.value=!0,S!==null&&clearTimeout(S),S=setTimeout(()=>{S=null,R.value=!1},P.delay),P.onScroll!==void 0&&e()}function c(x,w){h.value[yt[w].scroll]=x}function b(){L.value=!0}function A(){L.value=!1}let I=null;return oe(()=>D.$q.lang.rtl,x=>{h.value!==null&&gt(h.value,Math.abs(_.horizontal.position.value)*(x===!0?-1:1))}),dr(()=>{I={top:_.vertical.position.value,left:_.horizontal.position.value}}),cr(()=>{if(I===null)return;const x=h.value;x!==null&&(gt(x,I.left),_t(x,I.top))}),ht(e.cancel),Object.assign(D,{getScrollTarget:()=>h.value,getScroll:i,getScrollPosition:()=>({top:_.vertical.position.value,left:_.horizontal.position.value}),getScrollPercentage:()=>({top:_.vertical.percentage.value,left:_.horizontal.percentage.value}),setScrollPosition:s,setScrollPercentage(x,w,O){s(x,w*(_[x].size.value-k[x].value)*(x==="horizontal"&&D.$q.lang.rtl===!0?-1:1),O)}}),()=>le("div",{class:T.value,onMouseenter:b,onMouseleave:A},[le("div",{ref:h,class:"q-scrollarea__container scroll relative-position fit hide-scrollbar",tabindex:P.tabindex!==void 0?P.tabindex:void 0},[le("div",{class:"q-scrollarea__content absolute",style:y.value},qt(C.default,[le(at,{debounce:0,onResize:u})])),le($t,{axis:"both",onScroll:n})]),le(at,{debounce:0,onResize:l}),le("div",{class:_.vertical.barClass.value,style:[P.barStyle,P.verticalBarStyle],"aria-hidden":"true",onMousedown:g}),le("div",{class:_.horizontal.barClass.value,style:[P.barStyle,P.horizontalBarStyle],"aria-hidden":"true",onMousedown:r}),Ee(le("div",{ref:_.vertical.ref,class:_.vertical.thumbClass.value,style:_.vertical.style.value,"aria-hidden":"true"}),d),Ee(le("div",{ref:_.horizontal.ref,class:_.horizontal.thumbClass.value,style:_.horizontal.style.value,"aria-hidden":"true"}),t)])}});const Mt=150;var Nt=Pe({name:"QDrawer",inheritAttrs:!1,props:{...hr,...Ht,side:{type:String,default:"left",validator:P=>["left","right"].includes(P)},width:{type:Number,default:300},mini:Boolean,miniToOverlay:Boolean,miniWidth:{type:Number,default:57},noMiniAnimation:Boolean,breakpoint:{type:Number,default:1023},showIfAbove:Boolean,behavior:{type:String,validator:P=>["default","desktop","mobile"].includes(P),default:"default"},bordered:Boolean,elevated:Boolean,overlay:Boolean,persistent:Boolean,noSwipeOpen:Boolean,noSwipeClose:Boolean,noSwipeBackdrop:Boolean},emits:[...fr,"onLayout","miniState"],setup(P,{slots:C,emit:f,attrs:R}){const E=We(),{proxy:{$q:L}}=E,k=zt(P,L),{preventBodyScroll:_}=mr(),{registerTimeout:D,removeTimeout:o}=vr(),S=At(ft,xe);if(S===xe)return console.error("QDrawer needs to be child of QLayout"),xe;let m,h=null,T;const y=ee(P.behavior==="mobile"||P.behavior!=="desktop"&&S.totalWidth.value<=P.breakpoint),d=q(()=>P.mini===!0&&y.value!==!0),t=q(()=>d.value===!0?P.miniWidth:P.width),i=ee(P.showIfAbove===!0&&y.value===!1?!0:P.modelValue===!0),e=q(()=>P.persistent!==!0&&(y.value===!0||M.value===!0));function s(j,Q){if(p(),j!==!1&&S.animate(),Z(0),y.value===!0){const ge=S.instances[x.value];ge!==void 0&&ge.belowBreakpoint===!0&&ge.hide(!1),se(1),S.isContainer.value!==!0&&_(!0)}else se(0),j!==!1&&te(!1);D(()=>{j!==!1&&te(!0),Q!==!0&&f("show",j)},Mt)}function l(j,Q){v(),j!==!1&&S.animate(),se(0),Z(a.value*t.value),pe(),Q!==!0?D(()=>{f("hide",j)},Mt):o()}const{show:n,hide:u}=gr({showing:i,hideOnRouteChange:e,handleShow:s,handleHide:l}),{addToHistory:p,removeFromHistory:v}=pr(i,u,e),g={belowBreakpoint:y,hide:u},r=q(()=>P.side==="right"),a=q(()=>(L.lang.rtl===!0?-1:1)*(r.value===!0?1:-1)),c=ee(0),b=ee(!1),A=ee(!1),I=ee(t.value*a.value),x=q(()=>r.value===!0?"left":"right"),w=q(()=>i.value===!0&&y.value===!1&&P.overlay===!1?P.miniToOverlay===!0?P.miniWidth:t.value:0),O=q(()=>P.overlay===!0||P.miniToOverlay===!0||S.view.value.indexOf(r.value?"R":"L")>-1||L.platform.is.ios===!0&&S.isContainer.value===!0),F=q(()=>P.overlay===!1&&i.value===!0&&y.value===!1),M=q(()=>P.overlay===!0&&i.value===!0&&y.value===!1),N=q(()=>"fullscreen q-drawer__backdrop"+(i.value===!1&&b.value===!1?" hidden":"")),B=q(()=>({backgroundColor:`rgba(0,0,0,${c.value*.4})`})),U=q(()=>r.value===!0?S.rows.value.top[2]==="r":S.rows.value.top[0]==="l"),G=q(()=>r.value===!0?S.rows.value.bottom[2]==="r":S.rows.value.bottom[0]==="l"),H=q(()=>{const j={};return S.header.space===!0&&U.value===!1&&(O.value===!0?j.top=`${S.header.offset}px`:S.header.space===!0&&(j.top=`${S.header.size}px`)),S.footer.space===!0&&G.value===!1&&(O.value===!0?j.bottom=`${S.footer.offset}px`:S.footer.space===!0&&(j.bottom=`${S.footer.size}px`)),j}),z=q(()=>{const j={width:`${t.value}px`,transform:`translateX(${I.value}px)`};return y.value===!0?j:Object.assign(j,H.value)}),Y=q(()=>"q-drawer__content fit "+(S.isContainer.value!==!0?"scroll":"overflow-auto")),W=q(()=>`q-drawer q-drawer--${P.side}`+(A.value===!0?" q-drawer--mini-animate":"")+(P.bordered===!0?" q-drawer--bordered":"")+(k.value===!0?" q-drawer--dark q-dark":"")+(b.value===!0?" no-transition":i.value===!0?"":" q-layout--prevent-focus")+(y.value===!0?" fixed q-drawer--on-top q-drawer--mobile q-drawer--top-padding":` q-drawer--${d.value===!0?"mini":"standard"}`+(O.value===!0||F.value!==!0?" fixed":"")+(P.overlay===!0||P.miniToOverlay===!0?" q-drawer--on-top":"")+(U.value===!0?" q-drawer--top-padding":""))),$=q(()=>{const j=L.lang.rtl===!0?P.side:x.value;return[[nt,fe,void 0,{[j]:!0,mouse:!0}]]}),ie=q(()=>{const j=L.lang.rtl===!0?x.value:P.side;return[[nt,he,void 0,{[j]:!0,mouse:!0}]]}),ae=q(()=>{const j=L.lang.rtl===!0?x.value:P.side;return[[nt,he,void 0,{[j]:!0,mouse:!0,mouseAllDir:!0}]]});function ue(){Se(y,P.behavior==="mobile"||P.behavior!=="desktop"&&S.totalWidth.value<=P.breakpoint)}oe(y,j=>{j===!0?(m=i.value,i.value===!0&&u(!1)):P.overlay===!1&&P.behavior!=="mobile"&&m!==!1&&(i.value===!0?(Z(0),se(0),pe()):n(!1))}),oe(()=>P.side,(j,Q)=>{S.instances[Q]===g&&(S.instances[Q]=void 0,S[Q].space=!1,S[Q].offset=0),S.instances[j]=g,S[j].size=t.value,S[j].space=F.value,S[j].offset=w.value}),oe(S.totalWidth,()=>{(S.isContainer.value===!0||document.qScrollPrevented!==!0)&&ue()}),oe(()=>P.behavior+P.breakpoint,ue),oe(S.isContainer,j=>{i.value===!0&&_(j!==!0),j===!0&&ue()}),oe(S.scrollbarWidth,()=>{Z(i.value===!0?0:void 0)}),oe(w,j=>{ve("offset",j)}),oe(F,j=>{f("onLayout",j),ve("space",j)}),oe(r,()=>{Z()}),oe(t,j=>{Z(),be(P.miniToOverlay,j)}),oe(()=>P.miniToOverlay,j=>{be(j,t.value)}),oe(()=>L.lang.rtl,()=>{Z()}),oe(()=>P.mini,()=>{P.noMiniAnimation||P.modelValue===!0&&(ne(),S.animate())}),oe(d,j=>{f("miniState",j)});function Z(j){j===void 0?ut(()=>{j=i.value===!0?0:t.value,Z(a.value*j)}):(S.isContainer.value===!0&&r.value===!0&&(y.value===!0||Math.abs(j)===t.value)&&(j+=a.value*S.scrollbarWidth.value),I.value=j)}function se(j){c.value=j}function te(j){const Q=j===!0?"remove":S.isContainer.value!==!0?"add":"";Q!==""&&document.body.classList[Q]("q-body--drawer-toggle")}function ne(){h!==null&&clearTimeout(h),E.proxy&&E.proxy.$el&&E.proxy.$el.classList.add("q-drawer--mini-animate"),A.value=!0,h=setTimeout(()=>{h=null,A.value=!1,E&&E.proxy&&E.proxy.$el&&E.proxy.$el.classList.remove("q-drawer--mini-animate")},150)}function fe(j){if(i.value!==!1)return;const Q=t.value,ge=Me(j.distance.x,0,Q);if(j.isFinal===!0){ge>=Math.min(75,Q)===!0?n():(S.animate(),se(0),Z(a.value*Q)),b.value=!1;return}Z((L.lang.rtl===!0?r.value!==!0:r.value)?Math.max(Q-ge,0):Math.min(0,ge-Q)),se(Me(ge/Q,0,1)),j.isFirst===!0&&(b.value=!0)}function he(j){if(i.value!==!0)return;const Q=t.value,ge=j.direction===P.side,Te=(L.lang.rtl===!0?ge!==!0:ge)?Me(j.distance.x,0,Q):0;if(j.isFinal===!0){Math.abs(Te)<Math.min(75,Q)===!0?(S.animate(),se(1),Z(0)):u(),b.value=!1;return}Z(a.value*Te),se(Me(1-Te/Q,0,1)),j.isFirst===!0&&(b.value=!0)}function pe(){_(!1),te(!0)}function ve(j,Q){S.update(P.side,j,Q)}function Se(j,Q){j.value!==Q&&(j.value=Q)}function be(j,Q){ve("size",j===!0?P.miniWidth:Q)}return S.instances[P.side]=g,be(P.miniToOverlay,t.value),ve("space",F.value),ve("offset",w.value),P.showIfAbove===!0&&P.modelValue!==!0&&i.value===!0&&P["onUpdate:modelValue"]!==void 0&&f("update:modelValue",!0),vt(()=>{f("onLayout",F.value),f("miniState",d.value),m=P.showIfAbove===!0;const j=()=>{(i.value===!0?s:l)(!1,!0)};if(S.totalWidth.value!==0){ut(j);return}T=oe(S.totalWidth,()=>{T(),T=void 0,i.value===!1&&P.showIfAbove===!0&&y.value===!1?n(!1):j()})}),ht(()=>{T!==void 0&&T(),h!==null&&(clearTimeout(h),h=null),i.value===!0&&pe(),S.instances[P.side]===g&&(S.instances[P.side]=void 0,ve("size",0),ve("offset",0),ve("space",!1))}),()=>{const j=[];y.value===!0&&(P.noSwipeOpen===!1&&j.push(Ee(le("div",{key:"open",class:`q-drawer__opener fixed-${P.side}`,"aria-hidden":"true"}),$.value)),j.push(Rt("div",{ref:"backdrop",class:N.value,style:B.value,"aria-hidden":"true",onClick:u},void 0,"backdrop",P.noSwipeBackdrop!==!0&&i.value===!0,()=>ae.value)));const Q=d.value===!0&&C.mini!==void 0,ge=[le("div",{...R,key:""+Q,class:[Y.value,R.class]},Q===!0?C.mini():ct(C.default))];return P.elevated===!0&&i.value===!0&&ge.push(le("div",{class:"q-layout__shadow absolute-full overflow-hidden no-pointer-events"})),j.push(Rt("aside",{ref:"content",class:W.value,style:z.value},ge,"contentclose",P.noSwipeClose!==!0&&y.value===!0,()=>ie.value)),le("div",{class:"q-drawer-container"},j)}}}),Kr=Pe({name:"QPageContainer",setup(P,{slots:C}){const{proxy:{$q:f}}=We(),R=At(ft,xe);if(R===xe)return console.error("QPageContainer needs to be child of QLayout"),xe;Wt(yr,!0);const E=q(()=>{const L={};return R.header.space===!0&&(L.paddingTop=`${R.header.size}px`),R.right.space===!0&&(L[`padding${f.lang.rtl===!0?"Left":"Right"}`]=`${R.right.size}px`),R.footer.space===!0&&(L.paddingBottom=`${R.footer.size}px`),R.left.space===!0&&(L[`padding${f.lang.rtl===!0?"Right":"Left"}`]=`${R.left.size}px`),L});return()=>le("div",{class:"q-page-container",style:E.value},ct(C.default))}}),Vr=Pe({name:"QLayout",props:{container:Boolean,view:{type:String,default:"hhh lpr fff",validator:P=>/^(h|l)h(h|r) lpr (f|l)f(f|r)$/.test(P.toLowerCase())},onScroll:Function,onScrollHeight:Function,onResize:Function},setup(P,{slots:C,emit:f}){const{proxy:{$q:R}}=We(),E=ee(null),L=ee(R.screen.height),k=ee(P.container===!0?0:R.screen.width),_=ee({position:0,direction:"down",inflectionPoint:0}),D=ee(0),o=ee(Er.value===!0?0:pt()),S=q(()=>"q-layout q-layout--"+(P.container===!0?"containerized":"standard")),m=q(()=>P.container===!1?{minHeight:R.screen.height+"px"}:null),h=q(()=>o.value!==0?{[R.lang.rtl===!0?"left":"right"]:`${o.value}px`}:null),T=q(()=>o.value!==0?{[R.lang.rtl===!0?"right":"left"]:0,[R.lang.rtl===!0?"left":"right"]:`-${o.value}px`,width:`calc(100% + ${o.value}px)`}:null);function y(l){if(P.container===!0||document.qScrollPrevented!==!0){const n={position:l.position.top,direction:l.direction,directionChanged:l.directionChanged,inflectionPoint:l.inflectionPoint.top,delta:l.delta.top};_.value=n,P.onScroll!==void 0&&f("scroll",n)}}function d(l){const{height:n,width:u}=l;let p=!1;L.value!==n&&(p=!0,L.value=n,P.onScrollHeight!==void 0&&f("scrollHeight",n),i()),k.value!==u&&(p=!0,k.value=u),p===!0&&P.onResize!==void 0&&f("resize",l)}function t({height:l}){D.value!==l&&(D.value=l,i())}function i(){if(P.container===!0){const l=L.value>D.value?pt():0;o.value!==l&&(o.value=l)}}let e=null;const s={instances:{},view:q(()=>P.view),isContainer:q(()=>P.container),rootRef:E,height:L,containerHeight:D,scrollbarWidth:o,totalWidth:q(()=>k.value+o.value),rows:q(()=>{const l=P.view.toLowerCase().split(" ");return{top:l[0].split(""),middle:l[1].split(""),bottom:l[2].split("")}}),header:Re({size:0,offset:0,space:!1}),right:Re({size:300,offset:0,space:!1}),footer:Re({size:0,offset:0,space:!1}),left:Re({size:300,offset:0,space:!1}),scroll:_,animate(){e!==null?clearTimeout(e):document.body.classList.add("q-body--layout-animate"),e=setTimeout(()=>{e=null,document.body.classList.remove("q-body--layout-animate")},155)},update(l,n,u){s[l][n]=u}};if(Wt(ft,s),pt()>0){let u=function(){l=null,n.classList.remove("hide-scrollbar")},p=function(){if(l===null){if(n.scrollHeight>R.screen.height)return;n.classList.add("hide-scrollbar")}else clearTimeout(l);l=setTimeout(u,300)},v=function(g){l!==null&&g==="remove"&&(clearTimeout(l),u()),window[`${g}EventListener`]("resize",p)},l=null;const n=document.body;oe(()=>P.container!==!0?"add":"remove",v),P.container!==!0&&v("add"),kt(()=>{v("remove")})}return()=>{const l=qt(C.default,[le($t,{onScroll:y}),le(at,{onResize:d})]),n=le("div",{class:S.value,style:m.value,ref:P.container===!0?void 0:E,tabindex:-1},l);return P.container===!0?le("div",{class:"q-layout-container overflow-hidden",ref:E},[le(at,{onResize:t}),le("div",{class:"absolute-full",style:h.value},[le("div",{class:"scroll",style:T.value},[n])])]):n}}}),Hr=Object.defineProperty,zr=Object.defineProperties,qr=Object.getOwnPropertyDescriptors,Bt=Object.getOwnPropertySymbols,Wr=Object.prototype.hasOwnProperty,Yr=Object.prototype.propertyIsEnumerable,Ut=(P,C,f)=>C in P?Hr(P,C,{enumerable:!0,configurable:!0,writable:!0,value:f}):P[C]=f,bt=(P,C)=>{for(var f in C||(C={}))Wr.call(C,f)&&Ut(P,f,C[f]);if(Bt)for(var f of Bt(C))Yr.call(C,f)&&Ut(P,f,C[f]);return P},Lt=(P,C)=>zr(P,qr(C));function Gt(P,C,f,R){var E,L=!1,k=0;function _(){E&&clearTimeout(E)}function D(){for(var o=arguments.length,S=new Array(o),m=0;m<o;m++)S[m]=arguments[m];var h=this,T=Date.now()-k;function y(){k=Date.now(),f.apply(h,S)}function d(){E=void 0}L||(R&&!E&&y(),_(),R===void 0&&T>P?y():C!==!0&&(E=setTimeout(R?d:y,R===void 0?P-T:P)))}return typeof C!="boolean"&&(R=f,f=C,C=void 0),D.cancel=function(){_(),L=!0},D}function jt(P,C,f){return f===void 0?Gt(P,C,!1):Gt(P,f,C!==!1)}function Xr(P){return P&&P.__esModule&&Object.prototype.hasOwnProperty.call(P,"default")?P.default:P}var Qt={exports:{}};typeof window!="undefined"&&(Qt.exports=function(P){var C={};function f(R){if(C[R])return C[R].exports;var E=C[R]={i:R,l:!1,exports:{}};return P[R].call(E.exports,E,E.exports,f),E.l=!0,E.exports}return f.m=P,f.c=C,f.d=function(R,E,L){f.o(R,E)||Object.defineProperty(R,E,{enumerable:!0,get:L})},f.r=function(R){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(R,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(R,"__esModule",{value:!0})},f.t=function(R,E){if(1&E&&(R=f(R)),8&E||4&E&&typeof R=="object"&&R&&R.__esModule)return R;var L=Object.create(null);if(f.r(L),Object.defineProperty(L,"default",{enumerable:!0,value:R}),2&E&&typeof R!="string")for(var k in R)f.d(L,k,function(_){return R[_]}.bind(null,k));return L},f.n=function(R){var E=R&&R.__esModule?function(){return R.default}:function(){return R};return f.d(E,"a",E),E},f.o=function(R,E){return Object.prototype.hasOwnProperty.call(R,E)},f.p="/dist/",f(f.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(P,C,f){var R=Object.prototype.hasOwnProperty,E="~";function L(){}function k(S,m,h){this.fn=S,this.context=m,this.once=h||!1}function _(S,m,h,T,y){if(typeof h!="function")throw new TypeError("The listener must be a function");var d=new k(h,T||S,y),t=E?E+m:m;return S._events[t]?S._events[t].fn?S._events[t]=[S._events[t],d]:S._events[t].push(d):(S._events[t]=d,S._eventsCount++),S}function D(S,m){--S._eventsCount==0?S._events=new L:delete S._events[m]}function o(){this._events=new L,this._eventsCount=0}Object.create&&(L.prototype=Object.create(null),new L().__proto__||(E=!1)),o.prototype.eventNames=function(){var S,m,h=[];if(this._eventsCount===0)return h;for(m in S=this._events)R.call(S,m)&&h.push(E?m.slice(1):m);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(S)):h},o.prototype.listeners=function(S){var m=E?E+S:S,h=this._events[m];if(!h)return[];if(h.fn)return[h.fn];for(var T=0,y=h.length,d=new Array(y);T<y;T++)d[T]=h[T].fn;return d},o.prototype.listenerCount=function(S){var m=E?E+S:S,h=this._events[m];return h?h.fn?1:h.length:0},o.prototype.emit=function(S,m,h,T,y,d){var t=E?E+S:S;if(!this._events[t])return!1;var i,e,s=this._events[t],l=arguments.length;if(s.fn){switch(s.once&&this.removeListener(S,s.fn,void 0,!0),l){case 1:return s.fn.call(s.context),!0;case 2:return s.fn.call(s.context,m),!0;case 3:return s.fn.call(s.context,m,h),!0;case 4:return s.fn.call(s.context,m,h,T),!0;case 5:return s.fn.call(s.context,m,h,T,y),!0;case 6:return s.fn.call(s.context,m,h,T,y,d),!0}for(e=1,i=new Array(l-1);e<l;e++)i[e-1]=arguments[e];s.fn.apply(s.context,i)}else{var n,u=s.length;for(e=0;e<u;e++)switch(s[e].once&&this.removeListener(S,s[e].fn,void 0,!0),l){case 1:s[e].fn.call(s[e].context);break;case 2:s[e].fn.call(s[e].context,m);break;case 3:s[e].fn.call(s[e].context,m,h);break;case 4:s[e].fn.call(s[e].context,m,h,T);break;default:if(!i)for(n=1,i=new Array(l-1);n<l;n++)i[n-1]=arguments[n];s[e].fn.apply(s[e].context,i)}}return!0},o.prototype.on=function(S,m,h){return _(this,S,m,h,!1)},o.prototype.once=function(S,m,h){return _(this,S,m,h,!0)},o.prototype.removeListener=function(S,m,h,T){var y=E?E+S:S;if(!this._events[y])return this;if(!m)return D(this,y),this;var d=this._events[y];if(d.fn)d.fn!==m||T&&!d.once||h&&d.context!==h||D(this,y);else{for(var t=0,i=[],e=d.length;t<e;t++)(d[t].fn!==m||T&&!d[t].once||h&&d[t].context!==h)&&i.push(d[t]);i.length?this._events[y]=i.length===1?i[0]:i:D(this,y)}return this},o.prototype.removeAllListeners=function(S){var m;return S?(m=E?E+S:S,this._events[m]&&D(this,m)):(this._events=new L,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=E,o.EventEmitter=o,P.exports=o},"./node_modules/url-toolkit/src/url-toolkit.js":function(P,C,f){var R,E,L,k,_;R=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#[^]*)?$/,E=/^([^\/?#]*)([^]*)$/,L=/(?:\/|^)\.(?=\/)/g,k=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,_={buildAbsoluteURL:function(D,o,S){if(S=S||{},D=D.trim(),!(o=o.trim())){if(!S.alwaysNormalize)return D;var m=_.parseURL(D);if(!m)throw new Error("Error trying to parse base URL.");return m.path=_.normalizePath(m.path),_.buildURLFromParts(m)}var h=_.parseURL(o);if(!h)throw new Error("Error trying to parse relative URL.");if(h.scheme)return S.alwaysNormalize?(h.path=_.normalizePath(h.path),_.buildURLFromParts(h)):o;var T=_.parseURL(D);if(!T)throw new Error("Error trying to parse base URL.");if(!T.netLoc&&T.path&&T.path[0]!=="/"){var y=E.exec(T.path);T.netLoc=y[1],T.path=y[2]}T.netLoc&&!T.path&&(T.path="/");var d={scheme:T.scheme,netLoc:h.netLoc,path:null,params:h.params,query:h.query,fragment:h.fragment};if(!h.netLoc&&(d.netLoc=T.netLoc,h.path[0]!=="/"))if(h.path){var t=T.path,i=t.substring(0,t.lastIndexOf("/")+1)+h.path;d.path=_.normalizePath(i)}else d.path=T.path,h.params||(d.params=T.params,h.query||(d.query=T.query));return d.path===null&&(d.path=S.alwaysNormalize?_.normalizePath(h.path):h.path),_.buildURLFromParts(d)},parseURL:function(D){var o=R.exec(D);return o?{scheme:o[1]||"",netLoc:o[2]||"",path:o[3]||"",params:o[4]||"",query:o[5]||"",fragment:o[6]||""}:null},normalizePath:function(D){for(D=D.split("").reverse().join("").replace(L,"");D.length!==(D=D.replace(k,"")).length;);return D.split("").reverse().join("")},buildURLFromParts:function(D){return D.scheme+D.netLoc+D.path+D.params+D.query+D.fragment}},P.exports=_},"./node_modules/webworkify-webpack/index.js":function(P,C,f){function R(o){var S={};function m(T){if(S[T])return S[T].exports;var y=S[T]={i:T,l:!1,exports:{}};return o[T].call(y.exports,y,y.exports,m),y.l=!0,y.exports}m.m=o,m.c=S,m.i=function(T){return T},m.d=function(T,y,d){m.o(T,y)||Object.defineProperty(T,y,{configurable:!1,enumerable:!0,get:d})},m.r=function(T){Object.defineProperty(T,"__esModule",{value:!0})},m.n=function(T){var y=T&&T.__esModule?function(){return T.default}:function(){return T};return m.d(y,"a",y),y},m.o=function(T,y){return Object.prototype.hasOwnProperty.call(T,y)},m.p="/",m.oe=function(T){throw console.error(T),T};var h=m(m.s=ENTRY_MODULE);return h.default||h}var E="[\\.|\\-|\\+|\\w|/|@]+",L="\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)";function k(o){return(o+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function _(o,S,m){var h={};h[m]=[];var T=S.toString(),y=T.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!y)return h;for(var d,t=y[1],i=new RegExp("(\\\\n|\\W)"+k(t)+L,"g");d=i.exec(T);)d[3]!=="dll-reference"&&h[m].push(d[3]);for(i=new RegExp("\\("+k(t)+'\\("(dll-reference\\s('+E+'))"\\)\\)'+L,"g");d=i.exec(T);)o[d[2]]||(h[m].push(d[1]),o[d[2]]=f(d[1]).m),h[d[2]]=h[d[2]]||[],h[d[2]].push(d[4]);for(var e,s=Object.keys(h),l=0;l<s.length;l++)for(var n=0;n<h[s[l]].length;n++)e=h[s[l]][n],isNaN(1*e)||(h[s[l]][n]=1*h[s[l]][n]);return h}function D(o){return Object.keys(o).reduce(function(S,m){return S||o[m].length>0},!1)}P.exports=function(o,S){S=S||{};var m={main:f.m},h=S.all?{main:Object.keys(m.main)}:function(i,e){for(var s={main:[e]},l={main:[]},n={main:{}};D(s);)for(var u=Object.keys(s),p=0;p<u.length;p++){var v=u[p],g=s[v].pop();if(n[v]=n[v]||{},!n[v][g]&&i[v][g]){n[v][g]=!0,l[v]=l[v]||[],l[v].push(g);for(var r=_(i,i[v][g],v),a=Object.keys(r),c=0;c<a.length;c++)s[a[c]]=s[a[c]]||[],s[a[c]]=s[a[c]].concat(r[a[c]])}}return l}(m,o),T="";Object.keys(h).filter(function(i){return i!=="main"}).forEach(function(i){for(var e=0;h[i][e];)e++;h[i].push(e),m[i][e]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",T=T+"var "+i+" = ("+R.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+h[i].map(function(s){return JSON.stringify(s)+": "+m[i][s].toString()}).join(",")+`});
`}),T=T+"new (("+R.toString().replace("ENTRY_MODULE",JSON.stringify(o))+")({"+h.main.map(function(i){return JSON.stringify(i)+": "+m.main[i].toString()}).join(",")+"}))(self);";var y=new window.Blob([T],{type:"text/javascript"});if(S.bare)return y;var d=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(y),t=new window.Worker(d);return t.objectURL=d,t}},"./src/config.ts":function(P,C,f){f.r(C),f.d(C,"hlsDefaultConfig",function(){return u}),f.d(C,"mergeConfig",function(){return p}),f.d(C,"enableStreamingMode",function(){return v});var R=f("./src/controller/abr-controller.ts"),E=f("./src/controller/audio-stream-controller.ts"),L=f("./src/controller/audio-track-controller.ts"),k=f("./src/controller/subtitle-stream-controller.ts"),_=f("./src/controller/subtitle-track-controller.ts"),D=f("./src/controller/buffer-controller.ts"),o=f("./src/controller/timeline-controller.ts"),S=f("./src/controller/cap-level-controller.ts"),m=f("./src/controller/fps-controller.ts"),h=f("./src/controller/eme-controller.ts"),T=f("./src/utils/xhr-loader.ts"),y=f("./src/utils/fetch-loader.ts"),d=f("./src/utils/cues.ts"),t=f("./src/utils/mediakeys-helper.ts"),i=f("./src/utils/logger.ts");function e(){return(e=Object.assign||function(g){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(g[c]=a[c])}return g}).apply(this,arguments)}function s(g,r){var a=Object.keys(g);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(g);r&&(c=c.filter(function(b){return Object.getOwnPropertyDescriptor(g,b).enumerable})),a.push.apply(a,c)}return a}function l(g){for(var r=1;r<arguments.length;r++){var a=arguments[r]!=null?arguments[r]:{};r%2?s(Object(a),!0).forEach(function(c){n(g,c,a[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(g,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach(function(c){Object.defineProperty(g,c,Object.getOwnPropertyDescriptor(a,c))})}return g}function n(g,r,a){return r in g?Object.defineProperty(g,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):g[r]=a,g}var u=l(l({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:T.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:R.default,bufferController:D.default,capLevelController:S.default,fpsController:m.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:t.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0},{cueHandler:d.default,enableCEA708Captions:!0,enableWebVTT:!0,enableIMSC1:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:k.SubtitleStreamController,subtitleTrackController:_.default,timelineController:o.TimelineController,audioStreamController:E.default,audioTrackController:L.default,emeController:h.default});function p(g,r){if((r.liveSyncDurationCount||r.liveMaxLatencyDurationCount)&&(r.liveSyncDuration||r.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(r.liveMaxLatencyDurationCount!==void 0&&(r.liveSyncDurationCount===void 0||r.liveMaxLatencyDurationCount<=r.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(r.liveMaxLatencyDuration!==void 0&&(r.liveSyncDuration===void 0||r.liveMaxLatencyDuration<=r.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return e({},g,r)}function v(g){var r=g.loader;r!==y.default&&r!==T.default?(i.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),g.progressive=!1):Object(y.fetchSupported)()&&(g.loader=y.default,g.progressive=!0,g.enableSoftwareAES=!0,i.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}},"./src/controller/abr-controller.ts":function(P,C,f){f.r(C);var R=f("./src/polyfills/number.ts"),E=f("./src/utils/ewma-bandwidth-estimator.ts"),L=f("./src/events.ts"),k=f("./src/utils/buffer-helper.ts"),_=f("./src/errors.ts"),D=f("./src/types/loader.ts"),o=f("./src/utils/logger.ts");function S(h,T){for(var y=0;y<T.length;y++){var d=T[y];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(h,d.key,d)}}var m=function(){function h(t){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=t;var i=t.config;this.bwEstimator=new E.default(i.abrEwmaSlowVoD,i.abrEwmaFastVoD,i.abrEwmaDefaultEstimate),this.registerListeners()}var T,y,d=h.prototype;return d.registerListeners=function(){var t=this.hls;t.on(L.Events.FRAG_LOADING,this.onFragLoading,this),t.on(L.Events.FRAG_LOADED,this.onFragLoaded,this),t.on(L.Events.FRAG_BUFFERED,this.onFragBuffered,this),t.on(L.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(L.Events.ERROR,this.onError,this)},d.unregisterListeners=function(){var t=this.hls;t.off(L.Events.FRAG_LOADING,this.onFragLoading,this),t.off(L.Events.FRAG_LOADED,this.onFragLoaded,this),t.off(L.Events.FRAG_BUFFERED,this.onFragBuffered,this),t.off(L.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(L.Events.ERROR,this.onError,this)},d.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},d.onFragLoading=function(t,i){var e,s=i.frag;s.type===D.PlaylistLevelType.MAIN&&(this.timer||(this.fragCurrent=s,this.partCurrent=(e=i.part)!=null?e:null,this.timer=self.setInterval(this.onCheck,100)))},d.onLevelLoaded=function(t,i){var e=this.hls.config;i.details.live?this.bwEstimator.update(e.abrEwmaSlowLive,e.abrEwmaFastLive):this.bwEstimator.update(e.abrEwmaSlowVoD,e.abrEwmaFastVoD)},d._abandonRulesCheck=function(){var t=this.fragCurrent,i=this.partCurrent,e=this.hls,s=e.autoLevelEnabled,l=e.config,n=e.media;if(t&&n){var u=i?i.stats:t.stats,p=i?i.duration:t.duration;if(u.aborted)return o.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);if(s&&!n.paused&&n.playbackRate&&n.readyState){var v=performance.now()-u.loading.start,g=Math.abs(n.playbackRate);if(!(v<=500*p/g)){var r=e.levels,a=e.minAutoLevel,c=r[t.level],b=u.total||Math.max(u.loaded,Math.round(p*c.maxBitrate/8)),A=Math.max(1,u.bwEstimate?u.bwEstimate/8:1e3*u.loaded/v),I=(b-u.loaded)/A,x=n.currentTime,w=(k.BufferHelper.bufferInfo(n,x,l.maxBufferHole).end-x)/g;if(!(w>=2*p/g||I<=w)){var O,F=Number.POSITIVE_INFINITY;for(O=t.level-1;O>a&&!((F=p*r[O].maxBitrate/(6.4*A))<w);O--);if(!(F>=I)){var M=this.bwEstimator.getEstimate();o.logger.warn("Fragment "+t.sn+(i?" part "+i.index:"")+" of level "+t.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+O+`
      Current BW estimate: `+(Object(R.isFiniteNumber)(M)?(M/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+I.toFixed(3)+` s
      Estimated load time for the next fragment: `+F.toFixed(3)+` s
      Time to underbuffer: `+w.toFixed(3)+" s"),e.nextLoadLevel=O,this.bwEstimator.sample(v,u.loaded),this.clearTimer(),t.loader&&(this.fragCurrent=this.partCurrent=null,t.loader.abort()),e.trigger(L.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:t,part:i,stats:u})}}}}}},d.onFragLoaded=function(t,i){var e=i.frag,s=i.part;if(e.type===D.PlaylistLevelType.MAIN&&Object(R.isFiniteNumber)(e.sn)){var l=s?s.stats:e.stats,n=s?s.duration:e.duration;if(this.clearTimer(),this.lastLoadedFragLevel=e.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var u=this.hls.levels[e.level],p=(u.loaded?u.loaded.bytes:0)+l.loaded,v=(u.loaded?u.loaded.duration:0)+n;u.loaded={bytes:p,duration:v},u.realBitrate=Math.round(8*p/v)}if(e.bitrateTest){var g={stats:l,frag:e,part:s,id:e.type};this.onFragBuffered(L.Events.FRAG_BUFFERED,g),e.bitrateTest=!1}}},d.onFragBuffered=function(t,i){var e=i.frag,s=i.part,l=s?s.stats:e.stats;if(!l.aborted&&e.type===D.PlaylistLevelType.MAIN&&e.sn!=="initSegment"){var n=l.parsing.end-l.loading.start;this.bwEstimator.sample(n,l.loaded),l.bwEstimate=this.bwEstimator.getEstimate(),e.bitrateTest?this.bitrateTestDelay=n/1e3:this.bitrateTestDelay=0}},d.onError=function(t,i){switch(i.details){case _.ErrorDetails.FRAG_LOAD_ERROR:case _.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},d.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},d.getNextABRAutoLevel=function(){var t=this.fragCurrent,i=this.partCurrent,e=this.hls,s=e.maxAutoLevel,l=e.config,n=e.minAutoLevel,u=e.media,p=i?i.duration:t?t.duration:0,v=u?u.currentTime:0,g=u&&u.playbackRate!==0?Math.abs(u.playbackRate):1,r=this.bwEstimator?this.bwEstimator.getEstimate():l.abrEwmaDefaultEstimate,a=(k.BufferHelper.bufferInfo(u,v,l.maxBufferHole).end-v)/g,c=this.findBestLevel(r,n,s,a,l.abrBandWidthFactor,l.abrBandWidthUpFactor);if(c>=0)return c;o.logger.trace((a?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var b=p?Math.min(p,l.maxStarvationDelay):l.maxStarvationDelay,A=l.abrBandWidthFactor,I=l.abrBandWidthUpFactor;if(!a){var x=this.bitrateTestDelay;x&&(b=(p?Math.min(p,l.maxLoadingDelay):l.maxLoadingDelay)-x,o.logger.trace("bitrate test took "+Math.round(1e3*x)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*b)+" ms"),A=I=1)}return c=this.findBestLevel(r,n,s,a+b,A,I),Math.max(c,0)},d.findBestLevel=function(t,i,e,s,l,n){for(var u,p=this.fragCurrent,v=this.partCurrent,g=this.lastLoadedFragLevel,r=this.hls.levels,a=r[g],c=!(a==null||(u=a.details)===null||u===void 0||!u.live),b=a==null?void 0:a.codecSet,A=v?v.duration:p?p.duration:0,I=e;I>=i;I--){var x=r[I];if(x&&(!b||x.codecSet===b)){var w=x.details,O=(v?w==null?void 0:w.partTarget:w==null?void 0:w.averagetargetduration)||A,F=void 0;F=I<=g?l*t:n*t;var M=r[I].maxBitrate,N=M*O/F;if(o.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+I+"/"+Math.round(F)+"/"+M+"/"+O+"/"+s+"/"+N),F>M&&(!N||c&&!this.bitrateTestDelay||N<s))return I}}return-1},T=h,(y=[{key:"nextAutoLevel",get:function(){var t=this._nextAutoLevel,i=this.bwEstimator;if(!(t===-1||i&&i.canEstimate()))return t;var e=this.getNextABRAutoLevel();return t!==-1&&(e=Math.min(t,e)),e},set:function(t){this._nextAutoLevel=t}}])&&S(T.prototype,y),h}();C.default=m},"./src/controller/audio-stream-controller.ts":function(P,C,f){f.r(C);var R=f("./src/polyfills/number.ts"),E=f("./src/controller/base-stream-controller.ts"),L=f("./src/events.ts"),k=f("./src/utils/buffer-helper.ts"),_=f("./src/controller/fragment-tracker.ts"),D=f("./src/types/level.ts"),o=f("./src/types/loader.ts"),S=f("./src/loader/fragment.ts"),m=f("./src/demux/chunk-cache.ts"),h=f("./src/demux/transmuxer-interface.ts"),T=f("./src/types/transmuxer.ts"),y=f("./src/controller/fragment-finders.ts"),d=f("./src/utils/discontinuities.ts"),t=f("./src/errors.ts"),i=f("./src/utils/logger.ts");function e(){return(e=Object.assign||function(n){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var v in p)Object.prototype.hasOwnProperty.call(p,v)&&(n[v]=p[v])}return n}).apply(this,arguments)}function s(n,u){return(s=Object.setPrototypeOf||function(p,v){return p.__proto__=v,p})(n,u)}var l=function(n){var u,p;function v(r,a){var c;return(c=n.call(this,r,a,"[audio-stream-controller]")||this).videoBuffer=null,c.videoTrackCC=-1,c.waitingVideoCC=-1,c.audioSwitch=!1,c.trackId=-1,c.waitingData=null,c.mainDetails=null,c.bufferFlushed=!1,c._registerListeners(),c}p=n,(u=v).prototype=Object.create(p.prototype),u.prototype.constructor=u,s(u,p);var g=v.prototype;return g.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},g._registerListeners=function(){var r=this.hls;r.on(L.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(L.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(L.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(L.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.on(L.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),r.on(L.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.on(L.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.on(L.Events.ERROR,this.onError,this),r.on(L.Events.BUFFER_RESET,this.onBufferReset,this),r.on(L.Events.BUFFER_CREATED,this.onBufferCreated,this),r.on(L.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.on(L.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),r.on(L.Events.FRAG_BUFFERED,this.onFragBuffered,this)},g._unregisterListeners=function(){var r=this.hls;r.off(L.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(L.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(L.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(L.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.off(L.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),r.off(L.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.off(L.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.off(L.Events.ERROR,this.onError,this),r.off(L.Events.BUFFER_RESET,this.onBufferReset,this),r.off(L.Events.BUFFER_CREATED,this.onBufferCreated,this),r.off(L.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.off(L.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),r.off(L.Events.FRAG_BUFFERED,this.onFragBuffered,this)},g.onInitPtsFound=function(r,a){var c=a.frag,b=a.id,A=a.initPTS;if(b==="main"){var I=c.cc;this.initPTS[c.cc]=A,this.log("InitPTS for cc: "+I+" found from main: "+A),this.videoTrackCC=I,this.state===E.State.WAITING_INIT_PTS&&this.tick()}},g.startLoad=function(r){if(!this.levels)return this.startPosition=r,void(this.state=E.State.STOPPED);var a=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,a>0&&r===-1?(this.log("Override startPosition with lastCurrentTime @"+a.toFixed(3)),this.state=E.State.IDLE):(this.loadedmetadata=!1,this.state=E.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=r,this.tick()},g.doTick=function(){switch(this.state){case E.State.IDLE:this.doTickIdle();break;case E.State.WAITING_TRACK:var r,a=this.levels,c=this.trackId,b=a==null||(r=a[c])===null||r===void 0?void 0:r.details;if(b){if(this.waitForCdnTuneIn(b))break;this.state=E.State.WAITING_INIT_PTS}break;case E.State.FRAG_LOADING_WAITING_RETRY:var A,I=performance.now(),x=this.retryDate;(!x||I>=x||(A=this.media)!==null&&A!==void 0&&A.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state=E.State.IDLE);break;case E.State.WAITING_INIT_PTS:var w=this.waitingData;if(w){var O=w.frag,F=w.part,M=w.cache,N=w.complete;if(this.initPTS[O.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=E.State.FRAG_LOADING;var B={frag:O,part:F,payload:M.flush(),networkDetails:null};this._handleFragmentLoadProgress(B),N&&n.prototype._handleFragmentLoadComplete.call(this,B)}else if(this.videoTrackCC!==this.waitingVideoCC)i.logger.log("Waiting fragment cc ("+O.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var U=this.getLoadPosition(),G=k.BufferHelper.bufferInfo(this.mediaBuffer,U,this.config.maxBufferHole);Object(y.fragmentWithinToleranceTest)(G.end,this.config.maxFragLookUpTolerance,O)<0&&(i.logger.log("Waiting fragment cc ("+O.cc+") @ "+O.start+" cancelled because another fragment at "+G.end+" is needed"),this.clearWaitingFragment())}}else this.state=E.State.IDLE}this.onTickEnd()},g.clearWaitingFragment=function(){var r=this.waitingData;r&&(this.fragmentTracker.removeFragment(r.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=E.State.IDLE)},g.onTickEnd=function(){var r=this.media;if(r&&r.readyState){var a=(this.mediaBuffer?this.mediaBuffer:r).buffered;!this.loadedmetadata&&a.length&&(this.loadedmetadata=!0),this.lastCurrentTime=r.currentTime}},g.doTickIdle=function(){var r,a,c=this.hls,b=this.levels,A=this.media,I=this.trackId,x=c.config;if(b&&b[I]&&(A||!this.startFragRequested&&x.startFragPrefetch)){var w=b[I].details;if(!w||w.live&&this.levelLastLoaded!==I||this.waitForCdnTuneIn(w))this.state=E.State.WAITING_TRACK;else{this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer?this.mediaBuffer:this.media,S.ElementaryStreamTypes.AUDIO,o.PlaylistLevelType.AUDIO));var O=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,o.PlaylistLevelType.AUDIO);if(O!==null){var F=O.len,M=this.getMaxBufferLength(),N=this.audioSwitch;if(!(F>=M)||N){if(!N&&this._streamEnded(O,w))return c.trigger(L.Events.BUFFER_EOS,{type:"audio"}),void(this.state=E.State.ENDED);var B=w.fragments[0].start,U=O.end;if(N){var G=this.getLoadPosition();U=G,w.PTSKnown&&G<B&&(O.end>B||O.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),A.currentTime=B+.05)}var H=this.getNextFragment(U,w);H?((r=H.decryptdata)===null||r===void 0?void 0:r.keyFormat)!=="identity"||(a=H.decryptdata)!==null&&a!==void 0&&a.key?this.loadFragment(H,w,U):this.loadKey(H,w):this.bufferFlushed=!0}}}}},g.getMaxBufferLength=function(){var r=n.prototype.getMaxBufferLength.call(this),a=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,o.PlaylistLevelType.MAIN);return a===null?r:Math.max(r,a.len)},g.onMediaDetaching=function(){this.videoBuffer=null,n.prototype.onMediaDetaching.call(this)},g.onAudioTracksUpdated=function(r,a){var c=a.audioTracks;this.resetTransmuxer(),this.levels=c.map(function(b){return new D.Level(b)})},g.onAudioTrackSwitching=function(r,a){var c=!!a.url;this.trackId=a.id;var b=this.fragCurrent;b!=null&&b.loader&&b.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),c?this.setInterval(100):this.resetTransmuxer(),c?(this.audioSwitch=!0,this.state=E.State.IDLE):this.state=E.State.STOPPED,this.tick()},g.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},g.onLevelLoaded=function(r,a){this.mainDetails=a.details},g.onAudioTrackLoaded=function(r,a){var c,b=this.levels,A=a.details,I=a.id;if(b){this.log("Track "+I+" loaded ["+A.startSN+","+A.endSN+"],duration:"+A.totalduration);var x=b[I],w=0;if(A.live||(c=x.details)!==null&&c!==void 0&&c.live){var O=this.mainDetails;if(A.fragments[0]||(A.deltaUpdateFailed=!0),A.deltaUpdateFailed||!O)return;!x.details&&A.hasProgramDateTime&&O.hasProgramDateTime?(Object(d.alignPDT)(A,O),w=A.fragments[0].start):w=this.alignPlaylists(A,x.details)}x.details=A,this.levelLastLoaded=I,this.startFragRequested||!this.mainDetails&&A.live||this.setStartPosition(x.details,w),this.state!==E.State.WAITING_TRACK||this.waitForCdnTuneIn(A)||(this.state=E.State.IDLE),this.tick()}else this.warn("Audio tracks were reset while loading level "+I)},g._handleFragmentLoadProgress=function(r){var a,c=r.frag,b=r.part,A=r.payload,I=this.config,x=this.trackId,w=this.levels;if(w){var O=w[x];console.assert(O,"Audio track is defined on fragment load progress");var F=O.details;console.assert(F,"Audio track details are defined on fragment load progress");var M=I.defaultAudioCodec||O.audioCodec||"mp4a.40.2",N=this.transmuxer;N||(N=this.transmuxer=new h.default(this.hls,o.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var B=this.initPTS[c.cc],U=(a=c.initSegment)===null||a===void 0?void 0:a.data;if(B!==void 0){var G=b?b.index:-1,H=G!==-1,z=new T.ChunkMetadata(c.level,c.sn,c.stats.chunkCount,A.byteLength,G,H);N.push(A,U,M,"",c,b,F.totalduration,!1,z,B)}else i.logger.log("Unknown video PTS for cc "+c.cc+", waiting for video PTS before demuxing audio frag "+c.sn+" of ["+F.startSN+" ,"+F.endSN+"],track "+x),(this.waitingData=this.waitingData||{frag:c,part:b,cache:new m.default,complete:!1}).cache.push(new Uint8Array(A)),this.waitingVideoCC=this.videoTrackCC,this.state=E.State.WAITING_INIT_PTS}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+c.sn+" of level "+c.level+" will not be buffered")},g._handleFragmentLoadComplete=function(r){this.waitingData?this.waitingData.complete=!0:n.prototype._handleFragmentLoadComplete.call(this,r)},g.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},g.onBufferCreated=function(r,a){var c=a.tracks.audio;c&&(this.mediaBuffer=c.buffer),a.tracks.video&&(this.videoBuffer=a.tracks.video.buffer)},g.onFragBuffered=function(r,a){var c=a.frag,b=a.part;c.type===o.PlaylistLevelType.AUDIO&&(this.fragContextChanged(c)?this.warn("Fragment "+c.sn+(b?" p: "+b.index:"")+" of level "+c.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch):(c.sn!=="initSegment"&&(this.fragPrevious=c,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(L.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(c,b)))},g.onError=function(r,a){switch(a.details){case t.ErrorDetails.FRAG_LOAD_ERROR:case t.ErrorDetails.FRAG_LOAD_TIMEOUT:case t.ErrorDetails.KEY_LOAD_ERROR:case t.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(o.PlaylistLevelType.AUDIO,a);break;case t.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case t.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==E.State.ERROR&&this.state!==E.State.STOPPED&&(this.state=a.fatal?E.State.ERROR:E.State.IDLE,this.warn(a.details+" while loading frag, switching to "+this.state+" state"));break;case t.ErrorDetails.BUFFER_FULL_ERROR:if(a.parent==="audio"&&(this.state===E.State.PARSING||this.state===E.State.PARSED)){var c=!0,b=this.getFwdBufferInfo(this.mediaBuffer,o.PlaylistLevelType.AUDIO);b&&b.len>.5&&(c=!this.reduceMaxBufferLength(b.len)),c&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,n.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}}},g.onBufferFlushed=function(r,a){a.type===S.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},g._handleTransmuxComplete=function(r){var a,c="audio",b=this.hls,A=r.remuxResult,I=r.chunkMeta,x=this.getCurrentContext(I);if(!x)return this.warn("The loading context changed while buffering fragment "+I.sn+" of level "+I.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(I.level);var w=x.frag,O=x.part,F=A.audio,M=A.text,N=A.id3,B=A.initSegment;if(!this.fragContextChanged(w)){if(this.state=E.State.PARSING,this.audioSwitch&&F&&this.completeAudioSwitch(),B!=null&&B.tracks&&(this._bufferInitSegment(B.tracks,w,I),b.trigger(L.Events.FRAG_PARSING_INIT_SEGMENT,{frag:w,id:c,tracks:B.tracks})),F){var U=F.startPTS,G=F.endPTS,H=F.startDTS,z=F.endDTS;O&&(O.elementaryStreams[S.ElementaryStreamTypes.AUDIO]={startPTS:U,endPTS:G,startDTS:H,endDTS:z}),w.setElementaryStreamInfo(S.ElementaryStreamTypes.AUDIO,U,G,H,z),this.bufferFragmentData(F,w,O,I)}if(N!=null&&(a=N.samples)!==null&&a!==void 0&&a.length){var Y=e({frag:w,id:c},N);b.trigger(L.Events.FRAG_PARSING_METADATA,Y)}if(M){var W=e({frag:w,id:c},M);b.trigger(L.Events.FRAG_PARSING_USERDATA,W)}}},g._bufferInitSegment=function(r,a,c){if(this.state===E.State.PARSING){r.video&&delete r.video;var b=r.audio;if(b){b.levelCodec=b.codec,b.id="audio",this.log("Init audio buffer, container:"+b.container+", codecs[parsed]=["+b.codec+"]"),this.hls.trigger(L.Events.BUFFER_CODECS,r);var A=b.initSegment;if(A!=null&&A.byteLength){var I={type:"audio",frag:a,part:null,chunkMeta:c,parent:a.type,data:A};this.hls.trigger(L.Events.BUFFER_APPENDING,I)}this.tick()}}},g.loadFragment=function(r,a,c){var b=this.fragmentTracker.getState(r);this.fragCurrent=r,(this.audioSwitch||b===_.FragmentState.NOT_LOADED||b===_.FragmentState.PARTIAL)&&(r.sn==="initSegment"?this._loadInitSegment(r):a.live&&!Object(R.isFiniteNumber)(this.initPTS[r.cc])?(this.log("Waiting for video PTS in continuity counter "+r.cc+" of live stream before loading audio fragment "+r.sn+" of level "+this.trackId),this.state=E.State.WAITING_INIT_PTS):(this.startFragRequested=!0,n.prototype.loadFragment.call(this,r,a,c)))},g.completeAudioSwitch=function(){var r=this.hls,a=this.media,c=this.trackId;a&&(this.log("Switching audio track : flushing all audio"),n.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,r.trigger(L.Events.AUDIO_TRACK_SWITCHED,{id:c})},v}(E.default);C.default=l},"./src/controller/audio-track-controller.ts":function(P,C,f){f.r(C);var R=f("./src/events.ts"),E=f("./src/errors.ts"),L=f("./src/controller/base-playlist-controller.ts"),k=f("./src/types/loader.ts");function _(S,m){for(var h=0;h<m.length;h++){var T=m[h];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(S,T.key,T)}}function D(S,m){return(D=Object.setPrototypeOf||function(h,T){return h.__proto__=T,h})(S,m)}var o=function(S){var m,h;function T(i){var e;return(e=S.call(this,i,"[audio-track-controller]")||this).tracks=[],e.groupId=null,e.tracksInGroup=[],e.trackId=-1,e.trackName="",e.selectDefaultTrack=!0,e.registerListeners(),e}h=S,(m=T).prototype=Object.create(h.prototype),m.prototype.constructor=m,D(m,h);var y,d,t=T.prototype;return t.registerListeners=function(){var i=this.hls;i.on(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.on(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),i.on(R.Events.LEVEL_LOADING,this.onLevelLoading,this),i.on(R.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),i.on(R.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),i.on(R.Events.ERROR,this.onError,this)},t.unregisterListeners=function(){var i=this.hls;i.off(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.off(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),i.off(R.Events.LEVEL_LOADING,this.onLevelLoading,this),i.off(R.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),i.off(R.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),i.off(R.Events.ERROR,this.onError,this)},t.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,S.prototype.destroy.call(this)},t.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},t.onManifestParsed=function(i,e){this.tracks=e.audioTracks||[]},t.onAudioTrackLoaded=function(i,e){var s=e.id,l=e.details,n=this.tracksInGroup[s];if(n){var u=n.details;n.details=e.details,this.log("audioTrack "+s+" loaded ["+l.startSN+"-"+l.endSN+"]"),s===this.trackId&&(this.retryCount=0,this.playlistLoaded(s,e,u))}else this.warn("Invalid audio track id "+s)},t.onLevelLoading=function(i,e){this.switchLevel(e.level)},t.onLevelSwitching=function(i,e){this.switchLevel(e.level)},t.switchLevel=function(i){var e=this.hls.levels[i];if(e!=null&&e.audioGroupIds){var s=e.audioGroupIds[e.urlId];if(this.groupId!==s){this.groupId=s;var l=this.tracks.filter(function(u){return!s||u.groupId===s});this.selectDefaultTrack&&!l.some(function(u){return u.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=l;var n={audioTracks:l};this.log("Updating audio tracks, "+l.length+' track(s) found in "'+s+'" group-id'),this.hls.trigger(R.Events.AUDIO_TRACKS_UPDATED,n),this.selectInitialTrack()}}},t.onError=function(i,e){S.prototype.onError.call(this,i,e),!e.fatal&&e.context&&e.context.type===k.PlaylistContextType.AUDIO_TRACK&&e.context.id===this.trackId&&e.context.groupId===this.groupId&&this.retryLoadingOrFail(e)},t.setAudioTrack=function(i){var e=this.tracksInGroup;if(i<0||i>=e.length)this.warn("Invalid id passed to audio-track controller");else{this.clearTimer();var s=e[this.trackId];this.log("Now switching to audio-track index "+i);var l=e[i],n=l.id,u=l.groupId,p=u===void 0?"":u,v=l.name,g=l.type,r=l.url;if(this.trackId=i,this.trackName=v,this.selectDefaultTrack=!1,this.hls.trigger(R.Events.AUDIO_TRACK_SWITCHING,{id:n,groupId:p,name:v,type:g,url:r}),!l.details||l.details.live){var a=this.switchParams(l.url,s==null?void 0:s.details);this.loadPlaylist(a)}}},t.selectInitialTrack=function(){var i=this.tracksInGroup;console.assert(i.length,"Initial audio track should be selected when tracks are known");var e=this.trackName,s=this.findTrackId(e)||this.findTrackId();s!==-1?this.setAudioTrack(s):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(R.Events.ERROR,{type:E.ErrorTypes.MEDIA_ERROR,details:E.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},t.findTrackId=function(i){for(var e=this.tracksInGroup,s=0;s<e.length;s++){var l=e[s];if((!this.selectDefaultTrack||l.default)&&(!i||i===l.name))return l.id}return-1},t.loadPlaylist=function(i){var e=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(e)){var s=e.id,l=e.groupId,n=e.url;if(i)try{n=i.addDirectives(n)}catch(u){this.warn("Could not construct new URL with HLS Delivery Directives: "+u)}this.log("loading audio-track playlist for id: "+s),this.clearTimer(),this.hls.trigger(R.Events.AUDIO_TRACK_LOADING,{url:n,id:s,groupId:l,deliveryDirectives:i||null})}},y=T,(d=[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(i){this.selectDefaultTrack=!1,this.setAudioTrack(i)}}])&&_(y.prototype,d),T}(L.default);C.default=o},"./src/controller/base-playlist-controller.ts":function(P,C,f){f.r(C),f.d(C,"default",function(){return D});var R=f("./src/polyfills/number.ts"),E=f("./src/types/level.ts"),L=f("./src/controller/level-helper.ts"),k=f("./src/utils/logger.ts"),_=f("./src/errors.ts"),D=function(){function o(m,h){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=k.logger.log.bind(k.logger,h+":"),this.warn=k.logger.warn.bind(k.logger,h+":"),this.hls=m}var S=o.prototype;return S.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},S.onError=function(m,h){h.fatal&&h.type===_.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},S.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},S.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},S.stopLoad=function(){this.canLoad=!1,this.clearTimer()},S.switchParams=function(m,h){var T=h==null?void 0:h.renditionReports;if(T)for(var y=0;y<T.length;y++){var d=T[y],t=""+d.URI;if(t===m.substr(-t.length)){var i=parseInt(d["LAST-MSN"]),e=parseInt(d["LAST-PART"]);if(h&&this.hls.config.lowLatencyMode){var s=Math.min(h.age-h.partTarget,h.targetduration);e!==void 0&&s>h.partTarget&&(e+=1)}if(Object(R.isFiniteNumber)(i))return new E.HlsUrlParameters(i,Object(R.isFiniteNumber)(e)?e:void 0,E.HlsSkip.No)}}},S.loadPlaylist=function(m){},S.shouldLoadTrack=function(m){return this.canLoad&&m&&!!m.url&&(!m.details||m.details.live)},S.playlistLoaded=function(m,h,T){var y=this,d=h.details,t=h.stats,i=t.loading.end?Math.max(0,self.performance.now()-t.loading.end):0;if(d.advancedDateTime=Date.now()-i,d.live||T!=null&&T.live){if(d.reloaded(T),T&&this.log("live playlist "+m+" "+(d.advanced?"REFRESHED "+d.lastPartSn+"-"+d.lastPartIndex:"MISSED")),T&&d.fragments.length>0&&Object(L.mergeDetails)(T,d),!this.canLoad||!d.live)return;var e,s=void 0,l=void 0;if(d.canBlockReload&&d.endSN&&d.advanced){var n=this.hls.config.lowLatencyMode,u=d.lastPartSn,p=d.endSN,v=d.lastPartIndex,g=u===p;v!==-1?(s=g?p+1:u,l=g?n?0:v:v+1):s=p+1;var r=d.age,a=r+d.ageHeader,c=Math.min(a-d.partTarget,1.5*d.targetduration);if(c>0){if(T&&c>T.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+T.tuneInGoal+" to: "+c+" with playlist age: "+d.age),c=0;else{var b=Math.floor(c/d.targetduration);s+=b,l!==void 0&&(l+=Math.round(c%d.targetduration/d.partTarget)),this.log("CDN Tune-in age: "+d.ageHeader+"s last advanced "+r.toFixed(2)+"s goal: "+c+" skip sn "+b+" to part "+l)}d.tuneInGoal=c}if(e=this.getDeliveryDirectives(d,h.deliveryDirectives,s,l),n||!g)return void this.loadPlaylist(e)}else e=this.getDeliveryDirectives(d,h.deliveryDirectives,s,l);var A=Object(L.computeReloadInterval)(d,t);s!==void 0&&d.canBlockReload&&(A-=d.partTarget||1),this.log("reload live playlist "+m+" in "+Math.round(A)+" ms"),this.timer=self.setTimeout(function(){return y.loadPlaylist(e)},A)}else this.clearTimer()},S.getDeliveryDirectives=function(m,h,T,y){var d=Object(E.getSkipValue)(m,T);return h!=null&&h.skip&&m.deltaUpdateFailed&&(T=h.msn,y=h.part,d=E.HlsSkip.No),new E.HlsUrlParameters(T,y,d)},S.retryLoadingOrFail=function(m){var h,T=this,y=this.hls.config,d=this.retryCount<y.levelLoadingMaxRetry;if(d)if(this.retryCount++,m.details.indexOf("LoadTimeOut")>-1&&(h=m.context)!==null&&h!==void 0&&h.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+m.details+'"'),this.loadPlaylist();else{var t=Math.min(Math.pow(2,this.retryCount)*y.levelLoadingRetryDelay,y.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return T.loadPlaylist()},t),this.warn("retry playlist loading #"+this.retryCount+" in "+t+' ms after "'+m.details+'"')}else this.warn('cannot recover from error "'+m.details+'"'),this.clearTimer(),m.fatal=!0;return d},o}()},"./src/controller/base-stream-controller.ts":function(P,C,f){f.r(C),f.d(C,"State",function(){return n}),f.d(C,"default",function(){return u});var R=f("./src/polyfills/number.ts"),E=f("./src/task-loop.ts"),L=f("./src/controller/fragment-tracker.ts"),k=f("./src/utils/buffer-helper.ts"),_=f("./src/utils/logger.ts"),D=f("./src/events.ts"),o=f("./src/errors.ts"),S=f("./src/types/transmuxer.ts"),m=f("./src/utils/mp4-tools.ts"),h=f("./src/utils/discontinuities.ts"),T=f("./src/controller/fragment-finders.ts"),y=f("./src/controller/level-helper.ts"),d=f("./src/loader/fragment-loader.ts"),t=f("./src/crypt/decrypter.ts"),i=f("./src/utils/time-ranges.ts"),e=f("./src/types/loader.ts");function s(p,v){for(var g=0;g<v.length;g++){var r=v[g];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(p,r.key,r)}}function l(p,v){return(l=Object.setPrototypeOf||function(g,r){return g.__proto__=r,g})(p,v)}var n={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BACKTRACKING:"BACKTRACKING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},u=function(p){var v,g;function r(A,I,x){var w;return(w=p.call(this)||this).hls=void 0,w.fragPrevious=null,w.fragCurrent=null,w.fragmentTracker=void 0,w.transmuxer=null,w._state=n.STOPPED,w.media=void 0,w.mediaBuffer=void 0,w.config=void 0,w.bitrateTest=!1,w.lastCurrentTime=0,w.nextLoadPosition=0,w.startPosition=0,w.loadedmetadata=!1,w.fragLoadError=0,w.retryDate=0,w.levels=null,w.fragmentLoader=void 0,w.levelLastLoaded=null,w.startFragRequested=!1,w.decrypter=void 0,w.initPTS=[],w.onvseeking=null,w.onvended=null,w.logPrefix="",w.log=void 0,w.warn=void 0,w.logPrefix=x,w.log=_.logger.log.bind(_.logger,x+":"),w.warn=_.logger.warn.bind(_.logger,x+":"),w.hls=A,w.fragmentLoader=new d.default(A.config),w.fragmentTracker=I,w.config=A.config,w.decrypter=new t.default(A,A.config),A.on(D.Events.KEY_LOADED,w.onKeyLoaded,function(O){if(O===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return O}(w)),w}g=p,(v=r).prototype=Object.create(g.prototype),v.prototype.constructor=v,l(v,g);var a,c,b=r.prototype;return b.doTick=function(){this.onTickEnd()},b.onTickEnd=function(){},b.startLoad=function(A){},b.stopLoad=function(){this.fragmentLoader.abort();var A=this.fragCurrent;A&&this.fragmentTracker.removeFragment(A),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=n.STOPPED},b._streamEnded=function(A,I){var x=this.fragCurrent,w=this.fragmentTracker;if(!I.live&&x&&x.sn===I.endSN&&!A.nextStart){var O=w.getState(x);return O===L.FragmentState.PARTIAL||O===L.FragmentState.OK}return!1},b.onMediaAttached=function(A,I){var x=this.media=this.mediaBuffer=I.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),x.addEventListener("seeking",this.onvseeking),x.addEventListener("ended",this.onvended);var w=this.config;this.levels&&w.autoStartLoad&&this.state===n.STOPPED&&this.startLoad(w.startPosition)},b.onMediaDetaching=function(){var A=this.media;A!=null&&A.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),A&&(A.removeEventListener("seeking",this.onvseeking),A.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},b.onMediaSeeking=function(){var A=this.config,I=this.fragCurrent,x=this.media,w=this.mediaBuffer,O=this.state,F=x?x.currentTime:0,M=k.BufferHelper.bufferInfo(w||x,F,A.maxBufferHole);if(this.log("media seeking to "+(Object(R.isFiniteNumber)(F)?F.toFixed(3):F)+", state: "+O),O===n.ENDED)this.resetLoadingState();else if(I&&!M.len){var N=A.maxFragLookUpTolerance,B=I.start-N,U=F>I.start+I.duration+N;(F<B||U)&&(U&&I.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),I.loader.abort()),this.resetLoadingState())}x&&(this.lastCurrentTime=F),this.loadedmetadata||M.len||(this.nextLoadPosition=this.startPosition=F),this.tickImmediate()},b.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},b.onKeyLoaded=function(A,I){if(this.state===n.KEY_LOADING&&I.frag===this.fragCurrent&&this.levels){this.state=n.IDLE;var x=this.levels[I.frag.level].details;x&&this.loadFragment(I.frag,x,I.frag.start)}},b.onHandlerDestroying=function(){this.stopLoad(),p.prototype.onHandlerDestroying.call(this)},b.onHandlerDestroyed=function(){this.state=n.STOPPED,this.hls.off(D.Events.KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,p.prototype.onHandlerDestroyed.call(this)},b.loadKey=function(A,I){this.log("Loading key for "+A.sn+" of ["+I.startSN+"-"+I.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+A.level),this.state=n.KEY_LOADING,this.fragCurrent=A,this.hls.trigger(D.Events.KEY_LOADING,{frag:A})},b.loadFragment=function(A,I,x){this._loadFragForPlayback(A,I,x)},b._loadFragForPlayback=function(A,I,x){var w=this;this._doFragLoad(A,I,x,function(O){if(w.fragContextChanged(A))return w.warn("Fragment "+A.sn+(O.part?" p: "+O.part.index:"")+" of level "+A.level+" was dropped during download."),void w.fragmentTracker.removeFragment(A);A.stats.chunkCount++,w._handleFragmentLoadProgress(O)}).then(function(O){if(O){w.fragLoadError=0;var F=w.state;if(!w.fragContextChanged(A))return"payload"in O&&(w.log("Loaded fragment "+A.sn+" of level "+A.level),w.hls.trigger(D.Events.FRAG_LOADED,O),w.state===n.BACKTRACKING)?(w.fragmentTracker.backtrack(A,O),void w.resetFragmentLoading(A)):void w._handleFragmentLoadComplete(O);(F===n.FRAG_LOADING||F===n.BACKTRACKING||!w.fragCurrent&&F===n.PARSING)&&(w.fragmentTracker.removeFragment(A),w.state=n.IDLE)}}).catch(function(O){w.warn(O),w.resetFragmentLoading(A)})},b.flushMainBuffer=function(A,I,x){if(x===void 0&&(x=null),A-I){var w={startOffset:A,endOffset:I,type:x};this.fragLoadError=0,this.hls.trigger(D.Events.BUFFER_FLUSHING,w)}},b._loadInitSegment=function(A){var I=this;this._doFragLoad(A).then(function(x){if(!x||I.fragContextChanged(A)||!I.levels)throw new Error("init load aborted");return x}).then(function(x){var w=I.hls,O=x.payload,F=A.decryptdata;if(O&&O.byteLength>0&&F&&F.key&&F.iv&&F.method==="AES-128"){var M=self.performance.now();return I.decrypter.webCryptoDecrypt(new Uint8Array(O),F.key.buffer,F.iv.buffer).then(function(N){var B=self.performance.now();return w.trigger(D.Events.FRAG_DECRYPTED,{frag:A,payload:N,stats:{tstart:M,tdecrypt:B}}),x.payload=N,x})}return x}).then(function(x){var w=I.fragCurrent,O=I.hls,F=I.levels;if(!F)throw new Error("init load aborted, missing levels");var M=F[A.level].details;console.assert(M,"Level details are defined when init segment is loaded");var N=A.stats;I.state=n.IDLE,I.fragLoadError=0,A.data=new Uint8Array(x.payload),N.parsing.start=N.buffering.start=self.performance.now(),N.parsing.end=N.buffering.end=self.performance.now(),x.frag===w&&O.trigger(D.Events.FRAG_BUFFERED,{stats:N,frag:w,part:null,id:A.type}),I.tick()}).catch(function(x){I.warn(x),I.resetFragmentLoading(A)})},b.fragContextChanged=function(A){var I=this.fragCurrent;return!A||!I||A.level!==I.level||A.sn!==I.sn||A.urlId!==I.urlId},b.fragBufferedComplete=function(A,I){var x=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+A.type+" sn: "+A.sn+(I?" part: "+I.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+A.level+" "+i.default.toString(k.BufferHelper.getBuffered(x))),this.state=n.IDLE,this.tick()},b._handleFragmentLoadComplete=function(A){var I=this.transmuxer;if(I){var x=A.frag,w=A.part,O=A.partsLoaded,F=!O||O.length===0||O.some(function(N){return!N}),M=new S.ChunkMetadata(x.level,x.sn,x.stats.chunkCount+1,0,w?w.index:-1,!F);I.flush(M)}},b._handleFragmentLoadProgress=function(A){},b._doFragLoad=function(A,I,x,w){var O=this;if(x===void 0&&(x=null),!this.levels)throw new Error("frag load aborted, missing levels");if(x=Math.max(A.start,x||0),this.config.lowLatencyMode&&I){var F=I.partList;if(F&&w){x>A.end&&I.fragmentHint&&(A=I.fragmentHint);var M=this.getNextPart(F,A,x);if(M>-1){var N=F[M];return this.log("Loading part sn: "+A.sn+" p: "+N.index+" cc: "+A.cc+" of playlist ["+I.startSN+"-"+I.endSN+"] parts [0-"+M+"-"+(F.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+A.level+", target: "+parseFloat(x.toFixed(3))),this.nextLoadPosition=N.start+N.duration,this.state=n.FRAG_LOADING,this.hls.trigger(D.Events.FRAG_LOADING,{frag:A,part:F[M],targetBufferTime:x}),this.doFragPartsLoad(A,F,M,w).catch(function(B){return O.handleFragLoadError(B)})}if(!A.url||this.loadedEndOfParts(F,x))return Promise.resolve(null)}}return this.log("Loading fragment "+A.sn+" cc: "+A.cc+" "+(I?"of ["+I.startSN+"-"+I.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+A.level+", target: "+parseFloat(x.toFixed(3))),Object(R.isFiniteNumber)(A.sn)&&!this.bitrateTest&&(this.nextLoadPosition=A.start+A.duration),this.state=n.FRAG_LOADING,this.hls.trigger(D.Events.FRAG_LOADING,{frag:A,targetBufferTime:x}),this.fragmentLoader.load(A,w).catch(function(B){return O.handleFragLoadError(B)})},b.doFragPartsLoad=function(A,I,x,w){var O=this;return new Promise(function(F,M){var N=[];(function B(U){var G=I[U];O.fragmentLoader.loadPart(A,G,w).then(function(H){N[G.index]=H;var z=H.part;O.hls.trigger(D.Events.FRAG_LOADED,H);var Y=I[U+1];if(!Y||Y.fragment!==A)return F({frag:A,part:z,partsLoaded:N});B(U+1)}).catch(M)})(x)})},b.handleFragLoadError=function(A){var I=A.data;return I&&I.details===o.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(I.frag,I.part):this.hls.trigger(D.Events.ERROR,I),null},b._handleTransmuxerFlush=function(A){var I=this.getCurrentContext(A);if(I&&this.state===n.PARSING){var x=I.frag,w=I.part,O=I.level,F=self.performance.now();x.stats.parsing.end=F,w&&(w.stats.parsing.end=F),this.updateLevelTiming(x,w,O,A.partial)}else this.fragCurrent||(this.state=n.IDLE)},b.getCurrentContext=function(A){var I=this.levels,x=A.level,w=A.sn,O=A.part;if(!I||!I[x])return this.warn("Levels object was unset while buffering fragment "+w+" of level "+x+". The current chunk will not be buffered."),null;var F=I[x],M=O>-1?Object(y.getPartWith)(F,w,O):null,N=M?M.fragment:Object(y.getFragmentWithSN)(F,w,this.fragCurrent);return N?{frag:N,part:M,level:F}:null},b.bufferFragmentData=function(A,I,x,w){if(A&&this.state===n.PARSING){var O=A.data1,F=A.data2,M=O;if(O&&F&&(M=Object(m.appendUint8Array)(O,F)),M&&M.length){var N={type:A.type,frag:I,part:x,chunkMeta:w,parent:I.type,data:M};this.hls.trigger(D.Events.BUFFER_APPENDING,N),A.dropped&&A.independent&&!x&&this.flushBufferGap(I)}}},b.flushBufferGap=function(A){var I=this.media;if(I)if(k.BufferHelper.isBuffered(I,I.currentTime)){var x=I.currentTime,w=k.BufferHelper.bufferInfo(I,x,0),O=A.duration,F=Math.min(2*this.config.maxFragLookUpTolerance,.25*O),M=Math.max(Math.min(A.start-F,w.end-F),x+F);A.start-M>F&&this.flushMainBuffer(M,A.start)}else this.flushMainBuffer(0,A.start)},b.getFwdBufferInfo=function(A,I){var x=this.config,w=this.getLoadPosition();if(!Object(R.isFiniteNumber)(w))return null;var O=k.BufferHelper.bufferInfo(A,w,x.maxBufferHole);if(O.len===0&&O.nextStart!==void 0){var F=this.fragmentTracker.getBufferedFrag(w,I);if(F&&O.nextStart<F.end)return k.BufferHelper.bufferInfo(A,w,Math.max(O.nextStart,x.maxBufferHole))}return O},b.getMaxBufferLength=function(A){var I,x=this.config;return I=A?Math.max(8*x.maxBufferSize/A,x.maxBufferLength):x.maxBufferLength,Math.min(I,x.maxMaxBufferLength)},b.reduceMaxBufferLength=function(A){var I=this.config,x=A||I.maxBufferLength;return I.maxMaxBufferLength>=x&&(I.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+I.maxMaxBufferLength+"s"),!0)},b.getNextFragment=function(A,I){var x,w,O=I.fragments,F=O.length;if(!F)return null;var M,N=this.config,B=O[0].start;if(I.live){var U=N.initialLiveManifestSize;if(F<U)return this.warn("Not enough fragments to start playback (have: "+F+", need: "+U+")"),null;I.PTSKnown||this.startFragRequested||this.startPosition!==-1||(M=this.getInitialLiveFragment(I,O),this.startPosition=M?this.hls.liveSyncPosition||M.start:A)}else A<=B&&(M=O[0]);if(!M){var G=N.lowLatencyMode?I.partEnd:I.fragmentEnd;M=this.getFragmentAtPosition(A,G,I)}return(x=M)===null||x===void 0||!x.initSegment||(w=M)!==null&&w!==void 0&&w.initSegment.data||this.bitrateTest||(M=M.initSegment),M},b.getNextPart=function(A,I,x){for(var w=-1,O=!1,F=!0,M=0,N=A.length;M<N;M++){var B=A[M];if(F=F&&!B.independent,w>-1&&x<B.start)break;var U=B.loaded;!U&&(O||B.independent||F)&&B.fragment===I&&(w=M),O=U}return w},b.loadedEndOfParts=function(A,I){var x=A[A.length-1];return x&&I>x.start&&x.loaded},b.getInitialLiveFragment=function(A,I){var x=this.fragPrevious,w=null;if(x){if(A.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+x.programDateTime),w=Object(T.findFragmentByPDT)(I,x.endProgramDateTime,this.config.maxFragLookUpTolerance)),!w){var O=x.sn+1;if(O>=A.startSN&&O<=A.endSN){var F=I[O-A.startSN];x.cc===F.cc&&(w=F,this.log("Live playlist, switching playlist, load frag with next SN: "+w.sn))}w||(w=Object(T.findFragWithCC)(I,x.cc))&&this.log("Live playlist, switching playlist, load frag with same CC: "+w.sn)}}else{var M=this.hls.liveSyncPosition;M!==null&&(w=this.getFragmentAtPosition(M,this.bitrateTest?A.fragmentEnd:A.edge,A))}return w},b.getFragmentAtPosition=function(A,I,x){var w,O=this.config,F=this.fragPrevious,M=x.fragments,N=x.endSN,B=x.fragmentHint,U=O.maxFragLookUpTolerance,G=!!(O.lowLatencyMode&&x.partList&&B);if(G&&B&&!this.bitrateTest&&(M=M.concat(B),N=B.sn),A<I){var H=A>I-U?0:U;w=Object(T.findFragmentByPTS)(F,M,A,H)}else w=M[M.length-1];if(w){var z=w.sn-x.startSN,Y=F&&w.level===F.level,W=M[z+1];if(this.fragmentTracker.getState(w)===L.FragmentState.BACKTRACKED){w=null;for(var $=z;M[$]&&this.fragmentTracker.getState(M[$])===L.FragmentState.BACKTRACKED;)w=F?M[$--]:M[--$];w||(w=W)}else F&&w.sn===F.sn&&!G&&Y&&(w.sn<N&&this.fragmentTracker.getState(W)!==L.FragmentState.OK?(this.log("SN "+w.sn+" just loaded, load next one: "+W.sn),w=W):w=null)}return w},b.synchronizeToLiveEdge=function(A){var I=this.config,x=this.media;if(x){var w=this.hls.liveSyncPosition,O=x.currentTime,F=A.fragments[0].start,M=A.edge,N=O>=F-I.maxFragLookUpTolerance&&O<=M;if(w!==null&&x.duration>w&&(O<w||!N)){var B=I.liveMaxLatencyDuration!==void 0?I.liveMaxLatencyDuration:I.liveMaxLatencyDurationCount*A.targetduration;(!N&&x.readyState<4||O<M-B)&&(this.loadedmetadata||(this.nextLoadPosition=w),x.readyState&&(this.warn("Playback: "+O.toFixed(3)+" is located too far from the end of live sliding playlist: "+M+", reset currentTime to : "+w.toFixed(3)),x.currentTime=w))}}},b.alignPlaylists=function(A,I){var x=this.levels,w=this.levelLastLoaded,O=this.fragPrevious,F=w!==null?x[w]:null,M=A.fragments.length;if(!M)return this.warn("No fragments in live playlist"),0;var N=A.fragments[0].start,B=!I,U=A.alignedSliding&&Object(R.isFiniteNumber)(N);if(B||!U&&!N){Object(h.alignStream)(O,F,A);var G=A.fragments[0].start;return this.log("Live playlist sliding: "+G.toFixed(2)+" start-sn: "+(I?I.startSN:"na")+"->"+A.startSN+" prev-sn: "+(O?O.sn:"na")+" fragments: "+M),G}return N},b.waitForCdnTuneIn=function(A){return A.live&&A.canBlockReload&&A.tuneInGoal>Math.max(A.partHoldBack,3*A.partTarget)},b.setStartPosition=function(A,I){var x=this.startPosition;if(x<I&&(x=-1),x===-1||this.lastCurrentTime===-1){var w=A.startTimeOffset;Object(R.isFiniteNumber)(w)?(x=I+w,w<0&&(x+=A.totalduration),x=Math.min(Math.max(I,x),I+A.totalduration),this.log("Start time offset "+w+" found in playlist, adjust startPosition to "+x),this.startPosition=x):A.live?x=this.hls.liveSyncPosition||I:this.startPosition=x=0,this.lastCurrentTime=x}this.nextLoadPosition=x},b.getLoadPosition=function(){var A=this.media,I=0;return this.loadedmetadata&&A?I=A.currentTime:this.nextLoadPosition&&(I=this.nextLoadPosition),I},b.handleFragLoadAborted=function(A,I){this.transmuxer&&A.sn!=="initSegment"&&A.stats.aborted&&(this.warn("Fragment "+A.sn+(I?" part"+I.index:"")+" of level "+A.level+" was aborted"),this.resetFragmentLoading(A))},b.resetFragmentLoading=function(A){this.fragCurrent&&this.fragContextChanged(A)||(this.state=n.IDLE)},b.onFragmentOrKeyLoadError=function(A,I){if(!I.fatal){var x=I.frag;if(x&&x.type===A){var w=this.fragCurrent;console.assert(w&&x.sn===w.sn&&x.level===w.level&&x.urlId===w.urlId,"Frag load error must match current frag to retry");var O=this.config;if(this.fragLoadError+1<=O.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded(x.level))return;var F=Math.min(Math.pow(2,this.fragLoadError)*O.fragLoadingRetryDelay,O.fragLoadingMaxRetryTimeout);this.warn("Fragment "+x.sn+" of "+A+" "+x.level+" failed to load, retrying in "+F+"ms"),this.retryDate=self.performance.now()+F,this.fragLoadError++,this.state=n.FRAG_LOADING_WAITING_RETRY}else I.levelRetry?(A===e.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=n.IDLE):(_.logger.error(I.details+" reaches max retry, redispatch as fatal ..."),I.fatal=!0,this.hls.stopLoad(),this.state=n.ERROR)}}},b.afterBufferFlushed=function(A,I,x){if(A){var w=k.BufferHelper.getBuffered(A);this.fragmentTracker.detectEvictedFragments(I,w,x),this.state===n.ENDED&&this.resetLoadingState()}},b.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=n.IDLE},b.resetLiveStartWhenNotLoaded=function(A){if(!this.loadedmetadata){this.startFragRequested=!1;var I=this.levels?this.levels[A].details:null;if(I!=null&&I.live)return this.startPosition=-1,this.setStartPosition(I,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},b.updateLevelTiming=function(A,I,x,w){var O=this,F=x.details;console.assert(!!F,"level.details must be defined"),Object.keys(A.elementaryStreams).reduce(function(M,N){var B=A.elementaryStreams[N];if(B){var U=B.endPTS-B.startPTS;if(U<=0)return O.warn("Could not parse fragment "+A.sn+" "+N+" duration reliably ("+U+") resetting transmuxer to fallback to playlist timing"),O.resetTransmuxer(),M||!1;var G=w?0:Object(y.updateFragPTSDTS)(F,A,B.startPTS,B.endPTS,B.startDTS,B.endDTS);return O.hls.trigger(D.Events.LEVEL_PTS_UPDATED,{details:F,level:x,drift:G,type:N,frag:A,start:B.startPTS,end:B.endPTS}),!0}return M},!1)?(this.state=n.PARSED,this.hls.trigger(D.Events.FRAG_PARSED,{frag:A,part:I})):this.resetLoadingState()},b.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},a=r,(c=[{key:"state",get:function(){return this._state},set:function(A){var I=this._state;I!==A&&(this._state=A,this.log(I+"->"+A))}}])&&s(a.prototype,c),r}(E.default)},"./src/controller/buffer-controller.ts":function(P,C,f){f.r(C),f.d(C,"default",function(){return T});var R=f("./src/polyfills/number.ts"),E=f("./src/events.ts"),L=f("./src/utils/logger.ts"),k=f("./src/errors.ts"),_=f("./src/utils/buffer-helper.ts"),D=f("./src/utils/mediasource-helper.ts"),o=f("./src/loader/fragment.ts"),S=f("./src/controller/buffer-operation-queue.ts"),m=Object(D.getMediaSource)(),h=/([ha]vc.)(?:\.[^.,]+)+/,T=function(){function y(t){var i=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var e=i.hls,s=i.media,l=i.mediaSource;L.logger.log("[buffer-controller]: Media source opened"),s&&(i.updateMediaElementDuration(),e.trigger(E.Events.MEDIA_ATTACHED,{media:s})),l&&l.removeEventListener("sourceopen",i._onMediaSourceOpen),i.checkPendingTracks()},this._onMediaSourceClose=function(){L.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){L.logger.log("[buffer-controller]: Media source ended")},this.hls=t,this._initSourceBuffer(),this.registerListeners()}var d=y.prototype;return d.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},d.destroy=function(){this.unregisterListeners(),this.details=null},d.registerListeners=function(){var t=this.hls;t.on(E.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(E.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(E.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(E.Events.BUFFER_RESET,this.onBufferReset,this),t.on(E.Events.BUFFER_APPENDING,this.onBufferAppending,this),t.on(E.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.on(E.Events.BUFFER_EOS,this.onBufferEos,this),t.on(E.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(E.Events.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(E.Events.FRAG_PARSED,this.onFragParsed,this),t.on(E.Events.FRAG_CHANGED,this.onFragChanged,this)},d.unregisterListeners=function(){var t=this.hls;t.off(E.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(E.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(E.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(E.Events.BUFFER_RESET,this.onBufferReset,this),t.off(E.Events.BUFFER_APPENDING,this.onBufferAppending,this),t.off(E.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.off(E.Events.BUFFER_EOS,this.onBufferEos,this),t.off(E.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(E.Events.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(E.Events.FRAG_PARSED,this.onFragParsed,this),t.off(E.Events.FRAG_CHANGED,this.onFragChanged,this)},d._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new S.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},d.onManifestParsed=function(t,i){var e=2;(i.audio&&!i.video||!i.altAudio)&&(e=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=e,this.details=null,L.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},d.onMediaAttaching=function(t,i){var e=this.media=i.media;if(e&&m){var s=this.mediaSource=new m;s.addEventListener("sourceopen",this._onMediaSourceOpen),s.addEventListener("sourceended",this._onMediaSourceEnded),s.addEventListener("sourceclose",this._onMediaSourceClose),e.src=self.URL.createObjectURL(s),this._objectUrl=e.src}},d.onMediaDetaching=function(){var t=this.media,i=this.mediaSource,e=this._objectUrl;if(i){if(L.logger.log("[buffer-controller]: media source detaching"),i.readyState==="open")try{i.endOfStream()}catch(s){L.logger.warn("[buffer-controller]: onMediaDetaching: "+s.message+" while calling endOfStream")}this.onBufferReset(),i.removeEventListener("sourceopen",this._onMediaSourceOpen),i.removeEventListener("sourceended",this._onMediaSourceEnded),i.removeEventListener("sourceclose",this._onMediaSourceClose),t&&(e&&self.URL.revokeObjectURL(e),t.src===e?(t.removeAttribute("src"),t.load()):L.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(E.Events.MEDIA_DETACHED,void 0)},d.onBufferReset=function(){var t=this;this.getSourceBufferTypes().forEach(function(i){var e=t.sourceBuffer[i];try{e&&(t.removeBufferListeners(i),t.mediaSource&&t.mediaSource.removeSourceBuffer(e),t.sourceBuffer[i]=void 0)}catch(s){L.logger.warn("[buffer-controller]: Failed to reset the "+i+" buffer",s)}}),this._initSourceBuffer()},d.onBufferCodecs=function(t,i){var e=this,s=this.getSourceBufferTypes().length;Object.keys(i).forEach(function(l){if(s){var n=e.tracks[l];if(n&&typeof n.buffer.changeType=="function"){var u=i[l],p=u.codec,v=u.levelCodec,g=u.container;if((n.levelCodec||n.codec).replace(h,"$1")!==(v||p).replace(h,"$1")){var r=g+";codecs="+(v||p);e.appendChangeType(l,r)}}}else e.pendingTracks[l]=i[l]}),s||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},d.appendChangeType=function(t,i){var e=this,s=this.operationQueue,l={execute:function(){var n=e.sourceBuffer[t];n&&(L.logger.log("[buffer-controller]: changing "+t+" sourceBuffer type to "+i),n.changeType(i)),s.shiftAndExecuteNext(t)},onStart:function(){},onComplete:function(){},onError:function(n){L.logger.warn("[buffer-controller]: Failed to change "+t+" SourceBuffer type",n)}};s.append(l,t)},d.onBufferAppending=function(t,i){var e=this,s=this.hls,l=this.operationQueue,n=this.tracks,u=i.data,p=i.type,v=i.frag,g=i.part,r=i.chunkMeta,a=r.buffering[p],c=self.performance.now();a.start=c;var b=v.stats.buffering,A=g?g.stats.buffering:null;b.start===0&&(b.start=c),A&&A.start===0&&(A.start=c);var I=n.audio,x=p==="audio"&&r.id===1&&(I==null?void 0:I.container)==="audio/mpeg",w={execute:function(){if(a.executeStart=self.performance.now(),x){var O=e.sourceBuffer[p];if(O){var F=v.start-O.timestampOffset;Math.abs(F)>=.1&&(L.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+v.start+" (delta: "+F+") sn: "+v.sn+")"),O.timestampOffset=v.start)}}e.appendExecutor(u,p)},onStart:function(){},onComplete:function(){var O=self.performance.now();a.executeEnd=a.end=O,b.first===0&&(b.first=O),A&&A.first===0&&(A.first=O);var F=e.sourceBuffer,M={};for(var N in F)M[N]=_.BufferHelper.getBuffered(F[N]);e.appendError=0,e.hls.trigger(E.Events.BUFFER_APPENDED,{type:p,frag:v,part:g,chunkMeta:r,parent:v.type,timeRanges:M})},onError:function(O){L.logger.error("[buffer-controller]: Error encountered while trying to append to the "+p+" SourceBuffer",O);var F={type:k.ErrorTypes.MEDIA_ERROR,parent:v.type,details:k.ErrorDetails.BUFFER_APPEND_ERROR,err:O,fatal:!1};O.code===DOMException.QUOTA_EXCEEDED_ERR?F.details=k.ErrorDetails.BUFFER_FULL_ERROR:(e.appendError++,F.details=k.ErrorDetails.BUFFER_APPEND_ERROR,e.appendError>s.config.appendErrorMaxRetry&&(L.logger.error("[buffer-controller]: Failed "+s.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),F.fatal=!0)),s.trigger(E.Events.ERROR,F)}};l.append(w,p)},d.onBufferFlushing=function(t,i){var e=this,s=this.operationQueue,l=function(n){return{execute:e.removeExecutor.bind(e,n,i.startOffset,i.endOffset),onStart:function(){},onComplete:function(){e.hls.trigger(E.Events.BUFFER_FLUSHED,{type:n})},onError:function(u){L.logger.warn("[buffer-controller]: Failed to remove from "+n+" SourceBuffer",u)}}};i.type?s.append(l(i.type),i.type):this.getSourceBufferTypes().forEach(function(n){s.append(l(n),n)})},d.onFragParsed=function(t,i){var e=this,s=i.frag,l=i.part,n=[],u=l?l.elementaryStreams:s.elementaryStreams;u[o.ElementaryStreamTypes.AUDIOVIDEO]?n.push("audiovideo"):(u[o.ElementaryStreamTypes.AUDIO]&&n.push("audio"),u[o.ElementaryStreamTypes.VIDEO]&&n.push("video")),n.length===0&&L.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+s.type+" level: "+s.level+" sn: "+s.sn),this.blockBuffers(function(){var p=self.performance.now();s.stats.buffering.end=p,l&&(l.stats.buffering.end=p);var v=l?l.stats:s.stats;e.hls.trigger(E.Events.FRAG_BUFFERED,{frag:s,part:l,stats:v,id:s.type})},n)},d.onFragChanged=function(t,i){this.flushBackBuffer()},d.onBufferEos=function(t,i){var e=this;this.getSourceBufferTypes().reduce(function(s,l){var n=e.sourceBuffer[l];return i.type&&i.type!==l||n&&!n.ended&&(n.ended=!0,L.logger.log("[buffer-controller]: "+l+" sourceBuffer now EOS")),s&&!(n&&!n.ended)},!0)&&this.blockBuffers(function(){var s=e.mediaSource;s&&s.readyState==="open"&&s.endOfStream()})},d.onLevelUpdated=function(t,i){var e=i.details;e.fragments.length&&(this.details=e,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},d.flushBackBuffer=function(){var t=this.hls,i=this.details,e=this.media,s=this.sourceBuffer;if(e&&i!==null){var l=this.getSourceBufferTypes();if(l.length){var n=i.live&&t.config.liveBackBufferLength!==null?t.config.liveBackBufferLength:t.config.backBufferLength;if(Object(R.isFiniteNumber)(n)&&!(n<0)){var u=e.currentTime,p=i.levelTargetDuration,v=Math.max(n,p),g=Math.floor(u/p)*p-v;l.forEach(function(r){var a=s[r];if(a){var c=_.BufferHelper.getBuffered(a);c.length>0&&g>c.start(0)&&(t.trigger(E.Events.BACK_BUFFER_REACHED,{bufferEnd:g}),i.live&&t.trigger(E.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:g}),t.trigger(E.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:g,type:r}))}})}}}},d.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&this.mediaSource.readyState==="open"){var t=this.details,i=this.hls,e=this.media,s=this.mediaSource,l=t.fragments[0].start+t.totalduration,n=e.duration,u=Object(R.isFiniteNumber)(s.duration)?s.duration:0;t.live&&i.config.liveDurationInfinity?(L.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),s.duration=1/0,this.updateSeekableRange(t)):(l>u&&l>n||!Object(R.isFiniteNumber)(n))&&(L.logger.log("[buffer-controller]: Updating Media Source duration to "+l.toFixed(3)),s.duration=l)}},d.updateSeekableRange=function(t){var i=this.mediaSource,e=t.fragments;if(e.length&&t.live&&i!=null&&i.setLiveSeekableRange){var s=Math.max(0,e[0].start),l=Math.max(s,s+t.totalduration);i.setLiveSeekableRange(s,l)}},d.checkPendingTracks=function(){var t=this.bufferCodecEventsExpected,i=this.operationQueue,e=this.pendingTracks,s=Object.keys(e).length;if(s&&!t||s===2){this.createSourceBuffers(e),this.pendingTracks={};var l=this.getSourceBufferTypes();if(l.length===0)return void this.hls.trigger(E.Events.ERROR,{type:k.ErrorTypes.MEDIA_ERROR,details:k.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});l.forEach(function(n){i.executeNext(n)})}},d.createSourceBuffers=function(t){var i=this.sourceBuffer,e=this.mediaSource;if(!e)throw Error("createSourceBuffers called when mediaSource was null");var s=0;for(var l in t)if(!i[l]){var n=t[l];if(!n)throw Error("source buffer exists for track "+l+", however track does not");var u=n.levelCodec||n.codec,p=n.container+";codecs="+u;L.logger.log("[buffer-controller]: creating sourceBuffer("+p+")");try{var v=i[l]=e.addSourceBuffer(p),g=l;this.addBufferListener(g,"updatestart",this._onSBUpdateStart),this.addBufferListener(g,"updateend",this._onSBUpdateEnd),this.addBufferListener(g,"error",this._onSBUpdateError),this.tracks[l]={buffer:v,codec:u,container:n.container,levelCodec:n.levelCodec,id:n.id},s++}catch(r){L.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+r.message),this.hls.trigger(E.Events.ERROR,{type:k.ErrorTypes.MEDIA_ERROR,details:k.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:r,mimeType:p})}}s&&this.hls.trigger(E.Events.BUFFER_CREATED,{tracks:this.tracks})},d._onSBUpdateStart=function(t){this.operationQueue.current(t).onStart()},d._onSBUpdateEnd=function(t){var i=this.operationQueue;i.current(t).onComplete(),i.shiftAndExecuteNext(t)},d._onSBUpdateError=function(t,i){L.logger.error("[buffer-controller]: "+t+" SourceBuffer error",i),this.hls.trigger(E.Events.ERROR,{type:k.ErrorTypes.MEDIA_ERROR,details:k.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var e=this.operationQueue.current(t);e&&e.onError(i)},d.removeExecutor=function(t,i,e){var s=this.media,l=this.mediaSource,n=this.operationQueue,u=this.sourceBuffer[t];if(!s||!l||!u)return L.logger.warn("[buffer-controller]: Attempting to remove from the "+t+" SourceBuffer, but it does not exist"),void n.shiftAndExecuteNext(t);var p=Object(R.isFiniteNumber)(s.duration)?s.duration:1/0,v=Object(R.isFiniteNumber)(l.duration)?l.duration:1/0,g=Math.max(0,i),r=Math.min(e,p,v);r>g?(L.logger.log("[buffer-controller]: Removing ["+g+","+r+"] from the "+t+" SourceBuffer"),console.assert(!u.updating,t+" sourceBuffer must not be updating"),u.remove(g,r)):n.shiftAndExecuteNext(t)},d.appendExecutor=function(t,i){var e=this.operationQueue,s=this.sourceBuffer[i];if(!s)return L.logger.warn("[buffer-controller]: Attempting to append to the "+i+" SourceBuffer, but it does not exist"),void e.shiftAndExecuteNext(i);s.ended=!1,console.assert(!s.updating,i+" sourceBuffer must not be updating"),s.appendBuffer(t)},d.blockBuffers=function(t,i){var e=this;if(i===void 0&&(i=this.getSourceBufferTypes()),!i.length)return L.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve(t);var s=this.operationQueue,l=i.map(function(n){return s.appendBlocker(n)});Promise.all(l).then(function(){t(),i.forEach(function(n){var u=e.sourceBuffer[n];u&&u.updating||s.shiftAndExecuteNext(n)})})},d.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},d.addBufferListener=function(t,i,e){var s=this.sourceBuffer[t];if(s){var l=e.bind(this,t);this.listeners[t].push({event:i,listener:l}),s.addEventListener(i,l)}},d.removeBufferListeners=function(t){var i=this.sourceBuffer[t];i&&this.listeners[t].forEach(function(e){i.removeEventListener(e.event,e.listener)})},y}()},"./src/controller/buffer-operation-queue.ts":function(P,C,f){f.r(C),f.d(C,"default",function(){return E});var R=f("./src/utils/logger.ts"),E=function(){function L(_){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=_}var k=L.prototype;return k.append=function(_,D){var o=this.queues[D];o.push(_),o.length===1&&this.buffers[D]&&this.executeNext(D)},k.insertAbort=function(_,D){this.queues[D].unshift(_),this.executeNext(D)},k.appendBlocker=function(_){var D,o=new Promise(function(m){D=m}),S={execute:D,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(S,_),o},k.executeNext=function(_){var D=this.buffers,o=this.queues,S=D[_],m=o[_];if(m.length){var h=m[0];try{h.execute()}catch(T){R.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),h.onError(T),S&&S.updating||(m.shift(),this.executeNext(_))}}},k.shiftAndExecuteNext=function(_){this.queues[_].shift(),this.executeNext(_)},k.current=function(_){return this.queues[_][0]},L}()},"./src/controller/cap-level-controller.ts":function(P,C,f){f.r(C);var R=f("./src/events.ts");function E(k,_){for(var D=0;D<_.length;D++){var o=_[D];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(k,o.key,o)}}var L=function(){function k(m){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=m,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var _,D,o,S=k.prototype;return S.setStreamController=function(m){this.streamController=m},S.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},S.registerListeners=function(){var m=this.hls;m.on(R.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),m.on(R.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),m.on(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),m.on(R.Events.BUFFER_CODECS,this.onBufferCodecs,this),m.on(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},S.unregisterListener=function(){var m=this.hls;m.off(R.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),m.off(R.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),m.off(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),m.off(R.Events.BUFFER_CODECS,this.onBufferCodecs,this),m.off(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},S.onFpsDropLevelCapping=function(m,h){k.isLevelAllowed(h.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(h.droppedLevel)},S.onMediaAttaching=function(m,h){this.media=h.media instanceof HTMLVideoElement?h.media:null},S.onManifestParsed=function(m,h){var T=this.hls;this.restrictedLevels=[],this.firstLevel=h.firstLevel,T.config.capLevelToPlayerSize&&h.video&&this.startCapping()},S.onBufferCodecs=function(m,h){this.hls.config.capLevelToPlayerSize&&h.video&&this.startCapping()},S.onMediaDetaching=function(){this.stopCapping()},S.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var m=this.hls.levels;if(m.length){var h=this.hls;h.autoLevelCapping=this.getMaxLevel(m.length-1),h.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=h.autoLevelCapping}}},S.getMaxLevel=function(m){var h=this,T=this.hls.levels;if(!T.length)return-1;var y=T.filter(function(d,t){return k.isLevelAllowed(t,h.restrictedLevels)&&t<=m});return this.clientRect=null,k.getMaxLevelByMediaSize(y,this.mediaWidth,this.mediaHeight)},S.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},S.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},S.getDimensions=function(){if(this.clientRect)return this.clientRect;var m=this.media,h={width:0,height:0};if(m){var T=m.getBoundingClientRect();h.width=T.width,h.height=T.height,h.width||h.height||(h.width=T.right-T.left||m.width||0,h.height=T.bottom-T.top||m.height||0)}return this.clientRect=h,h},k.isLevelAllowed=function(m,h){return h===void 0&&(h=[]),h.indexOf(m)===-1},k.getMaxLevelByMediaSize=function(m,h,T){if(!m||!m.length)return-1;for(var y,d,t=m.length-1,i=0;i<m.length;i+=1){var e=m[i];if((e.width>=h||e.height>=T)&&(y=e,!(d=m[i+1])||y.width!==d.width||y.height!==d.height)){t=i;break}}return t},_=k,o=[{key:"contentScaleFactor",get:function(){var m=1;try{m=self.devicePixelRatio}catch{}return m}}],(D=[{key:"mediaWidth",get:function(){return this.getDimensions().width*k.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*k.contentScaleFactor}}])&&E(_.prototype,D),o&&E(_,o),k}();C.default=L},"./src/controller/eme-controller.ts":function(P,C,f){f.r(C);var R=f("./src/events.ts"),E=f("./src/errors.ts"),L=f("./src/utils/logger.ts"),k=f("./src/utils/mediakeys-helper.ts");function _(o,S){for(var m=0;m<S.length;m++){var h=S[m];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(o,h.key,h)}}var D=function(){function o(T){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=T,this._config=T.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var S,m,h=o.prototype;return h.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},h._registerListeners=function(){this.hls.on(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(R.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(R.Events.MANIFEST_PARSED,this.onManifestParsed,this)},h._unregisterListeners=function(){this.hls.off(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(R.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(R.Events.MANIFEST_PARSED,this.onManifestParsed,this)},h.getLicenseServerUrl=function(T){switch(T){case k.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+T+'"')},h._attemptKeySystemAccess=function(T,y,d){var t=this,i=function(s,l,n,u){switch(s){case k.KeySystems.WIDEVINE:return function(p,v,g){var r={audioCapabilities:[],videoCapabilities:[]};return p.forEach(function(a){r.audioCapabilities.push({contentType:'audio/mp4; codecs="'+a+'"',robustness:g.audioRobustness||""})}),v.forEach(function(a){r.videoCapabilities.push({contentType:'video/mp4; codecs="'+a+'"',robustness:g.videoRobustness||""})}),[r]}(l,n,u);default:throw new Error("Unknown key-system: "+s)}}(T,y,d,this._drmSystemOptions);L.logger.log("Requesting encrypted media key-system access");var e=this.requestMediaKeySystemAccess(T,i);this.mediaKeysPromise=e.then(function(s){return t._onMediaKeySystemAccessObtained(T,s)}),e.catch(function(s){L.logger.error('Failed to obtain key-system "'+T+'" access:',s)})},h._onMediaKeySystemAccessObtained=function(T,y){var d=this;L.logger.log('Access for key-system "'+T+'" obtained');var t={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:y,mediaKeySystemDomain:T};this._mediaKeysList.push(t);var i=Promise.resolve().then(function(){return y.createMediaKeys()}).then(function(e){return t.mediaKeys=e,L.logger.log('Media-keys created for key-system "'+T+'"'),d._onMediaKeysCreated(),e});return i.catch(function(e){L.logger.error("Failed to create media-keys:",e)}),i},h._onMediaKeysCreated=function(){var T=this;this._mediaKeysList.forEach(function(y){y.mediaKeysSession||(y.mediaKeysSession=y.mediaKeys.createSession(),T._onNewMediaKeySession(y.mediaKeysSession))})},h._onNewMediaKeySession=function(T){var y=this;L.logger.log("New key-system session "+T.sessionId),T.addEventListener("message",function(d){y._onKeySessionMessage(T,d.message)},!1)},h._onKeySessionMessage=function(T,y){L.logger.log("Got EME message event, creating license request"),this._requestLicense(y,function(d){L.logger.log("Received license data (length: "+(d&&d.byteLength)+"), updating key-session"),T.update(d)})},h.onMediaEncrypted=function(T){var y=this;if(L.logger.log('Media is encrypted using "'+T.initDataType+'" init data type'),!this.mediaKeysPromise)return L.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),void this.hls.trigger(R.Events.ERROR,{type:E.ErrorTypes.KEY_SYSTEM_ERROR,details:E.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});var d=function(t){y._media&&(y._attemptSetMediaKeys(t),y._generateRequestWithPreferredKeySession(T.initDataType,T.initData))};this.mediaKeysPromise.then(d).catch(d)},h._attemptSetMediaKeys=function(T){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var y=this._mediaKeysList[0];if(!y||!y.mediaKeys)return L.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(R.Events.ERROR,{type:E.ErrorTypes.KEY_SYSTEM_ERROR,details:E.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});L.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(y.mediaKeys),this._hasSetMediaKeys=!0}},h._generateRequestWithPreferredKeySession=function(T,y){var d=this,t=this._mediaKeysList[0];if(!t)return L.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(R.Events.ERROR,{type:E.ErrorTypes.KEY_SYSTEM_ERROR,details:E.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(t.mediaKeysSessionInitialized)L.logger.warn("Key-Session already initialized but requested again");else{var i=t.mediaKeysSession;if(!i)return L.logger.error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(R.Events.ERROR,{type:E.ErrorTypes.KEY_SYSTEM_ERROR,details:E.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});if(!y)return L.logger.warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(R.Events.ERROR,{type:E.ErrorTypes.KEY_SYSTEM_ERROR,details:E.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});L.logger.log('Generating key-session request for "'+T+'" init data type'),t.mediaKeysSessionInitialized=!0,i.generateRequest(T,y).then(function(){L.logger.debug("Key-session generation succeeded")}).catch(function(e){L.logger.error("Error generating key-session request:",e),d.hls.trigger(R.Events.ERROR,{type:E.ErrorTypes.KEY_SYSTEM_ERROR,details:E.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})}},h._createLicenseXhr=function(T,y,d){var t=new XMLHttpRequest;t.responseType="arraybuffer",t.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,t,T,y,d);var i=this._licenseXhrSetup;if(i)try{i.call(this.hls,t,T),i=void 0}catch(e){L.logger.error(e)}try{t.readyState||t.open("POST",T,!0),i&&i.call(this.hls,t,T)}catch(e){throw new Error("issue setting up KeySystem license XHR "+e)}return t},h._onLicenseRequestReadyStageChange=function(T,y,d,t){switch(T.readyState){case 4:if(T.status===200){this._requestLicenseFailureCount=0,L.logger.log("License request succeeded");var i=T.response,e=this._licenseResponseCallback;if(e)try{i=e.call(this.hls,T,y)}catch(l){L.logger.error(l)}t(i)}else{if(L.logger.error("License Request XHR failed ("+y+"). Status: "+T.status+" ("+T.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>3)return void this.hls.trigger(R.Events.ERROR,{type:E.ErrorTypes.KEY_SYSTEM_ERROR,details:E.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});var s=3-this._requestLicenseFailureCount+1;L.logger.warn("Retrying license request, "+s+" attempts left"),this._requestLicense(d,t)}}},h._generateLicenseRequestChallenge=function(T,y){switch(T.mediaKeySystemDomain){case k.KeySystems.WIDEVINE:return y}throw new Error("unsupported key-system: "+T.mediaKeySystemDomain)},h._requestLicense=function(T,y){L.logger.log("Requesting content license for key-system");var d=this._mediaKeysList[0];if(!d)return L.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(R.Events.ERROR,{type:E.ErrorTypes.KEY_SYSTEM_ERROR,details:E.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});try{var t=this.getLicenseServerUrl(d.mediaKeySystemDomain),i=this._createLicenseXhr(t,T,y);L.logger.log("Sending license request to URL: "+t);var e=this._generateLicenseRequestChallenge(d,T);i.send(e)}catch(s){L.logger.error("Failure requesting DRM license: "+s),this.hls.trigger(R.Events.ERROR,{type:E.ErrorTypes.KEY_SYSTEM_ERROR,details:E.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},h.onMediaAttached=function(T,y){if(this._emeEnabled){var d=y.media;this._media=d,d.addEventListener("encrypted",this._onMediaEncrypted)}},h.onMediaDetached=function(){var T=this._media,y=this._mediaKeysList;T&&(T.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(y.map(function(d){if(d.mediaKeysSession)return d.mediaKeysSession.close().catch(function(){})})).then(function(){return T.setMediaKeys(null)}).catch(function(){}))},h.onManifestParsed=function(T,y){if(this._emeEnabled){var d=y.levels.map(function(i){return i.audioCodec}).filter(function(i){return!!i}),t=y.levels.map(function(i){return i.videoCodec}).filter(function(i){return!!i});this._attemptKeySystemAccess(k.KeySystems.WIDEVINE,d,t)}},S=o,(m=[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}])&&_(S.prototype,m),o}();C.default=D},"./src/controller/fps-controller.ts":function(P,C,f){f.r(C);var R=f("./src/events.ts"),E=f("./src/utils/logger.ts"),L=function(){function k(D){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=D,this.registerListeners()}var _=k.prototype;return _.setStreamController=function(D){this.streamController=D},_.registerListeners=function(){this.hls.on(R.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},_.unregisterListeners=function(){this.hls.off(R.Events.MEDIA_ATTACHING,this.onMediaAttaching)},_.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},_.onMediaAttaching=function(D,o){var S=this.hls.config;if(S.capLevelOnFPSDrop){var m=o.media instanceof self.HTMLVideoElement?o.media:null;this.media=m,m&&typeof m.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),S.fpsDroppedMonitoringPeriod)}},_.checkFPS=function(D,o,S){var m=performance.now();if(o){if(this.lastTime){var h=m-this.lastTime,T=S-this.lastDroppedFrames,y=o-this.lastDecodedFrames,d=1e3*T/h,t=this.hls;if(t.trigger(R.Events.FPS_DROP,{currentDropped:T,currentDecoded:y,totalDroppedFrames:S}),d>0&&T>t.config.fpsDroppedMonitoringThreshold*y){var i=t.currentLevel;E.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+i),i>0&&(t.autoLevelCapping===-1||t.autoLevelCapping>=i)&&(i-=1,t.trigger(R.Events.FPS_DROP_LEVEL_CAPPING,{level:i,droppedLevel:t.currentLevel}),t.autoLevelCapping=i,this.streamController.nextLevelSwitch())}}this.lastTime=m,this.lastDroppedFrames=S,this.lastDecodedFrames=o}},_.checkFPSInterval=function(){var D=this.media;if(D)if(this.isVideoPlaybackQualityAvailable){var o=D.getVideoPlaybackQuality();this.checkFPS(D,o.totalVideoFrames,o.droppedVideoFrames)}else this.checkFPS(D,D.webkitDecodedFrameCount,D.webkitDroppedFrameCount)},k}();C.default=L},"./src/controller/fragment-finders.ts":function(P,C,f){f.r(C),f.d(C,"findFragmentByPDT",function(){return L}),f.d(C,"findFragmentByPTS",function(){return k}),f.d(C,"fragmentWithinToleranceTest",function(){return _}),f.d(C,"pdtWithinToleranceTest",function(){return D}),f.d(C,"findFragWithCC",function(){return o});var R=f("./src/polyfills/number.ts"),E=f("./src/utils/binary-search.ts");function L(S,m,h){if(m===null||!Array.isArray(S)||!S.length||!Object(R.isFiniteNumber)(m)||m<(S[0].programDateTime||0)||m>=(S[S.length-1].endProgramDateTime||0))return null;h=h||0;for(var T=0;T<S.length;++T){var y=S[T];if(D(m,h,y))return y}return null}function k(S,m,h,T){h===void 0&&(h=0),T===void 0&&(T=0);var y=null;if(S?y=m[S.sn-m[0].sn+1]||null:h===0&&m[0].start===0&&(y=m[0]),y&&_(h,T,y)===0)return y;var d=E.default.search(m,_.bind(null,h,T));return d||y}function _(S,m,h){S===void 0&&(S=0),m===void 0&&(m=0);var T=Math.min(m,h.duration+(h.deltaPTS?h.deltaPTS:0));return h.start+h.duration-T<=S?1:h.start-T>S&&h.start?-1:0}function D(S,m,h){var T=1e3*Math.min(m,h.duration+(h.deltaPTS?h.deltaPTS:0));return(h.endProgramDateTime||0)-T>S}function o(S,m){return E.default.search(S,function(h){return h.cc<m?1:h.cc>m?-1:0})}},"./src/controller/fragment-tracker.ts":function(P,C,f){f.r(C),f.d(C,"FragmentState",function(){return R}),f.d(C,"FragmentTracker",function(){return _});var R,E,L=f("./src/events.ts"),k=f("./src/types/loader.ts");(E=R||(R={})).NOT_LOADED="NOT_LOADED",E.BACKTRACKED="BACKTRACKED",E.APPENDING="APPENDING",E.PARTIAL="PARTIAL",E.OK="OK";var _=function(){function S(h){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=h,this._registerListeners()}var m=S.prototype;return m._registerListeners=function(){var h=this.hls;h.on(L.Events.BUFFER_APPENDED,this.onBufferAppended,this),h.on(L.Events.FRAG_BUFFERED,this.onFragBuffered,this),h.on(L.Events.FRAG_LOADED,this.onFragLoaded,this)},m._unregisterListeners=function(){var h=this.hls;h.off(L.Events.BUFFER_APPENDED,this.onBufferAppended,this),h.off(L.Events.FRAG_BUFFERED,this.onFragBuffered,this),h.off(L.Events.FRAG_LOADED,this.onFragLoaded,this)},m.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},m.getAppendedFrag=function(h,T){if(T===k.PlaylistLevelType.MAIN){var y=this.activeFragment,d=this.activeParts;if(!y)return null;if(d)for(var t=d.length;t--;){var i=d[t],e=i?i.end:y.appendedPTS;if(i.start<=h&&e!==void 0&&h<=e)return t>9&&(this.activeParts=d.slice(t-9)),i}else if(y.start<=h&&y.appendedPTS!==void 0&&h<=y.appendedPTS)return y}return this.getBufferedFrag(h,T)},m.getBufferedFrag=function(h,T){for(var y=this.fragments,d=Object.keys(y),t=d.length;t--;){var i=y[d[t]];if((i==null?void 0:i.body.type)===T&&i.buffered){var e=i.body;if(e.start<=h&&h<=e.end)return e}}return null},m.detectEvictedFragments=function(h,T,y){var d=this;Object.keys(this.fragments).forEach(function(t){var i=d.fragments[t];if(i)if(i.buffered){var e=i.range[h];e&&e.time.some(function(s){var l=!d.isTimeBuffered(s.startPTS,s.endPTS,T);return l&&d.removeFragment(i.body),l})}else i.body.type===y&&d.removeFragment(i.body)})},m.detectPartialFragments=function(h){var T=this,y=this.timeRanges,d=h.frag,t=h.part;if(y&&d.sn!=="initSegment"){var i=o(d),e=this.fragments[i];e&&(Object.keys(y).forEach(function(s){var l=d.elementaryStreams[s];if(l){var n=y[s],u=t!==null||l.partial===!0;e.range[s]=T.getBufferedTimes(d,t,u,n)}}),e.backtrack=e.loaded=null,Object.keys(e.range).length?e.buffered=!0:this.removeFragment(e.body))}},m.fragBuffered=function(h){var T=o(h),y=this.fragments[T];y&&(y.backtrack=y.loaded=null,y.buffered=!0)},m.getBufferedTimes=function(h,T,y,d){for(var t={time:[],partial:y},i=T?T.start:h.start,e=T?T.end:h.end,s=h.minEndPTS||e,l=h.maxStartPTS||i,n=0;n<d.length;n++){var u=d.start(n)-this.bufferPadding,p=d.end(n)+this.bufferPadding;if(l>=u&&s<=p){t.time.push({startPTS:Math.max(i,d.start(n)),endPTS:Math.min(e,d.end(n))});break}if(i<p&&e>u)t.partial=!0,t.time.push({startPTS:Math.max(i,d.start(n)),endPTS:Math.min(e,d.end(n))});else if(e<=u)break}return t},m.getPartialFragment=function(h){var T,y,d,t=null,i=0,e=this.bufferPadding,s=this.fragments;return Object.keys(s).forEach(function(l){var n=s[l];n&&D(n)&&(y=n.body.start-e,d=n.body.end+e,h>=y&&h<=d&&(T=Math.min(h-y,d-h),i<=T&&(t=n.body,i=T)))}),t},m.getState=function(h){var T=o(h),y=this.fragments[T];return y?y.buffered?D(y)?R.PARTIAL:R.OK:y.backtrack?R.BACKTRACKED:R.APPENDING:R.NOT_LOADED},m.backtrack=function(h,T){var y=o(h),d=this.fragments[y];if(!d||d.backtrack)return null;var t=d.backtrack=T||d.loaded;return d.loaded=null,t},m.getBacktrackData=function(h){var T=o(h),y=this.fragments[T];if(y){var d,t=y.backtrack;if(t!=null&&(d=t.payload)!==null&&d!==void 0&&d.byteLength)return t;this.removeFragment(h)}return null},m.isTimeBuffered=function(h,T,y){for(var d,t,i=0;i<y.length;i++){if(d=y.start(i)-this.bufferPadding,t=y.end(i)+this.bufferPadding,h>=d&&T<=t)return!0;if(T<=d)return!1}return!1},m.onFragLoaded=function(h,T){var y=T.frag,d=T.part;if(y.sn!=="initSegment"&&!y.bitrateTest&&!d){var t=o(y);this.fragments[t]={body:y,loaded:T,backtrack:null,buffered:!1,range:Object.create(null)}}},m.onBufferAppended=function(h,T){var y=this,d=T.frag,t=T.part,i=T.timeRanges;if(d.type===k.PlaylistLevelType.MAIN)if(this.activeFragment=d,t){var e=this.activeParts;e||(this.activeParts=e=[]),e.push(t)}else this.activeParts=null;this.timeRanges=i,Object.keys(i).forEach(function(s){var l=i[s];if(y.detectEvictedFragments(s,l),!t)for(var n=0;n<l.length;n++)d.appendedPTS=Math.max(l.end(n),d.appendedPTS||0)})},m.onFragBuffered=function(h,T){this.detectPartialFragments(T)},m.hasFragment=function(h){var T=o(h);return!!this.fragments[T]},m.removeFragmentsInRange=function(h,T,y){var d=this;Object.keys(this.fragments).forEach(function(t){var i=d.fragments[t];if(i&&i.buffered){var e=i.body;e.type===y&&e.start<T&&e.end>h&&d.removeFragment(e)}})},m.removeFragment=function(h){var T=o(h);h.stats.loaded=0,h.clearElementaryStreamInfo(),delete this.fragments[T]},m.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},S}();function D(S){var m,h;return S.buffered&&(((m=S.range.video)===null||m===void 0?void 0:m.partial)||((h=S.range.audio)===null||h===void 0?void 0:h.partial))}function o(S){return S.type+"_"+S.level+"_"+S.urlId+"_"+S.sn}},"./src/controller/gap-controller.ts":function(P,C,f){f.r(C),f.d(C,"STALL_MINIMUM_DURATION_MS",function(){return _}),f.d(C,"MAX_START_GAP_JUMP",function(){return D}),f.d(C,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return o}),f.d(C,"SKIP_BUFFER_RANGE_START",function(){return S}),f.d(C,"default",function(){return m});var R=f("./src/utils/buffer-helper.ts"),E=f("./src/errors.ts"),L=f("./src/events.ts"),k=f("./src/utils/logger.ts"),_=250,D=2,o=.1,S=.05,m=function(){function h(y,d,t,i){this.config=void 0,this.media=void 0,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=y,this.media=d,this.fragmentTracker=t,this.hls=i}var T=h.prototype;return T.destroy=function(){this.hls=this.fragmentTracker=this.media=null},T.poll=function(y){var d=this.config,t=this.media,i=this.stalled,e=t.currentTime,s=t.seeking,l=this.seeking&&!s,n=!this.seeking&&s;if(this.seeking=s,e===y){if((n||l)&&(this.stalled=null),!t.paused&&!t.ended&&t.playbackRate!==0&&R.BufferHelper.getBuffered(t).length){var u=R.BufferHelper.bufferInfo(t,e,0),p=u.len>0,v=u.nextStart||0;if(p||v){if(s){var g=u.len>D,r=!v||v-e>D&&!this.fragmentTracker.getPartialFragment(e);if(g||r)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var a,c=Math.max(v,u.start||0)-e,b=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,A=!(b==null||(a=b.details)===null||a===void 0)&&a.live?2*b.details.targetduration:D;if(c>0&&c<=A)return void this._trySkipBufferHole(null)}var I=self.performance.now();if(i!==null){var x=I-i;!s&&x>=_&&this._reportStall(u.len);var w=R.BufferHelper.bufferInfo(t,e,d.maxBufferHole);this._tryFixBufferStall(w,x)}else this.stalled=I}}}else if(this.moved=!0,i!==null){if(this.stallReported){var O=self.performance.now()-i;k.logger.warn("playback not stuck anymore @"+e+", after "+Math.round(O)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}},T._tryFixBufferStall=function(y,d){var t=this.config,i=this.fragmentTracker,e=this.media.currentTime,s=i.getPartialFragment(e);s&&this._trySkipBufferHole(s)||y.len>t.maxBufferHole&&d>1e3*t.highBufferWatchdogPeriod&&(k.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},T._reportStall=function(y){var d=this.hls,t=this.media;this.stallReported||(this.stallReported=!0,k.logger.warn("Playback stalling at @"+t.currentTime+" due to low buffer (buffer="+y+")"),d.trigger(L.Events.ERROR,{type:E.ErrorTypes.MEDIA_ERROR,details:E.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:y}))},T._trySkipBufferHole=function(y){for(var d=this.config,t=this.hls,i=this.media,e=i.currentTime,s=0,l=R.BufferHelper.getBuffered(i),n=0;n<l.length;n++){var u=l.start(n);if(e+d.maxBufferHole>=s&&e<u){var p=Math.max(u+S,i.currentTime+o);return k.logger.warn("skipping hole, adjusting currentTime from "+e+" to "+p),this.moved=!0,this.stalled=null,i.currentTime=p,y&&t.trigger(L.Events.ERROR,{type:E.ErrorTypes.MEDIA_ERROR,details:E.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+e+" to "+p,frag:y}),p}s=l.end(n)}return 0},T._tryNudgeBuffer=function(){var y=this.config,d=this.hls,t=this.media,i=t.currentTime,e=(this.nudgeRetry||0)+1;if(this.nudgeRetry=e,e<y.nudgeMaxRetry){var s=i+e*y.nudgeOffset;k.logger.warn("Nudging 'currentTime' from "+i+" to "+s),t.currentTime=s,d.trigger(L.Events.ERROR,{type:E.ErrorTypes.MEDIA_ERROR,details:E.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else k.logger.error("Playhead still not moving while enough data buffered @"+i+" after "+y.nudgeMaxRetry+" nudges"),d.trigger(L.Events.ERROR,{type:E.ErrorTypes.MEDIA_ERROR,details:E.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},h}()},"./src/controller/id3-track-controller.ts":function(P,C,f){f.r(C);var R=f("./src/events.ts"),E=f("./src/utils/texttrack-utils.ts"),L=f("./src/demux/id3.ts"),k=function(){function _(o){this.hls=void 0,this.id3Track=null,this.media=null,this.hls=o,this._registerListeners()}var D=_.prototype;return D.destroy=function(){this._unregisterListeners()},D._registerListeners=function(){var o=this.hls;o.on(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),o.on(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.on(R.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),o.on(R.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},D._unregisterListeners=function(){var o=this.hls;o.off(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),o.off(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.off(R.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),o.off(R.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},D.onMediaAttached=function(o,S){this.media=S.media},D.onMediaDetaching=function(){this.id3Track&&(Object(E.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null)},D.getID3Track=function(o){if(this.media){for(var S=0;S<o.length;S++){var m=o[S];if(m.kind==="metadata"&&m.label==="id3")return Object(E.sendAddTrackEvent)(m,this.media),m}return this.media.addTextTrack("metadata","id3")}},D.onFragParsingMetadata=function(o,S){if(this.media){var m=S.frag,h=S.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var T=self.WebKitDataCue||self.VTTCue||self.TextTrackCue,y=0;y<h.length;y++){var d=L.getID3Frames(h[y].data);if(d){var t=h[y].pts,i=y<h.length-1?h[y+1].pts:m.end;i-t<=0&&(i=t+.25);for(var e=0;e<d.length;e++){var s=d[e];if(!L.isTimeStampFrame(s)){var l=new T(t,i,"");l.value=s,this.id3Track.addCue(l)}}}}}},D.onBufferFlushing=function(o,S){var m=S.startOffset,h=S.endOffset,T=S.type;if(!T||T==="audio"){var y=this.id3Track;y&&Object(E.removeCuesInRange)(y,m,h)}},_}();C.default=k},"./src/controller/latency-controller.ts":function(P,C,f){f.r(C),f.d(C,"default",function(){return _});var R=f("./src/errors.ts"),E=f("./src/events.ts"),L=f("./src/utils/logger.ts");function k(D,o){for(var S=0;S<o.length;S++){var m=o[S];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(D,m.key,m)}}var _=function(){function D(h){var T=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return T.timeupdate()},this.hls=h,this.config=h.config,this.registerListeners()}var o,S,m=D.prototype;return m.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},m.registerListeners=function(){this.hls.on(E.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(E.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(E.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(E.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(E.Events.ERROR,this.onError,this)},m.unregisterListeners=function(){this.hls.off(E.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(E.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(E.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(E.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(E.Events.ERROR,this.onError)},m.onMediaAttached=function(h,T){this.media=T.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},m.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},m.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},m.onLevelUpdated=function(h,T){var y=T.details;this.levelDetails=y,y.advanced&&this.timeupdate(),!y.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},m.onError=function(h,T){T.details===R.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,L.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},m.timeupdate=function(){var h=this.media,T=this.levelDetails;if(h&&T){this.currentTime=h.currentTime;var y=this.computeLatency();if(y!==null){this._latency=y;var d=this.config,t=d.lowLatencyMode,i=d.maxLiveSyncPlaybackRate;if(t&&i!==1){var e=this.targetLatency;if(e!==null){var s=y-e,l=s<Math.min(this.maxLatency,e+T.targetduration);if(T.live&&l&&s>.05&&this.forwardBufferLength>1){var n=Math.min(2,Math.max(1,i)),u=Math.round(2/(1+Math.exp(-.75*s-this.edgeStalled))*20)/20;h.playbackRate=Math.min(n,Math.max(1,u))}else h.playbackRate!==1&&h.playbackRate!==0&&(h.playbackRate=1)}}}}},m.estimateLiveEdge=function(){var h=this.levelDetails;return h===null?null:h.edge+h.age},m.computeLatency=function(){var h=this.estimateLiveEdge();return h===null?null:h-this.currentTime},o=D,(S=[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var h=this.config,T=this.levelDetails;return h.liveMaxLatencyDuration!==void 0?h.liveMaxLatencyDuration:T?h.liveMaxLatencyDurationCount*T.targetduration:0}},{key:"targetLatency",get:function(){var h=this.levelDetails;if(h===null)return null;var T=h.holdBack,y=h.partHoldBack,d=h.targetduration,t=this.config,i=t.liveSyncDuration,e=t.liveSyncDurationCount,s=t.lowLatencyMode,l=this.hls.userConfig,n=s&&y||T;(l.liveSyncDuration||l.liveSyncDurationCount||n===0)&&(n=i!==void 0?i:e*d);var u=d;return n+Math.min(1*this.stallCount,u)}},{key:"liveSyncPosition",get:function(){var h=this.estimateLiveEdge(),T=this.targetLatency,y=this.levelDetails;if(h===null||T===null||y===null)return null;var d=y.edge,t=h-T-this.edgeStalled,i=d-y.totalduration,e=d-(this.config.lowLatencyMode&&y.partTarget||y.targetduration);return Math.min(Math.max(i,t),e)}},{key:"drift",get:function(){var h=this.levelDetails;return h===null?1:h.drift}},{key:"edgeStalled",get:function(){var h=this.levelDetails;if(h===null)return 0;var T=3*(this.config.lowLatencyMode&&h.partTarget||h.targetduration);return Math.max(h.age-T,0)}},{key:"forwardBufferLength",get:function(){var h=this.media,T=this.levelDetails;if(!h||!T)return 0;var y=h.buffered.length;return y?h.buffered.end(y-1):T.edge-this.currentTime}}])&&k(o.prototype,S),D}()},"./src/controller/level-controller.ts":function(P,C,f){f.r(C),f.d(C,"default",function(){return y});var R=f("./src/types/level.ts"),E=f("./src/events.ts"),L=f("./src/errors.ts"),k=f("./src/utils/codecs.ts"),_=f("./src/controller/level-helper.ts"),D=f("./src/controller/base-playlist-controller.ts"),o=f("./src/types/loader.ts");function S(){return(S=Object.assign||function(d){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&(d[e]=i[e])}return d}).apply(this,arguments)}function m(d,t){for(var i=0;i<t.length;i++){var e=t[i];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(d,e.key,e)}}function h(d,t){return(h=Object.setPrototypeOf||function(i,e){return i.__proto__=e,i})(d,t)}var T=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),y=function(d){var t,i;function e(u){var p;return(p=d.call(this,u,"[level-controller]")||this)._levels=[],p._firstLevel=-1,p._startLevel=void 0,p.currentLevelIndex=-1,p.manualLevelIndex=-1,p.onParsedComplete=void 0,p._registerListeners(),p}i=d,(t=e).prototype=Object.create(i.prototype),t.prototype.constructor=t,h(t,i);var s,l,n=e.prototype;return n._registerListeners=function(){var u=this.hls;u.on(E.Events.MANIFEST_LOADED,this.onManifestLoaded,this),u.on(E.Events.LEVEL_LOADED,this.onLevelLoaded,this),u.on(E.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),u.on(E.Events.FRAG_LOADED,this.onFragLoaded,this),u.on(E.Events.ERROR,this.onError,this)},n._unregisterListeners=function(){var u=this.hls;u.off(E.Events.MANIFEST_LOADED,this.onManifestLoaded,this),u.off(E.Events.LEVEL_LOADED,this.onLevelLoaded,this),u.off(E.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),u.off(E.Events.FRAG_LOADED,this.onFragLoaded,this),u.off(E.Events.ERROR,this.onError,this)},n.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,d.prototype.destroy.call(this)},n.startLoad=function(){this._levels.forEach(function(u){u.loadError=0}),d.prototype.startLoad.call(this)},n.onManifestLoaded=function(u,p){var v,g,r=[],a=[],c=[],b={},A=!1,I=!1,x=!1;if(p.levels.forEach(function(M){var N=M.attrs;A=A||!(!M.width||!M.height),I=I||!!M.videoCodec,x=x||!!M.audioCodec,T&&M.audioCodec&&M.audioCodec.indexOf("mp4a.40.34")!==-1&&(M.audioCodec=void 0);var B=M.bitrate+"-"+M.attrs.RESOLUTION+"-"+M.attrs.CODECS;(g=b[B])?g.url.push(M.url):(g=new R.Level(M),b[B]=g,r.push(g)),N&&(N.AUDIO&&Object(_.addGroupId)(g,"audio",N.AUDIO),N.SUBTITLES&&Object(_.addGroupId)(g,"text",N.SUBTITLES))}),(A||I)&&x&&(r=r.filter(function(M){var N=M.videoCodec,B=M.width,U=M.height;return!!N||!(!B||!U)})),r=r.filter(function(M){var N=M.audioCodec,B=M.videoCodec;return(!N||Object(k.isCodecSupportedInMp4)(N,"audio"))&&(!B||Object(k.isCodecSupportedInMp4)(B,"video"))}),p.audioTracks&&(a=p.audioTracks.filter(function(M){return!M.audioCodec||Object(k.isCodecSupportedInMp4)(M.audioCodec,"audio")}),Object(_.assignTrackIdsByGroup)(a)),p.subtitles&&(c=p.subtitles,Object(_.assignTrackIdsByGroup)(c)),r.length>0){v=r[0].bitrate,r.sort(function(M,N){return M.bitrate-N.bitrate}),this._levels=r;for(var w=0;w<r.length;w++)if(r[w].bitrate===v){this._firstLevel=w,this.log("manifest loaded, "+r.length+" level(s) found, first bitrate: "+v);break}var O=x&&!I,F={levels:r,audioTracks:a,subtitleTracks:c,firstLevel:this._firstLevel,stats:p.stats,audio:x,video:I,altAudio:!O&&a.some(function(M){return!!M.url})};this.hls.trigger(E.Events.MANIFEST_PARSED,F),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(E.Events.ERROR,{type:L.ErrorTypes.MEDIA_ERROR,details:L.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:p.url,reason:"no level with compatible codecs found in manifest"})},n.onError=function(u,p){if(d.prototype.onError.call(this,u,p),!p.fatal){var v=p.context,g=this._levels[this.currentLevelIndex];if(v&&(v.type===o.PlaylistContextType.AUDIO_TRACK&&g.audioGroupIds&&v.groupId===g.audioGroupIds[g.urlId]||v.type===o.PlaylistContextType.SUBTITLE_TRACK&&g.textGroupIds&&v.groupId===g.textGroupIds[g.urlId]))this.redundantFailover(this.currentLevelIndex);else{var r,a=!1,c=!0;switch(p.details){case L.ErrorDetails.FRAG_LOAD_ERROR:case L.ErrorDetails.FRAG_LOAD_TIMEOUT:case L.ErrorDetails.KEY_LOAD_ERROR:case L.ErrorDetails.KEY_LOAD_TIMEOUT:if(p.frag){var b=this._levels[p.frag.level];b?(b.fragmentError++,b.fragmentError>this.hls.config.fragLoadingMaxRetry&&(r=p.frag.level)):r=p.frag.level}break;case L.ErrorDetails.LEVEL_LOAD_ERROR:case L.ErrorDetails.LEVEL_LOAD_TIMEOUT:v&&(v.deliveryDirectives&&(c=!1),r=v.level),a=!0;break;case L.ErrorDetails.REMUX_ALLOC_ERROR:r=p.level,a=!0}r!==void 0&&this.recoverLevel(p,r,a,c)}}},n.recoverLevel=function(u,p,v,g){var r=u.details,a=this._levels[p];if(a.loadError++,v){if(!this.retryLoadingOrFail(u))return void(this.currentLevelIndex=-1);u.levelRetry=!0}if(g){var c=a.url.length;if(c>1&&a.loadError<c)u.levelRetry=!0,this.redundantFailover(p);else if(this.manualLevelIndex===-1){var b=p===0?this._levels.length-1:p-1;this.currentLevelIndex!==b&&this._levels[b].loadError===0&&(this.warn(r+": switch to "+b),u.levelRetry=!0,this.hls.nextAutoLevel=b)}}},n.redundantFailover=function(u){var p=this._levels[u],v=p.url.length;if(v>1){var g=(p.urlId+1)%v;this.warn("Switching to redundant URL-id "+g),this._levels.forEach(function(r){r.urlId=g}),this.level=u}},n.onFragLoaded=function(u,p){var v=p.frag;if(v!==void 0&&v.type===o.PlaylistLevelType.MAIN){var g=this._levels[v.level];g!==void 0&&(g.fragmentError=0,g.loadError=0)}},n.onLevelLoaded=function(u,p){var v,g,r=p.level,a=p.details,c=this._levels[r];if(!c)return this.warn("Invalid level index "+r),void((g=p.deliveryDirectives)!==null&&g!==void 0&&g.skip&&(a.deltaUpdateFailed=!0));r===this.currentLevelIndex?(c.fragmentError===0&&(c.loadError=0,this.retryCount=0),this.playlistLoaded(r,p,c.details)):(v=p.deliveryDirectives)!==null&&v!==void 0&&v.skip&&(a.deltaUpdateFailed=!0)},n.onAudioTrackSwitched=function(u,p){var v=this.hls.levels[this.currentLevelIndex];if(v&&v.audioGroupIds){for(var g=-1,r=this.hls.audioTracks[p.id].groupId,a=0;a<v.audioGroupIds.length;a++)if(v.audioGroupIds[a]===r){g=a;break}g!==v.urlId&&(v.urlId=g,this.startLoad())}},n.loadPlaylist=function(u){var p=this.currentLevelIndex,v=this._levels[p];if(this.canLoad&&v&&v.url.length>0){var g=v.urlId,r=v.url[g];if(u)try{r=u.addDirectives(r)}catch(a){this.warn("Could not construct new URL with HLS Delivery Directives: "+a)}this.log("Attempt loading level index "+p+(u?" at sn "+u.msn+" part "+u.part:"")+" with URL-id "+g+" "+r),this.clearTimer(),this.hls.trigger(E.Events.LEVEL_LOADING,{url:r,level:p,id:g,deliveryDirectives:u||null})}},n.removeLevel=function(u,p){var v=function(r,a){return a!==p},g=this._levels.filter(function(r,a){return a!==u||r.url.length>1&&p!==void 0&&(r.url=r.url.filter(v),r.audioGroupIds&&(r.audioGroupIds=r.audioGroupIds.filter(v)),r.textGroupIds&&(r.textGroupIds=r.textGroupIds.filter(v)),r.urlId=0,!0)}).map(function(r,a){var c=r.details;return c!=null&&c.fragments&&c.fragments.forEach(function(b){b.level=a}),r});this._levels=g,this.hls.trigger(E.Events.LEVELS_UPDATED,{levels:g})},s=e,(l=[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(u){var p,v=this._levels;if(v.length!==0&&(this.currentLevelIndex!==u||(p=v[u])===null||p===void 0||!p.details)){if(u<0||u>=v.length){var g=u<0;if(this.hls.trigger(E.Events.ERROR,{type:L.ErrorTypes.OTHER_ERROR,details:L.ErrorDetails.LEVEL_SWITCH_ERROR,level:u,fatal:g,reason:"invalid level idx"}),g)return;u=Math.min(u,v.length-1)}this.clearTimer();var r=this.currentLevelIndex,a=v[r],c=v[u];this.log("switching to level "+u+" from "+r),this.currentLevelIndex=u;var b=S({},c,{level:u,maxBitrate:c.maxBitrate,uri:c.uri,urlId:c.urlId});delete b._urlId,this.hls.trigger(E.Events.LEVEL_SWITCHING,b);var A=c.details;if(!A||A.live){var I=this.switchParams(c.uri,a==null?void 0:a.details);this.loadPlaylist(I)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(u){this.manualLevelIndex=u,this._startLevel===void 0&&(this._startLevel=u),u!==-1&&(this.level=u)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(u){this._firstLevel=u}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var u=this.hls.config.startLevel;return u!==void 0?u:this._firstLevel}return this._startLevel},set:function(u){this._startLevel=u}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(u){this.level=u,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=u)}}])&&m(s.prototype,l),e}(D.default)},"./src/controller/level-helper.ts":function(P,C,f){f.r(C),f.d(C,"addGroupId",function(){return L}),f.d(C,"assignTrackIdsByGroup",function(){return k}),f.d(C,"updatePTS",function(){return _}),f.d(C,"updateFragPTSDTS",function(){return o}),f.d(C,"mergeDetails",function(){return S}),f.d(C,"mapPartIntersection",function(){return m}),f.d(C,"mapFragmentIntersection",function(){return h}),f.d(C,"adjustSliding",function(){return T}),f.d(C,"addSliding",function(){return y}),f.d(C,"computeReloadInterval",function(){return d}),f.d(C,"getFragmentWithSN",function(){return t}),f.d(C,"getPartWith",function(){return i});var R=f("./src/polyfills/number.ts"),E=f("./src/utils/logger.ts");function L(e,s,l){switch(s){case"audio":e.audioGroupIds||(e.audioGroupIds=[]),e.audioGroupIds.push(l);break;case"text":e.textGroupIds||(e.textGroupIds=[]),e.textGroupIds.push(l)}}function k(e){var s={};e.forEach(function(l){var n=l.groupId||"";l.id=s[n]=s[n]||0,s[n]++})}function _(e,s,l){D(e[s],e[l])}function D(e,s){var l=s.startPTS;if(Object(R.isFiniteNumber)(l)){var n,u=0;s.sn>e.sn?(u=l-e.start,n=e):(u=e.start-l,n=s),n.duration!==u&&(n.duration=u)}else s.sn>e.sn?e.cc===s.cc&&e.minEndPTS?s.start=e.start+(e.minEndPTS-e.start):s.start=e.start+e.duration:s.start=Math.max(e.start-s.duration,0)}function o(e,s,l,n,u,p){n-l<=0&&(E.logger.warn("Fragment should have a positive duration",s),n=l+s.duration,p=u+s.duration);var v=l,g=n,r=s.startPTS,a=s.endPTS;if(Object(R.isFiniteNumber)(r)){var c=Math.abs(r-l);Object(R.isFiniteNumber)(s.deltaPTS)?s.deltaPTS=Math.max(c,s.deltaPTS):s.deltaPTS=c,v=Math.max(l,r),l=Math.min(l,r),u=Math.min(u,s.startDTS),g=Math.min(n,a),n=Math.max(n,a),p=Math.max(p,s.endDTS)}s.duration=n-l;var b=l-s.start;s.appendedPTS=n,s.start=s.startPTS=l,s.maxStartPTS=v,s.startDTS=u,s.endPTS=n,s.minEndPTS=g,s.endDTS=p;var A,I=s.sn;if(!e||I<e.startSN||I>e.endSN)return 0;var x=I-e.startSN,w=e.fragments;for(w[x]=s,A=x;A>0;A--)D(w[A],w[A-1]);for(A=x;A<w.length-1;A++)D(w[A],w[A+1]);return e.fragmentHint&&D(w[w.length-1],e.fragmentHint),e.PTSKnown=e.alignedSliding=!0,b}function S(e,s){for(var l=null,n=e.fragments,u=n.length-1;u>=0;u--){var p=n[u].initSegment;if(p){l=p;break}}e.fragmentHint&&delete e.fragmentHint.endPTS;var v,g=0;if(h(e,s,function(I,x){var w;I.relurl&&(g=I.cc-x.cc),Object(R.isFiniteNumber)(I.startPTS)&&Object(R.isFiniteNumber)(I.endPTS)&&(x.start=x.startPTS=I.startPTS,x.startDTS=I.startDTS,x.appendedPTS=I.appendedPTS,x.maxStartPTS=I.maxStartPTS,x.endPTS=I.endPTS,x.endDTS=I.endDTS,x.minEndPTS=I.minEndPTS,x.duration=I.endPTS-I.startPTS,x.duration&&(v=x),s.PTSKnown=s.alignedSliding=!0),x.elementaryStreams=I.elementaryStreams,x.loader=I.loader,x.stats=I.stats,x.urlId=I.urlId,I.initSegment?(x.initSegment=I.initSegment,l=I.initSegment):x.initSegment&&x.initSegment.relurl!=((w=l)===null||w===void 0?void 0:w.relurl)||(x.initSegment=l)}),s.skippedSegments&&(s.deltaUpdateFailed=s.fragments.some(function(I){return!I}),s.deltaUpdateFailed)){E.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var r=s.skippedSegments;r--;)s.fragments.shift();s.startSN=s.fragments[0].sn,s.startCC=s.fragments[0].cc}var a=s.fragments;if(g){E.logger.warn("discontinuity sliding from playlist, take drift into account");for(var c=0;c<a.length;c++)a[c].cc+=g}s.skippedSegments&&(s.startCC=s.fragments[0].cc),m(e.partList,s.partList,function(I,x){x.elementaryStreams=I.elementaryStreams,x.stats=I.stats}),v?o(s,v,v.startPTS,v.endPTS,v.startDTS,v.endDTS):T(e,s),a.length&&(s.totalduration=s.edge-a[0].start),s.driftStartTime=e.driftStartTime,s.driftStart=e.driftStart;var b=s.advancedDateTime;if(s.advanced&&b){var A=s.edge;s.driftStart||(s.driftStartTime=b,s.driftStart=A),s.driftEndTime=b,s.driftEnd=A}else s.driftEndTime=e.driftEndTime,s.driftEnd=e.driftEnd,s.advancedDateTime=e.advancedDateTime}function m(e,s,l){if(e&&s)for(var n=0,u=0,p=e.length;u<=p;u++){var v=e[u],g=s[u+n];v&&g&&v.index===g.index&&v.fragment.sn===g.fragment.sn?l(v,g):n--}}function h(e,s,l){for(var n=s.skippedSegments,u=Math.max(e.startSN,s.startSN)-s.startSN,p=(e.fragmentHint?1:0)+(n?s.endSN:Math.min(e.endSN,s.endSN))-s.startSN,v=s.startSN-e.startSN,g=s.fragmentHint?s.fragments.concat(s.fragmentHint):s.fragments,r=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,a=u;a<=p;a++){var c=r[v+a],b=g[a];n&&!b&&a<n&&(b=s.fragments[a]=c),c&&b&&l(c,b)}}function T(e,s){var l=s.startSN+s.skippedSegments-e.startSN,n=e.fragments;l<0||l>=n.length||y(s,n[l].start)}function y(e,s){if(s){for(var l=e.fragments,n=e.skippedSegments;n<l.length;n++)l[n].start+=s;e.fragmentHint&&(e.fragmentHint.start+=s)}}function d(e,s){var l,n=1e3*e.levelTargetDuration,u=n/2,p=e.age,v=p>0&&p<3*n,g=s.loading.end-s.loading.start,r=e.availabilityDelay;if(e.updated===!1)if(v){var a=333*e.misses;l=Math.max(Math.min(u,2*g),a),e.availabilityDelay=(e.availabilityDelay||0)+l}else l=u;else v?(r=Math.min(r||n/2,p),e.availabilityDelay=r,l=r+n-p):l=n-g;return Math.round(l)}function t(e,s,l){if(!e||!e.details)return null;var n=e.details,u=n.fragments[s-n.startSN];return u||((u=n.fragmentHint)&&u.sn===s?u:s<n.startSN&&l&&l.sn===s?l:null)}function i(e,s,l){if(!e||!e.details)return null;var n=e.details.partList;if(n)for(var u=n.length;u--;){var p=n[u];if(p.index===l&&p.fragment.sn===s)return p}return null}},"./src/controller/stream-controller.ts":function(P,C,f){f.r(C),f.d(C,"default",function(){return e});var R=f("./src/polyfills/number.ts"),E=f("./src/controller/base-stream-controller.ts"),L=f("./src/is-supported.ts"),k=f("./src/events.ts"),_=f("./src/utils/buffer-helper.ts"),D=f("./src/controller/fragment-tracker.ts"),o=f("./src/types/loader.ts"),S=f("./src/loader/fragment.ts"),m=f("./src/demux/transmuxer-interface.ts"),h=f("./src/types/transmuxer.ts"),T=f("./src/controller/gap-controller.ts"),y=f("./src/errors.ts"),d=f("./src/utils/logger.ts");function t(s,l){for(var n=0;n<l.length;n++){var u=l[n];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(s,u.key,u)}}function i(s,l){return(i=Object.setPrototypeOf||function(n,u){return n.__proto__=u,n})(s,l)}var e=function(s){var l,n;function u(r,a){var c;return(c=s.call(this,r,a,"[stream-controller]")||this).audioCodecSwap=!1,c.gapController=null,c.level=-1,c._forceStartLoad=!1,c.altAudio=!1,c.audioOnly=!1,c.fragPlaying=null,c.onvplaying=null,c.onvseeked=null,c.fragLastKbps=0,c.stalled=!1,c.couldBacktrack=!1,c.audioCodecSwitch=!1,c.videoBuffer=null,c._registerListeners(),c}n=s,(l=u).prototype=Object.create(n.prototype),l.prototype.constructor=l,i(l,n);var p,v,g=u.prototype;return g._registerListeners=function(){var r=this.hls;r.on(k.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(k.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(k.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(k.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.on(k.Events.LEVEL_LOADING,this.onLevelLoading,this),r.on(k.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.on(k.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),r.on(k.Events.ERROR,this.onError,this),r.on(k.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.on(k.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),r.on(k.Events.BUFFER_CREATED,this.onBufferCreated,this),r.on(k.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.on(k.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),r.on(k.Events.FRAG_BUFFERED,this.onFragBuffered,this)},g._unregisterListeners=function(){var r=this.hls;r.off(k.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(k.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(k.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(k.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.off(k.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.off(k.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),r.off(k.Events.ERROR,this.onError,this),r.off(k.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.off(k.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),r.off(k.Events.BUFFER_CREATED,this.onBufferCreated,this),r.off(k.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.off(k.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),r.off(k.Events.FRAG_BUFFERED,this.onFragBuffered,this)},g.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},g.startLoad=function(r){if(this.levels){var a=this.lastCurrentTime,c=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var b=c.startLevel;b===-1&&(c.config.testBandwidth?(b=0,this.bitrateTest=!0):b=c.nextAutoLevel),this.level=c.nextLoadLevel=b,this.loadedmetadata=!1}a>0&&r===-1&&(this.log("Override startPosition with lastCurrentTime @"+a.toFixed(3)),r=a),this.state=E.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=r,this.tick()}else this._forceStartLoad=!0,this.state=E.State.STOPPED},g.stopLoad=function(){this._forceStartLoad=!1,s.prototype.stopLoad.call(this)},g.doTick=function(){switch(this.state){case E.State.IDLE:this.doTickIdle();break;case E.State.WAITING_LEVEL:var r,a=this.levels,c=this.level,b=a==null||(r=a[c])===null||r===void 0?void 0:r.details;if(b&&(!b.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(b))break;this.state=E.State.IDLE;break}break;case E.State.FRAG_LOADING_WAITING_RETRY:var A,I=self.performance.now(),x=this.retryDate;(!x||I>=x||(A=this.media)!==null&&A!==void 0&&A.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=E.State.IDLE)}this.onTickEnd()},g.onTickEnd=function(){s.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},g.doTickIdle=function(){var r,a,c=this.hls,b=this.levelLastLoaded,A=this.levels,I=this.media,x=c.config,w=c.nextLoadLevel;if(b!==null&&(I||!this.startFragRequested&&x.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&A&&A[w]){var O=A[w];this.level=c.nextLoadLevel=w;var F=O.details;if(!F||this.state===E.State.WAITING_LEVEL||F.live&&this.levelLastLoaded!==w)this.state=E.State.WAITING_LEVEL;else{var M=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:I,o.PlaylistLevelType.MAIN);if(M!==null&&!(M.len>=this.getMaxBufferLength(O.maxBitrate))){if(this._streamEnded(M,F)){var N={};return this.altAudio&&(N.type="video"),this.hls.trigger(k.Events.BUFFER_EOS,N),void(this.state=E.State.ENDED)}var B=M.end,U=this.getNextFragment(B,F);if(this.couldBacktrack&&!this.fragPrevious&&U&&U.sn!=="initSegment"){var G=U.sn-F.startSN;G>1&&(U=F.fragments[G-1],this.fragmentTracker.removeFragment(U))}if(U&&this.fragmentTracker.getState(U)===D.FragmentState.OK&&this.nextLoadPosition>B){var H=this.audioOnly&&!this.altAudio?S.ElementaryStreamTypes.AUDIO:S.ElementaryStreamTypes.VIDEO;this.afterBufferFlushed(I,H,o.PlaylistLevelType.MAIN),U=this.getNextFragment(this.nextLoadPosition,F)}U&&(!U.initSegment||U.initSegment.data||this.bitrateTest||(U=U.initSegment),((r=U.decryptdata)===null||r===void 0?void 0:r.keyFormat)!=="identity"||(a=U.decryptdata)!==null&&a!==void 0&&a.key?this.loadFragment(U,F,B):this.loadKey(U,F))}}}},g.loadFragment=function(r,a,c){var b,A=this.fragmentTracker.getState(r);if(this.fragCurrent=r,A===D.FragmentState.BACKTRACKED){var I=this.fragmentTracker.getBacktrackData(r);if(I)return this._handleFragmentLoadProgress(I),void this._handleFragmentLoadComplete(I);A=D.FragmentState.NOT_LOADED}A===D.FragmentState.NOT_LOADED||A===D.FragmentState.PARTIAL?r.sn==="initSegment"?this._loadInitSegment(r):this.bitrateTest?(r.bitrateTest=!0,this.log("Fragment "+r.sn+" of level "+r.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(r)):(this.startFragRequested=!0,s.prototype.loadFragment.call(this,r,a,c)):A===D.FragmentState.APPENDING?this.reduceMaxBufferLength(r.duration)&&this.fragmentTracker.removeFragment(r):((b=this.media)===null||b===void 0?void 0:b.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},g.getAppendedFrag=function(r){var a=this.fragmentTracker.getAppendedFrag(r,o.PlaylistLevelType.MAIN);return a&&"fragment"in a?a.fragment:a},g.getBufferedFrag=function(r){return this.fragmentTracker.getBufferedFrag(r,o.PlaylistLevelType.MAIN)},g.followingBufferedFrag=function(r){return r?this.getBufferedFrag(r.end+.5):null},g.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},g.nextLevelSwitch=function(){var r=this.levels,a=this.media;if(a!=null&&a.readyState){var c,b=this.getAppendedFrag(a.currentTime);if(b&&b.start>1&&this.flushMainBuffer(0,b.start-1),!a.paused&&r){var A=r[this.hls.nextLoadLevel],I=this.fragLastKbps;c=I&&this.fragCurrent?this.fragCurrent.duration*A.maxBitrate/(1e3*I)+1:0}else c=0;var x=this.getBufferedFrag(a.currentTime+c);if(x){var w=this.followingBufferedFrag(x);if(w){this.abortCurrentFrag();var O=w.maxStartPTS?w.maxStartPTS:w.start,F=w.duration,M=Math.max(x.end,O+Math.min(Math.max(F-this.config.maxFragLookUpTolerance,.5*F),.75*F));this.flushMainBuffer(M,Number.POSITIVE_INFINITY)}}}},g.abortCurrentFrag=function(){var r=this.fragCurrent;this.fragCurrent=null,r!=null&&r.loader&&r.loader.abort(),this.state===E.State.KEY_LOADING&&(this.state=E.State.IDLE),this.nextLoadPosition=this.getLoadPosition()},g.flushMainBuffer=function(r,a){s.prototype.flushMainBuffer.call(this,r,a,this.altAudio?"video":null)},g.onMediaAttached=function(r,a){s.prototype.onMediaAttached.call(this,r,a);var c=a.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),c.addEventListener("playing",this.onvplaying),c.addEventListener("seeked",this.onvseeked),this.gapController=new T.default(this.config,c,this.fragmentTracker,this.hls)},g.onMediaDetaching=function(){var r=this.media;r&&(r.removeEventListener("playing",this.onvplaying),r.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),s.prototype.onMediaDetaching.call(this)},g.onMediaPlaying=function(){this.tick()},g.onMediaSeeked=function(){var r=this.media,a=r?r.currentTime:null;Object(R.isFiniteNumber)(a)&&this.log("Media seeked to "+a.toFixed(3)),this.tick()},g.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(k.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=this.stalled=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null},g.onManifestParsed=function(r,a){var c,b=!1,A=!1;a.levels.forEach(function(I){(c=I.audioCodec)&&(c.indexOf("mp4a.40.2")!==-1&&(b=!0),c.indexOf("mp4a.40.5")!==-1&&(A=!0))}),this.audioCodecSwitch=b&&A&&!Object(L.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=a.levels,this.startFragRequested=!1},g.onLevelLoading=function(r,a){var c=this.levels;if(c&&this.state===E.State.IDLE){var b=c[a.level];(!b.details||b.details.live&&this.levelLastLoaded!==a.level||this.waitForCdnTuneIn(b.details))&&(this.state=E.State.WAITING_LEVEL)}},g.onLevelLoaded=function(r,a){var c,b=this.levels,A=a.level,I=a.details,x=I.totalduration;if(b){this.log("Level "+A+" loaded ["+I.startSN+","+I.endSN+"], cc ["+I.startCC+", "+I.endCC+"] duration:"+x);var w=this.fragCurrent;!w||this.state!==E.State.FRAG_LOADING&&this.state!==E.State.FRAG_LOADING_WAITING_RETRY||w.level!==a.level&&w.loader&&(this.state=E.State.IDLE,w.loader.abort());var O=b[A],F=0;if(I.live||(c=O.details)!==null&&c!==void 0&&c.live){if(I.fragments[0]||(I.deltaUpdateFailed=!0),I.deltaUpdateFailed)return;F=this.alignPlaylists(I,O.details)}if(O.details=I,this.levelLastLoaded=A,this.hls.trigger(k.Events.LEVEL_UPDATED,{details:I,level:A}),this.state===E.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(I))return;this.state=E.State.IDLE}this.startFragRequested?I.live&&this.synchronizeToLiveEdge(I):this.setStartPosition(I,F),this.tick()}else this.warn("Levels were reset while loading level "+A)},g._handleFragmentLoadProgress=function(r){var a,c=r.frag,b=r.part,A=r.payload,I=this.levels;if(I){var x=I[c.level],w=x.details;if(w){var O=x.videoCodec,F=w.PTSKnown||!w.live,M=(a=c.initSegment)===null||a===void 0?void 0:a.data,N=this._getAudioCodec(x),B=this.transmuxer=this.transmuxer||new m.default(this.hls,o.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),U=b?b.index:-1,G=U!==-1,H=new h.ChunkMetadata(c.level,c.sn,c.stats.chunkCount,A.byteLength,U,G),z=this.initPTS[c.cc];B.push(A,M,N,O,c,b,w.totalduration,F,H,z)}else this.warn("Dropping fragment "+c.sn+" of level "+c.level+" after level details were reset")}else this.warn("Levels were reset while fragment load was in progress. Fragment "+c.sn+" of level "+c.level+" will not be buffered")},g.onAudioTrackSwitching=function(r,a){var c=this.altAudio,b=!!a.url,A=a.id;if(!b){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var I=this.fragCurrent;I!=null&&I.loader&&(this.log("Switching to main audio track, cancel main fragment load"),I.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var x=this.hls;c&&x.trigger(k.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),x.trigger(k.Events.AUDIO_TRACK_SWITCHED,{id:A})}},g.onAudioTrackSwitched=function(r,a){var c=a.id,b=!!this.hls.audioTracks[c].url;if(b){var A=this.videoBuffer;A&&this.mediaBuffer!==A&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=A)}this.altAudio=b,this.tick()},g.onBufferCreated=function(r,a){var c,b,A=a.tracks,I=!1;for(var x in A){var w=A[x];if(w.id==="main"){if(b=x,c=w,x==="video"){var O=A[x];O&&(this.videoBuffer=O.buffer)}}else I=!0}I&&c?(this.log("Alternate track found, use "+b+".buffered to schedule main fragment loading"),this.mediaBuffer=c.buffer):this.mediaBuffer=this.media},g.onFragBuffered=function(r,a){var c=a.frag,b=a.part;if(!c||c.type===o.PlaylistLevelType.MAIN){if(this.fragContextChanged(c))return this.warn("Fragment "+c.sn+(b?" p: "+b.index:"")+" of level "+c.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===E.State.PARSED&&(this.state=E.State.IDLE));var A=b?b.stats:c.stats;this.fragLastKbps=Math.round(8*A.total/(A.buffering.end-A.loading.first)),c.sn!=="initSegment"&&(this.fragPrevious=c),this.fragBufferedComplete(c,b)}},g.onError=function(r,a){switch(a.details){case y.ErrorDetails.FRAG_LOAD_ERROR:case y.ErrorDetails.FRAG_LOAD_TIMEOUT:case y.ErrorDetails.KEY_LOAD_ERROR:case y.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(o.PlaylistLevelType.MAIN,a);break;case y.ErrorDetails.LEVEL_LOAD_ERROR:case y.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==E.State.ERROR&&(a.fatal?(this.warn(""+a.details),this.state=E.State.ERROR):a.levelRetry||this.state!==E.State.WAITING_LEVEL||(this.state=E.State.IDLE));break;case y.ErrorDetails.BUFFER_FULL_ERROR:if(a.parent==="main"&&(this.state===E.State.PARSING||this.state===E.State.PARSED)){var c=!0,b=this.getFwdBufferInfo(this.media,o.PlaylistLevelType.MAIN);b&&b.len>.5&&(c=!this.reduceMaxBufferLength(b.len)),c&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}}},g.checkBuffer=function(){var r=this.media,a=this.gapController;if(r&&a&&r.readyState){var c=_.BufferHelper.getBuffered(r);!this.loadedmetadata&&c.length?(this.loadedmetadata=!0,this.seekToStartPos()):a.poll(this.lastCurrentTime),this.lastCurrentTime=r.currentTime}},g.onFragLoadEmergencyAborted=function(){this.state=E.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},g.onBufferFlushed=function(r,a){var c=a.type;if(c!==S.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var b=(c===S.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(b,c,o.PlaylistLevelType.MAIN)}},g.onLevelsUpdated=function(r,a){this.levels=a.levels},g.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},g.seekToStartPos=function(){var r=this.media,a=r.currentTime,c=this.startPosition;if(c>=0&&a<c){if(r.seeking)return void d.logger.log("could not seek to "+c+", already seeking at "+a);var b=_.BufferHelper.getBuffered(r),A=(b.length?b.start(0):0)-c;A>0&&A<this.config.maxBufferHole&&(d.logger.log("adjusting start position by "+A+" to match buffer start"),c+=A,this.startPosition=c),this.log("seek to target start position "+c+" from current time "+a),r.currentTime=c}},g._getAudioCodec=function(r){var a=this.config.defaultAudioCodec||r.audioCodec;return this.audioCodecSwap&&a&&(this.log("Swapping audio codec"),a=a.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),a},g._loadBitrateTestFrag=function(r){var a=this;this._doFragLoad(r).then(function(c){var b=a.hls;if(c&&!b.nextLoadLevel&&!a.fragContextChanged(r)){a.fragLoadError=0,a.state=E.State.IDLE,a.startFragRequested=!1,a.bitrateTest=!1;var A=r.stats;A.parsing.start=A.parsing.end=A.buffering.start=A.buffering.end=self.performance.now(),b.trigger(k.Events.FRAG_LOADED,c)}})},g._handleTransmuxComplete=function(r){var a,c="main",b=this.hls,A=r.remuxResult,I=r.chunkMeta,x=this.getCurrentContext(I);if(!x)return this.warn("The loading context changed while buffering fragment "+I.sn+" of level "+I.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(I.level);var w=x.frag,O=x.part,F=x.level,M=A.video,N=A.text,B=A.id3,U=A.initSegment,G=this.altAudio?void 0:A.audio;if(!this.fragContextChanged(w)){if(this.state=E.State.PARSING,U){U.tracks&&(this._bufferInitSegment(F,U.tracks,w,I),b.trigger(k.Events.FRAG_PARSING_INIT_SEGMENT,{frag:w,id:c,tracks:U.tracks}));var H=U.initPTS,z=U.timescale;Object(R.isFiniteNumber)(H)&&(this.initPTS[w.cc]=H,b.trigger(k.Events.INIT_PTS_FOUND,{frag:w,id:c,initPTS:H,timescale:z}))}if(M&&A.independent!==!1){if(F.details){var Y=M.startPTS,W=M.endPTS,$=M.startDTS,ie=M.endDTS;if(O)O.elementaryStreams[M.type]={startPTS:Y,endPTS:W,startDTS:$,endDTS:ie};else if(M.firstKeyFrame&&M.independent&&(this.couldBacktrack=!0),M.dropped&&M.independent){if(this.getLoadPosition()+this.config.maxBufferHole<Y)return void this.backtrack(w);w.setElementaryStreamInfo(M.type,w.start,W,w.start,ie,!0)}w.setElementaryStreamInfo(M.type,Y,W,$,ie),this.bufferFragmentData(M,w,O,I)}}else if(A.independent===!1)return void this.backtrack(w);if(G){var ae=G.startPTS,ue=G.endPTS,Z=G.startDTS,se=G.endDTS;O&&(O.elementaryStreams[S.ElementaryStreamTypes.AUDIO]={startPTS:ae,endPTS:ue,startDTS:Z,endDTS:se}),w.setElementaryStreamInfo(S.ElementaryStreamTypes.AUDIO,ae,ue,Z,se),this.bufferFragmentData(G,w,O,I)}if(B!=null&&(a=B.samples)!==null&&a!==void 0&&a.length){var te={frag:w,id:c,samples:B.samples};b.trigger(k.Events.FRAG_PARSING_METADATA,te)}if(N){var ne={frag:w,id:c,samples:N.samples};b.trigger(k.Events.FRAG_PARSING_USERDATA,ne)}}},g._bufferInitSegment=function(r,a,c,b){var A=this;if(this.state===E.State.PARSING){this.audioOnly=!!a.audio&&!a.video,this.altAudio&&!this.audioOnly&&delete a.audio;var I=a.audio,x=a.video,w=a.audiovideo;if(I){var O=r.audioCodec,F=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(O&&(O=O.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),I.metadata.channelCount!==1&&F.indexOf("firefox")===-1&&(O="mp4a.40.5")),F.indexOf("android")!==-1&&I.container!=="audio/mpeg"&&(O="mp4a.40.2",this.log("Android: force audio codec to "+O)),r.audioCodec&&r.audioCodec!==O&&this.log('Swapping manifest audio codec "'+r.audioCodec+'" for "'+O+'"'),I.levelCodec=O,I.id="main",this.log("Init audio buffer, container:"+I.container+", codecs[selected/level/parsed]=["+(O||"")+"/"+(r.audioCodec||"")+"/"+I.codec+"]")}x&&(x.levelCodec=r.videoCodec,x.id="main",this.log("Init video buffer, container:"+x.container+", codecs[level/parsed]=["+(r.videoCodec||"")+"/"+x.codec+"]")),w&&this.log("Init audiovideo buffer, container:"+w.container+", codecs[level/parsed]=["+(r.attrs.CODECS||"")+"/"+w.codec+"]"),this.hls.trigger(k.Events.BUFFER_CODECS,a),Object.keys(a).forEach(function(M){var N=a[M].initSegment;N!=null&&N.byteLength&&A.hls.trigger(k.Events.BUFFER_APPENDING,{type:M,data:N,frag:c,part:null,chunkMeta:b,parent:c.type})}),this.tick()}},g.backtrack=function(r){this.couldBacktrack=!0,this.resetTransmuxer(),this.flushBufferGap(r);var a=this.fragmentTracker.backtrack(r);this.fragPrevious=null,this.nextLoadPosition=r.start,a?this.resetFragmentLoading(r):this.state=E.State.BACKTRACKING},g.checkFragmentChanged=function(){var r=this.media,a=null;if(r&&r.readyState>1&&r.seeking===!1){var c=r.currentTime;if(_.BufferHelper.isBuffered(r,c)?a=this.getAppendedFrag(c):_.BufferHelper.isBuffered(r,c+.1)&&(a=this.getAppendedFrag(c+.1)),a){var b=this.fragPlaying,A=a.level;b&&a.sn===b.sn&&b.level===A&&a.urlId===b.urlId||(this.hls.trigger(k.Events.FRAG_CHANGED,{frag:a}),b&&b.level===A||this.hls.trigger(k.Events.LEVEL_SWITCHED,{level:A}),this.fragPlaying=a)}}},p=u,(v=[{key:"nextLevel",get:function(){var r=this.nextBufferedFrag;return r?r.level:-1}},{key:"currentLevel",get:function(){var r=this.media;if(r){var a=this.getAppendedFrag(r.currentTime);if(a)return a.level}return-1}},{key:"nextBufferedFrag",get:function(){var r=this.media;if(r){var a=this.getAppendedFrag(r.currentTime);return this.followingBufferedFrag(a)}return null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}])&&t(p.prototype,v),u}(E.default)},"./src/controller/subtitle-stream-controller.ts":function(P,C,f){f.r(C),f.d(C,"SubtitleStreamController",function(){return d});var R=f("./src/events.ts"),E=f("./src/utils/logger.ts"),L=f("./src/utils/buffer-helper.ts"),k=f("./src/controller/fragment-finders.ts"),_=f("./src/utils/discontinuities.ts"),D=f("./src/controller/level-helper.ts"),o=f("./src/controller/fragment-tracker.ts"),S=f("./src/controller/base-stream-controller.ts"),m=f("./src/types/loader.ts"),h=f("./src/types/level.ts");function T(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function y(t,i){return(y=Object.setPrototypeOf||function(e,s){return e.__proto__=s,e})(t,i)}var d=function(t){var i,e;function s(p,v){var g;return(g=t.call(this,p,v,"[subtitle-stream-controller]")||this).levels=[],g.currentTrackId=-1,g.tracksBuffered=[],g.mainDetails=null,g._registerListeners(),g}e=t,(i=s).prototype=Object.create(e.prototype),i.prototype.constructor=i,y(i,e);var l,n,u=s.prototype;return u.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},u._registerListeners=function(){var p=this.hls;p.on(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),p.on(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),p.on(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),p.on(R.Events.LEVEL_LOADED,this.onLevelLoaded,this),p.on(R.Events.ERROR,this.onError,this),p.on(R.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),p.on(R.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),p.on(R.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),p.on(R.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),p.on(R.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},u._unregisterListeners=function(){var p=this.hls;p.off(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),p.off(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),p.off(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),p.off(R.Events.LEVEL_LOADED,this.onLevelLoaded,this),p.off(R.Events.ERROR,this.onError,this),p.off(R.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),p.off(R.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),p.off(R.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),p.off(R.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),p.off(R.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},u.startLoad=function(){this.stopLoad(),this.state=S.State.IDLE,this.setInterval(500),this.tick()},u.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},u.onLevelLoaded=function(p,v){this.mainDetails=v.details},u.onSubtitleFragProcessed=function(p,v){var g=v.frag,r=v.success;if(this.fragPrevious=g,this.state=S.State.IDLE,r){var a=this.tracksBuffered[this.currentTrackId];if(a){for(var c,b=g.start,A=0;A<a.length;A++)if(b>=a[A].start&&b<=a[A].end){c=a[A];break}var I=g.start+g.duration;c?c.end=I:(c={start:b,end:I},a.push(c)),this.fragmentTracker.fragBuffered(g)}}},u.onBufferFlushing=function(p,v){var g=v.startOffset,r=v.endOffset;if(g===0&&r!==Number.POSITIVE_INFINITY){var a=this.currentTrackId,c=this.levels;if(!c.length||!c[a]||!c[a].details)return;var b=r-c[a].details.targetduration;if(b<=0)return;v.endOffsetSubtitles=Math.max(0,b),this.tracksBuffered.forEach(function(A){for(var I=0;I<A.length;)if(A[I].end<=b)A.shift();else{if(!(A[I].start<b))break;A[I].start=b,I++}}),this.fragmentTracker.removeFragmentsInRange(g,b,m.PlaylistLevelType.SUBTITLE)}},u.onError=function(p,v){var g,r=v.frag;r&&r.type===m.PlaylistLevelType.SUBTITLE&&((g=this.fragCurrent)!==null&&g!==void 0&&g.loader&&this.fragCurrent.loader.abort(),this.state=S.State.IDLE)},u.onSubtitleTracksUpdated=function(p,v){var g=this,r=v.subtitleTracks;this.tracksBuffered=[],this.levels=r.map(function(a){return new h.Level(a)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(a){g.tracksBuffered[a.id]=[]}),this.mediaBuffer=null},u.onSubtitleTrackSwitch=function(p,v){if(this.currentTrackId=v.id,this.levels.length&&this.currentTrackId!==-1){var g=this.levels[this.currentTrackId];g!=null&&g.details?(this.mediaBuffer=this.mediaBufferTimeRanges,this.setInterval(500)):this.mediaBuffer=null}else this.clearInterval()},u.onSubtitleTrackLoaded=function(p,v){var g,r=v.details,a=v.id,c=this.currentTrackId,b=this.levels;if(b.length){var A=b[c];if(!(a>=b.length||a!==c)&&A){if(this.mediaBuffer=this.mediaBufferTimeRanges,r.live||(g=A.details)!==null&&g!==void 0&&g.live){var I=this.mainDetails;if(r.deltaUpdateFailed||!I)return;var x=I.fragments[0];A.details?this.alignPlaylists(r,A.details)===0&&x&&Object(D.addSliding)(r,x.start):r.hasProgramDateTime&&I.hasProgramDateTime?Object(_.alignPDT)(r,I):x&&Object(D.addSliding)(r,x.start)}A.details=r,this.levelLastLoaded=a,this.tick(),r.live&&!this.fragCurrent&&this.media&&this.state===S.State.IDLE&&(Object(k.findFragmentByPTS)(null,r.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),A.details=void 0))}}},u._handleFragmentLoadComplete=function(p){var v=p.frag,g=p.payload,r=v.decryptdata,a=this.hls;if(!this.fragContextChanged(v)&&g&&g.byteLength>0&&r&&r.key&&r.iv&&r.method==="AES-128"){var c=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(g),r.key.buffer,r.iv.buffer).then(function(b){var A=performance.now();a.trigger(R.Events.FRAG_DECRYPTED,{frag:v,payload:b,stats:{tstart:c,tdecrypt:A}})})}},u.doTick=function(){if(this.media){if(this.state===S.State.IDLE){var p,v=this.currentTrackId,g=this.levels;if(!g.length||!g[v]||!g[v].details)return;var r=g[v].details,a=r.targetduration,c=this.config,b=this.media,A=L.BufferHelper.bufferedInfo(this.mediaBufferTimeRanges,b.currentTime-a,c.maxBufferHole),I=A.end;if(A.len>this.getMaxBufferLength()+a)return;console.assert(r,"Subtitle track details are defined on idle subtitle stream controller tick");var x,w=r.fragments,O=w.length,F=r.edge,M=this.fragPrevious;if(I<F){var N=c.maxFragLookUpTolerance;M&&r.hasProgramDateTime&&(x=Object(k.findFragmentByPDT)(w,M.endProgramDateTime,N)),x||!(x=Object(k.findFragmentByPTS)(M,w,I,N))&&M&&M.start<w[0].start&&(x=w[0])}else x=w[O-1];(p=x)!==null&&p!==void 0&&p.encrypted?(E.logger.log("Loading key for "+x.sn),this.state=S.State.KEY_LOADING,this.hls.trigger(R.Events.KEY_LOADING,{frag:x})):x&&this.fragmentTracker.getState(x)===o.FragmentState.NOT_LOADED&&this.loadFragment(x,r,I)}}else this.state=S.State.IDLE},u.loadFragment=function(p,v,g){this.fragCurrent=p,t.prototype.loadFragment.call(this,p,v,g)},l=s,(n=[{key:"mediaBufferTimeRanges",get:function(){return this.tracksBuffered[this.currentTrackId]||[]}}])&&T(l.prototype,n),s}(S.default)},"./src/controller/subtitle-track-controller.ts":function(P,C,f){f.r(C);var R=f("./src/events.ts"),E=f("./src/utils/texttrack-utils.ts"),L=f("./src/controller/base-playlist-controller.ts"),k=f("./src/types/loader.ts");function _(m,h){for(var T=0;T<h.length;T++){var y=h[T];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(m,y.key,y)}}function D(m,h){return(D=Object.setPrototypeOf||function(T,y){return T.__proto__=y,T})(m,h)}var o=function(m){var h,T;function y(e){var s;return(s=m.call(this,e,"[subtitle-track-controller]")||this).media=null,s.tracks=[],s.groupId=null,s.tracksInGroup=[],s.trackId=-1,s.selectDefaultTrack=!0,s.queuedDefaultTrack=-1,s.trackChangeListener=function(){return s.onTextTracksChanged()},s.asyncPollTrackChange=function(){return s.pollTrackChange(0)},s.useTextTrackPolling=!1,s.subtitlePollingInterval=-1,s.subtitleDisplay=!0,s.registerListeners(),s}T=m,(h=y).prototype=Object.create(T.prototype),h.prototype.constructor=h,D(h,T);var d,t,i=y.prototype;return i.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,m.prototype.destroy.call(this)},i.registerListeners=function(){var e=this.hls;e.on(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(R.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(R.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(R.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(R.Events.ERROR,this.onError,this)},i.unregisterListeners=function(){var e=this.hls;e.off(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(R.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(R.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(R.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(R.Events.ERROR,this.onError,this)},i.onMediaAttached=function(e,s){this.media=s.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},i.pollTrackChange=function(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,e)},i.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),S(this.media.textTracks).forEach(function(e){Object(E.clearCurrentCues)(e)}),this.subtitleTrack=-1,this.media=null)},i.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},i.onManifestParsed=function(e,s){this.tracks=s.subtitleTracks},i.onSubtitleTrackLoaded=function(e,s){var l=s.id,n=s.details,u=this.trackId,p=this.tracksInGroup[u];if(p){var v=p.details;p.details=s.details,this.log("subtitle track "+l+" loaded ["+n.startSN+"-"+n.endSN+"]"),l===this.trackId&&(this.retryCount=0,this.playlistLoaded(l,s,v))}else this.warn("Invalid subtitle track id "+l)},i.onLevelLoading=function(e,s){this.switchLevel(s.level)},i.onLevelSwitching=function(e,s){this.switchLevel(s.level)},i.switchLevel=function(e){var s=this.hls.levels[e];if(s!=null&&s.textGroupIds){var l=s.textGroupIds[s.urlId];if(this.groupId!==l){var n=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,u=this.tracks.filter(function(g){return!l||g.groupId===l});this.tracksInGroup=u;var p=this.findTrackId(n==null?void 0:n.name)||this.findTrackId();this.groupId=l;var v={subtitleTracks:u};this.log("Updating subtitle tracks, "+u.length+' track(s) found in "'+l+'" group-id'),this.hls.trigger(R.Events.SUBTITLE_TRACKS_UPDATED,v),p!==-1&&this.setSubtitleTrack(p,n)}}},i.findTrackId=function(e){for(var s=this.tracksInGroup,l=0;l<s.length;l++){var n=s[l];if((!this.selectDefaultTrack||n.default)&&(!e||e===n.name))return n.id}return-1},i.onError=function(e,s){m.prototype.onError.call(this,e,s),!s.fatal&&s.context&&s.context.type===k.PlaylistContextType.SUBTITLE_TRACK&&s.context.id===this.trackId&&s.context.groupId===this.groupId&&this.retryLoadingOrFail(s)},i.loadPlaylist=function(e){var s=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(s)){var l=s.id,n=s.groupId,u=s.url;if(e)try{u=e.addDirectives(u)}catch(p){this.warn("Could not construct new URL with HLS Delivery Directives: "+p)}this.log("Loading subtitle playlist for id "+l),this.hls.trigger(R.Events.SUBTITLE_TRACK_LOADING,{url:u,id:l,groupId:n,deliveryDirectives:e||null})}},i.toggleTrackModes=function(e){var s=this,l=this.media,n=this.subtitleDisplay,u=this.trackId;if(l){var p=S(l.textTracks),v=p.filter(function(a){return a.groupId===s.groupId});if(e===-1)[].slice.call(p).forEach(function(a){a.mode="disabled"});else{var g=v[u];g&&(g.mode="disabled")}var r=v[e];r&&(r.mode=n?"showing":"hidden")}},i.setSubtitleTrack=function(e,s){var l,n=this.tracksInGroup;if(this.media){if(this.trackId!==e&&this.toggleTrackModes(e),!(this.trackId===e&&(e===-1||(l=n[e])!==null&&l!==void 0&&l.details)||e<-1||e>=n.length)){this.clearTimer();var u=n[e];if(this.log("Switching to subtitle track "+e),this.trackId=e,u){var p=u.id,v=u.groupId,g=v===void 0?"":v,r=u.name,a=u.type,c=u.url;this.hls.trigger(R.Events.SUBTITLE_TRACK_SWITCH,{id:p,groupId:g,name:r,type:a,url:c});var b=this.switchParams(u.url,s==null?void 0:s.details);this.loadPlaylist(b)}else this.hls.trigger(R.Events.SUBTITLE_TRACK_SWITCH,{id:e})}}else this.queuedDefaultTrack=e},i.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var e=-1,s=S(this.media.textTracks),l=0;l<s.length;l++)if(s[l].mode==="hidden")e=l;else if(s[l].mode==="showing"){e=l;break}this.subtitleTrack!==e&&(this.subtitleTrack=e)}},d=y,(t=[{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.selectDefaultTrack=!1;var s=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(e,s)}}])&&_(d.prototype,t),y}(L.default);function S(m){for(var h=[],T=0;T<m.length;T++){var y=m[T];y.kind==="subtitles"&&y.label&&h.push(m[T])}return h}C.default=o},"./src/controller/timeline-controller.ts":function(P,C,f){f.r(C),f.d(C,"TimelineController",function(){return h});var R=f("./src/polyfills/number.ts"),E=f("./src/events.ts"),L=f("./src/utils/cea-608-parser.ts"),k=f("./src/utils/output-filter.ts"),_=f("./src/utils/webvtt-parser.ts"),D=f("./src/utils/texttrack-utils.ts"),o=f("./src/utils/imsc1-ttml-parser.ts"),S=f("./src/types/loader.ts"),m=f("./src/utils/logger.ts"),h=function(){function y(t){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this.captionsProperties=void 0,this.hls=t,this.config=t.config,this.Cues=t.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var i=new k.default(this,"textTrack1"),e=new k.default(this,"textTrack2"),s=new k.default(this,"textTrack3"),l=new k.default(this,"textTrack4");this.cea608Parser1=new L.default(1,i,e),this.cea608Parser2=new L.default(3,s,l)}t.on(E.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(E.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(E.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(E.Events.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(E.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(E.Events.FRAG_LOADING,this.onFragLoading,this),t.on(E.Events.FRAG_LOADED,this.onFragLoaded,this),t.on(E.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.on(E.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),t.on(E.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(E.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.on(E.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var d=y.prototype;return d.destroy=function(){var t=this.hls;t.off(E.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(E.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(E.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(E.Events.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(E.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(E.Events.FRAG_LOADING,this.onFragLoading,this),t.off(E.Events.FRAG_LOADED,this.onFragLoaded,this),t.off(E.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.off(E.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),t.off(E.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(E.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.off(E.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},d.addCues=function(t,i,e,s,l){for(var n,u,p,v,g=!1,r=l.length;r--;){var a=l[r],c=(n=a[0],u=a[1],p=i,v=e,Math.min(u,v)-Math.max(n,p));if(c>=0&&(a[0]=Math.min(a[0],i),a[1]=Math.max(a[1],e),g=!0,c/(e-i)>.5))return}if(g||l.push([i,e]),this.config.renderTextTracksNatively){var b=this.captionsTracks[t];this.Cues.newCue(b,i,e,s)}else{var A=this.Cues.newCue(null,i,e,s);this.hls.trigger(E.Events.CUES_PARSED,{type:"captions",cues:A,track:t})}},d.onInitPtsFound=function(t,i){var e=this,s=i.frag,l=i.id,n=i.initPTS,u=i.timescale,p=this.unparsedVttFrags;l==="main"&&(this.initPTS[s.cc]=n,this.timescale[s.cc]=u),p.length&&(this.unparsedVttFrags=[],p.forEach(function(v){e.onFragLoaded(E.Events.FRAG_LOADED,v)}))},d.getExistingTrack=function(t){var i=this.media;if(i)for(var e=0;e<i.textTracks.length;e++){var s=i.textTracks[e];if(s[t])return s}return null},d.createCaptionsTrack=function(t){this.config.renderTextTracksNatively?this.createNativeTrack(t):this.createNonNativeTrack(t)},d.createNativeTrack=function(t){if(!this.captionsTracks[t]){var i=this.captionsProperties,e=this.captionsTracks,s=this.media,l=i[t],n=l.label,u=l.languageCode,p=this.getExistingTrack(t);if(p)e[t]=p,Object(D.clearCurrentCues)(e[t]),Object(D.sendAddTrackEvent)(e[t],s);else{var v=this.createTextTrack("captions",n,u);v&&(v[t]=!0,e[t]=v)}}},d.createNonNativeTrack=function(t){if(!this.nonNativeCaptionsTracks[t]){var i=this.captionsProperties[t];if(i){var e={_id:t,label:i.label,kind:"captions",default:!!i.media&&!!i.media.default,closedCaptions:i.media};this.nonNativeCaptionsTracks[t]=e,this.hls.trigger(E.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[e]})}}},d.createTextTrack=function(t,i,e){var s=this.media;if(s)return s.addTextTrack(t,i,e)},d.onMediaAttaching=function(t,i){this.media=i.media,this._cleanTracks()},d.onMediaDetaching=function(){var t=this.captionsTracks;Object.keys(t).forEach(function(i){Object(D.clearCurrentCues)(t[i]),delete t[i]}),this.nonNativeCaptionsTracks={}},d.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},d._cleanTracks=function(){var t=this.media;if(t){var i=t.textTracks;if(i)for(var e=0;e<i.length;e++)Object(D.clearCurrentCues)(i[e])}},d.onSubtitleTracksUpdated=function(t,i){var e=this;this.textTracks=[];var s=i.subtitleTracks||[],l=s.some(function(v){return v.textCodec===o.IMSC1_CODEC});if(this.config.enableWebVTT||l&&this.config.enableIMSC1){var n=this.tracks&&s&&this.tracks.length===s.length;if(this.tracks=s||[],this.config.renderTextTracksNatively){var u=this.media?this.media.textTracks:[];this.tracks.forEach(function(v,g){var r;if(g<u.length){for(var a=null,c=0;c<u.length;c++)if(T(u[c],v)){a=u[c];break}a&&(r=a)}r?Object(D.clearCurrentCues)(r):(r=e.createTextTrack("subtitles",v.name,v.lang))&&(r.mode="disabled"),r&&(r.groupId=v.groupId,e.textTracks.push(r))})}else if(!n&&this.tracks&&this.tracks.length){var p=this.tracks.map(function(v){return{label:v.name,kind:v.type.toLowerCase(),default:v.default,subtitleTrack:v}});this.hls.trigger(E.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:p})}}},d.onManifestLoaded=function(t,i){var e=this;this.config.enableCEA708Captions&&i.captions&&i.captions.forEach(function(s){var l=/(?:CC|SERVICE)([1-4])/.exec(s.instreamId);if(l){var n="textTrack"+l[1],u=e.captionsProperties[n];u&&(u.label=s.name,s.lang&&(u.languageCode=s.lang),u.media=s)}})},d.onFragLoading=function(t,i){var e=this.cea608Parser1,s=this.cea608Parser2,l=this.lastSn;if(this.enabled&&e&&s&&i.frag.type===S.PlaylistLevelType.MAIN){var n=i.frag.sn;n!==l+1&&(e.reset(),s.reset()),this.lastSn=n}},d.onFragLoaded=function(t,i){var e=i.frag,s=i.payload,l=this.initPTS,n=this.unparsedVttFrags;if(e.type===S.PlaylistLevelType.SUBTITLE)if(s.byteLength){if(!Object(R.isFiniteNumber)(l[e.cc]))return n.push(i),void(l.length&&this.hls.trigger(E.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:new Error("Missing initial subtitle PTS")}));var u=e.decryptdata;if(u==null||u.key==null||u.method!=="AES-128"){var p=this.tracks[e.level],v=this.vttCCs;v[e.cc]||(v[e.cc]={start:e.start,prevCC:this.prevCC,new:!0},this.prevCC=e.cc),p&&p.textCodec===o.IMSC1_CODEC?this._parseIMSC1(e,s):this._parseVTTs(e,s,v)}}else this.hls.trigger(E.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:new Error("Empty subtitle payload")})},d._parseIMSC1=function(t,i){var e=this,s=this.hls;Object(o.parseIMSC1)(i,this.initPTS[t.cc],this.timescale[t.cc],function(l){e._appendCues(l,t.level),s.trigger(E.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})},function(l){m.logger.log("Failed to parse IMSC1: "+l),s.trigger(E.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:l})})},d._parseVTTs=function(t,i,e){var s=this,l=this.hls;Object(_.parseWebVTT)(i,this.initPTS[t.cc],this.timescale[t.cc],e,t.cc,t.start,function(n){s._appendCues(n,t.level),l.trigger(E.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})},function(n){s._fallbackToIMSC1(t,i),m.logger.log("Failed to parse VTT cue: "+n),l.trigger(E.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:n})})},d._fallbackToIMSC1=function(t,i){var e=this,s=this.tracks[t.level];s.textCodec||Object(o.parseIMSC1)(i,this.initPTS[t.cc],this.timescale[t.cc],function(){s.textCodec=o.IMSC1_CODEC,e._parseIMSC1(t,i)},function(){s.textCodec="wvtt"})},d._appendCues=function(t,i){var e=this.hls;if(this.config.renderTextTracksNatively){var s=this.textTracks[i];if(s.mode==="disabled")return;t.forEach(function(n){return Object(D.addCueToTrack)(s,n)})}else{var l=this.tracks[i].default?"default":"subtitles"+i;e.trigger(E.Events.CUES_PARSED,{type:"subtitles",cues:t,track:l})}},d.onFragDecrypted=function(t,i){var e=i.frag;if(e.type===S.PlaylistLevelType.SUBTITLE){if(!Object(R.isFiniteNumber)(this.initPTS[e.cc]))return void this.unparsedVttFrags.push(i);this.onFragLoaded(E.Events.FRAG_LOADED,i)}},d.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},d.onFragParsingUserdata=function(t,i){var e=this.cea608Parser1,s=this.cea608Parser2;if(this.enabled&&e&&s)for(var l=0;l<i.samples.length;l++){var n=i.samples[l].bytes;if(n){var u=this.extractCea608Data(n);e.addData(i.samples[l].pts,u[0]),s.addData(i.samples[l].pts,u[1])}}},d.onBufferFlushing=function(t,i){var e=i.startOffset,s=i.endOffset,l=i.endOffsetSubtitles,n=i.type,u=this.media;if(u&&!(u.currentTime<s)){if(!n||n==="video"){var p=this.captionsTracks;Object.keys(p).forEach(function(g){return Object(D.removeCuesInRange)(p[g],e,s)})}if(this.config.renderTextTracksNatively&&e===0&&l!==void 0){var v=this.textTracks;Object.keys(v).forEach(function(g){return Object(D.removeCuesInRange)(v[g],e,l)})}}},d.extractCea608Data=function(t){for(var i=31&t[0],e=2,s=[[],[]],l=0;l<i;l++){var n=t[e++],u=127&t[e++],p=127&t[e++],v=3&n;u===0&&p===0||(4&n)!=0&&(v!==0&&v!==1||(s[v].push(u),s[v].push(p)))}return s},y}();function T(y,d){return y&&y.label===d.name&&!(y.textTrack1||y.textTrack2)}},"./src/crypt/aes-crypto.ts":function(P,C,f){f.r(C),f.d(C,"default",function(){return R});var R=function(){function E(L,k){this.subtle=void 0,this.aesIV=void 0,this.subtle=L,this.aesIV=k}return E.prototype.decrypt=function(L,k){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},k,L)},E}()},"./src/crypt/aes-decryptor.ts":function(P,C,f){f.r(C),f.d(C,"removePadding",function(){return E}),f.d(C,"default",function(){return L});var R=f("./src/utils/typed-array.ts");function E(k){var _=k.byteLength,D=_&&new DataView(k.buffer).getUint8(_-1);return D?Object(R.sliceUint8)(k,0,_-D):k}var L=function(){function k(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var _=k.prototype;return _.uint8ArrayToUint32Array_=function(D){for(var o=new DataView(D),S=new Uint32Array(4),m=0;m<4;m++)S[m]=o.getUint32(4*m);return S},_.initTable=function(){var D=this.sBox,o=this.invSBox,S=this.subMix,m=S[0],h=S[1],T=S[2],y=S[3],d=this.invSubMix,t=d[0],i=d[1],e=d[2],s=d[3],l=new Uint32Array(256),n=0,u=0,p=0;for(p=0;p<256;p++)l[p]=p<128?p<<1:p<<1^283;for(p=0;p<256;p++){var v=u^u<<1^u<<2^u<<3^u<<4;v=v>>>8^255&v^99,D[n]=v,o[v]=n;var g=l[n],r=l[g],a=l[r],c=257*l[v]^16843008*v;m[n]=c<<24|c>>>8,h[n]=c<<16|c>>>16,T[n]=c<<8|c>>>24,y[n]=c,c=16843009*a^65537*r^257*g^16843008*n,t[v]=c<<24|c>>>8,i[v]=c<<16|c>>>16,e[v]=c<<8|c>>>24,s[v]=c,n?(n=g^l[l[l[a^g]]],u^=l[l[u]]):n=u=1}},_.expandKey=function(D){for(var o=this.uint8ArrayToUint32Array_(D),S=!0,m=0;m<o.length&&S;)S=o[m]===this.key[m],m++;if(!S){this.key=o;var h=this.keySize=o.length;if(h!==4&&h!==6&&h!==8)throw new Error("Invalid aes key size="+h);var T,y,d,t,i=this.ksRows=4*(h+6+1),e=this.keySchedule=new Uint32Array(i),s=this.invKeySchedule=new Uint32Array(i),l=this.sBox,n=this.rcon,u=this.invSubMix,p=u[0],v=u[1],g=u[2],r=u[3];for(T=0;T<i;T++)T<h?d=e[T]=o[T]:(t=d,T%h==0?(t=l[(t=t<<8|t>>>24)>>>24]<<24|l[t>>>16&255]<<16|l[t>>>8&255]<<8|l[255&t],t^=n[T/h|0]<<24):h>6&&T%h==4&&(t=l[t>>>24]<<24|l[t>>>16&255]<<16|l[t>>>8&255]<<8|l[255&t]),e[T]=d=(e[T-h]^t)>>>0);for(y=0;y<i;y++)T=i-y,t=3&y?e[T]:e[T-4],s[y]=y<4||T<=4?t:p[l[t>>>24]]^v[l[t>>>16&255]]^g[l[t>>>8&255]]^r[l[255&t]],s[y]=s[y]>>>0}},_.networkToHostOrderSwap=function(D){return D<<24|(65280&D)<<8|(16711680&D)>>8|D>>>24},_.decrypt=function(D,o,S){for(var m,h,T,y,d,t,i,e,s,l,n,u,p,v,g=this.keySize+6,r=this.invKeySchedule,a=this.invSBox,c=this.invSubMix,b=c[0],A=c[1],I=c[2],x=c[3],w=this.uint8ArrayToUint32Array_(S),O=w[0],F=w[1],M=w[2],N=w[3],B=new Int32Array(D),U=new Int32Array(B.length),G=this.networkToHostOrderSwap;o<B.length;){for(s=G(B[o]),l=G(B[o+1]),n=G(B[o+2]),u=G(B[o+3]),d=s^r[0],t=u^r[1],i=n^r[2],e=l^r[3],p=4,v=1;v<g;v++)m=b[d>>>24]^A[t>>16&255]^I[i>>8&255]^x[255&e]^r[p],h=b[t>>>24]^A[i>>16&255]^I[e>>8&255]^x[255&d]^r[p+1],T=b[i>>>24]^A[e>>16&255]^I[d>>8&255]^x[255&t]^r[p+2],y=b[e>>>24]^A[d>>16&255]^I[t>>8&255]^x[255&i]^r[p+3],d=m,t=h,i=T,e=y,p+=4;m=a[d>>>24]<<24^a[t>>16&255]<<16^a[i>>8&255]<<8^a[255&e]^r[p],h=a[t>>>24]<<24^a[i>>16&255]<<16^a[e>>8&255]<<8^a[255&d]^r[p+1],T=a[i>>>24]<<24^a[e>>16&255]<<16^a[d>>8&255]<<8^a[255&t]^r[p+2],y=a[e>>>24]<<24^a[d>>16&255]<<16^a[t>>8&255]<<8^a[255&i]^r[p+3],U[o]=G(m^O),U[o+1]=G(y^F),U[o+2]=G(T^M),U[o+3]=G(h^N),O=s,F=l,M=n,N=u,o+=4}return U.buffer},k}()},"./src/crypt/decrypter.ts":function(P,C,f){f.r(C),f.d(C,"default",function(){return o});var R=f("./src/crypt/aes-crypto.ts"),E=f("./src/crypt/fast-aes-key.ts"),L=f("./src/crypt/aes-decryptor.ts"),k=f("./src/utils/logger.ts"),_=f("./src/utils/mp4-tools.ts"),D=f("./src/utils/typed-array.ts"),o=function(){function S(h,T,y){var d=(y===void 0?{}:y).removePKCS7Padding,t=d===void 0||d;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=h,this.config=T,this.removePKCS7Padding=t,t)try{var i=self.crypto;i&&(this.subtle=i.subtle||i.webkitSubtle)}catch{}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var m=S.prototype;return m.destroy=function(){this.observer=null},m.isSync=function(){return this.config.enableSoftwareAES},m.flush=function(){var h=this.currentResult;if(h){var T=new Uint8Array(h);return this.reset(),this.removePKCS7Padding?Object(L.removePadding)(T):T}this.reset()},m.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},m.decrypt=function(h,T,y,d){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(h),T,y);var t=this.flush();t&&d(t.buffer)}else this.webCryptoDecrypt(new Uint8Array(h),T,y).then(d)},m.softwareDecrypt=function(h,T,y){var d=this.currentIV,t=this.currentResult,i=this.remainderData;this.logOnce("JS AES decrypt"),i&&(h=Object(_.appendUint8Array)(i,h),this.remainderData=null);var e=this.getValidChunk(h);if(!e.length)return null;d&&(y=d);var s=this.softwareDecrypter;s||(s=this.softwareDecrypter=new L.default),s.expandKey(T);var l=t;return this.currentResult=s.decrypt(e.buffer,0,y),this.currentIV=Object(D.sliceUint8)(e,-16).buffer,l||null},m.webCryptoDecrypt=function(h,T,y){var d=this,t=this.subtle;return this.key===T&&this.fastAesKey||(this.key=T,this.fastAesKey=new E.default(t,T)),this.fastAesKey.expandKey().then(function(i){return t?new R.default(t,y).decrypt(h.buffer,i):Promise.reject(new Error("web crypto not initialized"))}).catch(function(i){return d.onWebCryptoError(i,h,T,y)})},m.onWebCryptoError=function(h,T,y,d){return k.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",h),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(T,y,d)},m.getValidChunk=function(h){var T=h,y=h.length-h.length%16;return y!==h.length&&(T=Object(D.sliceUint8)(h,0,y),this.remainderData=Object(D.sliceUint8)(h,y)),T},m.logOnce=function(h){this.logEnabled&&(k.logger.log("[decrypter.ts]: "+h),this.logEnabled=!1)},S}()},"./src/crypt/fast-aes-key.ts":function(P,C,f){f.r(C),f.d(C,"default",function(){return R});var R=function(){function E(L,k){this.subtle=void 0,this.key=void 0,this.subtle=L,this.key=k}return E.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},E}()},"./src/demux/aacdemuxer.ts":function(P,C,f){f.r(C);var R=f("./src/demux/base-audio-demuxer.ts"),E=f("./src/demux/adts.ts"),L=f("./src/utils/logger.ts"),k=f("./src/demux/id3.ts");function _(o,S){return(_=Object.setPrototypeOf||function(m,h){return m.__proto__=h,m})(o,S)}var D=function(o){var S,m;function h(y,d){var t;return(t=o.call(this)||this).observer=void 0,t.config=void 0,t.observer=y,t.config=d,t}m=o,(S=h).prototype=Object.create(m.prototype),S.prototype.constructor=S,_(S,m);var T=h.prototype;return T.resetInitSegment=function(y,d,t){o.prototype.resetInitSegment.call(this,y,d,t),this._audioTrack={container:"audio/adts",type:"audio",id:0,pid:-1,sequenceNumber:0,isAAC:!0,samples:[],manifestCodec:y,duration:t,inputTimeScale:9e4,dropped:0}},h.probe=function(y){if(!y)return!1;for(var d=(k.getID3Data(y,0)||[]).length,t=y.length;d<t;d++)if(E.probe(y,d))return L.logger.log("ADTS sync word found !"),!0;return!1},T.canParse=function(y,d){return E.canParse(y,d)},T.appendFrame=function(y,d,t){E.initTrackConfig(y,this.observer,d,t,y.manifestCodec);var i=E.appendFrame(y,d,t,this.initPTS,this.frameIndex);if(i&&i.missing===0)return i},h}(R.default);D.minProbeByteLength=9,C.default=D},"./src/demux/adts.ts":function(P,C,f){f.r(C),f.d(C,"getAudioConfig",function(){return k}),f.d(C,"isHeaderPattern",function(){return _}),f.d(C,"getHeaderLength",function(){return D}),f.d(C,"getFullFrameLength",function(){return o}),f.d(C,"canGetFrameLength",function(){return S}),f.d(C,"isHeader",function(){return m}),f.d(C,"canParse",function(){return h}),f.d(C,"probe",function(){return T}),f.d(C,"initTrackConfig",function(){return y}),f.d(C,"getFrameDuration",function(){return d}),f.d(C,"parseFrameHeader",function(){return t}),f.d(C,"appendFrame",function(){return i});var R=f("./src/utils/logger.ts"),E=f("./src/errors.ts"),L=f("./src/events.ts");function k(e,s,l,n){var u,p,v,g,r=navigator.userAgent.toLowerCase(),a=n,c=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];u=1+((192&s[l+2])>>>6);var b=(60&s[l+2])>>>2;if(!(b>c.length-1))return v=(1&s[l+2])<<2,v|=(192&s[l+3])>>>6,R.logger.log("manifest codec:"+n+", ADTS type:"+u+", samplingIndex:"+b),/firefox/i.test(r)?b>=6?(u=5,g=new Array(4),p=b-3):(u=2,g=new Array(2),p=b):r.indexOf("android")!==-1?(u=2,g=new Array(2),p=b):(u=5,g=new Array(4),n&&(n.indexOf("mp4a.40.29")!==-1||n.indexOf("mp4a.40.5")!==-1)||!n&&b>=6?p=b-3:((n&&n.indexOf("mp4a.40.2")!==-1&&(b>=6&&v===1||/vivaldi/i.test(r))||!n&&v===1)&&(u=2,g=new Array(2)),p=b)),g[0]=u<<3,g[0]|=(14&b)>>1,g[1]|=(1&b)<<7,g[1]|=v<<3,u===5&&(g[1]|=(14&p)>>1,g[2]=(1&p)<<7,g[2]|=8,g[3]=0),{config:g,samplerate:c[b],channelCount:v,codec:"mp4a.40."+u,manifestCodec:a};e.trigger(L.Events.ERROR,{type:E.ErrorTypes.MEDIA_ERROR,details:E.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+b})}function _(e,s){return e[s]===255&&(246&e[s+1])==240}function D(e,s){return 1&e[s+1]?7:9}function o(e,s){return(3&e[s+3])<<11|e[s+4]<<3|(224&e[s+5])>>>5}function S(e,s){return s+5<e.length}function m(e,s){return s+1<e.length&&_(e,s)}function h(e,s){return S(e,s)&&_(e,s)&&o(e,s)<=e.length-s}function T(e,s){if(m(e,s)){var l=D(e,s);if(s+l>=e.length)return!1;var n=o(e,s);if(n<=l)return!1;var u=s+n;return u===e.length||m(e,u)}return!1}function y(e,s,l,n,u){if(!e.samplerate){var p=k(s,l,n,u);if(!p)return;e.config=p.config,e.samplerate=p.samplerate,e.channelCount=p.channelCount,e.codec=p.codec,e.manifestCodec=p.manifestCodec,R.logger.log("parsed codec:"+e.codec+", rate:"+p.samplerate+", channels:"+p.channelCount)}}function d(e){return 9216e4/e}function t(e,s,l,n,u){var p=D(e,s),v=o(e,s);if((v-=p)>0)return{headerLength:p,frameLength:v,stamp:l+n*u}}function i(e,s,l,n,u){var p=t(s,l,n,u,d(e.samplerate));if(p){var v,g=p.frameLength,r=p.headerLength,a=p.stamp,c=r+g,b=Math.max(0,l+c-s.length);b?(v=new Uint8Array(c-r)).set(s.subarray(l+r,s.length),0):v=s.subarray(l+r,l+c);var A={unit:v,pts:a};return b||e.samples.push(A),{sample:A,length:c,missing:b}}}},"./src/demux/base-audio-demuxer.ts":function(P,C,f){f.r(C),f.d(C,"initPTSFn",function(){return o});var R=f("./src/polyfills/number.ts"),E=f("./src/demux/id3.ts"),L=f("./src/demux/dummy-demuxed-track.ts"),k=f("./src/utils/mp4-tools.ts"),_=f("./src/utils/typed-array.ts"),D=function(){function S(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.initPTS=null}var m=S.prototype;return m.resetInitSegment=function(h,T,y){this._id3Track={type:"id3",id:0,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},m.resetTimeStamp=function(){},m.resetContiguity=function(){},m.canParse=function(h,T){return!1},m.appendFrame=function(h,T,y){},m.demux=function(h,T){this.cachedData&&(h=Object(k.appendUint8Array)(this.cachedData,h),this.cachedData=null);var y,d,t=E.getID3Data(h,0),i=t?t.length:0,e=this._audioTrack,s=this._id3Track,l=t?E.getTimeStamp(t):void 0,n=h.length;for(this.frameIndex!==0&&this.initPTS!==null||(this.initPTS=o(l,T)),t&&t.length>0&&s.samples.push({pts:this.initPTS,dts:this.initPTS,data:t}),d=this.initPTS;i<n;){if(this.canParse(h,i)){var u=this.appendFrame(e,h,i);u?(this.frameIndex++,d=u.sample.pts,y=i+=u.length):i=n}else E.canParse(h,i)?(t=E.getID3Data(h,i),s.samples.push({pts:d,dts:d,data:t}),y=i+=t.length):i++;if(i===n&&y!==n){var p=Object(_.sliceUint8)(h,y);this.cachedData?this.cachedData=Object(k.appendUint8Array)(this.cachedData,p):this.cachedData=p}}return{audioTrack:e,avcTrack:Object(L.dummyTrack)(),id3Track:s,textTrack:Object(L.dummyTrack)()}},m.demuxSampleAes=function(h,T,y){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},m.flush=function(h){var T=this.cachedData;return T&&(this.cachedData=null,this.demux(T,0)),this.frameIndex=0,{audioTrack:this._audioTrack,avcTrack:Object(L.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(L.dummyTrack)()}},m.destroy=function(){},S}(),o=function(S,m){return Object(R.isFiniteNumber)(S)?90*S:9e4*m};C.default=D},"./src/demux/chunk-cache.ts":function(P,C,f){f.r(C),f.d(C,"default",function(){return R});var R=function(){function E(){this.chunks=[],this.dataLength=0}var L=E.prototype;return L.push=function(k){this.chunks.push(k),this.dataLength+=k.length},L.flush=function(){var k,_=this.chunks,D=this.dataLength;return _.length?(k=_.length===1?_[0]:function(o,S){for(var m=new Uint8Array(S),h=0,T=0;T<o.length;T++){var y=o[T];m.set(y,h),h+=y.length}return m}(_,D),this.reset(),k):new Uint8Array(0)},L.reset=function(){this.chunks.length=0,this.dataLength=0},E}()},"./src/demux/dummy-demuxed-track.ts":function(P,C,f){function R(){return{type:"",id:-1,pid:-1,inputTimeScale:9e4,sequenceNumber:-1,samples:[],dropped:0}}f.r(C),f.d(C,"dummyTrack",function(){return R})},"./src/demux/exp-golomb.ts":function(P,C,f){f.r(C);var R=f("./src/utils/logger.ts"),E=function(){function L(_){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=_,this.bytesAvailable=_.byteLength,this.word=0,this.bitsAvailable=0}var k=L.prototype;return k.loadWord=function(){var _=this.data,D=this.bytesAvailable,o=_.byteLength-D,S=new Uint8Array(4),m=Math.min(4,D);if(m===0)throw new Error("no bytes available");S.set(_.subarray(o,o+m)),this.word=new DataView(S.buffer).getUint32(0),this.bitsAvailable=8*m,this.bytesAvailable-=m},k.skipBits=function(_){var D;this.bitsAvailable>_?(this.word<<=_,this.bitsAvailable-=_):(_-=this.bitsAvailable,_-=(D=_>>3)>>3,this.bytesAvailable-=D,this.loadWord(),this.word<<=_,this.bitsAvailable-=_)},k.readBits=function(_){var D=Math.min(this.bitsAvailable,_),o=this.word>>>32-D;return _>32&&R.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=D,this.bitsAvailable>0?this.word<<=D:this.bytesAvailable>0&&this.loadWord(),(D=_-D)>0&&this.bitsAvailable?o<<D|this.readBits(D):o},k.skipLZ=function(){var _;for(_=0;_<this.bitsAvailable;++_)if((this.word&2147483648>>>_)!=0)return this.word<<=_,this.bitsAvailable-=_,_;return this.loadWord(),_+this.skipLZ()},k.skipUEG=function(){this.skipBits(1+this.skipLZ())},k.skipEG=function(){this.skipBits(1+this.skipLZ())},k.readUEG=function(){var _=this.skipLZ();return this.readBits(_+1)-1},k.readEG=function(){var _=this.readUEG();return 1&_?1+_>>>1:-1*(_>>>1)},k.readBoolean=function(){return this.readBits(1)===1},k.readUByte=function(){return this.readBits(8)},k.readUShort=function(){return this.readBits(16)},k.readUInt=function(){return this.readBits(32)},k.skipScalingList=function(_){for(var D=8,o=8,S=0;S<_;S++)o!==0&&(o=(D+this.readEG()+256)%256),D=o===0?D:o},k.readSPS=function(){var _,D,o,S=0,m=0,h=0,T=0,y=this.readUByte.bind(this),d=this.readBits.bind(this),t=this.readUEG.bind(this),i=this.readBoolean.bind(this),e=this.skipBits.bind(this),s=this.skipEG.bind(this),l=this.skipUEG.bind(this),n=this.skipScalingList.bind(this);y();var u=y();if(d(5),e(3),y(),l(),u===100||u===110||u===122||u===244||u===44||u===83||u===86||u===118||u===128){var p=t();if(p===3&&e(1),l(),l(),e(1),i())for(D=p!==3?8:12,o=0;o<D;o++)i()&&n(o<6?16:64)}l();var v=t();if(v===0)t();else if(v===1)for(e(1),s(),s(),_=t(),o=0;o<_;o++)s();l(),e(1);var g=t(),r=t(),a=d(1);a===0&&e(1),e(1),i()&&(S=t(),m=t(),h=t(),T=t());var c=[1,1];if(i()&&i())switch(y()){case 1:c=[1,1];break;case 2:c=[12,11];break;case 3:c=[10,11];break;case 4:c=[16,11];break;case 5:c=[40,33];break;case 6:c=[24,11];break;case 7:c=[20,11];break;case 8:c=[32,11];break;case 9:c=[80,33];break;case 10:c=[18,11];break;case 11:c=[15,11];break;case 12:c=[64,33];break;case 13:c=[160,99];break;case 14:c=[4,3];break;case 15:c=[3,2];break;case 16:c=[2,1];break;case 255:c=[y()<<8|y(),y()<<8|y()]}return{width:Math.ceil(16*(g+1)-2*S-2*m),height:(2-a)*(r+1)*16-(a?2:4)*(h+T),pixelRatio:c}},k.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},L}();C.default=E},"./src/demux/id3.ts":function(P,C,f){f.r(C),f.d(C,"isHeader",function(){return E}),f.d(C,"isFooter",function(){return L}),f.d(C,"getID3Data",function(){return k}),f.d(C,"canParse",function(){return D}),f.d(C,"getTimeStamp",function(){return o}),f.d(C,"isTimeStampFrame",function(){return S}),f.d(C,"getID3Frames",function(){return h}),f.d(C,"decodeFrame",function(){return T}),f.d(C,"utf8ArrayToStr",function(){return e}),f.d(C,"testables",function(){return s});var R,E=function(l,n){return n+10<=l.length&&l[n]===73&&l[n+1]===68&&l[n+2]===51&&l[n+3]<255&&l[n+4]<255&&l[n+6]<128&&l[n+7]<128&&l[n+8]<128&&l[n+9]<128},L=function(l,n){return n+10<=l.length&&l[n]===51&&l[n+1]===68&&l[n+2]===73&&l[n+3]<255&&l[n+4]<255&&l[n+6]<128&&l[n+7]<128&&l[n+8]<128&&l[n+9]<128},k=function(l,n){for(var u=n,p=0;E(l,n);)p+=10,p+=_(l,n+6),L(l,n+10)&&(p+=10),n+=p;if(p>0)return l.subarray(u,u+p)},_=function(l,n){var u=0;return u=(127&l[n])<<21,u|=(127&l[n+1])<<14,u|=(127&l[n+2])<<7,u|=127&l[n+3]},D=function(l,n){return E(l,n)&&_(l,n+6)+10<=l.length-n},o=function(l){for(var n=h(l),u=0;u<n.length;u++){var p=n[u];if(S(p))return i(p)}},S=function(l){return l&&l.key==="PRIV"&&l.info==="com.apple.streaming.transportStreamTimestamp"},m=function(l){var n=String.fromCharCode(l[0],l[1],l[2],l[3]),u=_(l,4);return{type:n,size:u,data:l.subarray(10,10+u)}},h=function(l){for(var n=0,u=[];E(l,n);){for(var p=_(l,n+6),v=(n+=10)+p;n+8<v;){var g=m(l.subarray(n)),r=T(g);r&&u.push(r),n+=g.size+10}L(l,n)&&(n+=10)}return u},T=function(l){return l.type==="PRIV"?y(l):l.type[0]==="W"?t(l):d(l)},y=function(l){if(!(l.size<2)){var n=e(l.data,!0),u=new Uint8Array(l.data.subarray(n.length+1));return{key:l.type,info:n,data:u.buffer}}},d=function(l){if(!(l.size<2)){if(l.type==="TXXX"){var n=1,u=e(l.data.subarray(n),!0);n+=u.length+1;var p=e(l.data.subarray(n));return{key:l.type,info:u,data:p}}var v=e(l.data.subarray(1));return{key:l.type,data:v}}},t=function(l){if(l.type==="WXXX"){if(l.size<2)return;var n=1,u=e(l.data.subarray(n),!0);n+=u.length+1;var p=e(l.data.subarray(n));return{key:l.type,info:u,data:p}}var v=e(l.data);return{key:l.type,data:v}},i=function(l){if(l.data.byteLength===8){var n=new Uint8Array(l.data),u=1&n[3],p=(n[4]<<23)+(n[5]<<15)+(n[6]<<7)+n[7];return p/=45,u&&(p+=4772185884e-2),Math.round(p)}},e=function(l,n){n===void 0&&(n=!1);var u=(R||self.TextDecoder===void 0||(R=new self.TextDecoder("utf-8")),R);if(u){var p=u.decode(l);if(n){var v=p.indexOf("\0");return v!==-1?p.substring(0,v):p}return p.replace(/\0/g,"")}for(var g,r,a,c=l.length,b="",A=0;A<c;){if((g=l[A++])===0&&n)return b;if(g!==0&&g!==3)switch(g>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:b+=String.fromCharCode(g);break;case 12:case 13:r=l[A++],b+=String.fromCharCode((31&g)<<6|63&r);break;case 14:r=l[A++],a=l[A++],b+=String.fromCharCode((15&g)<<12|(63&r)<<6|(63&a)<<0)}}return b},s={decodeTextFrame:d}},"./src/demux/mp3demuxer.ts":function(P,C,f){f.r(C);var R=f("./src/demux/base-audio-demuxer.ts"),E=f("./src/demux/id3.ts"),L=f("./src/utils/logger.ts"),k=f("./src/demux/mpegaudio.ts");function _(o,S){return(_=Object.setPrototypeOf||function(m,h){return m.__proto__=h,m})(o,S)}var D=function(o){var S,m;function h(){return o.apply(this,arguments)||this}m=o,(S=h).prototype=Object.create(m.prototype),S.prototype.constructor=S,_(S,m);var T=h.prototype;return T.resetInitSegment=function(y,d,t){o.prototype.resetInitSegment.call(this,y,d,t),this._audioTrack={container:"audio/mpeg",type:"audio",id:0,pid:-1,sequenceNumber:0,isAAC:!1,samples:[],manifestCodec:y,duration:t,inputTimeScale:9e4,dropped:0}},h.probe=function(y){if(!y)return!1;for(var d=(E.getID3Data(y,0)||[]).length,t=y.length;d<t;d++)if(k.probe(y,d))return L.logger.log("MPEG Audio sync word found !"),!0;return!1},T.canParse=function(y,d){return k.canParse(y,d)},T.appendFrame=function(y,d,t){if(this.initPTS!==null)return k.appendFrame(y,d,t,this.initPTS,this.frameIndex)},h}(R.default);D.minProbeByteLength=4,C.default=D},"./src/demux/mp4demuxer.ts":function(P,C,f){f.r(C);var R=f("./src/utils/mp4-tools.ts"),E=f("./src/demux/dummy-demuxed-track.ts"),L=function(){function k(D,o){this.remainderData=null,this.config=void 0,this.config=o}var _=k.prototype;return _.resetTimeStamp=function(){},_.resetInitSegment=function(){},_.resetContiguity=function(){},k.probe=function(D){return Object(R.findBox)({data:D,start:0,end:Math.min(D.length,16384)},["moof"]).length>0},_.demux=function(D){var o=D,S=Object(E.dummyTrack)();if(this.config.progressive){this.remainderData&&(o=Object(R.appendUint8Array)(this.remainderData,D));var m=Object(R.segmentValidRange)(o);this.remainderData=m.remainder,S.samples=m.valid||new Uint8Array}else S.samples=o;return{audioTrack:Object(E.dummyTrack)(),avcTrack:S,id3Track:Object(E.dummyTrack)(),textTrack:Object(E.dummyTrack)()}},_.flush=function(){var D=Object(E.dummyTrack)();return D.samples=this.remainderData||new Uint8Array,this.remainderData=null,{audioTrack:Object(E.dummyTrack)(),avcTrack:D,id3Track:Object(E.dummyTrack)(),textTrack:Object(E.dummyTrack)()}},_.demuxSampleAes=function(D,o,S){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},_.destroy=function(){},k}();L.minProbeByteLength=1024,C.default=L},"./src/demux/mpegaudio.ts":function(P,C,f){f.r(C),f.d(C,"appendFrame",function(){return D}),f.d(C,"parseHeader",function(){return o}),f.d(C,"isHeaderPattern",function(){return S}),f.d(C,"isHeader",function(){return m}),f.d(C,"canParse",function(){return h}),f.d(C,"probe",function(){return T});var R=null,E=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],L=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],k=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],_=[0,1,1,4];function D(y,d,t,i,e){if(!(t+24>d.length)){var s=o(d,t);if(s&&t+s.frameLength<=d.length){var l=i+e*(9e4*s.samplesPerFrame/s.sampleRate),n={unit:d.subarray(t,t+s.frameLength),pts:l,dts:l};return y.config=[],y.channelCount=s.channelCount,y.samplerate=s.sampleRate,y.samples.push(n),{sample:n,length:s.frameLength,missing:0}}}}function o(y,d){var t=y[d+1]>>3&3,i=y[d+1]>>1&3,e=y[d+2]>>4&15,s=y[d+2]>>2&3;if(t!==1&&e!==0&&e!==15&&s!==3){var l=y[d+2]>>1&1,n=y[d+3]>>6,u=1e3*E[14*(t===3?3-i:i===3?3:4)+e-1],p=L[3*(t===3?0:t===2?1:2)+s],v=n===3?1:2,g=k[t][i],r=_[i],a=8*g*r,c=Math.floor(g*u/p+l)*r;if(R===null){var b=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);R=b?parseInt(b[1]):0}return!!R&&R<=87&&i===2&&u>=224e3&&n===0&&(y[d+3]=128|y[d+3]),{sampleRate:p,channelCount:v,frameLength:c,samplesPerFrame:a}}}function S(y,d){return y[d]===255&&(224&y[d+1])==224&&(6&y[d+1])!=0}function m(y,d){return d+1<y.length&&S(y,d)}function h(y,d){return S(y,d)&&4<=y.length-d}function T(y,d){if(d+1<y.length&&S(y,d)){var t=o(y,d),i=4;t!=null&&t.frameLength&&(i=t.frameLength);var e=d+i;return e===y.length||m(y,e)}return!1}},"./src/demux/sample-aes.ts":function(P,C,f){f.r(C);var R=f("./src/crypt/decrypter.ts"),E=f("./src/demux/tsdemuxer.ts"),L=function(){function k(D,o,S){this.keyData=void 0,this.decrypter=void 0,this.keyData=S,this.decrypter=new R.default(D,o,{removePKCS7Padding:!1})}var _=k.prototype;return _.decryptBuffer=function(D,o){this.decrypter.decrypt(D,this.keyData.key.buffer,this.keyData.iv.buffer,o)},_.decryptAacSample=function(D,o,S,m){var h=D[o].unit,T=h.subarray(16,h.length-h.length%16),y=T.buffer.slice(T.byteOffset,T.byteOffset+T.length),d=this;this.decryptBuffer(y,function(t){var i=new Uint8Array(t);h.set(i,16),m||d.decryptAacSamples(D,o+1,S)})},_.decryptAacSamples=function(D,o,S){for(;;o++){if(o>=D.length)return void S();if(!(D[o].unit.length<32)){var m=this.decrypter.isSync();if(this.decryptAacSample(D,o,S,m),!m)return}}},_.getAvcEncryptedData=function(D){for(var o=16*Math.floor((D.length-48)/160)+16,S=new Int8Array(o),m=0,h=32;h<=D.length-16;h+=160,m+=16)S.set(D.subarray(h,h+16),m);return S},_.getAvcDecryptedUnit=function(D,o){for(var S=new Uint8Array(o),m=0,h=32;h<=D.length-16;h+=160,m+=16)D.set(S.subarray(m,m+16),h);return D},_.decryptAvcSample=function(D,o,S,m,h,T){var y=Object(E.discardEPB)(h.data),d=this.getAvcEncryptedData(y),t=this;this.decryptBuffer(d.buffer,function(i){h.data=t.getAvcDecryptedUnit(y,i),T||t.decryptAvcSamples(D,o,S+1,m)})},_.decryptAvcSamples=function(D,o,S,m){if(D instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;o++,S=0){if(o>=D.length)return void m();for(var h=D[o].units;!(S>=h.length);S++){var T=h[S];if(!(T.data.length<=48||T.type!==1&&T.type!==5)){var y=this.decrypter.isSync();if(this.decryptAvcSample(D,o,S,m,T,y),!y)return}}}},k}();C.default=L},"./src/demux/transmuxer-interface.ts":function(P,C,f){f.r(C),f.d(C,"default",function(){return m});var R=f("./node_modules/webworkify-webpack/index.js"),E=f("./src/events.ts"),L=f("./src/demux/transmuxer.ts"),k=f("./src/utils/logger.ts"),_=f("./src/errors.ts"),D=f("./src/utils/mediasource-helper.ts"),o=f("./node_modules/eventemitter3/index.js"),S=Object(D.getMediaSource)()||{isTypeSupported:function(){return!1}},m=function(){function h(y,d,t,i){var e=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=y,this.id=d,this.onTransmuxComplete=t,this.onFlush=i;var s=y.config,l=function(v,g){(g=g||{}).frag=e.frag,g.id=e.id,y.trigger(v,g)};this.observer=new o.EventEmitter,this.observer.on(E.Events.FRAG_DECRYPTED,l),this.observer.on(E.Events.ERROR,l);var n={mp4:S.isTypeSupported("video/mp4"),mpeg:S.isTypeSupported("audio/mpeg"),mp3:S.isTypeSupported('audio/mp4; codecs="mp3"')},u=navigator.vendor;if(s.enableWorker&&typeof Worker!="undefined"){var p;k.logger.log("demuxing in webworker");try{p=this.worker=R("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),p.addEventListener("message",this.onwmsg),p.onerror=function(v){y.trigger(E.Events.ERROR,{type:_.ErrorTypes.OTHER_ERROR,details:_.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(v.message+"  ("+v.filename+":"+v.lineno+")")})},p.postMessage({cmd:"init",typeSupported:n,vendor:u,id:d,config:JSON.stringify(s)})}catch(v){k.logger.warn("Error in worker:",v),k.logger.error("Error while initializing DemuxerWorker, fallback to inline"),p&&self.URL.revokeObjectURL(p.objectURL),this.transmuxer=new L.default(this.observer,n,s,u,d),this.worker=null}}else this.transmuxer=new L.default(this.observer,n,s,u,d)}var T=h.prototype;return T.destroy=function(){var y=this.worker;if(y)y.removeEventListener("message",this.onwmsg),y.terminate(),this.worker=null;else{var d=this.transmuxer;d&&(d.destroy(),this.transmuxer=null)}var t=this.observer;t&&t.removeAllListeners(),this.observer=null},T.push=function(y,d,t,i,e,s,l,n,u,p){var v=this;u.transmuxing.start=self.performance.now();var g=this.transmuxer,r=this.worker,a=s?s.start:e.start,c=e.decryptdata,b=this.frag,A=!(b&&e.cc===b.cc),I=!(b&&u.level===b.level),x=b?u.sn-b.sn:-1,w=this.part?u.part-this.part.index:1,O=!I&&(x===1||x===0&&w===1),F=self.performance.now();(I||x||e.stats.parsing.start===0)&&(e.stats.parsing.start=F),!s||!w&&O||(s.stats.parsing.start=F);var M=new L.TransmuxState(A,O,n,I,a);if(!O||A){k.logger.log("[transmuxer-interface, "+e.type+"]: Starting new transmux session for sn: "+u.sn+" p: "+u.part+" level: "+u.level+" id: "+u.id+`
        discontinuity: `+A+`
        trackSwitch: `+I+`
        contiguous: `+O+`
        accurateTimeOffset: `+n+`
        timeOffset: `+a);var N=new L.TransmuxConfig(t,i,d,l,p);this.configureTransmuxer(N)}if(this.frag=e,this.part=s,r)r.postMessage({cmd:"demux",data:y,decryptdata:c,chunkMeta:u,state:M},y instanceof ArrayBuffer?[y]:[]);else if(g){var B=g.push(y,c,u,M);Object(L.isPromise)(B)?B.then(function(U){v.handleTransmuxComplete(U)}):this.handleTransmuxComplete(B)}},T.flush=function(y){var d=this;y.transmuxing.start=self.performance.now();var t=this.transmuxer,i=this.worker;if(i)i.postMessage({cmd:"flush",chunkMeta:y});else if(t){var e=t.flush(y);Object(L.isPromise)(e)?e.then(function(s){d.handleFlushResult(s,y)}):this.handleFlushResult(e,y)}},T.handleFlushResult=function(y,d){var t=this;y.forEach(function(i){t.handleTransmuxComplete(i)}),this.onFlush(d)},T.onWorkerMessage=function(y){var d=y.data,t=this.hls;switch(d.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(d.data);break;case"flush":this.onFlush(d.data);break;default:d.data=d.data||{},d.data.frag=this.frag,d.data.id=this.id,t.trigger(d.event,d.data)}},T.configureTransmuxer=function(y){var d=this.worker,t=this.transmuxer;d?d.postMessage({cmd:"configure",config:y}):t&&t.configure(y)},T.handleTransmuxComplete=function(y){y.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(y)},h}()},"./src/demux/transmuxer-worker.ts":function(P,C,f){f.r(C),f.d(C,"default",function(){return _});var R=f("./src/demux/transmuxer.ts"),E=f("./src/events.ts"),L=f("./src/utils/logger.ts"),k=f("./node_modules/eventemitter3/index.js");function _(m){var h=new k.EventEmitter,T=function(y,d){m.postMessage({event:y,data:d})};h.on(E.Events.FRAG_DECRYPTED,T),h.on(E.Events.ERROR,T),m.addEventListener("message",function(y){var d=y.data;switch(d.cmd){case"init":var t=JSON.parse(d.config);m.transmuxer=new R.default(h,d.typeSupported,t,d.vendor,d.id),Object(L.enableLogs)(t.debug),T("init",null);break;case"configure":m.transmuxer.configure(d.config);break;case"demux":var i=m.transmuxer.push(d.data,d.decryptdata,d.chunkMeta,d.state);Object(R.isPromise)(i)?i.then(function(l){D(m,l)}):D(m,i);break;case"flush":var e=d.chunkMeta,s=m.transmuxer.flush(e);Object(R.isPromise)(s)?s.then(function(l){S(m,l,e)}):S(m,s,e)}})}function D(m,h){if((T=h.remuxResult).audio||T.video||T.text||T.id3||T.initSegment){var T,y=[],d=h.remuxResult,t=d.audio,i=d.video;t&&o(y,t),i&&o(y,i),m.postMessage({event:"transmuxComplete",data:h},y)}}function o(m,h){h.data1&&m.push(h.data1.buffer),h.data2&&m.push(h.data2.buffer)}function S(m,h,T){h.forEach(function(y){D(m,y)}),m.postMessage({event:"flush",data:T})}},"./src/demux/transmuxer.ts":function(P,C,f){f.r(C),f.d(C,"default",function(){return e}),f.d(C,"isPromise",function(){return l}),f.d(C,"TransmuxConfig",function(){return n}),f.d(C,"TransmuxState",function(){return u});var R,E=f("./src/events.ts"),L=f("./src/errors.ts"),k=f("./src/crypt/decrypter.ts"),_=f("./src/demux/aacdemuxer.ts"),D=f("./src/demux/mp4demuxer.ts"),o=f("./src/demux/tsdemuxer.ts"),S=f("./src/demux/mp3demuxer.ts"),m=f("./src/remux/mp4-remuxer.ts"),h=f("./src/remux/passthrough-remuxer.ts"),T=f("./src/demux/chunk-cache.ts"),y=f("./src/utils/mp4-tools.ts"),d=f("./src/utils/logger.ts");try{R=self.performance.now.bind(self.performance)}catch{d.logger.debug("Unable to use Performance API on this environment"),R=self.Date.now}var t=[{demux:o.default,remux:m.default},{demux:D.default,remux:h.default},{demux:_.default,remux:m.default},{demux:S.default,remux:m.default}],i=1024;t.forEach(function(p){var v=p.demux;i=Math.max(i,v.minProbeByteLength)});var e=function(){function p(g,r,a,c,b){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new T.default,this.observer=g,this.typeSupported=r,this.config=a,this.vendor=c,this.id=b}var v=p.prototype;return v.configure=function(g){this.transmuxConfig=g,this.decrypter&&this.decrypter.reset()},v.push=function(g,r,a,c){var b=this,A=a.transmuxing;A.executeStart=R();var I=new Uint8Array(g),x=this.cache,w=this.config,O=this.currentTransmuxState,F=this.transmuxConfig;c&&(this.currentTransmuxState=c);var M=function(fe,he){var pe=null;return fe.byteLength>0&&he!=null&&he.key!=null&&he.iv!==null&&he.method!=null&&(pe=he),pe}(I,r);if(M&&M.method==="AES-128"){var N=this.getDecrypter();if(!w.enableSoftwareAES)return this.decryptionPromise=N.webCryptoDecrypt(I,M.key.buffer,M.iv.buffer).then(function(fe){var he=b.push(fe,null,a);return b.decryptionPromise=null,he}),this.decryptionPromise;var B=N.softwareDecrypt(I,M.key.buffer,M.iv.buffer);if(!B)return A.executeEnd=R(),s(a);I=new Uint8Array(B)}var U=c||O,G=U.contiguous,H=U.discontinuity,z=U.trackSwitch,Y=U.accurateTimeOffset,W=U.timeOffset,$=F.audioCodec,ie=F.videoCodec,ae=F.defaultInitPts,ue=F.duration,Z=F.initSegmentData;if((H||z)&&this.resetInitSegment(Z,$,ie,ue),H&&this.resetInitialTimestamp(ae),G||this.resetContiguity(),this.needsProbing(I,H,z)){if(x.dataLength){var se=x.flush();I=Object(y.appendUint8Array)(se,I)}this.configureTransmuxer(I,F)}var te=this.transmux(I,M,W,Y,a),ne=this.currentTransmuxState;return ne.contiguous=!0,ne.discontinuity=!1,ne.trackSwitch=!1,A.executeEnd=R(),te},v.flush=function(g){var r=this,a=g.transmuxing;a.executeStart=R();var c=this.decrypter,b=this.cache,A=this.currentTransmuxState,I=this.decryptionPromise;if(I)return I.then(function(){return r.flush(g)});var x=[],w=A.timeOffset;if(c){var O=c.flush();O&&x.push(this.push(O,null,g))}var F=b.dataLength;b.reset();var M=this.demuxer,N=this.remuxer;if(!M||!N)return F>=i&&this.observer.emit(E.Events.ERROR,E.Events.ERROR,{type:L.ErrorTypes.MEDIA_ERROR,details:L.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),a.executeEnd=R(),[s(g)];var B=M.flush(w);return l(B)?B.then(function(U){return r.flushRemux(x,U,g),x}):(this.flushRemux(x,B,g),x)},v.flushRemux=function(g,r,a){var c=r.audioTrack,b=r.avcTrack,A=r.id3Track,I=r.textTrack,x=this.currentTransmuxState,w=x.accurateTimeOffset,O=x.timeOffset;d.logger.log("[transmuxer.ts]: Flushed fragment "+a.sn+(a.part>-1?" p: "+a.part:"")+" of level "+a.level);var F=this.remuxer.remux(c,b,A,I,O,w,!0,this.id);g.push({remuxResult:F,chunkMeta:a}),a.transmuxing.executeEnd=R()},v.resetInitialTimestamp=function(g){var r=this.demuxer,a=this.remuxer;r&&a&&(r.resetTimeStamp(g),a.resetTimeStamp(g))},v.resetContiguity=function(){var g=this.demuxer,r=this.remuxer;g&&r&&(g.resetContiguity(),r.resetNextTimestamp())},v.resetInitSegment=function(g,r,a,c){var b=this.demuxer,A=this.remuxer;b&&A&&(b.resetInitSegment(r,a,c),A.resetInitSegment(g,r,a))},v.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},v.transmux=function(g,r,a,c,b){return r&&r.method==="SAMPLE-AES"?this.transmuxSampleAes(g,r,a,c,b):this.transmuxUnencrypted(g,a,c,b)},v.transmuxUnencrypted=function(g,r,a,c){var b=this.demuxer.demux(g,r,!1,!this.config.progressive),A=b.audioTrack,I=b.avcTrack,x=b.id3Track,w=b.textTrack;return{remuxResult:this.remuxer.remux(A,I,x,w,r,a,!1,this.id),chunkMeta:c}},v.transmuxSampleAes=function(g,r,a,c,b){var A=this;return this.demuxer.demuxSampleAes(g,r,a).then(function(I){return{remuxResult:A.remuxer.remux(I.audioTrack,I.avcTrack,I.id3Track,I.textTrack,a,c,!1,A.id),chunkMeta:b}})},v.configureTransmuxer=function(g,r){for(var a,c=this.config,b=this.observer,A=this.typeSupported,I=this.vendor,x=r.audioCodec,w=r.defaultInitPts,O=r.duration,F=r.initSegmentData,M=r.videoCodec,N=0,B=t.length;N<B;N++)if(t[N].demux.probe(g)){a=t[N];break}a||(d.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),a={demux:D.default,remux:h.default});var U=this.demuxer,G=this.remuxer,H=a.remux,z=a.demux;G&&G instanceof H||(this.remuxer=new H(b,c,A,I)),U&&U instanceof z||(this.demuxer=new z(b,c,A),this.probe=z.probe),this.resetInitSegment(F,x,M,O),this.resetInitialTimestamp(w)},v.needsProbing=function(g,r,a){return!this.demuxer||!this.remuxer||r||a},v.getDecrypter=function(){var g=this.decrypter;return g||(g=this.decrypter=new k.default(this.observer,this.config)),g},p}(),s=function(p){return{remuxResult:{},chunkMeta:p}};function l(p){return"then"in p&&p.then instanceof Function}var n=function(p,v,g,r,a){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=p,this.videoCodec=v,this.initSegmentData=g,this.duration=r,this.defaultInitPts=a},u=function(p,v,g,r,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.discontinuity=p,this.contiguous=v,this.accurateTimeOffset=g,this.trackSwitch=r,this.timeOffset=a}},"./src/demux/tsdemuxer.ts":function(P,C,f){f.r(C),f.d(C,"discardEPB",function(){return l});var R=f("./src/demux/adts.ts"),E=f("./src/demux/mpegaudio.ts"),L=f("./src/demux/exp-golomb.ts"),k=f("./src/demux/id3.ts"),_=f("./src/demux/sample-aes.ts"),D=f("./src/events.ts"),o=f("./src/utils/mp4-tools.ts"),S=f("./src/utils/logger.ts"),m=f("./src/errors.ts"),h={video:1,audio:2,id3:3,text:4},T=function(){function n(p,v,g){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this.aacLastPTS=null,this._initPTS=null,this._initDTS=null,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=p,this.config=v,this.typeSupported=g}n.probe=function(p){var v=n.syncOffset(p);return!(v<0||(v&&S.logger.warn("MPEG2-TS detected but first sync word found @ offset "+v+", junk ahead ?"),0))},n.syncOffset=function(p){for(var v=Math.min(1e3,p.length-564),g=0;g<v;){if(p[g]===71&&p[g+188]===71&&p[g+376]===71)return g;g++}return-1},n.createTrack=function(p,v){return{container:p==="video"||p==="audio"?"video/mp2t":void 0,type:p,id:h[p],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:p==="audio"?v:void 0}};var u=n.prototype;return u.resetInitSegment=function(p,v,g){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=n.createTrack("video",g),this._audioTrack=n.createTrack("audio",g),this._id3Track=n.createTrack("id3",g),this._txtTrack=n.createTrack("text",g),this._audioTrack.isAAC=!0,this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=p,this.videoCodec=v,this._duration=g},u.resetTimeStamp=function(){},u.resetContiguity=function(){var p=this._audioTrack,v=this._avcTrack,g=this._id3Track;p&&(p.pesData=null),v&&(v.pesData=null),g&&(g.pesData=null),this.aacOverFlow=null,this.aacLastPTS=null},u.demux=function(p,v,g,r){var a;g===void 0&&(g=!1),r===void 0&&(r=!1),g||(this.sampleAes=null);var c=this._avcTrack,b=this._audioTrack,A=this._id3Track,I=c.pid,x=c.pesData,w=b.pid,O=A.pid,F=b.pesData,M=A.pesData,N=!1,B=this.pmtParsed,U=this._pmtId,G=p.length;if(this.remainderData&&(G=(p=Object(o.appendUint8Array)(this.remainderData,p)).length,this.remainderData=null),G<188&&!r)return this.remainderData=p,{audioTrack:b,avcTrack:c,id3Track:A,textTrack:this._txtTrack};var H=Math.max(0,n.syncOffset(p));(G-=(G+H)%188)<p.byteLength&&!r&&(this.remainderData=new Uint8Array(p.buffer,G,p.buffer.byteLength-G));for(var z=H;z<G;z+=188)if(p[z]===71){var Y=!!(64&p[z+1]),W=((31&p[z+1])<<8)+p[z+2],$=void 0;if((48&p[z+3])>>4>1){if(($=z+5+p[z+4])===z+188)continue}else $=z+4;switch(W){case I:Y&&(x&&(a=i(x))&&this.parseAVCPES(a,!1),x={data:[],size:0}),x&&(x.data.push(p.subarray($,z+188)),x.size+=z+188-$);break;case w:Y&&(F&&(a=i(F))&&(b.isAAC?this.parseAACPES(a):this.parseMPEGPES(a)),F={data:[],size:0}),F&&(F.data.push(p.subarray($,z+188)),F.size+=z+188-$);break;case O:Y&&(M&&(a=i(M))&&this.parseID3PES(a),M={data:[],size:0}),M&&(M.data.push(p.subarray($,z+188)),M.size+=z+188-$);break;case 0:Y&&($+=p[$]+1),U=this._pmtId=d(p,$);break;case U:Y&&($+=p[$]+1);var ie=t(p,$,this.typeSupported.mpeg===!0||this.typeSupported.mp3===!0,g);(I=ie.avc)>0&&(c.pid=I),(w=ie.audio)>0&&(b.pid=w,b.isAAC=ie.isAAC),(O=ie.id3)>0&&(A.pid=O),N&&!B&&(S.logger.log("reparse from beginning"),N=!1,z=H-188),B=this.pmtParsed=!0;break;case 17:case 8191:break;default:N=!0}}else this.observer.emit(D.Events.ERROR,D.Events.ERROR,{type:m.ErrorTypes.MEDIA_ERROR,details:m.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});c.pesData=x,b.pesData=F,A.pesData=M;var ae={audioTrack:b,avcTrack:c,id3Track:A,textTrack:this._txtTrack};return r&&this.extractRemainingSamples(ae),ae},u.flush=function(){var p,v=this.remainderData;return this.remainderData=null,p=v?this.demux(v,-1,!1,!0):{audioTrack:this._audioTrack,avcTrack:this._avcTrack,textTrack:this._txtTrack,id3Track:this._id3Track},this.extractRemainingSamples(p),this.sampleAes?this.decrypt(p,this.sampleAes):p},u.extractRemainingSamples=function(p){var v,g=p.audioTrack,r=p.avcTrack,a=p.id3Track,c=r.pesData,b=g.pesData,A=a.pesData;c&&(v=i(c))?(this.parseAVCPES(v,!0),r.pesData=null):r.pesData=c,b&&(v=i(b))?(g.isAAC?this.parseAACPES(v):this.parseMPEGPES(v),g.pesData=null):(b!=null&&b.size&&S.logger.log("last AAC PES packet truncated,might overlap between fragments"),g.pesData=b),A&&(v=i(A))?(this.parseID3PES(v),a.pesData=null):a.pesData=A},u.demuxSampleAes=function(p,v,g){var r=this.demux(p,g,!0,!this.config.progressive),a=this.sampleAes=new _.default(this.observer,this.config,v);return this.decrypt(r,a)},u.decrypt=function(p,v){return new Promise(function(g){var r=p.audioTrack,a=p.avcTrack;r.samples&&r.isAAC?v.decryptAacSamples(r.samples,0,function(){a.samples?v.decryptAvcSamples(a.samples,0,0,function(){g(p)}):g(p)}):a.samples&&v.decryptAvcSamples(a.samples,0,0,function(){g(p)})})},u.destroy=function(){this._initPTS=this._initDTS=null,this._duration=0},u.parseAVCPES=function(p,v){var g,r=this,a=this._avcTrack,c=this.parseAVCNALu(p.data),b=this.avcSample,A=!1;p.data=null,b&&c.length&&!a.audFound&&(e(b,a),b=this.avcSample=y(!1,p.pts,p.dts,"")),c.forEach(function(I){switch(I.type){case 1:g=!0,b||(b=r.avcSample=y(!0,p.pts,p.dts,"")),b.frame=!0;var x=I.data;if(A&&x.length>4){var w=new L.default(x).readSliceType();w!==2&&w!==4&&w!==7&&w!==9||(b.key=!0)}break;case 5:g=!0,b||(b=r.avcSample=y(!0,p.pts,p.dts,"")),b.key=!0,b.frame=!0;break;case 6:g=!0;var O=new L.default(l(I.data));O.readUByte();for(var F=0,M=0,N=!1,B=0;!N&&O.bytesAvailable>1;){F=0;do F+=B=O.readUByte();while(B===255);M=0;do M+=B=O.readUByte();while(B===255);if(F===4&&O.bytesAvailable!==0){if(N=!0,O.readUByte()===181&&O.readUShort()===49&&O.readUInt()===1195456820&&O.readUByte()===3){for(var U=O.readUByte(),G=31&U,H=[U,O.readUByte()],z=0;z<G;z++)H.push(O.readUByte()),H.push(O.readUByte()),H.push(O.readUByte());s(r._txtTrack.samples,{type:3,pts:p.pts,bytes:H})}}else if(F===5&&O.bytesAvailable!==0){if(N=!0,M>16){for(var Y=[],W=0;W<16;W++)Y.push(O.readUByte().toString(16)),W!==3&&W!==5&&W!==7&&W!==9||Y.push("-");for(var $=M-16,ie=new Uint8Array($),ae=0;ae<$;ae++)ie[ae]=O.readUByte();s(r._txtTrack.samples,{pts:p.pts,payloadType:F,uuid:Y.join(""),userData:Object(k.utf8ArrayToStr)(ie),userDataBytes:ie})}}else if(M<O.bytesAvailable)for(var ue=0;ue<M;ue++)O.readUByte()}break;case 7:if(g=!0,A=!0,!a.sps){var Z=new L.default(I.data).readSPS();a.width=Z.width,a.height=Z.height,a.pixelRatio=Z.pixelRatio,a.sps=[I.data],a.duration=r._duration;for(var se=I.data.subarray(1,4),te="avc1.",ne=0;ne<3;ne++){var fe=se[ne].toString(16);fe.length<2&&(fe="0"+fe),te+=fe}a.codec=te}break;case 8:g=!0,a.pps||(a.pps=[I.data]);break;case 9:g=!1,a.audFound=!0,b&&e(b,a),b=r.avcSample=y(!1,p.pts,p.dts,"");break;case 12:g=!1;break;default:g=!1,b&&(b.debug+="unknown NAL "+I.type+" ")}b&&g&&b.units.push(I)}),v&&b&&(e(b,a),this.avcSample=null)},u.getLastNalUnit=function(){var p,v,g=this.avcSample;if(!g||g.units.length===0){var r=this._avcTrack.samples;g=r[r.length-1]}if((p=g)!==null&&p!==void 0&&p.units){var a=g.units;v=a[a.length-1]}return v},u.parseAVCNALu=function(p){var v,g,r=p.byteLength,a=this._avcTrack,c=a.naluState||0,b=c,A=[],I=0,x=-1,w=0;for(c===-1&&(x=0,w=31&p[0],c=0,I=1);I<r;)if(v=p[I++],c)if(c!==1)if(v)if(v===1){if(x>=0){var O={data:p.subarray(x,I-c-1),type:w};A.push(O)}else{var F=this.getLastNalUnit();if(F&&(b&&I<=4-b&&F.state&&(F.data=F.data.subarray(0,F.data.byteLength-b)),(g=I-c-1)>0)){var M=new Uint8Array(F.data.byteLength+g);M.set(F.data,0),M.set(p.subarray(0,g),F.data.byteLength),F.data=M}}I<r?(x=I,w=31&p[I],c=0):c=-1}else c=0;else c=3;else c=v?0:2;else c=v?0:1;if(x>=0&&c>=0){var N={data:p.subarray(x,r),type:w,state:c};A.push(N)}if(A.length===0){var B=this.getLastNalUnit();if(B){var U=new Uint8Array(B.data.byteLength+p.byteLength);U.set(B.data,0),U.set(p,B.data.byteLength),B.data=U}}return a.naluState=c,A},u.parseAACPES=function(p){var v,g,r,a,c,b=0,A=this._audioTrack,I=this.aacOverFlow,x=p.data;if(I){this.aacOverFlow=null;var w=I.sample.unit.byteLength,O=Math.min(I.missing,w),F=w-O;I.sample.unit.set(x.subarray(0,O),F),A.samples.push(I.sample),b=I.missing}for(v=b,g=x.length;v<g-1&&!R.isHeader(x,v);v++);if(v===b||(v<g-1?(r="AAC PES did not start with ADTS header,offset:"+v,a=!1):(r="no ADTS header found in AAC PES",a=!0),S.logger.warn("parsing error:"+r),this.observer.emit(D.Events.ERROR,D.Events.ERROR,{type:m.ErrorTypes.MEDIA_ERROR,details:m.ErrorDetails.FRAG_PARSING_ERROR,fatal:a,reason:r}),!a)){if(R.initTrackConfig(A,this.observer,x,v,this.audioCodec),p.pts!==void 0)c=p.pts;else{if(!I)return void S.logger.warn("[tsdemuxer]: AAC PES unknown PTS");var M=R.getFrameDuration(A.samplerate);c=I.sample.pts+M}for(var N=0;v<g;){if(R.isHeader(x,v)){if(v+5<g){var B=R.appendFrame(A,x,v,c,N);if(B){if(!B.missing){v+=B.length,N++;continue}this.aacOverFlow=B}}break}v++}}},u.parseMPEGPES=function(p){var v=p.data,g=v.length,r=0,a=0,c=p.pts;if(c!==void 0)for(;a<g;)if(E.isHeader(v,a)){var b=E.appendFrame(this._audioTrack,v,a,c,r);if(!b)break;a+=b.length,r++}else a++;else S.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")},u.parseID3PES=function(p){p.pts!==void 0?this._id3Track.samples.push(p):S.logger.warn("[tsdemuxer]: ID3 PES unknown PTS")},n}();function y(n,u,p,v){return{key:n,frame:!1,pts:u,dts:p,units:[],debug:v,length:0}}function d(n,u){return(31&n[u+10])<<8|n[u+11]}function t(n,u,p,v){var g={audio:-1,avc:-1,id3:-1,isAAC:!0},r=u+3+((15&n[u+1])<<8|n[u+2])-4;for(u+=12+((15&n[u+10])<<8|n[u+11]);u<r;){var a=(31&n[u+1])<<8|n[u+2];switch(n[u]){case 207:if(!v){S.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:g.audio===-1&&(g.audio=a);break;case 21:g.id3===-1&&(g.id3=a);break;case 219:if(!v){S.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:g.avc===-1&&(g.avc=a);break;case 3:case 4:p?g.audio===-1&&(g.audio=a,g.isAAC=!1):S.logger.log("MPEG audio found, not supported in this browser");break;case 36:S.logger.warn("Unsupported HEVC stream type found")}u+=5+((15&n[u+3])<<8|n[u+4])}return g}function i(n){var u,p,v,g,r,a=0,c=n.data;if(!n||n.size===0)return null;for(;c[0].length<19&&c.length>1;){var b=new Uint8Array(c[0].length+c[1].length);b.set(c[0]),b.set(c[1],c[0].length),c[0]=b,c.splice(1,1)}if(((u=c[0])[0]<<16)+(u[1]<<8)+u[2]===1){if((p=(u[4]<<8)+u[5])&&p>n.size-6)return null;var A=u[7];192&A&&(g=536870912*(14&u[9])+4194304*(255&u[10])+16384*(254&u[11])+128*(255&u[12])+(254&u[13])/2,64&A?g-(r=536870912*(14&u[14])+4194304*(255&u[15])+16384*(254&u[16])+128*(255&u[17])+(254&u[18])/2)>54e5&&(S.logger.warn(Math.round((g-r)/9e4)+"s delta between PTS and DTS, align them"),g=r):r=g);var I=(v=u[8])+9;if(n.size<=I)return null;n.size-=I;for(var x=new Uint8Array(n.size),w=0,O=c.length;w<O;w++){var F=(u=c[w]).byteLength;if(I){if(I>F){I-=F;continue}u=u.subarray(I),F-=I,I=0}x.set(u,a),a+=F}return p&&(p-=v+3),{data:x,pts:g,dts:r,len:p}}return null}function e(n,u){if(n.units.length&&n.frame){if(n.pts===void 0){var p=u.samples,v=p.length;if(!v)return void u.dropped++;var g=p[v-1];n.pts=g.pts,n.dts=g.dts}u.samples.push(n)}n.debug.length&&S.logger.log(n.pts+"/"+n.dts+":"+n.debug)}function s(n,u){var p=n.length;if(p>0){if(u.pts>=n[p-1].pts)n.push(u);else for(var v=p-1;v>=0;v--)if(u.pts<n[v].pts){n.splice(v,0,u);break}}else n.push(u)}function l(n){for(var u=n.byteLength,p=[],v=1;v<u-2;)n[v]===0&&n[v+1]===0&&n[v+2]===3?(p.push(v+2),v+=2):v++;if(p.length===0)return n;var g=u-p.length,r=new Uint8Array(g),a=0;for(v=0;v<g;a++,v++)a===p[0]&&(a++,p.shift()),r[v]=n[a];return r}T.minProbeByteLength=188,C.default=T},"./src/errors.ts":function(P,C,f){var R,E,L,k;f.r(C),f.d(C,"ErrorTypes",function(){return R}),f.d(C,"ErrorDetails",function(){return L}),(E=R||(R={})).NETWORK_ERROR="networkError",E.MEDIA_ERROR="mediaError",E.KEY_SYSTEM_ERROR="keySystemError",E.MUX_ERROR="muxError",E.OTHER_ERROR="otherError",(k=L||(L={})).KEY_SYSTEM_NO_KEYS="keySystemNoKeys",k.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",k.KEY_SYSTEM_NO_SESSION="keySystemNoSession",k.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",k.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",k.MANIFEST_LOAD_ERROR="manifestLoadError",k.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",k.MANIFEST_PARSING_ERROR="manifestParsingError",k.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",k.LEVEL_EMPTY_ERROR="levelEmptyError",k.LEVEL_LOAD_ERROR="levelLoadError",k.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",k.LEVEL_SWITCH_ERROR="levelSwitchError",k.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",k.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",k.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",k.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",k.FRAG_LOAD_ERROR="fragLoadError",k.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",k.FRAG_DECRYPT_ERROR="fragDecryptError",k.FRAG_PARSING_ERROR="fragParsingError",k.REMUX_ALLOC_ERROR="remuxAllocError",k.KEY_LOAD_ERROR="keyLoadError",k.KEY_LOAD_TIMEOUT="keyLoadTimeOut",k.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",k.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",k.BUFFER_APPEND_ERROR="bufferAppendError",k.BUFFER_APPENDING_ERROR="bufferAppendingError",k.BUFFER_STALLED_ERROR="bufferStalledError",k.BUFFER_FULL_ERROR="bufferFullError",k.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",k.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",k.INTERNAL_EXCEPTION="internalException",k.INTERNAL_ABORTED="aborted",k.UNKNOWN="unknown"},"./src/events.ts":function(P,C,f){var R,E;f.r(C),f.d(C,"Events",function(){return R}),(E=R||(R={})).MEDIA_ATTACHING="hlsMediaAttaching",E.MEDIA_ATTACHED="hlsMediaAttached",E.MEDIA_DETACHING="hlsMediaDetaching",E.MEDIA_DETACHED="hlsMediaDetached",E.BUFFER_RESET="hlsBufferReset",E.BUFFER_CODECS="hlsBufferCodecs",E.BUFFER_CREATED="hlsBufferCreated",E.BUFFER_APPENDING="hlsBufferAppending",E.BUFFER_APPENDED="hlsBufferAppended",E.BUFFER_EOS="hlsBufferEos",E.BUFFER_FLUSHING="hlsBufferFlushing",E.BUFFER_FLUSHED="hlsBufferFlushed",E.MANIFEST_LOADING="hlsManifestLoading",E.MANIFEST_LOADED="hlsManifestLoaded",E.MANIFEST_PARSED="hlsManifestParsed",E.LEVEL_SWITCHING="hlsLevelSwitching",E.LEVEL_SWITCHED="hlsLevelSwitched",E.LEVEL_LOADING="hlsLevelLoading",E.LEVEL_LOADED="hlsLevelLoaded",E.LEVEL_UPDATED="hlsLevelUpdated",E.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",E.LEVELS_UPDATED="hlsLevelsUpdated",E.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",E.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",E.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",E.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",E.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",E.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",E.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",E.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",E.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",E.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",E.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",E.CUES_PARSED="hlsCuesParsed",E.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",E.INIT_PTS_FOUND="hlsInitPtsFound",E.FRAG_LOADING="hlsFragLoading",E.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",E.FRAG_LOADED="hlsFragLoaded",E.FRAG_DECRYPTED="hlsFragDecrypted",E.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",E.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",E.FRAG_PARSING_METADATA="hlsFragParsingMetadata",E.FRAG_PARSED="hlsFragParsed",E.FRAG_BUFFERED="hlsFragBuffered",E.FRAG_CHANGED="hlsFragChanged",E.FPS_DROP="hlsFpsDrop",E.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",E.ERROR="hlsError",E.DESTROYING="hlsDestroying",E.KEY_LOADING="hlsKeyLoading",E.KEY_LOADED="hlsKeyLoaded",E.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",E.BACK_BUFFER_REACHED="hlsBackBufferReached"},"./src/hls.ts":function(P,C,f){f.r(C),f.d(C,"default",function(){return e});var R=f("./node_modules/url-toolkit/src/url-toolkit.js"),E=f("./src/loader/playlist-loader.ts"),L=f("./src/loader/key-loader.ts"),k=f("./src/controller/id3-track-controller.ts"),_=f("./src/controller/latency-controller.ts"),D=f("./src/controller/level-controller.ts"),o=f("./src/controller/fragment-tracker.ts"),S=f("./src/controller/stream-controller.ts"),m=f("./src/is-supported.ts"),h=f("./src/utils/logger.ts"),T=f("./src/config.ts"),y=f("./node_modules/eventemitter3/index.js"),d=f("./src/events.ts"),t=f("./src/errors.ts");function i(s,l){for(var n=0;n<l.length;n++){var u=l[n];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(s,u.key,u)}}var e=function(){function s(v){v===void 0&&(v={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new y.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this._media=null,this.url=null;var g=this.config=Object(T.mergeConfig)(s.DefaultConfig,v);this.userConfig=v,Object(h.enableLogs)(g.debug),this._autoLevelCapping=-1,g.progressive&&Object(T.enableStreamingMode)(g);var r=g.abrController,a=g.bufferController,c=g.capLevelController,b=g.fpsController,A=this.abrController=new r(this),I=this.bufferController=new a(this),x=this.capLevelController=new c(this),w=new b(this),O=new E.default(this),F=new L.default(this),M=new k.default(this),N=this.levelController=new D.default(this),B=new o.FragmentTracker(this),U=this.streamController=new S.default(this,B);x.setStreamController(U),w.setStreamController(U);var G=[N,U];this.networkControllers=G;var H=[O,F,A,I,x,w,M,B];this.audioTrackController=this.createController(g.audioTrackController,null,G),this.createController(g.audioStreamController,B,G),this.subtitleTrackController=this.createController(g.subtitleTrackController,null,G),this.createController(g.subtitleStreamController,B,G),this.createController(g.timelineController,null,H),this.emeController=this.createController(g.emeController,null,H),this.latencyController=this.createController(_.default,null,H),this.coreComponents=H}s.isSupported=function(){return Object(m.isSupported)()};var l,n,u,p=s.prototype;return p.createController=function(v,g,r){if(v){var a=g?new v(this,g):new v(this);return r&&r.push(a),a}return null},p.on=function(v,g,r){r===void 0&&(r=this),this._emitter.on(v,g,r)},p.once=function(v,g,r){r===void 0&&(r=this),this._emitter.once(v,g,r)},p.removeAllListeners=function(v){this._emitter.removeAllListeners(v)},p.off=function(v,g,r,a){r===void 0&&(r=this),this._emitter.off(v,g,r,a)},p.listeners=function(v){return this._emitter.listeners(v)},p.emit=function(v,g,r){return this._emitter.emit(v,g,r)},p.trigger=function(v,g){if(this.config.debug)return this.emit(v,v,g);try{return this.emit(v,v,g)}catch(r){h.logger.error("An internal error happened while handling event "+v+'. Error message: "'+r.message+'". Here is a stacktrace:',r),this.trigger(d.Events.ERROR,{type:t.ErrorTypes.OTHER_ERROR,details:t.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:v,error:r})}return!1},p.listenerCount=function(v){return this._emitter.listenerCount(v)},p.destroy=function(){h.logger.log("destroy"),this.trigger(d.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(v){return v.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(v){return v.destroy()}),this.coreComponents.length=0},p.attachMedia=function(v){h.logger.log("attachMedia"),this._media=v,this.trigger(d.Events.MEDIA_ATTACHING,{media:v})},p.detachMedia=function(){h.logger.log("detachMedia"),this.trigger(d.Events.MEDIA_DETACHING,void 0),this._media=null},p.loadSource=function(v){this.stopLoad();var g=this.media,r=this.url,a=this.url=R.buildAbsoluteURL(self.location.href,v,{alwaysNormalize:!0});h.logger.log("loadSource:"+a),g&&r&&r!==a&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(g)),this.trigger(d.Events.MANIFEST_LOADING,{url:v})},p.startLoad=function(v){v===void 0&&(v=-1),h.logger.log("startLoad("+v+")"),this.networkControllers.forEach(function(g){g.startLoad(v)})},p.stopLoad=function(){h.logger.log("stopLoad"),this.networkControllers.forEach(function(v){v.stopLoad()})},p.swapAudioCodec=function(){h.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},p.recoverMediaError=function(){h.logger.log("recoverMediaError");var v=this._media;this.detachMedia(),v&&this.attachMedia(v)},p.removeLevel=function(v,g){g===void 0&&(g=0),this.levelController.removeLevel(v,g)},l=s,u=[{key:"version",get:function(){return"1.0.10"}},{key:"Events",get:function(){return d.Events}},{key:"ErrorTypes",get:function(){return t.ErrorTypes}},{key:"ErrorDetails",get:function(){return t.ErrorDetails}},{key:"DefaultConfig",get:function(){return s.defaultConfig?s.defaultConfig:T.hlsDefaultConfig},set:function(v){s.defaultConfig=v}}],(n=[{key:"levels",get:function(){var v=this.levelController.levels;return v||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(v){h.logger.log("set currentLevel:"+v),this.loadLevel=v,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(v){h.logger.log("set nextLevel:"+v),this.levelController.manualLevel=v,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(v){h.logger.log("set loadLevel:"+v),this.levelController.manualLevel=v}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(v){this.levelController.nextLoadLevel=v}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(v){h.logger.log("set firstLevel:"+v),this.levelController.firstLevel=v}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(v){h.logger.log("set startLevel:"+v),v!==-1&&(v=Math.max(v,this.minAutoLevel)),this.levelController.startLevel=v}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(v){var g=!!v;g!==this.config.capLevelToPlayerSize&&(g?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=g)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(v){this._autoLevelCapping!==v&&(h.logger.log("set autoLevelCapping:"+v),this._autoLevelCapping=v)}},{key:"bandwidthEstimate",get:function(){var v=this.abrController.bwEstimator;return v?v.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var v=this.levels,g=this.config.minAutoBitrate;if(!v)return 0;for(var r=v.length,a=0;a<r;a++)if(v[a].maxBitrate>g)return a;return 0}},{key:"maxAutoLevel",get:function(){var v=this.levels,g=this.autoLevelCapping;return g===-1&&v&&v.length?v.length-1:g}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(v){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,v)}},{key:"audioTracks",get:function(){var v=this.audioTrackController;return v?v.audioTracks:[]}},{key:"audioTrack",get:function(){var v=this.audioTrackController;return v?v.audioTrack:-1},set:function(v){var g=this.audioTrackController;g&&(g.audioTrack=v)}},{key:"subtitleTracks",get:function(){var v=this.subtitleTrackController;return v?v.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var v=this.subtitleTrackController;return v?v.subtitleTrack:-1},set:function(v){var g=this.subtitleTrackController;g&&(g.subtitleTrack=v)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var v=this.subtitleTrackController;return!!v&&v.subtitleDisplay},set:function(v){var g=this.subtitleTrackController;g&&(g.subtitleDisplay=v)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(v){this.config.lowLatencyMode=v}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}])&&i(l.prototype,n),u&&i(l,u),s}();e.defaultConfig=void 0},"./src/is-supported.ts":function(P,C,f){f.r(C),f.d(C,"isSupported",function(){return L}),f.d(C,"changeTypeSupported",function(){return k});var R=f("./src/utils/mediasource-helper.ts");function E(){return self.SourceBuffer||self.WebKitSourceBuffer}function L(){var _=Object(R.getMediaSource)();if(!_)return!1;var D=E(),o=_&&typeof _.isTypeSupported=="function"&&_.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),S=!D||D.prototype&&typeof D.prototype.appendBuffer=="function"&&typeof D.prototype.remove=="function";return!!o&&!!S}function k(){var _,D=E();return typeof(D==null||(_=D.prototype)===null||_===void 0?void 0:_.changeType)=="function"}},"./src/loader/fragment-loader.ts":function(P,C,f){f.r(C),f.d(C,"default",function(){return m}),f.d(C,"LoadError",function(){return T});var R=f("./src/polyfills/number.ts"),E=f("./src/errors.ts");function L(y){var d=typeof Map=="function"?new Map:void 0;return(L=function(t){if(t===null||(i=t,Function.toString.call(i).indexOf("[native code]")===-1))return t;var i;if(typeof t!="function")throw new TypeError("Super expression must either be null or a function");if(d!==void 0){if(d.has(t))return d.get(t);d.set(t,e)}function e(){return k(t,arguments,o(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),D(e,t)})(y)}function k(y,d,t){return(k=_()?Reflect.construct:function(i,e,s){var l=[null];l.push.apply(l,e);var n=new(Function.bind.apply(i,l));return s&&D(n,s.prototype),n}).apply(null,arguments)}function _(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function D(y,d){return(D=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(y,d)}function o(y){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(d){return d.__proto__||Object.getPrototypeOf(d)})(y)}var S=Math.pow(2,17),m=function(){function y(t){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=t}var d=y.prototype;return d.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},d.abort=function(){this.loader&&this.loader.abort()},d.load=function(t,i){var e=this,s=t.url;if(!s)return Promise.reject(new T({type:E.ErrorTypes.NETWORK_ERROR,details:E.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t,networkDetails:null},"Fragment does not have a "+(s?"part list":"url")));this.abort();var l=this.config,n=l.fLoader,u=l.loader;return new Promise(function(p,v){e.loader&&e.loader.destroy();var g=e.loader=t.loader=n?new n(l):new u(l),r=h(t),a={timeout:l.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:l.fragLoadingMaxRetryTimeout,highWaterMark:S};t.stats=g.stats,g.load(r,a,{onSuccess:function(c,b,A,I){e.resetLoader(t,g),p({frag:t,part:null,payload:c.data,networkDetails:I})},onError:function(c,b,A){e.resetLoader(t,g),v(new T({type:E.ErrorTypes.NETWORK_ERROR,details:E.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t,response:c,networkDetails:A}))},onAbort:function(c,b,A){e.resetLoader(t,g),v(new T({type:E.ErrorTypes.NETWORK_ERROR,details:E.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:t,networkDetails:A}))},onTimeout:function(c,b,A){e.resetLoader(t,g),v(new T({type:E.ErrorTypes.NETWORK_ERROR,details:E.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,networkDetails:A}))},onProgress:function(c,b,A,I){i&&i({frag:t,part:null,payload:A,networkDetails:I})}})})},d.loadPart=function(t,i,e){var s=this;this.abort();var l=this.config,n=l.fLoader,u=l.loader;return new Promise(function(p,v){s.loader&&s.loader.destroy();var g=s.loader=t.loader=n?new n(l):new u(l),r=h(t,i),a={timeout:l.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:l.fragLoadingMaxRetryTimeout,highWaterMark:S};i.stats=g.stats,g.load(r,a,{onSuccess:function(c,b,A,I){s.resetLoader(t,g),s.updateStatsFromPart(t,i);var x={frag:t,part:i,payload:c.data,networkDetails:I};e(x),p(x)},onError:function(c,b,A){s.resetLoader(t,g),v(new T({type:E.ErrorTypes.NETWORK_ERROR,details:E.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t,part:i,response:c,networkDetails:A}))},onAbort:function(c,b,A){t.stats.aborted=i.stats.aborted,s.resetLoader(t,g),v(new T({type:E.ErrorTypes.NETWORK_ERROR,details:E.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:t,part:i,networkDetails:A}))},onTimeout:function(c,b,A){s.resetLoader(t,g),v(new T({type:E.ErrorTypes.NETWORK_ERROR,details:E.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,part:i,networkDetails:A}))}})})},d.updateStatsFromPart=function(t,i){var e=t.stats,s=i.stats,l=s.total;if(e.loaded+=s.loaded,l){var n=Math.round(t.duration/i.duration),u=Math.min(Math.round(e.loaded/l),n),p=(n-u)*Math.round(e.loaded/u);e.total=e.loaded+p}else e.total=Math.max(e.loaded,e.total);var v=e.loading,g=s.loading;v.start?v.first+=g.first-g.start:(v.start=g.start,v.first=g.first),v.end=g.end},d.resetLoader=function(t,i){t.loader=null,this.loader===i&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),i.destroy()},y}();function h(y,d){d===void 0&&(d=null);var t=d||y,i={frag:y,part:d,responseType:"arraybuffer",url:t.url,rangeStart:0,rangeEnd:0},e=t.byteRangeStartOffset,s=t.byteRangeEndOffset;return Object(R.isFiniteNumber)(e)&&Object(R.isFiniteNumber)(s)&&(i.rangeStart=e,i.rangeEnd=s),i}var T=function(y){var d,t;function i(e){for(var s,l=arguments.length,n=new Array(l>1?l-1:0),u=1;u<l;u++)n[u-1]=arguments[u];return(s=y.call.apply(y,[this].concat(n))||this).data=void 0,s.data=e,s}return t=y,(d=i).prototype=Object.create(t.prototype),d.prototype.constructor=d,D(d,t),i}(L(Error))},"./src/loader/fragment.ts":function(P,C,f){f.r(C),f.d(C,"ElementaryStreamTypes",function(){return R}),f.d(C,"BaseSegment",function(){return y}),f.d(C,"Fragment",function(){return d}),f.d(C,"Part",function(){return t});var R,E,L=f("./src/polyfills/number.ts"),k=f("./node_modules/url-toolkit/src/url-toolkit.js"),_=f("./src/utils/logger.ts"),D=f("./src/loader/level-key.ts"),o=f("./src/loader/load-stats.ts");function S(i,e){i.prototype=Object.create(e.prototype),i.prototype.constructor=i,m(i,e)}function m(i,e){return(m=Object.setPrototypeOf||function(s,l){return s.__proto__=l,s})(i,e)}function h(i,e){for(var s=0;s<e.length;s++){var l=e[s];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(i,l.key,l)}}function T(i,e,s){return e&&h(i.prototype,e),s&&h(i,s),i}(E=R||(R={})).AUDIO="audio",E.VIDEO="video",E.AUDIOVIDEO="audiovideo";var y=function(){function i(e){var s;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((s={})[R.AUDIO]=null,s[R.VIDEO]=null,s[R.AUDIOVIDEO]=null,s),this.baseurl=e}return i.prototype.setByteRange=function(e,s){var l=e.split("@",2),n=[];l.length===1?n[0]=s?s.byteRangeEndOffset:0:n[0]=parseInt(l[1]),n[1]=parseInt(l[0])+n[0],this._byteRange=n},T(i,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(k.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(e){this._url=e}}]),i}(),d=function(i){function e(l,n){var u;return(u=i.call(this,n)||this)._decryptdata=null,u.rawProgramDateTime=null,u.programDateTime=null,u.tagList=[],u.duration=0,u.sn=0,u.levelkey=void 0,u.type=void 0,u.loader=null,u.level=-1,u.cc=0,u.startPTS=void 0,u.endPTS=void 0,u.appendedPTS=void 0,u.startDTS=void 0,u.endDTS=void 0,u.start=0,u.deltaPTS=void 0,u.maxStartPTS=void 0,u.minEndPTS=void 0,u.stats=new o.LoadStats,u.urlId=0,u.data=void 0,u.bitrateTest=!1,u.title=null,u.initSegment=null,u.type=l,u}S(e,i);var s=e.prototype;return s.createInitializationVector=function(l){for(var n=new Uint8Array(16),u=12;u<16;u++)n[u]=l>>8*(15-u)&255;return n},s.setDecryptDataFromLevelKey=function(l,n){var u=l;return(l==null?void 0:l.method)==="AES-128"&&l.uri&&!l.iv&&((u=D.LevelKey.fromURI(l.uri)).method=l.method,u.iv=this.createInitializationVector(n),u.keyFormat="identity"),u},s.setElementaryStreamInfo=function(l,n,u,p,v,g){g===void 0&&(g=!1);var r=this.elementaryStreams,a=r[l];a?(a.startPTS=Math.min(a.startPTS,n),a.endPTS=Math.max(a.endPTS,u),a.startDTS=Math.min(a.startDTS,p),a.endDTS=Math.max(a.endDTS,v)):r[l]={startPTS:n,endPTS:u,startDTS:p,endDTS:v,partial:g}},s.clearElementaryStreamInfo=function(){var l=this.elementaryStreams;l[R.AUDIO]=null,l[R.VIDEO]=null,l[R.AUDIOVIDEO]=null},T(e,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var l=this.sn;typeof l!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&_.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),l=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,l)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!Object(L.isFiniteNumber)(this.programDateTime))return null;var l=Object(L.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*l}},{key:"encrypted",get:function(){var l;return!((l=this.decryptdata)===null||l===void 0||!l.keyFormat||!this.decryptdata.uri)}}]),e}(y),t=function(i){function e(s,l,n,u,p){var v;(v=i.call(this,n)||this).fragOffset=0,v.duration=0,v.gap=!1,v.independent=!1,v.relurl=void 0,v.fragment=void 0,v.index=void 0,v.stats=new o.LoadStats,v.duration=s.decimalFloatingPoint("DURATION"),v.gap=s.bool("GAP"),v.independent=s.bool("INDEPENDENT"),v.relurl=s.enumeratedString("URI"),v.fragment=l,v.index=u;var g=s.enumeratedString("BYTERANGE");return g&&v.setByteRange(g,p),p&&(v.fragOffset=p.fragOffset+p.duration),v}return S(e,i),T(e,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var s=this.elementaryStreams;return!!(s.audio||s.video||s.audiovideo)}}]),e}(y)},"./src/loader/key-loader.ts":function(P,C,f){f.r(C),f.d(C,"default",function(){return k});var R=f("./src/events.ts"),E=f("./src/errors.ts"),L=f("./src/utils/logger.ts"),k=function(){function _(o){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=o,this._registerListeners()}var D=_.prototype;return D._registerListeners=function(){this.hls.on(R.Events.KEY_LOADING,this.onKeyLoading,this)},D._unregisterListeners=function(){this.hls.off(R.Events.KEY_LOADING,this.onKeyLoading)},D.destroy=function(){for(var o in this._unregisterListeners(),this.loaders){var S=this.loaders[o];S&&S.destroy()}this.loaders={}},D.onKeyLoading=function(o,S){var m=S.frag,h=m.type,T=this.loaders[h];if(m.decryptdata){var y=m.decryptdata.uri;if(y!==this.decrypturl||this.decryptkey===null){var d=this.hls.config;if(T&&(L.logger.warn("abort previous key loader for type:"+h),T.abort()),!y)return void L.logger.warn("key uri is falsy");var t=d.loader,i=m.loader=this.loaders[h]=new t(d);this.decrypturl=y,this.decryptkey=null;var e={url:y,frag:m,responseType:"arraybuffer"},s={timeout:d.fragLoadingTimeOut,maxRetry:0,retryDelay:d.fragLoadingRetryDelay,maxRetryDelay:d.fragLoadingMaxRetryTimeout,highWaterMark:0},l={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};i.load(e,s,l)}else this.decryptkey&&(m.decryptdata.key=this.decryptkey,this.hls.trigger(R.Events.KEY_LOADED,{frag:m}))}else L.logger.warn("Missing decryption data on fragment in onKeyLoading")},D.loadsuccess=function(o,S,m){var h=m.frag;h.decryptdata?(this.decryptkey=h.decryptdata.key=new Uint8Array(o.data),h.loader=null,delete this.loaders[h.type],this.hls.trigger(R.Events.KEY_LOADED,{frag:h})):L.logger.error("after key load, decryptdata unset")},D.loaderror=function(o,S){var m=S.frag,h=m.loader;h&&h.abort(),delete this.loaders[m.type],this.hls.trigger(R.Events.ERROR,{type:E.ErrorTypes.NETWORK_ERROR,details:E.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:m,response:o})},D.loadtimeout=function(o,S){var m=S.frag,h=m.loader;h&&h.abort(),delete this.loaders[m.type],this.hls.trigger(R.Events.ERROR,{type:E.ErrorTypes.NETWORK_ERROR,details:E.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:m})},_}()},"./src/loader/level-details.ts":function(P,C,f){f.r(C),f.d(C,"LevelDetails",function(){return L});var R=f("./src/polyfills/number.ts");function E(k,_){for(var D=0;D<_.length;D++){var o=_[D];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(k,o.key,o)}}var L=function(){function k(o){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.url=o}var _,D;return k.prototype.reloaded=function(o){if(!o)return this.advanced=!0,void(this.updated=!0);var S=this.lastPartSn-o.lastPartSn,m=this.lastPartIndex-o.lastPartIndex;this.updated=this.endSN!==o.endSN||!!m||!!S,this.advanced=this.endSN>o.endSN||S>0||S===0&&m>0,this.updated||this.advanced?this.misses=Math.floor(.6*o.misses):this.misses=o.misses+1,this.availabilityDelay=o.availabilityDelay},_=k,(D=[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&Object(R.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var o=this.driftEndTime-this.driftStartTime;return o>0?1e3*(this.driftEnd-this.driftStart)/o:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var o;return(o=this.partList)!==null&&o!==void 0&&o.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var o;return(o=this.fragments)!==null&&o!==void 0&&o.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var o;return(o=this.partList)!==null&&o!==void 0&&o.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var o;return(o=this.partList)!==null&&o!==void 0&&o.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}])&&E(_.prototype,D),k}()},"./src/loader/level-key.ts":function(P,C,f){f.r(C),f.d(C,"LevelKey",function(){return L});var R=f("./node_modules/url-toolkit/src/url-toolkit.js");function E(k,_){for(var D=0;D<_.length;D++){var o=_[D];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(k,o.key,o)}}var L=function(){function k(o,S){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,this._uri=S?Object(R.buildAbsoluteURL)(o,S,{alwaysNormalize:!0}):o}var _,D;return k.fromURL=function(o,S){return new k(o,S)},k.fromURI=function(o){return new k(o)},_=k,(D=[{key:"uri",get:function(){return this._uri}}])&&E(_.prototype,D),k}()},"./src/loader/load-stats.ts":function(P,C,f){f.r(C),f.d(C,"LoadStats",function(){return R});var R=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(P,C,f){f.r(C),f.d(C,"default",function(){return t});var R=f("./src/polyfills/number.ts"),E=f("./node_modules/url-toolkit/src/url-toolkit.js"),L=f("./src/loader/fragment.ts"),k=f("./src/loader/level-details.ts"),_=f("./src/loader/level-key.ts"),D=f("./src/utils/attr-list.ts"),o=f("./src/utils/logger.ts"),S=f("./src/utils/codecs.ts"),m=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,h=/#EXT-X-MEDIA:(.*)/g,T=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),y=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(PLAYLIST-TYPE):(.+)/.source,/#EXT-X-(MEDIA-SEQUENCE): *(\d+)/.source,/#EXT-X-(SKIP):(.+)/.source,/#EXT-X-(TARGETDURATION): *(\d+)/.source,/#EXT-X-(KEY):(.+)/.source,/#EXT-X-(START):(.+)/.source,/#EXT-X-(ENDLIST)/.source,/#EXT-X-(DISCONTINUITY-SEQ)UENCE: *(\d+)/.source,/#EXT-X-(DIS)CONTINUITY/.source,/#EXT-X-(VERSION):(\d+)/.source,/#EXT-X-(MAP):(.+)/.source,/#EXT-X-(SERVER-CONTROL):(.+)/.source,/#EXT-X-(PART-INF):(.+)/.source,/#EXT-X-(GAP)/.source,/#EXT-X-(BITRATE):\s*(\d+)/.source,/#EXT-X-(PART):(.+)/.source,/#EXT-X-(PRELOAD-HINT):(.+)/.source,/#EXT-X-(RENDITION-REPORT):(.+)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),d=/\.(mp4|m4s|m4v|m4a)$/i,t=function(){function l(){}return l.findGroup=function(n,u){for(var p=0;p<n.length;p++){var v=n[p];if(v.id===u)return v}},l.convertAVC1ToAVCOTI=function(n){var u=n.split(".");if(u.length>2){var p=u.shift()+".";return p+=parseInt(u.shift()).toString(16),p+=("000"+parseInt(u.shift()).toString(16)).substr(-4)}return n},l.resolve=function(n,u){return E.buildAbsoluteURL(u,n,{alwaysNormalize:!0})},l.parseMasterPlaylist=function(n,u){var p,v=[],g={},r=!1;for(m.lastIndex=0;(p=m.exec(n))!=null;)if(p[1]){var a=new D.AttrList(p[1]),c={attrs:a,bitrate:a.decimalInteger("AVERAGE-BANDWIDTH")||a.decimalInteger("BANDWIDTH"),name:a.NAME,url:l.resolve(p[2],u)},b=a.decimalResolution("RESOLUTION");b&&(c.width=b.width,c.height=b.height),i((a.CODECS||"").split(/[ ,]+/).filter(function(I){return I}),c),c.videoCodec&&c.videoCodec.indexOf("avc1")!==-1&&(c.videoCodec=l.convertAVC1ToAVCOTI(c.videoCodec)),v.push(c)}else if(p[3]){var A=new D.AttrList(p[3]);A["DATA-ID"]&&(r=!0,g[A["DATA-ID"]]=A)}return{levels:v,sessionData:r?g:null}},l.parseMasterPlaylistMedia=function(n,u,p,v){var g;v===void 0&&(v=[]);var r=[],a=0;for(h.lastIndex=0;(g=h.exec(n))!==null;){var c=new D.AttrList(g[1]);if(c.TYPE===p){var b={attrs:c,bitrate:0,id:a++,groupId:c["GROUP-ID"],instreamId:c["INSTREAM-ID"],name:c.NAME||c.LANGUAGE||"",type:p,default:c.bool("DEFAULT"),autoselect:c.bool("AUTOSELECT"),forced:c.bool("FORCED"),lang:c.LANGUAGE,url:c.URI?l.resolve(c.URI,u):""};if(v.length){var A=l.findGroup(v,b.groupId)||v[0];e(b,A,"audioCodec"),e(b,A,"textCodec")}r.push(b)}}return r},l.parseLevelPlaylist=function(n,u,p,v,g){var r,a,c,b=new k.LevelDetails(u),A=b.fragments,I=null,x=0,w=0,O=0,F=0,M=null,N=new L.Fragment(v,u),B=-1,U=!1;for(T.lastIndex=0,b.m3u8=n;(r=T.exec(n))!==null;){U&&(U=!1,(N=new L.Fragment(v,u)).start=O,N.sn=x,N.cc=F,N.level=p,I&&(N.initSegment=I,N.rawProgramDateTime=I.rawProgramDateTime));var G=r[1];if(G){N.duration=parseFloat(G);var H=(" "+r[2]).slice(1);N.title=H||null,N.tagList.push(H?["INF",G,H]:["INF",G])}else if(r[3])Object(R.isFiniteNumber)(N.duration)&&(N.start=O,c&&(N.levelkey=c),N.sn=x,N.level=p,N.cc=F,N.urlId=g,A.push(N),N.relurl=(" "+r[3]).slice(1),s(N,M),M=N,O+=N.duration,x++,w=0,U=!0);else if(r[4]){var z=(" "+r[4]).slice(1);M?N.setByteRange(z,M):N.setByteRange(z)}else if(r[5])N.rawProgramDateTime=(" "+r[5]).slice(1),N.tagList.push(["PROGRAM-DATE-TIME",N.rawProgramDateTime]),B===-1&&(B=A.length);else{if(!(r=r[0].match(y))){o.logger.warn("No matches on slow regex match for level playlist!");continue}for(a=1;a<r.length&&r[a]===void 0;a++);var Y=(" "+r[a]).slice(1),W=(" "+r[a+1]).slice(1),$=r[a+2]?(" "+r[a+2]).slice(1):"";switch(Y){case"PLAYLIST-TYPE":b.type=W.toUpperCase();break;case"MEDIA-SEQUENCE":x=b.startSN=parseInt(W);break;case"SKIP":var ie=new D.AttrList(W),ae=ie.decimalInteger("SKIPPED-SEGMENTS");if(Object(R.isFiniteNumber)(ae)){b.skippedSegments=ae;for(var ue=ae;ue--;)A.unshift(null);x+=ae}var Z=ie.enumeratedString("RECENTLY-REMOVED-DATERANGES");Z&&(b.recentlyRemovedDateranges=Z.split("	"));break;case"TARGETDURATION":b.targetduration=parseFloat(W);break;case"VERSION":b.version=parseInt(W);break;case"EXTM3U":break;case"ENDLIST":b.live=!1;break;case"#":(W||$)&&N.tagList.push($?[W,$]:[W]);break;case"DIS":F++;case"GAP":N.tagList.push([Y]);break;case"BITRATE":N.tagList.push([Y,W]);break;case"DISCONTINUITY-SEQ":F=parseInt(W);break;case"KEY":var se,te=new D.AttrList(W),ne=te.enumeratedString("METHOD"),fe=te.URI,he=te.hexadecimalInteger("IV"),pe=te.enumeratedString("KEYFORMATVERSIONS"),ve=te.enumeratedString("KEYID"),Se=(se=te.enumeratedString("KEYFORMAT"))!=null?se:"identity";if(["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"].indexOf(Se)>-1){o.logger.warn("Keyformat "+Se+" is not supported from the manifest");continue}if(Se!=="identity")continue;ne&&(c=_.LevelKey.fromURL(u,fe),fe&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(ne)>=0&&(c.method=ne,c.keyFormat=Se,ve&&(c.keyID=ve),pe&&(c.keyFormatVersions=pe),c.iv=he));break;case"START":var be=new D.AttrList(W).decimalFloatingPoint("TIME-OFFSET");Object(R.isFiniteNumber)(be)&&(b.startTimeOffset=be);break;case"MAP":var j=new D.AttrList(W);N.relurl=j.URI,j.BYTERANGE&&N.setByteRange(j.BYTERANGE),N.level=p,N.sn="initSegment",c&&(N.levelkey=c),N.initSegment=null,I=N,U=!0;break;case"SERVER-CONTROL":var Q=new D.AttrList(W);b.canBlockReload=Q.bool("CAN-BLOCK-RELOAD"),b.canSkipUntil=Q.optionalFloat("CAN-SKIP-UNTIL",0),b.canSkipDateRanges=b.canSkipUntil>0&&Q.bool("CAN-SKIP-DATERANGES"),b.partHoldBack=Q.optionalFloat("PART-HOLD-BACK",0),b.holdBack=Q.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var ge=new D.AttrList(W);b.partTarget=ge.decimalFloatingPoint("PART-TARGET");break;case"PART":var Te=b.partList;Te||(Te=b.partList=[]);var Ie=w>0?Te[Te.length-1]:void 0,$e=w++,Ue=new L.Part(new D.AttrList(W),N,u,$e,Ie);Te.push(Ue),N.duration+=Ue.duration;break;case"PRELOAD-HINT":var Ce=new D.AttrList(W);b.preloadHint=Ce;break;case"RENDITION-REPORT":var et=new D.AttrList(W);b.renditionReports=b.renditionReports||[],b.renditionReports.push(et);break;default:o.logger.warn("line parsed but not handled: "+r)}}}M&&!M.relurl?(A.pop(),O-=M.duration,b.partList&&(b.fragmentHint=M)):b.partList&&(s(N,M),N.cc=F,b.fragmentHint=N);var Qe=A.length,we=A[0],tt=A[Qe-1];if((O+=b.skippedSegments*b.targetduration)>0&&Qe&&tt){b.averagetargetduration=O/Qe;var Ze=tt.sn;b.endSN=Ze!=="initSegment"?Ze:0,we&&(b.startCC=we.cc,we.initSegment||b.fragments.every(function(Ge){return Ge.relurl&&(Fe=Ge.relurl,d.test((je=(De=E.parseURL(Fe))===null||De===void 0?void 0:De.path)!=null?je:""));var Fe,je,De})&&(o.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(N=new L.Fragment(v,u)).relurl=tt.relurl,N.level=p,N.sn="initSegment",we.initSegment=N,b.needSidxRanges=!0))}else b.endSN=0,b.startCC=0;return b.fragmentHint&&(O+=b.fragmentHint.duration),b.totalduration=O,b.endCC=F,B>0&&function(Ge,Fe){for(var je=Ge[Fe],De=Fe;De--;){var Ke=Ge[De];if(!Ke)return;Ke.programDateTime=je.programDateTime-1e3*Ke.duration,je=Ke}}(A,B),b},l}();function i(l,n){["video","audio","text"].forEach(function(u){var p=l.filter(function(g){return Object(S.isCodecType)(g,u)});if(p.length){var v=p.filter(function(g){return g.lastIndexOf("avc1",0)===0||g.lastIndexOf("mp4a",0)===0});n[u+"Codec"]=v.length>0?v[0]:p[0],l=l.filter(function(g){return p.indexOf(g)===-1})}}),n.unknownCodecs=l}function e(l,n,u){var p=n[u];p&&(l[u]=p)}function s(l,n){l.rawProgramDateTime?l.programDateTime=Date.parse(l.rawProgramDateTime):n!=null&&n.programDateTime&&(l.programDateTime=n.endProgramDateTime),Object(R.isFiniteNumber)(l.programDateTime)||(l.programDateTime=null,l.rawProgramDateTime=null)}},"./src/loader/playlist-loader.ts":function(P,C,f){f.r(C);var R=f("./src/polyfills/number.ts"),E=f("./src/events.ts"),L=f("./src/errors.ts"),k=f("./src/utils/logger.ts"),_=f("./src/utils/mp4-tools.ts"),D=f("./src/loader/m3u8-parser.ts"),o=f("./src/types/loader.ts"),S=f("./src/utils/attr-list.ts");function m(T,y){var d=T.url;return d!==void 0&&d.indexOf("data:")!==0||(d=y.url),d}var h=function(){function T(d){this.hls=void 0,this.loaders=Object.create(null),this.hls=d,this.registerListeners()}var y=T.prototype;return y.registerListeners=function(){var d=this.hls;d.on(E.Events.MANIFEST_LOADING,this.onManifestLoading,this),d.on(E.Events.LEVEL_LOADING,this.onLevelLoading,this),d.on(E.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),d.on(E.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},y.unregisterListeners=function(){var d=this.hls;d.off(E.Events.MANIFEST_LOADING,this.onManifestLoading,this),d.off(E.Events.LEVEL_LOADING,this.onLevelLoading,this),d.off(E.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),d.off(E.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},y.createInternalLoader=function(d){var t=this.hls.config,i=t.pLoader,e=t.loader,s=new(i||e)(t);return d.loader=s,this.loaders[d.type]=s,s},y.getInternalLoader=function(d){return this.loaders[d.type]},y.resetInternalLoader=function(d){this.loaders[d]&&delete this.loaders[d]},y.destroyInternalLoaders=function(){for(var d in this.loaders){var t=this.loaders[d];t&&t.destroy(),this.resetInternalLoader(d)}},y.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},y.onManifestLoading=function(d,t){var i=t.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:o.PlaylistContextType.MANIFEST,url:i,deliveryDirectives:null})},y.onLevelLoading=function(d,t){var i=t.id,e=t.level,s=t.url,l=t.deliveryDirectives;this.load({id:i,groupId:null,level:e,responseType:"text",type:o.PlaylistContextType.LEVEL,url:s,deliveryDirectives:l})},y.onAudioTrackLoading=function(d,t){var i=t.id,e=t.groupId,s=t.url,l=t.deliveryDirectives;this.load({id:i,groupId:e,level:null,responseType:"text",type:o.PlaylistContextType.AUDIO_TRACK,url:s,deliveryDirectives:l})},y.onSubtitleTrackLoading=function(d,t){var i=t.id,e=t.groupId,s=t.url,l=t.deliveryDirectives;this.load({id:i,groupId:e,level:null,responseType:"text",type:o.PlaylistContextType.SUBTITLE_TRACK,url:s,deliveryDirectives:l})},y.load=function(d){var t,i,e,s,l,n,u=this.hls.config,p=this.getInternalLoader(d);if(p){var v=p.context;if(v&&v.url===d.url)return void k.logger.trace("[playlist-loader]: playlist request ongoing");k.logger.log("[playlist-loader]: aborting previous loader for type: "+d.type),p.abort()}switch(d.type){case o.PlaylistContextType.MANIFEST:i=u.manifestLoadingMaxRetry,e=u.manifestLoadingTimeOut,s=u.manifestLoadingRetryDelay,l=u.manifestLoadingMaxRetryTimeout;break;case o.PlaylistContextType.LEVEL:case o.PlaylistContextType.AUDIO_TRACK:case o.PlaylistContextType.SUBTITLE_TRACK:i=0,e=u.levelLoadingTimeOut;break;default:i=u.levelLoadingMaxRetry,e=u.levelLoadingTimeOut,s=u.levelLoadingRetryDelay,l=u.levelLoadingMaxRetryTimeout}if(p=this.createInternalLoader(d),(t=d.deliveryDirectives)!==null&&t!==void 0&&t.part&&(d.type===o.PlaylistContextType.LEVEL&&d.level!==null?n=this.hls.levels[d.level].details:d.type===o.PlaylistContextType.AUDIO_TRACK&&d.id!==null?n=this.hls.audioTracks[d.id].details:d.type===o.PlaylistContextType.SUBTITLE_TRACK&&d.id!==null&&(n=this.hls.subtitleTracks[d.id].details),n)){var g=n.partTarget,r=n.targetduration;g&&r&&(e=Math.min(1e3*Math.max(3*g,.8*r),e))}var a={timeout:e,maxRetry:i,retryDelay:s,maxRetryDelay:l,highWaterMark:0},c={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};p.load(d,a,c)},y.loadsuccess=function(d,t,i,e){if(e===void 0&&(e=null),i.isSidxRequest)return this.handleSidxRequest(d,i),void this.handlePlaylistLoaded(d,t,i,e);this.resetInternalLoader(i.type);var s=d.data;s.indexOf("#EXTM3U")===0?(t.parsing.start=performance.now(),s.indexOf("#EXTINF:")>0||s.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(d,t,i,e):this.handleMasterPlaylist(d,t,i,e)):this.handleManifestParsingError(d,i,"no EXTM3U delimiter",e)},y.loaderror=function(d,t,i){i===void 0&&(i=null),this.handleNetworkError(t,i,!1,d)},y.loadtimeout=function(d,t,i){i===void 0&&(i=null),this.handleNetworkError(t,i,!0)},y.handleMasterPlaylist=function(d,t,i,e){var s=this.hls,l=d.data,n=m(d,i),u=D.default.parseMasterPlaylist(l,n),p=u.levels,v=u.sessionData;if(p.length){var g=p.map(function(A){return{id:A.attrs.AUDIO,audioCodec:A.audioCodec}}),r=p.map(function(A){return{id:A.attrs.SUBTITLES,textCodec:A.textCodec}}),a=D.default.parseMasterPlaylistMedia(l,n,"AUDIO",g),c=D.default.parseMasterPlaylistMedia(l,n,"SUBTITLES",r),b=D.default.parseMasterPlaylistMedia(l,n,"CLOSED-CAPTIONS");a.length&&(a.some(function(A){return!A.url})||!p[0].audioCodec||p[0].attrs.AUDIO||(k.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),a.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new S.AttrList({}),bitrate:0,url:""}))),s.trigger(E.Events.MANIFEST_LOADED,{levels:p,audioTracks:a,subtitles:c,captions:b,url:n,stats:t,networkDetails:e,sessionData:v})}else this.handleManifestParsingError(d,i,"no level found in manifest",e)},y.handleTrackOrLevelPlaylist=function(d,t,i,e){var s=this.hls,l=i.id,n=i.level,u=i.type,p=m(d,i),v=Object(R.isFiniteNumber)(l)?l:0,g=Object(R.isFiniteNumber)(n)?n:v,r=function(I){switch(I.type){case o.PlaylistContextType.AUDIO_TRACK:return o.PlaylistLevelType.AUDIO;case o.PlaylistContextType.SUBTITLE_TRACK:return o.PlaylistLevelType.SUBTITLE;default:return o.PlaylistLevelType.MAIN}}(i),a=D.default.parseLevelPlaylist(d.data,p,g,r,v);if(a.fragments.length){if(u===o.PlaylistContextType.MANIFEST){var c={attrs:new S.AttrList({}),bitrate:0,details:a,name:"",url:p};s.trigger(E.Events.MANIFEST_LOADED,{levels:[c],audioTracks:[],url:p,stats:t,networkDetails:e,sessionData:null})}if(t.parsing.end=performance.now(),a.needSidxRanges){var b,A=(b=a.fragments[0].initSegment)===null||b===void 0?void 0:b.url;this.load({url:A,isSidxRequest:!0,type:u,level:n,levelDetails:a,id:l,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null})}else i.levelDetails=a,this.handlePlaylistLoaded(d,t,i,e)}else s.trigger(E.Events.ERROR,{type:L.ErrorTypes.NETWORK_ERROR,details:L.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:p,reason:"no fragments found in level",level:typeof i.level=="number"?i.level:void 0})},y.handleSidxRequest=function(d,t){var i=Object(_.parseSegmentIndex)(new Uint8Array(d.data));if(i){var e=i.references,s=t.levelDetails;e.forEach(function(l,n){var u=l.info,p=s.fragments[n];p.byteRange.length===0&&p.setByteRange(String(1+u.end-u.start)+"@"+String(u.start)),p.initSegment&&p.initSegment.setByteRange(String(i.moovEndOffset)+"@0")})}},y.handleManifestParsingError=function(d,t,i,e){this.hls.trigger(E.Events.ERROR,{type:L.ErrorTypes.NETWORK_ERROR,details:L.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:t.type===o.PlaylistContextType.MANIFEST,url:d.url,reason:i,response:d,context:t,networkDetails:e})},y.handleNetworkError=function(d,t,i,e){i===void 0&&(i=!1),k.logger.warn("[playlist-loader]: A network "+(i?"timeout":"error")+" occurred while loading "+d.type+" level: "+d.level+" id: "+d.id+' group-id: "'+d.groupId+'"');var s=L.ErrorDetails.UNKNOWN,l=!1,n=this.getInternalLoader(d);switch(d.type){case o.PlaylistContextType.MANIFEST:s=i?L.ErrorDetails.MANIFEST_LOAD_TIMEOUT:L.ErrorDetails.MANIFEST_LOAD_ERROR,l=!0;break;case o.PlaylistContextType.LEVEL:s=i?L.ErrorDetails.LEVEL_LOAD_TIMEOUT:L.ErrorDetails.LEVEL_LOAD_ERROR,l=!1;break;case o.PlaylistContextType.AUDIO_TRACK:s=i?L.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:L.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,l=!1;break;case o.PlaylistContextType.SUBTITLE_TRACK:s=i?L.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:L.ErrorDetails.SUBTITLE_LOAD_ERROR,l=!1}n&&this.resetInternalLoader(d.type);var u={type:L.ErrorTypes.NETWORK_ERROR,details:s,fatal:l,url:d.url,loader:n,context:d,networkDetails:t};e&&(u.response=e),this.hls.trigger(E.Events.ERROR,u)},y.handlePlaylistLoaded=function(d,t,i,e){var s=i.type,l=i.level,n=i.id,u=i.groupId,p=i.loader,v=i.levelDetails,g=i.deliveryDirectives;if(v!=null&&v.targetduration){if(p)switch(v.live&&(p.getCacheAge&&(v.ageHeader=p.getCacheAge()||0),p.getCacheAge&&!isNaN(v.ageHeader)||(v.ageHeader=0)),s){case o.PlaylistContextType.MANIFEST:case o.PlaylistContextType.LEVEL:this.hls.trigger(E.Events.LEVEL_LOADED,{details:v,level:l||0,id:n||0,stats:t,networkDetails:e,deliveryDirectives:g});break;case o.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(E.Events.AUDIO_TRACK_LOADED,{details:v,id:n||0,groupId:u||"",stats:t,networkDetails:e,deliveryDirectives:g});break;case o.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(E.Events.SUBTITLE_TRACK_LOADED,{details:v,id:n||0,groupId:u||"",stats:t,networkDetails:e,deliveryDirectives:g})}}else this.handleManifestParsingError(d,i,"invalid target duration",e)},T}();C.default=h},"./src/polyfills/number.ts":function(P,C,f){f.r(C),f.d(C,"isFiniteNumber",function(){return R}),f.d(C,"MAX_SAFE_INTEGER",function(){return E});var R=Number.isFinite||function(L){return typeof L=="number"&&isFinite(L)},E=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(P,C,f){f.r(C);var R=function(){function E(){}return E.getSilentFrame=function(L,k){switch(L){case"mp4a.40.2":if(k===1)return new Uint8Array([0,200,0,128,35,128]);if(k===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(k===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(k===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(k===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(k===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(k===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(k===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(k===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},E}();C.default=R},"./src/remux/mp4-generator.ts":function(P,C,f){f.r(C);var R=Math.pow(2,32)-1,E=function(){function L(){}return L.init=function(){var k;for(k in L.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},L.types)L.types.hasOwnProperty(k)&&(L.types[k]=[k.charCodeAt(0),k.charCodeAt(1),k.charCodeAt(2),k.charCodeAt(3)]);var _=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),D=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);L.HDLR_TYPES={video:_,audio:D};var o=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),S=new Uint8Array([0,0,0,0,0,0,0,0]);L.STTS=L.STSC=L.STCO=S,L.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),L.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),L.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),L.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var m=new Uint8Array([105,115,111,109]),h=new Uint8Array([97,118,99,49]),T=new Uint8Array([0,0,0,1]);L.FTYP=L.box(L.types.ftyp,m,T,m,h),L.DINF=L.box(L.types.dinf,L.box(L.types.dref,o))},L.box=function(k){for(var _=8,D=arguments.length,o=new Array(D>1?D-1:0),S=1;S<D;S++)o[S-1]=arguments[S];for(var m=o.length,h=m;m--;)_+=o[m].byteLength;var T=new Uint8Array(_);for(T[0]=_>>24&255,T[1]=_>>16&255,T[2]=_>>8&255,T[3]=255&_,T.set(k,4),m=0,_=8;m<h;m++)T.set(o[m],_),_+=o[m].byteLength;return T},L.hdlr=function(k){return L.box(L.types.hdlr,L.HDLR_TYPES[k])},L.mdat=function(k){return L.box(L.types.mdat,k)},L.mdhd=function(k,_){_*=k;var D=Math.floor(_/(R+1)),o=Math.floor(_%(R+1));return L.box(L.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,k>>24&255,k>>16&255,k>>8&255,255&k,D>>24,D>>16&255,D>>8&255,255&D,o>>24,o>>16&255,o>>8&255,255&o,85,196,0,0]))},L.mdia=function(k){return L.box(L.types.mdia,L.mdhd(k.timescale,k.duration),L.hdlr(k.type),L.minf(k))},L.mfhd=function(k){return L.box(L.types.mfhd,new Uint8Array([0,0,0,0,k>>24,k>>16&255,k>>8&255,255&k]))},L.minf=function(k){return k.type==="audio"?L.box(L.types.minf,L.box(L.types.smhd,L.SMHD),L.DINF,L.stbl(k)):L.box(L.types.minf,L.box(L.types.vmhd,L.VMHD),L.DINF,L.stbl(k))},L.moof=function(k,_,D){return L.box(L.types.moof,L.mfhd(k),L.traf(D,_))},L.moov=function(k){for(var _=k.length,D=[];_--;)D[_]=L.trak(k[_]);return L.box.apply(null,[L.types.moov,L.mvhd(k[0].timescale,k[0].duration)].concat(D).concat(L.mvex(k)))},L.mvex=function(k){for(var _=k.length,D=[];_--;)D[_]=L.trex(k[_]);return L.box.apply(null,[L.types.mvex].concat(D))},L.mvhd=function(k,_){_*=k;var D=Math.floor(_/(R+1)),o=Math.floor(_%(R+1)),S=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,k>>24&255,k>>16&255,k>>8&255,255&k,D>>24,D>>16&255,D>>8&255,255&D,o>>24,o>>16&255,o>>8&255,255&o,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return L.box(L.types.mvhd,S)},L.sdtp=function(k){var _,D,o=k.samples||[],S=new Uint8Array(4+o.length);for(_=0;_<o.length;_++)D=o[_].flags,S[_+4]=D.dependsOn<<4|D.isDependedOn<<2|D.hasRedundancy;return L.box(L.types.sdtp,S)},L.stbl=function(k){return L.box(L.types.stbl,L.stsd(k),L.box(L.types.stts,L.STTS),L.box(L.types.stsc,L.STSC),L.box(L.types.stsz,L.STSZ),L.box(L.types.stco,L.STCO))},L.avc1=function(k){var _,D,o,S=[],m=[];for(_=0;_<k.sps.length;_++)o=(D=k.sps[_]).byteLength,S.push(o>>>8&255),S.push(255&o),S=S.concat(Array.prototype.slice.call(D));for(_=0;_<k.pps.length;_++)o=(D=k.pps[_]).byteLength,m.push(o>>>8&255),m.push(255&o),m=m.concat(Array.prototype.slice.call(D));var h=L.box(L.types.avcC,new Uint8Array([1,S[3],S[4],S[5],255,224|k.sps.length].concat(S).concat([k.pps.length]).concat(m))),T=k.width,y=k.height,d=k.pixelRatio[0],t=k.pixelRatio[1];return L.box(L.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,T>>8&255,255&T,y>>8&255,255&y,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),h,L.box(L.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),L.box(L.types.pasp,new Uint8Array([d>>24,d>>16&255,d>>8&255,255&d,t>>24,t>>16&255,t>>8&255,255&t])))},L.esds=function(k){var _=k.config.length;return new Uint8Array([0,0,0,0,3,23+_,0,1,0,4,15+_,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([_]).concat(k.config).concat([6,1,2]))},L.mp4a=function(k){var _=k.samplerate;return L.box(L.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,k.channelCount,0,16,0,0,0,0,_>>8&255,255&_,0,0]),L.box(L.types.esds,L.esds(k)))},L.mp3=function(k){var _=k.samplerate;return L.box(L.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,k.channelCount,0,16,0,0,0,0,_>>8&255,255&_,0,0]))},L.stsd=function(k){return k.type==="audio"?k.isAAC||k.codec!=="mp3"?L.box(L.types.stsd,L.STSD,L.mp4a(k)):L.box(L.types.stsd,L.STSD,L.mp3(k)):L.box(L.types.stsd,L.STSD,L.avc1(k))},L.tkhd=function(k){var _=k.id,D=k.duration*k.timescale,o=k.width,S=k.height,m=Math.floor(D/(R+1)),h=Math.floor(D%(R+1));return L.box(L.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,_>>24&255,_>>16&255,_>>8&255,255&_,0,0,0,0,m>>24,m>>16&255,m>>8&255,255&m,h>>24,h>>16&255,h>>8&255,255&h,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,o>>8&255,255&o,0,0,S>>8&255,255&S,0,0]))},L.traf=function(k,_){var D=L.sdtp(k),o=k.id,S=Math.floor(_/(R+1)),m=Math.floor(_%(R+1));return L.box(L.types.traf,L.box(L.types.tfhd,new Uint8Array([0,0,0,0,o>>24,o>>16&255,o>>8&255,255&o])),L.box(L.types.tfdt,new Uint8Array([1,0,0,0,S>>24,S>>16&255,S>>8&255,255&S,m>>24,m>>16&255,m>>8&255,255&m])),L.trun(k,D.length+16+20+8+16+8+8),D)},L.trak=function(k){return k.duration=k.duration||4294967295,L.box(L.types.trak,L.tkhd(k),L.mdia(k))},L.trex=function(k){var _=k.id;return L.box(L.types.trex,new Uint8Array([0,0,0,0,_>>24,_>>16&255,_>>8&255,255&_,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},L.trun=function(k,_){var D,o,S,m,h,T,y=k.samples||[],d=y.length,t=12+16*d,i=new Uint8Array(t);for(_+=8+t,i.set([0,0,15,1,d>>>24&255,d>>>16&255,d>>>8&255,255&d,_>>>24&255,_>>>16&255,_>>>8&255,255&_],0),D=0;D<d;D++)S=(o=y[D]).duration,m=o.size,h=o.flags,T=o.cts,i.set([S>>>24&255,S>>>16&255,S>>>8&255,255&S,m>>>24&255,m>>>16&255,m>>>8&255,255&m,h.isLeading<<2|h.dependsOn,h.isDependedOn<<6|h.hasRedundancy<<4|h.paddingValue<<1|h.isNonSync,61440&h.degradPrio,15&h.degradPrio,T>>>24&255,T>>>16&255,T>>>8&255,255&T],12+16*D);return L.box(L.types.trun,i)},L.initSegment=function(k){L.types||L.init();var _=L.moov(k),D=new Uint8Array(L.FTYP.byteLength+_.byteLength);return D.set(L.FTYP),D.set(_,L.FTYP.byteLength),D},L}();E.types=void 0,E.HDLR_TYPES=void 0,E.STTS=void 0,E.STSC=void 0,E.STCO=void 0,E.STSZ=void 0,E.VMHD=void 0,E.SMHD=void 0,E.STSD=void 0,E.FTYP=void 0,E.DINF=void 0,C.default=E},"./src/remux/mp4-remuxer.ts":function(P,C,f){f.r(C),f.d(C,"default",function(){return d}),f.d(C,"normalizePts",function(){return t});var R=f("./src/polyfills/number.ts"),E=f("./src/remux/aac-helper.ts"),L=f("./src/remux/mp4-generator.ts"),k=f("./src/events.ts"),_=f("./src/errors.ts"),D=f("./src/utils/logger.ts"),o=f("./src/types/loader.ts"),S=f("./src/utils/timescale-conversion.ts");function m(){return(m=Object.assign||function(s){for(var l=1;l<arguments.length;l++){var n=arguments[l];for(var u in n)Object.prototype.hasOwnProperty.call(n,u)&&(s[u]=n[u])}return s}).apply(this,arguments)}var h=null,T=null,y=!1,d=function(){function s(n,u,p,v){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=n,this.config=u,this.typeSupported=p,this.ISGenerated=!1,h===null){var g=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);h=g?parseInt(g[1]):0}if(T===null){var r=navigator.userAgent.match(/Safari\/(\d+)/i);T=r?parseInt(r[1]):0}y=!!h&&h<75||!!T&&T<600}var l=s.prototype;return l.destroy=function(){},l.resetTimeStamp=function(n){D.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=n},l.resetNextTimestamp=function(){D.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},l.resetInitSegment=function(){D.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},l.getVideoStartPts=function(n){var u=!1,p=n.reduce(function(v,g){var r=g.pts-v;return r<-4294967296?(u=!0,t(v,g.pts)):r>0?v:g.pts},n[0].pts);return u&&D.logger.debug("PTS rollover detected"),p},l.remux=function(n,u,p,v,g,r,a,c){var b,A,I,x,w,O,F=g,M=g,N=n.pid>-1,B=u.pid>-1,U=u.samples.length,G=n.samples.length>0,H=U>1;if((!N||G)&&(!B||H)||this.ISGenerated||a){this.ISGenerated||(I=this.generateIS(n,u,g));var z=this.isVideoContiguous,Y=-1;if(H&&(Y=function(ue){for(var Z=0;Z<ue.length;Z++)if(ue[Z].key)return Z;return-1}(u.samples),!z&&this.config.forceKeyFrameOnDiscontinuity))if(O=!0,Y>0){D.logger.warn("[mp4-remuxer]: Dropped "+Y+" out of "+U+" video samples due to a missing keyframe");var W=this.getVideoStartPts(u.samples);u.samples=u.samples.slice(Y),u.dropped+=Y,M+=(u.samples[0].pts-W)/(u.timescale||9e4)}else Y===-1&&(D.logger.warn("[mp4-remuxer]: No keyframe found out of "+U+" video samples"),O=!1);if(this.ISGenerated){if(G&&H){var $=this.getVideoStartPts(u.samples),ie=(t(n.samples[0].pts,$)-$)/u.inputTimeScale;F+=Math.max(0,ie),M+=Math.max(0,-ie)}if(G){if(n.samplerate||(D.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),I=this.generateIS(n,u,g)),A=this.remuxAudio(n,F,this.isAudioContiguous,r,B||H||c===o.PlaylistLevelType.AUDIO?M:void 0),H){var ae=A?A.endPTS-A.startPTS:0;u.inputTimeScale||(D.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),I=this.generateIS(n,u,g)),b=this.remuxVideo(u,M,z,ae)}}else H&&(b=this.remuxVideo(u,M,z,0));b&&(b.firstKeyFrame=Y,b.independent=Y!==-1)}}return this.ISGenerated&&(p.samples.length&&(w=this.remuxID3(p,g)),v.samples.length&&(x=this.remuxText(v,g))),{audio:A,video:b,initSegment:I,independent:O,text:x,id3:w}},l.generateIS=function(n,u,p){var v,g,r,a=n.samples,c=u.samples,b=this.typeSupported,A={},I=!Object(R.isFiniteNumber)(this._initPTS),x="audio/mp4";if(I&&(v=g=1/0),n.config&&a.length&&(n.timescale=n.samplerate,n.isAAC||(b.mpeg?(x="audio/mpeg",n.codec=""):b.mp3&&(n.codec="mp3")),A.audio={id:"audio",container:x,codec:n.codec,initSegment:!n.isAAC&&b.mpeg?new Uint8Array(0):L.default.initSegment([n]),metadata:{channelCount:n.channelCount}},I&&(r=n.inputTimeScale,v=g=a[0].pts-Math.round(r*p))),u.sps&&u.pps&&c.length&&(u.timescale=u.inputTimeScale,A.video={id:"main",container:"video/mp4",codec:u.codec,initSegment:L.default.initSegment([u]),metadata:{width:u.width,height:u.height}},I)){r=u.inputTimeScale;var w=this.getVideoStartPts(c),O=Math.round(r*p);g=Math.min(g,t(c[0].dts,w)-O),v=Math.min(v,w-O)}if(Object.keys(A).length)return this.ISGenerated=!0,I&&(this._initPTS=v,this._initDTS=g),{tracks:A,initPTS:v,timescale:r}},l.remuxVideo=function(n,u,p,v){var g,r,a,c=n.inputTimeScale,b=n.samples,A=[],I=b.length,x=this._initPTS,w=this.nextAvcDts,O=8,F=Number.POSITIVE_INFINITY,M=Number.NEGATIVE_INFINITY,N=0,B=!1;p&&w!==null||(w=u*c-(b[0].pts-t(b[0].dts,b[0].pts)));for(var U=0;U<I;U++){var G=b[U];G.pts=t(G.pts-x,w),G.dts=t(G.dts-x,w),G.dts>G.pts&&(N=Math.max(Math.min(N,G.pts-G.dts),-18e3)),G.dts<b[U>0?U-1:U].dts&&(B=!0)}B&&b.sort(function(De,Ke){var tr=De.dts-Ke.dts,rr=De.pts-Ke.pts;return tr||rr}),r=b[0].dts,a=b[b.length-1].dts;var H=Math.round((a-r)/(I-1));if(N<0){if(N<-2*H){D.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(S.toMsFromMpegTsClock)(-H,!0)+" ms");for(var z=N,Y=0;Y<I;Y++)b[Y].dts=z=Math.max(z,b[Y].pts-H),b[Y].pts=Math.max(z,b[Y].pts)}else{D.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(S.toMsFromMpegTsClock)(N,!0)+" ms to overcome this issue");for(var W=0;W<I;W++)b[W].dts=b[W].dts+N}r=b[0].dts}if(p){var $=r-w,ie=$>H;if(ie||$<-1){ie?D.logger.warn("AVC: "+Object(S.toMsFromMpegTsClock)($,!0)+" ms ("+$+"dts) hole between fragments detected, filling it"):D.logger.warn("AVC: "+Object(S.toMsFromMpegTsClock)(-$,!0)+" ms ("+$+"dts) overlapping between fragments detected"),r=w;var ae=b[0].pts-$;b[0].dts=r,b[0].pts=ae,D.logger.log("Video: First PTS/DTS adjusted: "+Object(S.toMsFromMpegTsClock)(ae,!0)+"/"+Object(S.toMsFromMpegTsClock)(r,!0)+", delta: "+Object(S.toMsFromMpegTsClock)($,!0)+" ms")}}y&&(r=Math.max(0,r));for(var ue=0,Z=0,se=0;se<I;se++){for(var te=b[se],ne=te.units,fe=ne.length,he=0,pe=0;pe<fe;pe++)he+=ne[pe].data.length;Z+=he,ue+=fe,te.length=he,te.dts=Math.max(te.dts,r),te.pts=Math.max(te.pts,te.dts,0),F=Math.min(te.pts,F),M=Math.max(te.pts,M)}a=b[I-1].dts;var ve,Se=Z+4*ue+8;try{ve=new Uint8Array(Se)}catch{return void this.observer.emit(k.Events.ERROR,k.Events.ERROR,{type:_.ErrorTypes.MUX_ERROR,details:_.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:Se,reason:"fail allocating video mdat "+Se})}var be=new DataView(ve.buffer);be.setUint32(0,Se),ve.set(L.default.types.mdat,4);for(var j=0;j<I;j++){for(var Q=b[j],ge=Q.units,Te=0,Ie=0,$e=ge.length;Ie<$e;Ie++){var Ue=ge[Ie],Ce=Ue.data,et=Ue.data.byteLength;be.setUint32(O,et),O+=4,ve.set(Ce,O),O+=et,Te+=4+et}if(j<I-1)g=b[j+1].dts-Q.dts;else{var Qe=this.config,we=Q.dts-b[j>0?j-1:j].dts;if(Qe.stretchShortVideoTrack&&this.nextAudioPts!==null){var tt=Math.floor(Qe.maxBufferHole*c),Ze=(v?F+v*c:this.nextAudioPts)-Q.pts;Ze>tt?((g=Ze-we)<0&&(g=we),D.logger.log("[mp4-remuxer]: It is approximately "+Ze/90+" ms to the next segment; using duration "+g/90+" ms for the last video frame.")):g=we}else g=we}var Ge=Math.round(Q.pts-Q.dts);A.push(new i(Q.key,g,Te,Ge))}if(A.length&&h&&h<70){var Fe=A[0].flags;Fe.dependsOn=2,Fe.isNonSync=0}console.assert(g!==void 0,"mp4SampleDuration must be computed"),this.nextAvcDts=w=a+g,this.isVideoContiguous=!0;var je={data1:L.default.moof(n.sequenceNumber++,r,m({},n,{samples:A})),data2:ve,startPTS:F/c,endPTS:(M+g)/c,startDTS:r/c,endDTS:w/c,type:"video",hasAudio:!1,hasVideo:!0,nb:A.length,dropped:n.dropped};return n.samples=[],n.dropped=0,console.assert(ve.length,"MDAT length must not be zero"),je},l.remuxAudio=function(n,u,p,v,g){var r=n.inputTimeScale,a=r/(n.samplerate?n.samplerate:r),c=n.isAAC?1024:1152,b=c*a,A=this._initPTS,I=!n.isAAC&&this.typeSupported.mpeg,x=[],w=n.samples,O=I?0:8,F=this.nextAudioPts||-1,M=u*r;if(this.isAudioContiguous=p=p||w.length&&F>0&&(v&&Math.abs(M-F)<9e3||Math.abs(t(w[0].pts-A,M)-F)<20*b),w.forEach(function(Ce){Ce.pts=t(Ce.pts-A,M)}),!p||F<0){if(!(w=w.filter(function(Ce){return Ce.pts>=0})).length)return;F=g===0?0:v?Math.max(0,M):w[0].pts}if(n.isAAC)for(var N=g!==void 0,B=this.config.maxAudioFramesDrift,U=0,G=F;U<w.length;U++){var H=w[U],z=H.pts,Y=z-G,W=Math.abs(1e3*Y/r);if(Y<=-B*b&&N)U===0&&(D.logger.warn("Audio frame @ "+(z/r).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*Y/r)+" ms."),this.nextAudioPts=F=G=z);else if(Y>=B*b&&W<1e4&&N){var $=Math.round(Y/b);(G=z-$*b)<0&&($--,G+=b),U===0&&(this.nextAudioPts=F=G),D.logger.warn("[mp4-remuxer]: Injecting "+$+" audio frame @ "+(G/r).toFixed(3)+"s due to "+Math.round(1e3*Y/r)+" ms gap.");for(var ie=0;ie<$;ie++){var ae=Math.max(G,0),ue=E.default.getSilentFrame(n.manifestCodec||n.codec,n.channelCount);ue||(D.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),ue=H.unit.subarray()),w.splice(U,0,{unit:ue,pts:ae}),G+=b,U++}}H.pts=G,G+=b}for(var Z,se=null,te=null,ne=0,fe=w.length;fe--;)ne+=w[fe].unit.byteLength;for(var he=0,pe=w.length;he<pe;he++){var ve=w[he],Se=ve.unit,be=ve.pts;if(te!==null)x[he-1].duration=Math.round((be-te)/a);else{if(p&&n.isAAC&&(be=F),se=be,!(ne>0))return;ne+=O;try{Z=new Uint8Array(ne)}catch{return void this.observer.emit(k.Events.ERROR,k.Events.ERROR,{type:_.ErrorTypes.MUX_ERROR,details:_.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:ne,reason:"fail allocating audio mdat "+ne})}I||(new DataView(Z.buffer).setUint32(0,ne),Z.set(L.default.types.mdat,4))}Z.set(Se,O);var j=Se.byteLength;O+=j,x.push(new i(!0,c,j,0)),te=be}var Q=x.length;if(Q){var ge=x[x.length-1];this.nextAudioPts=F=te+a*ge.duration;var Te=I?new Uint8Array(0):L.default.moof(n.sequenceNumber++,se/a,m({},n,{samples:x}));n.samples=[];var Ie=se/r,$e=F/r,Ue={data1:Te,data2:Z,startPTS:Ie,endPTS:$e,startDTS:Ie,endDTS:$e,type:"audio",hasAudio:!0,hasVideo:!1,nb:Q};return this.isAudioContiguous=!0,console.assert(Z.length,"MDAT length must not be zero"),Ue}},l.remuxEmptyAudio=function(n,u,p,v){var g=n.inputTimeScale,r=g/(n.samplerate?n.samplerate:g),a=this.nextAudioPts,c=(a!==null?a:v.startDTS*g)+this._initDTS,b=v.endDTS*g+this._initDTS,A=1024*r,I=Math.ceil((b-c)/A),x=E.default.getSilentFrame(n.manifestCodec||n.codec,n.channelCount);if(D.logger.warn("[mp4-remuxer]: remux empty Audio"),x){for(var w=[],O=0;O<I;O++){var F=c+O*A;w.push({unit:x,pts:F,dts:F})}return n.samples=w,this.remuxAudio(n,u,p,!1)}D.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},l.remuxID3=function(n,u){var p=n.samples.length;if(p){for(var v=n.inputTimeScale,g=this._initPTS,r=this._initDTS,a=0;a<p;a++){var c=n.samples[a];c.pts=t(c.pts-g,u*v)/v,c.dts=t(c.dts-r,u*v)/v}var b=n.samples;return n.samples=[],{samples:b}}},l.remuxText=function(n,u){var p=n.samples.length;if(p){for(var v=n.inputTimeScale,g=this._initPTS,r=0;r<p;r++){var a=n.samples[r];a.pts=t(a.pts-g,u*v)/v}n.samples.sort(function(b,A){return b.pts-A.pts});var c=n.samples;return n.samples=[],{samples:c}}},s}();function t(s,l){var n;if(l===null)return s;for(n=l<s?-8589934592:8589934592;Math.abs(s-l)>4294967296;)s+=n;return s}var i=function(s,l,n,u){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=l,this.size=n,this.cts=u,this.flags=new e(s)},e=function(s){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=s?2:1,this.isNonSync=s?0:1}},"./src/remux/passthrough-remuxer.ts":function(P,C,f){f.r(C);var R=f("./src/polyfills/number.ts"),E=f("./src/utils/mp4-tools.ts"),L=f("./src/loader/fragment.ts"),k=f("./src/utils/logger.ts"),_=function(){function S(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var m=S.prototype;return m.destroy=function(){},m.resetTimeStamp=function(h){this.initPTS=h,this.lastEndDTS=null},m.resetNextTimestamp=function(){this.lastEndDTS=null},m.resetInitSegment=function(h,T,y){this.audioCodec=T,this.videoCodec=y,this.generateInitSegment(h),this.emitInitSegment=!0},m.generateInitSegment=function(h){var T=this.audioCodec,y=this.videoCodec;if(!h||!h.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var d=this.initData=Object(E.parseInitSegment)(h);T||(T=o(d.audio,L.ElementaryStreamTypes.AUDIO)),y||(y=o(d.video,L.ElementaryStreamTypes.VIDEO));var t={};d.audio&&d.video?t.audiovideo={container:"video/mp4",codec:T+","+y,initSegment:h,id:"main"}:d.audio?t.audio={container:"audio/mp4",codec:T,initSegment:h,id:"audio"}:d.video?t.video={container:"video/mp4",codec:y,initSegment:h,id:"main"}:k.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=t},m.remux=function(h,T,y,d,t){var i=this.initPTS,e=this.lastEndDTS,s={audio:void 0,video:void 0,text:d,id3:y,initSegment:void 0};Object(R.isFiniteNumber)(e)||(e=this.lastEndDTS=t||0);var l=T.samples;if(!l||!l.length)return s;var n={initPTS:void 0,timescale:1},u=this.initData;if(u&&u.length||(this.generateInitSegment(l),u=this.initData),!u||!u.length)return k.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),s;this.emitInitSegment&&(n.tracks=this.initTracks,this.emitInitSegment=!1),Object(R.isFiniteNumber)(i)||(this.initPTS=n.initPTS=i=D(u,l,e));var p=Object(E.getDuration)(l,u),v=e,g=p+v;Object(E.offsetStartDTS)(u,l,i),p>0?this.lastEndDTS=g:(k.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var r=!!u.audio,a=!!u.video,c="";r&&(c+="audio"),a&&(c+="video");var b={data1:l,startPTS:v,startDTS:v,endPTS:g,endDTS:g,type:c,hasAudio:r,hasVideo:a,nb:1,dropped:0};return s.audio=b.type==="audio"?b:void 0,s.video=b.type!=="audio"?b:void 0,s.text=d,s.id3=y,s.initSegment=n,s},S}(),D=function(S,m,h){return Object(E.getStartDTS)(S,m)-h};function o(S,m){var h=S==null?void 0:S.codec;return h&&h.length>4?h:h==="hvc1"?"hvc1.1.c.L120.90":h==="av01"?"av01.0.04M.08":h==="avc1"||m===L.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}C.default=_},"./src/task-loop.ts":function(P,C,f){f.r(C),f.d(C,"default",function(){return R});var R=function(){function E(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var L=E.prototype;return L.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},L.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},L.onHandlerDestroyed=function(){},L.hasInterval=function(){return!!this._tickInterval},L.hasNextTick=function(){return!!this._tickTimer},L.setInterval=function(k){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,k),!0)},L.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},L.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},L.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},L.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},L.doTick=function(){},E}()},"./src/types/level.ts":function(P,C,f){function R(o,S){for(var m=0;m<S.length;m++){var h=S[m];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(o,h.key,h)}}var E,L;function k(o,S){var m=o.canSkipUntil,h=o.canSkipDateRanges,T=o.endSN;return m&&(S!==void 0?S-T:0)<m?h?E.v2:E.Yes:E.No}f.r(C),f.d(C,"HlsSkip",function(){return E}),f.d(C,"getSkipValue",function(){return k}),f.d(C,"HlsUrlParameters",function(){return _}),f.d(C,"Level",function(){return D}),(L=E||(E={})).No="",L.Yes="YES",L.v2="v2";var _=function(){function o(S,m,h){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=S,this.part=m,this.skip=h}return o.prototype.addDirectives=function(S){var m=new self.URL(S);return this.msn!==void 0&&m.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&m.searchParams.set("_HLS_part",this.part.toString()),this.skip&&m.searchParams.set("_HLS_skip",this.skip),m.toString()},o}(),D=function(){function o(h){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[h.url],this.attrs=h.attrs,this.bitrate=h.bitrate,h.details&&(this.details=h.details),this.id=h.id||0,this.name=h.name,this.width=h.width||0,this.height=h.height||0,this.audioCodec=h.audioCodec,this.videoCodec=h.videoCodec,this.unknownCodecs=h.unknownCodecs,this.codecSet=[h.videoCodec,h.audioCodec].filter(function(T){return T}).join(",").replace(/\.[^.,]+/g,"")}var S,m;return S=o,(m=[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(h){var T=h%this.url.length;this._urlId!==T&&(this.details=void 0,this._urlId=T)}}])&&R(S.prototype,m),o}()},"./src/types/loader.ts":function(P,C,f){var R,E,L,k;f.r(C),f.d(C,"PlaylistContextType",function(){return R}),f.d(C,"PlaylistLevelType",function(){return L}),(E=R||(R={})).MANIFEST="manifest",E.LEVEL="level",E.AUDIO_TRACK="audioTrack",E.SUBTITLE_TRACK="subtitleTrack",(k=L||(L={})).MAIN="main",k.AUDIO="audio",k.SUBTITLE="subtitle"},"./src/types/transmuxer.ts":function(P,C,f){f.r(C),f.d(C,"ChunkMetadata",function(){return R});var R=function(E,L,k,_,D,o){_===void 0&&(_=0),D===void 0&&(D=-1),o===void 0&&(o=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=E,this.sn=L,this.id=k,this.size=_,this.part=D,this.partial=o}},"./src/utils/attr-list.ts":function(P,C,f){f.r(C),f.d(C,"AttrList",function(){return L});var R=/^(\d+)x(\d+)$/,E=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,L=function(){function k(D){for(var o in typeof D=="string"&&(D=k.parseAttrList(D)),D)D.hasOwnProperty(o)&&(this[o]=D[o])}var _=k.prototype;return _.decimalInteger=function(D){var o=parseInt(this[D],10);return o>Number.MAX_SAFE_INTEGER?1/0:o},_.hexadecimalInteger=function(D){if(this[D]){var o=(this[D]||"0x").slice(2);o=(1&o.length?"0":"")+o;for(var S=new Uint8Array(o.length/2),m=0;m<o.length/2;m++)S[m]=parseInt(o.slice(2*m,2*m+2),16);return S}return null},_.hexadecimalIntegerAsNumber=function(D){var o=parseInt(this[D],16);return o>Number.MAX_SAFE_INTEGER?1/0:o},_.decimalFloatingPoint=function(D){return parseFloat(this[D])},_.optionalFloat=function(D,o){var S=this[D];return S?parseFloat(S):o},_.enumeratedString=function(D){return this[D]},_.bool=function(D){return this[D]==="YES"},_.decimalResolution=function(D){var o=R.exec(this[D]);if(o!==null)return{width:parseInt(o[1],10),height:parseInt(o[2],10)}},k.parseAttrList=function(D){var o,S={};for(E.lastIndex=0;(o=E.exec(D))!==null;){var m=o[2];m.indexOf('"')===0&&m.lastIndexOf('"')===m.length-1&&(m=m.slice(1,-1)),S[o[1]]=m}return S},k}()},"./src/utils/binary-search.ts":function(P,C,f){f.r(C),C.default={search:function(R,E){for(var L=0,k=R.length-1,_=null,D=null;L<=k;){var o=E(D=R[_=(L+k)/2|0]);if(o>0)L=_+1;else{if(!(o<0))return D;k=_-1}}return null}}},"./src/utils/buffer-helper.ts":function(P,C,f){f.r(C),f.d(C,"BufferHelper",function(){return L});var R=f("./src/utils/logger.ts"),E={length:0,start:function(){return 0},end:function(){return 0}},L=function(){function k(){}return k.isBuffered=function(_,D){try{if(_){for(var o=k.getBuffered(_),S=0;S<o.length;S++)if(D>=o.start(S)&&D<=o.end(S))return!0}}catch{}return!1},k.bufferInfo=function(_,D,o){try{if(_){var S,m=k.getBuffered(_),h=[];for(S=0;S<m.length;S++)h.push({start:m.start(S),end:m.end(S)});return this.bufferedInfo(h,D,o)}}catch{}return{len:0,start:D,end:D,nextStart:void 0}},k.bufferedInfo=function(_,D,o){D=Math.max(0,D),_.sort(function(n,u){var p=n.start-u.start;return p||u.end-n.end});var S=[];if(o)for(var m=0;m<_.length;m++){var h=S.length;if(h){var T=S[h-1].end;_[m].start-T<o?_[m].end>T&&(S[h-1].end=_[m].end):S.push(_[m])}else S.push(_[m])}else S=_;for(var y,d=0,t=D,i=D,e=0;e<S.length;e++){var s=S[e].start,l=S[e].end;if(D+o>=s&&D<l)t=s,d=(i=l)-D;else if(D+o<s){y=s;break}}return{len:d,start:t||0,end:i||0,nextStart:y}},k.getBuffered=function(_){try{return _.buffered}catch(D){return R.logger.log("failed to get media.buffered",D),E}},k}()},"./src/utils/cea-608-parser.ts":function(P,C,f){f.r(C),f.d(C,"Row",function(){return s}),f.d(C,"CaptionScreen",function(){return l});var R,E,L=f("./src/utils/logger.ts"),k={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},_=function(g){var r=g;return k.hasOwnProperty(g)&&(r=k[g]),String.fromCharCode(r)},D=15,o=100,S={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},m={17:2,18:4,21:6,22:8,23:10,19:13,20:15},h={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},T={25:2,26:4,29:6,30:8,31:10,27:13,28:15},y=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];(E=R||(R={}))[E.ERROR=0]="ERROR",E[E.TEXT=1]="TEXT",E[E.WARNING=2]="WARNING",E[E.INFO=2]="INFO",E[E.DEBUG=3]="DEBUG",E[E.DATA=3]="DATA";var d=function(){function g(){this.time=null,this.verboseLevel=R.ERROR}return g.prototype.log=function(r,a){this.verboseLevel>=r&&L.logger.log(this.time+" ["+r+"] "+a)},g}(),t=function(g){for(var r=[],a=0;a<g.length;a++)r.push(g[a].toString(16));return r},i=function(){function g(a,c,b,A,I){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=a||"white",this.underline=c||!1,this.italics=b||!1,this.background=A||"black",this.flash=I||!1}var r=g.prototype;return r.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},r.setStyles=function(a){for(var c=["foreground","underline","italics","background","flash"],b=0;b<c.length;b++){var A=c[b];a.hasOwnProperty(A)&&(this[A]=a[A])}},r.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},r.equals=function(a){return this.foreground===a.foreground&&this.underline===a.underline&&this.italics===a.italics&&this.background===a.background&&this.flash===a.flash},r.copy=function(a){this.foreground=a.foreground,this.underline=a.underline,this.italics=a.italics,this.background=a.background,this.flash=a.flash},r.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},g}(),e=function(){function g(a,c,b,A,I,x){this.uchar=void 0,this.penState=void 0,this.uchar=a||" ",this.penState=new i(c,b,A,I,x)}var r=g.prototype;return r.reset=function(){this.uchar=" ",this.penState.reset()},r.setChar=function(a,c){this.uchar=a,this.penState.copy(c)},r.setPenState=function(a){this.penState.copy(a)},r.equals=function(a){return this.uchar===a.uchar&&this.penState.equals(a.penState)},r.copy=function(a){this.uchar=a.uchar,this.penState.copy(a.penState)},r.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},g}(),s=function(){function g(a){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var c=0;c<o;c++)this.chars.push(new e);this.logger=a,this.pos=0,this.currPenState=new i}var r=g.prototype;return r.equals=function(a){for(var c=!0,b=0;b<o;b++)if(!this.chars[b].equals(a.chars[b])){c=!1;break}return c},r.copy=function(a){for(var c=0;c<o;c++)this.chars[c].copy(a.chars[c])},r.isEmpty=function(){for(var a=!0,c=0;c<o;c++)if(!this.chars[c].isEmpty()){a=!1;break}return a},r.setCursor=function(a){this.pos!==a&&(this.pos=a),this.pos<0?(this.logger.log(R.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>o&&(this.logger.log(R.DEBUG,"Too large cursor position "+this.pos),this.pos=o)},r.moveCursor=function(a){var c=this.pos+a;if(a>1)for(var b=this.pos+1;b<c+1;b++)this.chars[b].setPenState(this.currPenState);this.setCursor(c)},r.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},r.insertChar=function(a){a>=144&&this.backSpace();var c=_(a);this.pos>=o?this.logger.log(R.ERROR,"Cannot insert "+a.toString(16)+" ("+c+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(c,this.currPenState),this.moveCursor(1))},r.clearFromPos=function(a){var c;for(c=a;c<o;c++)this.chars[c].reset()},r.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},r.clearToEndOfRow=function(){this.clearFromPos(this.pos)},r.getTextString=function(){for(var a=[],c=!0,b=0;b<o;b++){var A=this.chars[b].uchar;A!==" "&&(c=!1),a.push(A)}return c?"":a.join("")},r.setPenStyles=function(a){this.currPenState.setStyles(a),this.chars[this.pos].setPenState(this.currPenState)},g}(),l=function(){function g(a){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var c=0;c<D;c++)this.rows.push(new s(a));this.logger=a,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var r=g.prototype;return r.reset=function(){for(var a=0;a<D;a++)this.rows[a].clear();this.currRow=14},r.equals=function(a){for(var c=!0,b=0;b<D;b++)if(!this.rows[b].equals(a.rows[b])){c=!1;break}return c},r.copy=function(a){for(var c=0;c<D;c++)this.rows[c].copy(a.rows[c])},r.isEmpty=function(){for(var a=!0,c=0;c<D;c++)if(!this.rows[c].isEmpty()){a=!1;break}return a},r.backSpace=function(){this.rows[this.currRow].backSpace()},r.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},r.insertChar=function(a){this.rows[this.currRow].insertChar(a)},r.setPen=function(a){this.rows[this.currRow].setPenStyles(a)},r.moveCursor=function(a){this.rows[this.currRow].moveCursor(a)},r.setCursor=function(a){this.logger.log(R.INFO,"setCursor: "+a),this.rows[this.currRow].setCursor(a)},r.setPAC=function(a){this.logger.log(R.INFO,"pacData = "+JSON.stringify(a));var c=a.row-1;if(this.nrRollUpRows&&c<this.nrRollUpRows-1&&(c=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==c){for(var b=0;b<D;b++)this.rows[b].clear();var A=this.currRow+1-this.nrRollUpRows,I=this.lastOutputScreen;if(I){var x=I.rows[A].cueStartTime,w=this.logger.time;if(x&&w!==null&&x<w)for(var O=0;O<this.nrRollUpRows;O++)this.rows[c-this.nrRollUpRows+O+1].copy(I.rows[A+O])}}this.currRow=c;var F=this.rows[this.currRow];if(a.indent!==null){var M=a.indent,N=Math.max(M-1,0);F.setCursor(a.indent),a.color=F.chars[N].penState.foreground}var B={foreground:a.color,underline:a.underline,italics:a.italics,background:"black",flash:!1};this.setPen(B)},r.setBkgData=function(a){this.logger.log(R.INFO,"bkgData = "+JSON.stringify(a)),this.backSpace(),this.setPen(a),this.insertChar(32)},r.setRollUpRows=function(a){this.nrRollUpRows=a},r.rollUp=function(){if(this.nrRollUpRows!==null){this.logger.log(R.TEXT,this.getDisplayText());var a=this.currRow+1-this.nrRollUpRows,c=this.rows.splice(a,1)[0];c.clear(),this.rows.splice(this.currRow,0,c),this.logger.log(R.INFO,"Rolling up")}else this.logger.log(R.DEBUG,"roll_up but nrRollUpRows not set yet")},r.getDisplayText=function(a){a=a||!1;for(var c=[],b="",A=-1,I=0;I<D;I++){var x=this.rows[I].getTextString();x&&(A=I+1,a?c.push("Row "+A+": '"+x+"'"):c.push(x.trim()))}return c.length>0&&(b=a?"["+c.join(" | ")+"]":c.join(`
`)),b},r.getTextAndFormat=function(){return this.rows},g}(),n=function(){function g(a,c,b){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=a,this.outputFilter=c,this.mode=null,this.verbose=0,this.displayedMemory=new l(b),this.nonDisplayedMemory=new l(b),this.lastOutputScreen=new l(b),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=b}var r=g.prototype;return r.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},r.getHandler=function(){return this.outputFilter},r.setHandler=function(a){this.outputFilter=a},r.setPAC=function(a){this.writeScreen.setPAC(a)},r.setBkgData=function(a){this.writeScreen.setBkgData(a)},r.setMode=function(a){a!==this.mode&&(this.mode=a,this.logger.log(R.INFO,"MODE="+a),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=a)},r.insertChars=function(a){for(var c=0;c<a.length;c++)this.writeScreen.insertChar(a[c]);var b=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(R.INFO,b+": "+this.writeScreen.getDisplayText(!0)),this.mode!=="MODE_PAINT-ON"&&this.mode!=="MODE_ROLL-UP"||(this.logger.log(R.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},r.ccRCL=function(){this.logger.log(R.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},r.ccBS=function(){this.logger.log(R.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},r.ccAOF=function(){},r.ccAON=function(){},r.ccDER=function(){this.logger.log(R.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},r.ccRU=function(a){this.logger.log(R.INFO,"RU("+a+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(a)},r.ccFON=function(){this.logger.log(R.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},r.ccRDC=function(){this.logger.log(R.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},r.ccTR=function(){this.logger.log(R.INFO,"TR"),this.setMode("MODE_TEXT")},r.ccRTD=function(){this.logger.log(R.INFO,"RTD"),this.setMode("MODE_TEXT")},r.ccEDM=function(){this.logger.log(R.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},r.ccCR=function(){this.logger.log(R.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},r.ccENM=function(){this.logger.log(R.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},r.ccEOC=function(){if(this.logger.log(R.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var a=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=a,this.writeScreen=this.nonDisplayedMemory,this.logger.log(R.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},r.ccTO=function(a){this.logger.log(R.INFO,"TO("+a+") - Tab Offset"),this.writeScreen.moveCursor(a)},r.ccMIDROW=function(a){var c={flash:!1};if(c.underline=a%2==1,c.italics=a>=46,c.italics)c.foreground="white";else{var b=Math.floor(a/2)-16;c.foreground=["white","green","blue","cyan","red","yellow","magenta"][b]}this.logger.log(R.INFO,"MIDROW: "+JSON.stringify(c)),this.writeScreen.setPen(c)},r.outputDataUpdate=function(a){a===void 0&&(a=!1);var c=this.logger.time;c!==null&&this.outputFilter&&(this.cueStartTime!==null||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,c,this.lastOutputScreen),a&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:c):this.cueStartTime=c,this.lastOutputScreen.copy(this.displayedMemory))},r.cueSplitAtTime=function(a){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,a,this.displayedMemory),this.cueStartTime=a))},g}(),u=function(){function g(a,c,b){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var A=new d;this.channels=[null,new n(a,c,A),new n(a+1,b,A)],this.cmdHistory={a:null,b:null},this.logger=A}var r=g.prototype;return r.getHandler=function(a){return this.channels[a].getHandler()},r.setHandler=function(a,c){this.channels[a].setHandler(c)},r.addData=function(a,c){var b,A,I,x=!1;this.logger.time=a;for(var w=0;w<c.length;w+=2)if(A=127&c[w],I=127&c[w+1],A!==0||I!==0){if(this.logger.log(R.DATA,"["+t([c[w],c[w+1]])+"] -> ("+t([A,I])+")"),(b=this.parseCmd(A,I))||(b=this.parseMidrow(A,I)),b||(b=this.parsePAC(A,I)),b||(b=this.parseBackgroundAttributes(A,I)),!b&&(x=this.parseChars(A,I))){var O=this.currentChannel;O&&O>0?this.channels[O].insertChars(x):this.logger.log(R.WARNING,"No channel found yet. TEXT-MODE?")}b||x||this.logger.log(R.WARNING,"Couldn't parse cleaned data "+t([A,I])+" orig: "+t([c[w],c[w+1]]))}},r.parseCmd=function(a,c){var b=this.cmdHistory;if(!((a===20||a===28||a===21||a===29)&&c>=32&&c<=47||(a===23||a===31)&&c>=33&&c<=35))return!1;if(v(a,c,b))return p(null,null,b),this.logger.log(R.DEBUG,"Repeated command ("+t([a,c])+") is dropped"),!0;var A=a===20||a===21||a===23?1:2,I=this.channels[A];return a===20||a===21||a===28||a===29?c===32?I.ccRCL():c===33?I.ccBS():c===34?I.ccAOF():c===35?I.ccAON():c===36?I.ccDER():c===37?I.ccRU(2):c===38?I.ccRU(3):c===39?I.ccRU(4):c===40?I.ccFON():c===41?I.ccRDC():c===42?I.ccTR():c===43?I.ccRTD():c===44?I.ccEDM():c===45?I.ccCR():c===46?I.ccENM():c===47&&I.ccEOC():I.ccTO(c-32),p(a,c,b),this.currentChannel=A,!0},r.parseMidrow=function(a,c){var b=0;if((a===17||a===25)&&c>=32&&c<=47){if((b=a===17?1:2)!==this.currentChannel)return this.logger.log(R.ERROR,"Mismatch channel in midrow parsing"),!1;var A=this.channels[b];return!!A&&(A.ccMIDROW(c),this.logger.log(R.DEBUG,"MIDROW ("+t([a,c])+")"),!0)}return!1},r.parsePAC=function(a,c){var b,A=this.cmdHistory;if(!((a>=17&&a<=23||a>=25&&a<=31)&&c>=64&&c<=127||(a===16||a===24)&&c>=64&&c<=95))return!1;if(v(a,c,A))return p(null,null,A),!0;var I=a<=23?1:2;b=c>=64&&c<=95?I===1?S[a]:h[a]:I===1?m[a]:T[a];var x=this.channels[I];return!!x&&(x.setPAC(this.interpretPAC(b,c)),p(a,c,A),this.currentChannel=I,!0)},r.interpretPAC=function(a,c){var b,A={color:null,italics:!1,indent:null,underline:!1,row:a};return b=c>95?c-96:c-64,A.underline=(1&b)==1,b<=13?A.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(b/2)]:b<=15?(A.italics=!0,A.color="white"):A.indent=4*Math.floor((b-16)/2),A},r.parseChars=function(a,c){var b,A,I=null,x=null;if(a>=25?(b=2,x=a-8):(b=1,x=a),x>=17&&x<=19?(A=x===17?c+80:x===18?c+112:c+144,this.logger.log(R.INFO,"Special char '"+_(A)+"' in channel "+b),I=[A]):a>=32&&a<=127&&(I=c===0?[a]:[a,c]),I){var w=t(I);this.logger.log(R.DEBUG,"Char codes =  "+w.join(",")),p(a,c,this.cmdHistory)}return I},r.parseBackgroundAttributes=function(a,c){var b;if(!((a===16||a===24)&&c>=32&&c<=47||(a===23||a===31)&&c>=45&&c<=47))return!1;var A={};a===16||a===24?(b=Math.floor((c-32)/2),A.background=y[b],c%2==1&&(A.background=A.background+"_semi")):c===45?A.background="transparent":(A.foreground="black",c===47&&(A.underline=!0));var I=a<=23?1:2;return this.channels[I].setBkgData(A),p(a,c,this.cmdHistory),!0},r.reset=function(){for(var a=0;a<Object.keys(this.channels).length;a++){var c=this.channels[a];c&&c.reset()}this.cmdHistory={a:null,b:null}},r.cueSplitAtTime=function(a){for(var c=0;c<this.channels.length;c++){var b=this.channels[c];b&&b.cueSplitAtTime(a)}},g}();function p(g,r,a){a.a=g,a.b=r}function v(g,r,a){return a.a===g&&a.b===r}C.default=u},"./src/utils/codecs.ts":function(P,C,f){f.r(C),f.d(C,"isCodecType",function(){return E}),f.d(C,"isCodecSupportedInMp4",function(){return L});var R={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function E(k,_){var D=R[_];return!!D&&D[k.slice(0,4)]===!0}function L(k,_){return MediaSource.isTypeSupported((_||"video")+'/mp4;codecs="'+k+'"')}},"./src/utils/cues.ts":function(P,C,f){f.r(C);var R=f("./src/utils/vttparser.ts"),E=f("./src/utils/webvtt-parser.ts"),L=f("./src/utils/texttrack-utils.ts"),k=/\s/,_={newCue:function(D,o,S,m){for(var h,T,y,d,t,i=[],e=self.VTTCue||self.TextTrackCue,s=0;s<m.rows.length;s++)if(y=!0,d=0,t="",!(h=m.rows[s]).isEmpty()){for(var l=0;l<h.chars.length;l++)k.test(h.chars[l].uchar)&&y?d++:(t+=h.chars[l].uchar,y=!1);h.cueStartTime=o,o===S&&(S+=1e-4),d>=16?d--:d++;var n=Object(R.fixLineBreaks)(t.trim()),u=Object(E.generateCueId)(o,S,n);D&&D.cues&&D.cues.getCueById(u)||((T=new e(o,S,n)).id=u,T.line=s+1,T.align="left",T.position=10+Math.min(80,10*Math.floor(8*d/32)),i.push(T))}return D&&i.length&&(i.sort(function(p,v){return p.line==="auto"||v.line==="auto"?0:p.line>8&&v.line>8?v.line-p.line:p.line-v.line}),i.forEach(function(p){return Object(L.addCueToTrack)(D,p)})),i}};C.default=_},"./src/utils/discontinuities.ts":function(P,C,f){f.r(C),f.d(C,"findFirstFragWithCC",function(){return k}),f.d(C,"shouldAlignOnDiscontinuities",function(){return _}),f.d(C,"findDiscontinuousReferenceFrag",function(){return D}),f.d(C,"adjustSlidingStart",function(){return S}),f.d(C,"alignStream",function(){return m}),f.d(C,"alignPDT",function(){return h});var R=f("./src/polyfills/number.ts"),E=f("./src/utils/logger.ts"),L=f("./src/controller/level-helper.ts");function k(T,y){for(var d=null,t=0,i=T.length;t<i;t++){var e=T[t];if(e&&e.cc===y){d=e;break}}return d}function _(T,y,d){return!(!y.details||!(d.endCC>d.startCC||T&&T.cc<d.startCC))}function D(T,y){var d=T.fragments,t=y.fragments;if(t.length&&d.length){var i=k(d,t[0].cc);if(i&&(!i||i.startPTS))return i;E.logger.log("No frag in previous level to align on")}else E.logger.log("No fragments to align")}function o(T,y){if(T){var d=T.start+y;T.start=T.startPTS=d,T.endPTS=d+T.duration}}function S(T,y){for(var d=y.fragments,t=0,i=d.length;t<i;t++)o(d[t],T);y.fragmentHint&&o(y.fragmentHint,T),y.alignedSliding=!0}function m(T,y,d){y&&(function(t,i,e){if(_(t,e,i)){var s=D(e.details,i);s&&Object(R.isFiniteNumber)(s.start)&&(E.logger.log("Adjusting PTS using last level due to CC increase within current level "+i.url),S(s.start,i))}}(T,d,y),!d.alignedSliding&&y.details&&h(d,y.details),d.alignedSliding||!y.details||d.skippedSegments||Object(L.adjustSliding)(y.details,d))}function h(T,y){if(y.fragments.length&&T.hasProgramDateTime&&y.hasProgramDateTime){var d=y.fragments[0].programDateTime,t=T.fragments[0].programDateTime,i=(t-d)/1e3+y.fragments[0].start;i&&Object(R.isFiniteNumber)(i)&&(E.logger.log("Adjusting PTS using programDateTime delta "+(t-d)+"ms, sliding:"+i.toFixed(3)+" "+T.url+" "),S(i,T))}}},"./src/utils/ewma-bandwidth-estimator.ts":function(P,C,f){f.r(C);var R=f("./src/utils/ewma.ts"),E=function(){function L(_,D,o){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=o,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new R.default(_),this.fast_=new R.default(D)}var k=L.prototype;return k.update=function(_,D){var o=this.slow_,S=this.fast_;this.slow_.halfLife!==_&&(this.slow_=new R.default(_,o.getEstimate(),o.getTotalWeight())),this.fast_.halfLife!==D&&(this.fast_=new R.default(D,S.getEstimate(),S.getTotalWeight()))},k.sample=function(_,D){var o=(_=Math.max(_,this.minDelayMs_))/1e3,S=8*D/o;this.fast_.sample(o,S),this.slow_.sample(o,S)},k.canEstimate=function(){var _=this.fast_;return _&&_.getTotalWeight()>=this.minWeight_},k.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},k.destroy=function(){},L}();C.default=E},"./src/utils/ewma.ts":function(P,C,f){f.r(C);var R=function(){function E(k,_,D){_===void 0&&(_=0),D===void 0&&(D=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=k,this.alpha_=k?Math.exp(Math.log(.5)/k):0,this.estimate_=_,this.totalWeight_=D}var L=E.prototype;return L.sample=function(k,_){var D=Math.pow(this.alpha_,k);this.estimate_=_*(1-D)+D*this.estimate_,this.totalWeight_+=k},L.getTotalWeight=function(){return this.totalWeight_},L.getEstimate=function(){if(this.alpha_){var k=1-Math.pow(this.alpha_,this.totalWeight_);if(k)return this.estimate_/k}return this.estimate_},E}();C.default=R},"./src/utils/fetch-loader.ts":function(P,C,f){f.r(C),f.d(C,"fetchSupported",function(){return m});var R=f("./src/polyfills/number.ts"),E=f("./src/loader/load-stats.ts"),L=f("./src/demux/chunk-cache.ts");function k(d){var t=typeof Map=="function"?new Map:void 0;return(k=function(i){if(i===null||(e=i,Function.toString.call(e).indexOf("[native code]")===-1))return i;var e;if(typeof i!="function")throw new TypeError("Super expression must either be null or a function");if(t!==void 0){if(t.has(i))return t.get(i);t.set(i,s)}function s(){return _(i,arguments,S(this).constructor)}return s.prototype=Object.create(i.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),o(s,i)})(d)}function _(d,t,i){return(_=D()?Reflect.construct:function(e,s,l){var n=[null];n.push.apply(n,s);var u=new(Function.bind.apply(e,n));return l&&o(u,l.prototype),u}).apply(null,arguments)}function D(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function o(d,t){return(o=Object.setPrototypeOf||function(i,e){return i.__proto__=e,i})(d,t)}function S(d){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(d)}function m(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var h=function(){function d(i){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=i.fetchSetup||T,this.controller=new self.AbortController,this.stats=new E.LoadStats}var t=d.prototype;return t.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},t.abortInternal=function(){var i=this.response;i&&i.ok||(this.stats.aborted=!0,this.controller.abort())},t.abort=function(){var i;this.abortInternal(),(i=this.callbacks)!==null&&i!==void 0&&i.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},t.load=function(i,e,s){var l=this,n=this.stats;if(n.loading.start)throw new Error("Loader can only be used once.");n.loading.start=self.performance.now();var u=function(r,a){var c={method:"GET",mode:"cors",credentials:"same-origin",signal:a};return r.rangeEnd&&(c.headers=new self.Headers({Range:"bytes="+r.rangeStart+"-"+String(r.rangeEnd-1)})),c}(i,this.controller.signal),p=s.onProgress,v=i.responseType==="arraybuffer",g=v?"byteLength":"length";this.context=i,this.config=e,this.callbacks=s,this.request=this.fetchSetup(i,u),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){l.abortInternal(),s.onTimeout(n,i,l.response)},e.timeout),self.fetch(this.request).then(function(r){if(l.response=l.loader=r,!r.ok){var a=r.status,c=r.statusText;throw new y(c||"fetch, bad network response",a,r)}return n.loading.first=Math.max(self.performance.now(),n.loading.start),n.total=parseInt(r.headers.get("Content-Length")||"0"),p&&Object(R.isFiniteNumber)(e.highWaterMark)?l.loadProgressively(r,n,i,e.highWaterMark,p):v?r.arrayBuffer():r.text()}).then(function(r){var a=l.response;self.clearTimeout(l.requestTimeout),n.loading.end=Math.max(self.performance.now(),n.loading.first),n.loaded=n.total=r[g];var c={url:a.url,data:r};p&&!Object(R.isFiniteNumber)(e.highWaterMark)&&p(n,i,r,a),s.onSuccess(c,n,i,a)}).catch(function(r){if(self.clearTimeout(l.requestTimeout),!n.aborted){var a=r.code||0;s.onError({code:a,text:r.message},i,r.details)}})},t.getCacheAge=function(){var i=null;if(this.response){var e=this.response.headers.get("age");i=e?parseFloat(e):null}return i},t.loadProgressively=function(i,e,s,l,n){l===void 0&&(l=0);var u=new L.default,p=i.body.getReader();return function v(){return p.read().then(function(g){if(g.done)return u.dataLength&&n(e,s,u.flush(),i),Promise.resolve(new ArrayBuffer(0));var r=g.value,a=r.length;return e.loaded+=a,a<l||u.dataLength?(u.push(r),u.dataLength>=l&&n(e,s,u.flush(),i)):n(e,s,r,i),v()}).catch(function(){return Promise.reject()})}()},d}();function T(d,t){return new self.Request(d.url,t)}var y=function(d){var t,i;function e(s,l,n){var u;return(u=d.call(this,s)||this).code=void 0,u.details=void 0,u.code=l,u.details=n,u}return i=d,(t=e).prototype=Object.create(i.prototype),t.prototype.constructor=t,o(t,i),e}(k(Error));C.default=h},"./src/utils/imsc1-ttml-parser.ts":function(P,C,f){f.r(C),f.d(C,"IMSC1_CODEC",function(){return S}),f.d(C,"parseIMSC1",function(){return y});var R=f("./src/utils/mp4-tools.ts"),E=f("./src/utils/vttparser.ts"),L=f("./src/utils/vttcue.ts"),k=f("./src/demux/id3.ts"),_=f("./src/utils/timescale-conversion.ts"),D=f("./src/utils/webvtt-parser.ts");function o(){return(o=Object.assign||function(n){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var v in p)Object.prototype.hasOwnProperty.call(p,v)&&(n[v]=p[v])}return n}).apply(this,arguments)}var S="stpp.ttml.im1t",m=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,h=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,T={left:"start",center:"center",right:"end",start:"start",end:"end"};function y(n,u,p,v,g){var r=Object(R.findBox)(new Uint8Array(n),["mdat"]);if(r.length!==0){var a=r[0],c=Object(k.utf8ArrayToStr)(new Uint8Array(n,a.start,a.end-a.start)),b=Object(_.toTimescaleFromScale)(u,1,p);try{v(function(A,I){var x=new DOMParser().parseFromString(A,"text/xml").getElementsByTagName("tt")[0];if(!x)throw new Error("Invalid ttml");var w={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},O=Object.keys(w).reduce(function(U,G){return U[G]=x.getAttribute("ttp:"+G)||w[G],U},{}),F=x.getAttribute("xml:space")!=="preserve",M=t(d(x,"styling","style")),N=t(d(x,"layout","region")),B=d(x,"body","[begin]");return[].map.call(B,function(U){var G=i(U,F);if(!G||!U.hasAttribute("begin"))return null;var H=l(U.getAttribute("begin"),O),z=l(U.getAttribute("dur"),O),Y=l(U.getAttribute("end"),O);if(H===null)throw s(U);if(Y===null){if(z===null)throw s(U);Y=H+z}var W=new L.default(H-I,Y-I,G);W.id=Object(D.generateCueId)(W.startTime,W.endTime,W.text);var $=N[U.getAttribute("region")],ie=M[U.getAttribute("style")];W.position=10,W.size=80;var ae=function(se,te){var ne="http://www.w3.org/ns/ttml#styling";return["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce(function(fe,he){var pe=e(te,ne,he)||e(se,ne,he);return pe&&(fe[he]=pe),fe},{})}($,ie),ue=ae.textAlign;if(ue){var Z=T[ue];Z&&(W.lineAlign=Z),W.align=ue}return o(W,ae),W}).filter(function(U){return U!==null})}(c,b))}catch(A){g(A)}}else g(new Error("Could not parse IMSC1 mdat"))}function d(n,u,p){var v=n.getElementsByTagName(u)[0];return v?[].slice.call(v.querySelectorAll(p)):[]}function t(n){return n.reduce(function(u,p){var v=p.getAttribute("xml:id");return v&&(u[v]=p),u},{})}function i(n,u){return[].slice.call(n.childNodes).reduce(function(p,v,g){var r;return v.nodeName==="br"&&g?p+`
`:(r=v.childNodes)!==null&&r!==void 0&&r.length?i(v,u):u?p+v.textContent.trim().replace(/\s+/g," "):p+v.textContent},"")}function e(n,u,p){return n.hasAttributeNS(u,p)?n.getAttributeNS(u,p):null}function s(n){return new Error("Could not parse ttml timestamp "+n)}function l(n,u){if(!n)return null;var p=Object(E.parseTimeStamp)(n);return p===null&&(m.test(n)?p=function(v,g){var r=m.exec(v),a=(0|r[4])+(0|r[5])/g.subFrameRate;return 3600*(0|r[1])+60*(0|r[2])+(0|r[3])+a/g.frameRate}(n,u):h.test(n)&&(p=function(v,g){var r=h.exec(v),a=Number(r[1]);switch(r[2]){case"h":return 3600*a;case"m":return 60*a;case"ms":return 1e3*a;case"f":return a/g.frameRate;case"t":return a/g.tickRate}return a}(n,u))),p}},"./src/utils/logger.ts":function(P,C,f){f.r(C),f.d(C,"enableLogs",function(){return _}),f.d(C,"logger",function(){return D});var R=function(){},E={trace:R,debug:R,log:R,warn:R,info:R,error:R},L=E;function k(o){var S=self.console[o];return S?S.bind(self.console,"["+o+"] >"):R}function _(o){if(self.console&&o===!0||typeof o=="object"){(function(S){for(var m=arguments.length,h=new Array(m>1?m-1:0),T=1;T<m;T++)h[T-1]=arguments[T];h.forEach(function(y){L[y]=S[y]?S[y].bind(S):k(y)})})(o,"debug","log","info","warn","error");try{L.log()}catch{L=E}}else L=E}var D=E},"./src/utils/mediakeys-helper.ts":function(P,C,f){var R,E;f.r(C),f.d(C,"KeySystems",function(){return R}),f.d(C,"requestMediaKeySystemAccess",function(){return L}),(E=R||(R={})).WIDEVINE="com.widevine.alpha",E.PLAYREADY="com.microsoft.playready";var L=typeof self!="undefined"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null},"./src/utils/mediasource-helper.ts":function(P,C,f){function R(){return self.MediaSource||self.WebKitMediaSource}f.r(C),f.d(C,"getMediaSource",function(){return R})},"./src/utils/mp4-tools.ts":function(P,C,f){f.r(C),f.d(C,"bin2str",function(){return _}),f.d(C,"readUint16",function(){return D}),f.d(C,"readUint32",function(){return o}),f.d(C,"writeUint32",function(){return S}),f.d(C,"findBox",function(){return m}),f.d(C,"parseSegmentIndex",function(){return h}),f.d(C,"parseInitSegment",function(){return T}),f.d(C,"getStartDTS",function(){return y}),f.d(C,"getDuration",function(){return d}),f.d(C,"computeRawDurationFromSamples",function(){return t}),f.d(C,"offsetStartDTS",function(){return i}),f.d(C,"segmentValidRange",function(){return e}),f.d(C,"appendUint8Array",function(){return s});var R=f("./src/utils/typed-array.ts"),E=f("./src/loader/fragment.ts"),L=Math.pow(2,32)-1,k=[].push;function _(l){return String.fromCharCode.apply(null,l)}function D(l,n){"data"in l&&(n+=l.start,l=l.data);var u=l[n]<<8|l[n+1];return u<0?65536+u:u}function o(l,n){"data"in l&&(n+=l.start,l=l.data);var u=l[n]<<24|l[n+1]<<16|l[n+2]<<8|l[n+3];return u<0?4294967296+u:u}function S(l,n,u){"data"in l&&(n+=l.start,l=l.data),l[n]=u>>24,l[n+1]=u>>16&255,l[n+2]=u>>8&255,l[n+3]=255&u}function m(l,n){var u,p,v,g=[];if(!n.length)return g;"data"in l?(u=l.data,p=l.start,v=l.end):(p=0,v=(u=l).byteLength);for(var r=p;r<v;){var a=o(u,r),c=a>1?r+a:v;if(_(u.subarray(r+4,r+8))===n[0])if(n.length===1)g.push({data:u,start:r+8,end:c});else{var b=m({data:u,start:r+8,end:c},n.slice(1));b.length&&k.apply(g,b)}r=c}return g}function h(l){var n=m(l,["moov"])[0],u=n?n.end:null,p=m(l,["sidx"]);if(!p||!p[0])return null;var v=[],g=p[0],r=g.data[0],a=r===0?8:16,c=o(g,a);a+=4,a+=r===0?8:16,a+=2;var b=g.end+0,A=D(g,a);a+=2;for(var I=0;I<A;I++){var x=a,w=o(g,x);x+=4;var O=2147483647&w;if((2147483648&w)>>>31==1)return console.warn("SIDX has hierarchical references (not supported)"),null;var F=o(g,x);x+=4,v.push({referenceSize:O,subsegmentDuration:F,info:{duration:F/c,start:b,end:b+O-1}}),b+=O,a=x+=4}return{earliestPresentationTime:0,timescale:c,version:r,referencesCount:A,references:v,moovEndOffset:u}}function T(l){for(var n=[],u=m(l,["moov","trak"]),p=0;p<u.length;p++){var v=u[p],g=m(v,["tkhd"])[0];if(g){var r=g.data[g.start],a=r===0?12:20,c=o(g,a),b=m(v,["mdia","mdhd"])[0];if(b){var A=o(b,a=(r=b.data[b.start])===0?12:20),I=m(v,["mdia","hdlr"])[0];if(I){var x=_(I.data.subarray(I.start+8,I.start+12)),w={soun:E.ElementaryStreamTypes.AUDIO,vide:E.ElementaryStreamTypes.VIDEO}[x];if(w){var O=m(v,["mdia","minf","stbl","stsd"])[0],F=void 0;O&&(F=_(O.data.subarray(O.start+12,O.start+16))),n[c]={timescale:A,type:w},n[w]={timescale:A,id:c,codec:F}}}}}}return m(l,["moov","mvex","trex"]).forEach(function(M){var N=o(M,4),B=n[N];B&&(B.default={duration:o(M,12),flags:o(M,20)})}),n}function y(l,n){return m(n,["moof","traf"]).reduce(function(u,p){var v=m(p,["tfdt"])[0],g=v.data[v.start],r=m(p,["tfhd"]).reduce(function(a,c){var b=o(c,4),A=l[b];if(A){var I=o(v,4);g===1&&(I*=Math.pow(2,32),I+=o(v,8));var x=I/(A.timescale||9e4);if(isFinite(x)&&(a===null||x<a))return x}return a},null);return r!==null&&isFinite(r)&&(u===null||r<u)?r:u},null)||0}function d(l,n){for(var u=0,p=0,v=0,g=m(l,["moof","traf"]),r=0;r<g.length;r++){var a=g[r],c=m(a,["tfhd"])[0],b=n[o(c,4)];if(b){var A=b.default,I=o(c,0)|(A==null?void 0:A.flags),x=A==null?void 0:A.duration;8&I&&(x=o(c,2&I?12:8));for(var w=b.timescale||9e4,O=m(a,["trun"]),F=0;F<O.length;F++)u=x?x*o(O[F],4):t(O[F]),b.type===E.ElementaryStreamTypes.VIDEO?p+=u/w:b.type===E.ElementaryStreamTypes.AUDIO&&(v+=u/w)}}if(p===0&&v===0){var M=h(l);if(M!=null&&M.references)return M.references.reduce(function(N,B){return N+B.info.duration||0},0)}return p||v}function t(l){var n=o(l,0),u=8;1&n&&(u+=4),4&n&&(u+=4);for(var p=0,v=o(l,4),g=0;g<v;g++)256&n&&(p+=o(l,u),u+=4),512&n&&(u+=4),1024&n&&(u+=4),2048&n&&(u+=4);return p}function i(l,n,u){m(n,["moof","traf"]).forEach(function(p){m(p,["tfhd"]).forEach(function(v){var g=o(v,4),r=l[g];if(r){var a=r.timescale||9e4;m(p,["tfdt"]).forEach(function(c){var b=c.data[c.start],A=o(c,4);if(b===0)S(c,4,A-u*a);else{A*=Math.pow(2,32),A+=o(c,8),A-=u*a,A=Math.max(A,0);var I=Math.floor(A/(L+1)),x=Math.floor(A%(L+1));S(c,4,I),S(c,8,x)}})}})})}function e(l){var n={valid:null,remainder:null},u=m(l,["moof"]);if(!u)return n;if(u.length<2)return n.remainder=l,n;var p=u[u.length-1];return n.valid=Object(R.sliceUint8)(l,0,p.start-8),n.remainder=Object(R.sliceUint8)(l,p.start-8),n}function s(l,n){var u=new Uint8Array(l.length+n.length);return u.set(l),u.set(n,l.length),u}},"./src/utils/output-filter.ts":function(P,C,f){f.r(C),f.d(C,"default",function(){return R});var R=function(){function E(k,_){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=k,this.trackName=_}var L=E.prototype;return L.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},L.newCue=function(k,_,D){(this.startTime===null||this.startTime>k)&&(this.startTime=k),this.endTime=_,this.screen=D,this.timelineController.createCaptionsTrack(this.trackName)},L.reset=function(){this.cueRanges=[]},E}()},"./src/utils/texttrack-utils.ts":function(P,C,f){f.r(C),f.d(C,"sendAddTrackEvent",function(){return E}),f.d(C,"addCueToTrack",function(){return L}),f.d(C,"clearCurrentCues",function(){return k}),f.d(C,"removeCuesInRange",function(){return _}),f.d(C,"getCuesInRange",function(){return D});var R=f("./src/utils/logger.ts");function E(o,S){var m;try{m=new Event("addtrack")}catch{(m=document.createEvent("Event")).initEvent("addtrack",!1,!1)}m.track=o,S.dispatchEvent(m)}function L(o,S){var m=o.mode;if(m==="disabled"&&(o.mode="hidden"),o.cues&&!o.cues.getCueById(S.id))try{if(o.addCue(S),!o.cues.getCueById(S.id))throw new Error("addCue is failed for: "+S)}catch(T){R.logger.debug("[texttrack-utils]: "+T);var h=new self.TextTrackCue(S.startTime,S.endTime,S.text);h.id=S.id,o.addCue(h)}m==="disabled"&&(o.mode=m)}function k(o){var S=o.mode;if(S==="disabled"&&(o.mode="hidden"),o.cues)for(var m=o.cues.length;m--;)o.removeCue(o.cues[m]);S==="disabled"&&(o.mode=S)}function _(o,S,m){var h=o.mode;if(h==="disabled"&&(o.mode="hidden"),o.cues&&o.cues.length>0)for(var T=D(o.cues,S,m),y=0;y<T.length;y++)o.removeCue(T[y]);h==="disabled"&&(o.mode=h)}function D(o,S,m){var h=[],T=function(i,e){if(e<i[0].startTime)return 0;var s=i.length-1;if(e>i[s].endTime)return-1;for(var l=0,n=s;l<=n;){var u=Math.floor((n+l)/2);if(e<i[u].startTime)n=u-1;else{if(!(e>i[u].startTime&&l<s))return u;l=u+1}}return i[l].startTime-e<e-i[n].startTime?l:n}(o,S);if(T>-1)for(var y=T,d=o.length;y<d;y++){var t=o[y];if(t.startTime>=S&&t.endTime<=m)h.push(t);else if(t.startTime>m)return h}return h}},"./src/utils/time-ranges.ts":function(P,C,f){f.r(C),C.default={toString:function(R){for(var E="",L=R.length,k=0;k<L;k++)E+="["+R.start(k).toFixed(3)+","+R.end(k).toFixed(3)+"]";return E}}},"./src/utils/timescale-conversion.ts":function(P,C,f){function R(_,D,o,S){o===void 0&&(o=1),S===void 0&&(S=!1);var m=_*D*o;return S?Math.round(m):m}function E(_,D,o,S){return o===void 0&&(o=1),S===void 0&&(S=!1),R(_,D,1/o,S)}function L(_,D){return D===void 0&&(D=!1),R(_,1e3,1/9e4,D)}function k(_,D){return D===void 0&&(D=1),R(_,9e4,1/D)}f.r(C),f.d(C,"toTimescaleFromBase",function(){return R}),f.d(C,"toTimescaleFromScale",function(){return E}),f.d(C,"toMsFromMpegTsClock",function(){return L}),f.d(C,"toMpegTsClockFromTimescale",function(){return k})},"./src/utils/typed-array.ts":function(P,C,f){function R(E,L,k){return Uint8Array.prototype.slice?E.slice(L,k):new Uint8Array(Array.prototype.slice.call(E,L,k))}f.r(C),f.d(C,"sliceUint8",function(){return R})},"./src/utils/vttcue.ts":function(P,C,f){f.r(C),C.default=function(){if(typeof self!="undefined"&&self.VTTCue)return self.VTTCue;var R=["","lr","rl"],E=["start","middle","end","left","right"];function L(o,S){if(typeof S!="string"||!Array.isArray(o))return!1;var m=S.toLowerCase();return!!~o.indexOf(m)&&m}function k(o){return L(E,o)}function _(o){for(var S=arguments.length,m=new Array(S>1?S-1:0),h=1;h<S;h++)m[h-1]=arguments[h];for(var T=1;T<arguments.length;T++){var y=arguments[T];for(var d in y)o[d]=y[d]}return o}function D(o,S,m){var h=this,T={enumerable:!0};h.hasBeenReset=!1;var y="",d=!1,t=o,i=S,e=m,s=null,l="",n=!0,u="auto",p="start",v=50,g="middle",r=50,a="middle";Object.defineProperty(h,"id",_({},T,{get:function(){return y},set:function(c){y=""+c}})),Object.defineProperty(h,"pauseOnExit",_({},T,{get:function(){return d},set:function(c){d=!!c}})),Object.defineProperty(h,"startTime",_({},T,{get:function(){return t},set:function(c){if(typeof c!="number")throw new TypeError("Start time must be set to a number.");t=c,this.hasBeenReset=!0}})),Object.defineProperty(h,"endTime",_({},T,{get:function(){return i},set:function(c){if(typeof c!="number")throw new TypeError("End time must be set to a number.");i=c,this.hasBeenReset=!0}})),Object.defineProperty(h,"text",_({},T,{get:function(){return e},set:function(c){e=""+c,this.hasBeenReset=!0}})),Object.defineProperty(h,"region",_({},T,{get:function(){return s},set:function(c){s=c,this.hasBeenReset=!0}})),Object.defineProperty(h,"vertical",_({},T,{get:function(){return l},set:function(c){var b=function(A){return L(R,A)}(c);if(b===!1)throw new SyntaxError("An invalid or illegal string was specified.");l=b,this.hasBeenReset=!0}})),Object.defineProperty(h,"snapToLines",_({},T,{get:function(){return n},set:function(c){n=!!c,this.hasBeenReset=!0}})),Object.defineProperty(h,"line",_({},T,{get:function(){return u},set:function(c){if(typeof c!="number"&&c!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");u=c,this.hasBeenReset=!0}})),Object.defineProperty(h,"lineAlign",_({},T,{get:function(){return p},set:function(c){var b=k(c);if(!b)throw new SyntaxError("An invalid or illegal string was specified.");p=b,this.hasBeenReset=!0}})),Object.defineProperty(h,"position",_({},T,{get:function(){return v},set:function(c){if(c<0||c>100)throw new Error("Position must be between 0 and 100.");v=c,this.hasBeenReset=!0}})),Object.defineProperty(h,"positionAlign",_({},T,{get:function(){return g},set:function(c){var b=k(c);if(!b)throw new SyntaxError("An invalid or illegal string was specified.");g=b,this.hasBeenReset=!0}})),Object.defineProperty(h,"size",_({},T,{get:function(){return r},set:function(c){if(c<0||c>100)throw new Error("Size must be between 0 and 100.");r=c,this.hasBeenReset=!0}})),Object.defineProperty(h,"align",_({},T,{get:function(){return a},set:function(c){var b=k(c);if(!b)throw new SyntaxError("An invalid or illegal string was specified.");a=b,this.hasBeenReset=!0}})),h.displayState=void 0}return D.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},D}()},"./src/utils/vttparser.ts":function(P,C,f){f.r(C),f.d(C,"parseTimeStamp",function(){return L}),f.d(C,"fixLineBreaks",function(){return m}),f.d(C,"VTTParser",function(){return h});var R=f("./src/utils/vttcue.ts"),E=function(){function T(){}return T.prototype.decode=function(y,d){if(!y)return"";if(typeof y!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(y))},T}();function L(T){function y(t,i,e,s){return 3600*(0|t)+60*(0|i)+(0|e)+parseFloat(s||0)}var d=T.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return d?parseFloat(d[2])>59?y(d[2],d[3],0,d[4]):y(d[1],d[2],d[3],d[4]):null}var k=function(){function T(){this.values=Object.create(null)}var y=T.prototype;return y.set=function(d,t){this.get(d)||t===""||(this.values[d]=t)},y.get=function(d,t,i){return i?this.has(d)?this.values[d]:t[i]:this.has(d)?this.values[d]:t},y.has=function(d){return d in this.values},y.alt=function(d,t,i){for(var e=0;e<i.length;++e)if(t===i[e]){this.set(d,t);break}},y.integer=function(d,t){/^-?\d+$/.test(t)&&this.set(d,parseInt(t,10))},y.percent=function(d,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){var i=parseFloat(t);if(i>=0&&i<=100)return this.set(d,i),!0}return!1},T}();function _(T,y,d,t){var i=t?T.split(t):[T];for(var e in i)if(typeof i[e]=="string"){var s=i[e].split(d);s.length===2&&y(s[0],s[1])}}var D=new R.default(0,0,""),o=D.align==="middle"?"middle":"center";function S(T,y,d){var t=T;function i(){var s=L(T);if(s===null)throw new Error("Malformed timestamp: "+t);return T=T.replace(/^[^\sa-zA-Z-]+/,""),s}function e(){T=T.replace(/^\s+/,"")}if(e(),y.startTime=i(),e(),T.substr(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+t);T=T.substr(3),e(),y.endTime=i(),e(),function(s,l){var n=new k;_(s,function(v,g){var r;switch(v){case"region":for(var a=d.length-1;a>=0;a--)if(d[a].id===g){n.set(v,d[a].region);break}break;case"vertical":n.alt(v,g,["rl","lr"]);break;case"line":r=g.split(","),n.integer(v,r[0]),n.percent(v,r[0])&&n.set("snapToLines",!1),n.alt(v,r[0],["auto"]),r.length===2&&n.alt("lineAlign",r[1],["start",o,"end"]);break;case"position":r=g.split(","),n.percent(v,r[0]),r.length===2&&n.alt("positionAlign",r[1],["start",o,"end","line-left","line-right","auto"]);break;case"size":n.percent(v,g);break;case"align":n.alt(v,g,["start",o,"end","left","right"])}},/:/,/\s/),l.region=n.get("region",null),l.vertical=n.get("vertical","");var u=n.get("line","auto");u==="auto"&&D.line===-1&&(u=-1),l.line=u,l.lineAlign=n.get("lineAlign","start"),l.snapToLines=n.get("snapToLines",!0),l.size=n.get("size",100),l.align=n.get("align",o);var p=n.get("position","auto");p==="auto"&&D.position===50&&(p=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=p}(T,y)}function m(T){return T.replace(/<br(?: \/)?>/gi,`
`)}var h=function(){function T(){this.state="INITIAL",this.buffer="",this.decoder=new E,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var y=T.prototype;return y.parse=function(d){var t=this;function i(){var u=t.buffer,p=0;for(u=m(u);p<u.length&&u[p]!=="\r"&&u[p]!==`
`;)++p;var v=u.substr(0,p);return u[p]==="\r"&&++p,u[p]===`
`&&++p,t.buffer=u.substr(p),v}d&&(t.buffer+=t.decoder.decode(d,{stream:!0}));try{var e="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;var s=(e=i()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!s||!s[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}for(var l=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(l?l=!1:e=i(),t.state){case"HEADER":/:/.test(e)?_(e,function(u,p){},/:/):e||(t.state="ID");continue;case"NOTE":e||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(e)){t.state="NOTE";break}if(!e)continue;if(t.cue=new R.default(0,0,""),t.state="CUE",e.indexOf("-->")===-1){t.cue.id=e;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{S(e,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var n=e.indexOf("-->")!==-1;if(!e||n&&(l=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=e;continue;case"BADCUE":e||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},y.flush=function(){var d=this;try{if((d.cue||d.state==="HEADER")&&(d.buffer+=`

`,d.parse()),d.state==="INITIAL"||d.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){d.onparsingerror&&d.onparsingerror(t)}return d.onflush&&d.onflush(),this},T}()},"./src/utils/webvtt-parser.ts":function(P,C,f){f.r(C),f.d(C,"generateCueId",function(){return m}),f.d(C,"parseWebVTT",function(){return h});var R=f("./src/polyfills/number.ts"),E=f("./src/utils/vttparser.ts"),L=f("./src/demux/id3.ts"),k=f("./src/utils/timescale-conversion.ts"),_=f("./src/remux/mp4-remuxer.ts"),D=/\r\n|\n\r|\n|\r/g,o=function(T,y,d){return d===void 0&&(d=0),T.substr(d,y.length)===y},S=function(T){for(var y=5381,d=T.length;d;)y=33*y^T.charCodeAt(--d);return(y>>>0).toString()};function m(T,y,d){return S(T.toString())+S(y.toString())+S(d)}function h(T,y,d,t,i,e,s,l){var n,u=new E.VTTParser,p=Object(L.utf8ArrayToStr)(new Uint8Array(T)).trim().replace(D,`
`).split(`
`),v=[],g=Object(k.toMpegTsClockFromTimescale)(y,d),r="00:00.000",a=0,c=0,b=!0,A=!1;u.oncue=function(I){var x=t[i],w=t.ccOffset,O=(a-g)/9e4;if(x!=null&&x.new&&(c!==void 0?w=t.ccOffset=x.start:function(B,U,G){var H=B[U],z=B[H.prevCC];if(!z||!z.new&&H.new)return B.ccOffset=B.presentationOffset=H.start,void(H.new=!1);for(;(Y=z)!==null&&Y!==void 0&&Y.new;){var Y;B.ccOffset+=H.start-z.start,H.new=!1,z=B[(H=z).prevCC]}B.presentationOffset=G}(t,i,O)),O&&(w=O-t.presentationOffset),A){var F=I.endTime-I.startTime,M=Object(_.normalizePts)(9e4*(I.startTime+w-c),9e4*e)/9e4;I.startTime=M,I.endTime=M+F}var N=I.text.trim();I.text=decodeURIComponent(encodeURIComponent(N)),I.id||(I.id=m(I.startTime,I.endTime,N)),I.endTime>0&&v.push(I)},u.onparsingerror=function(I){n=I},u.onflush=function(){n?l(n):s(v)},p.forEach(function(I){if(b){if(o(I,"X-TIMESTAMP-MAP=")){b=!1,A=!0,I.substr(16).split(",").forEach(function(x){o(x,"LOCAL:")?r=x.substr(6):o(x,"MPEGTS:")&&(a=parseInt(x.substr(7)))});try{c=function(x){var w=parseInt(x.substr(-3)),O=parseInt(x.substr(-6,2)),F=parseInt(x.substr(-9,2)),M=x.length>9?parseInt(x.substr(0,x.indexOf(":"))):0;if(!(Object(R.isFiniteNumber)(w)&&Object(R.isFiniteNumber)(O)&&Object(R.isFiniteNumber)(F)&&Object(R.isFiniteNumber)(M)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+x);return w+=1e3*O,(w+=6e4*F)+36e5*M}(r)/1e3}catch(x){A=!1,n=x}return}I===""&&(b=!1)}u.parse(I+`
`)}),u.flush()}},"./src/utils/xhr-loader.ts":function(P,C,f){f.r(C);var R=f("./src/utils/logger.ts"),E=f("./src/loader/load-stats.ts"),L=/^age:\s*[\d.]+\s*$/m,k=function(){function _(o){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=o?o.xhrSetup:null,this.stats=new E.LoadStats,this.retryDelay=0}var D=_.prototype;return D.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},D.abortInternal=function(){var o=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),o&&(o.onreadystatechange=null,o.onprogress=null,o.readyState!==4&&(this.stats.aborted=!0,o.abort()))},D.abort=function(){var o;this.abortInternal(),(o=this.callbacks)!==null&&o!==void 0&&o.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},D.load=function(o,S,m){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=o,this.config=S,this.callbacks=m,this.retryDelay=S.retryDelay,this.loadInternal()},D.loadInternal=function(){var o=this.config,S=this.context;if(o){var m=this.loader=new self.XMLHttpRequest,h=this.stats;h.loading.first=0,h.loaded=0;var T=this.xhrSetup;try{if(T)try{T(m,S.url)}catch{m.open("GET",S.url,!0),T(m,S.url)}m.readyState||m.open("GET",S.url,!0)}catch(y){return void this.callbacks.onError({code:m.status,text:y.message},S,m)}S.rangeEnd&&m.setRequestHeader("Range","bytes="+S.rangeStart+"-"+(S.rangeEnd-1)),m.onreadystatechange=this.readystatechange.bind(this),m.onprogress=this.loadprogress.bind(this),m.responseType=S.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),o.timeout),m.send()}},D.readystatechange=function(){var o=this.context,S=this.loader,m=this.stats;if(o&&S){var h=S.readyState,T=this.config;if(!m.aborted&&h>=2)if(self.clearTimeout(this.requestTimeout),m.loading.first===0&&(m.loading.first=Math.max(self.performance.now(),m.loading.start)),h===4){S.onreadystatechange=null,S.onprogress=null;var y=S.status;if(y>=200&&y<300){var d,t;if(m.loading.end=Math.max(self.performance.now(),m.loading.first),t=o.responseType==="arraybuffer"?(d=S.response).byteLength:(d=S.responseText).length,m.loaded=m.total=t,!this.callbacks)return;var i=this.callbacks.onProgress;if(i&&i(m,o,d,S),!this.callbacks)return;var e={url:S.responseURL,data:d};this.callbacks.onSuccess(e,m,o,S)}else m.retry>=T.maxRetry||y>=400&&y<499?(R.logger.error(y+" while loading "+o.url),this.callbacks.onError({code:y,text:S.statusText},o,S)):(R.logger.warn(y+" while loading "+o.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,T.maxRetryDelay),m.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),T.timeout)}},D.loadtimeout=function(){R.logger.warn("timeout while loading "+this.context.url);var o=this.callbacks;o&&(this.abortInternal(),o.onTimeout(this.stats,this.context,this.loader))},D.loadprogress=function(o){var S=this.stats;S.loaded=o.loaded,o.lengthComputable&&(S.total=o.total)},D.getCacheAge=function(){var o=null;if(this.loader&&L.test(this.loader.getAllResponseHeaders())){var S=this.loader.getResponseHeader("age");o=S?parseFloat(S):null}return o},_}();C.default=k}}).default);var Et=Xr(Qt.exports);const $r={name:"d-icon"},ke=Object.assign($r,{props:{icon:String,size:[Number,String]},setup:function(P){const C=P,f=q(()=>({fontSize:/^\d+$/.test(C.size)?C.size+"px":C.size}));return(R,E)=>(J(),re("i",{class:Ve(["d-icon iconfont",P.icon]),style:He(K(f))},null,6))}});ke.__scopeId="data-v-0c690e66";Ye("data-v-4cb76d59");const Qr={class:"d-player-top"},Zr={class:"top-title"},Jr={class:"top-title"};Xe();const ei={props:{title:{default:""}},setup(P){Date.prototype.format=function(R){let E={"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds()};for(var L in E)new RegExp("("+L+")").test(R)&&(R=R.replace(RegExp.$1,RegExp.$1.length==1?E[L]:("00"+E[L]).substr((""+E[L]).length)));return R};let C=ee("00:00:00");C.value=new Date().format("hh:mm:ss");let f=null;return f=setInterval(()=>{C.value=new Date().format("hh:mm:ss")},1e3),kt(()=>{clearInterval(f)}),(R,E)=>(J(),re("div",Qr,[V("p",Zr,ce(P.title||""),1),V("p",Jr,ce(K(C)),1)]))},__scopeId:"data-v-4cb76d59"};Ye("data-v-ac2469ec");const ti={class:"d-status"},ri={class:"d-flex-center"},ii={class:"d-flex-center"},ni=ye("5X\u901F\u64AD\u653E\u4E2D ");Xe();var Zt=Be({props:["state"],setup:P=>(C,f)=>Ee((J(),re("div",ti,[Ee(V("li",ri,[X(ke,{size:"18",class:"d-status-icon",icon:"icon-volume-"+(P.state.volume==0?"mute":P.state.volume>.5?"up":"down")},null,8,["icon"]),ye(" "+ce(~~(100*P.state.volume))+"% ",1)],512),[[Ae,P.state.handleType=="volume"]]),Ee(V("li",ii,[X(ke,{size:"12",icon:"icon-play"}),X(ke,{size:"12",icon:"icon-play",style:{"margin-right":"5px"}}),ni],512),[[Ae,P.state.handleType=="playbackRate"||P.state.isMultiplesPlay]])],512)),[[Ae,P.state.handleType||P.state.isMultiplesPlay]])});Zt.__scopeId="data-v-ac2469ec",Ye("data-v-385f7870");const ai=["checked","true-value","false-value"],si=V("span",{class:"d-switch_action"},null,-1);Xe();var lt=Be({props:{modelValue:{type:[Number,String,Boolean]},width:{type:String,default:"40px"},trueValue:{type:[Number,String,Boolean],default:!0},falseValue:{type:[Number,String,Boolean],default:!0},activeColor:{type:[String],default:"#409EFF"}},emits:["update:modelValue","change"],setup(P,{emit:C}){const f=P;Dt(k=>({"014e5dc0":P.width,e4e32852:P.activeColor}));const R=ee(null),E=q(()=>f.modelValue===f.trueValue),L=()=>{ut(()=>{const k=R.value.checked;C("update:modelValue",k),C("change",k)})};return(k,_)=>(J(),re("div",{class:Ve(["d-switch",{"is-checked":K(E)}])},[V("input",{class:"d-switch__input",ref:R,type:"checkbox",checked:K(E),onChange:L,"true-value":P.trueValue,"false-value":P.falseValue},null,40,ai),si],2))}});lt.__scopeId="data-v-385f7870",Ye("data-v-b2384226");const oi={key:0},li=V("i",{class:"rotating iconfont icon-loading f50"},null,-1),ui=[V("i",{class:"rotating iconfont icon-loading f50"},null,-1),V("p",null,"\u6B63\u5728\u7F13\u51B2...",-1)],di=[V("i",{class:"iconfont icon-replay f24 mr5"},null,-1),ye("\u91CD\u65B0\u64AD\u653E ")],ci=[V("i",{class:"iconfont icon-replay f24 mr5"},null,-1),ye("\u8BF7\u6C42\u9519\u8BEF ")];Xe();var Jt=Be({props:{loadType:String,text:{type:String,default:""}},setup(P){const C=P,{proxy:f}=We(),R=["loadstart","waiting","ended","error","stalled"],E=()=>{f.$parent.play()},L=q(()=>{let k="background: rgba(0, 0, 0, .1);z-index:1";return C.loadType=="loadstart"&&(k="background: rgba(0, 0, 0, 1);;z-index:3"),k});return(k,_)=>Ee((J(),re("div",{class:"d-loading",style:He(K(L))},[V("div",null,[P.loadType=="loadstart"?(J(),re("span",oi,[li,V("p",null,ce(P.text),1)])):me("",!0),Ee(V("span",null,ui,512),[[Ae,P.loadType=="waiting"]]),Ee(V("span",null,[V("p",{onClick:E,class:"d-flex-x d-pointer"},di)],512),[[Ae,P.loadType=="ended"]]),Ee(V("span",null,[V("p",{onClick:E,class:"d-flex-x d-pointer"},ci)],512),[[Ae,P.loadType=="error"||P.loadType=="stalled"]])])],4)),[[Ae,R.includes(P.loadType)]])}});Jt.__scopeId="data-v-b2384226";const qe=function(P,C,f,R=!1){P&&C&&f&&P.addEventListener(C,f,R)},Le=function(P,C,f,R=!1){P&&C&&f&&P.removeEventListener(C,f,R)};Ye("data-v-5a794390");const hi=["onMousedown"];Xe();var Je=Be(Lt(bt({},{name:"DSlider"}),{props:{modelValue:{required:!0,type:Number,default:0},disabled:{type:Boolean,default:!1},vertical:{type:Boolean,default:!1},hover:{type:Boolean,default:!0},hoverText:{type:String,default:""},preload:{type:Number,default:0},size:{type:String,default:"10px"}},emits:["update:modelValue","change","onMousemove"],setup:function(P,{emit:C}){const f=P;Dt(t=>({"5242b67b":P.size}));const R=ee(null),E=ee(null),L=Re({dragging:!1,hoverPosition:0,hoverTipsLeft:"50%"}),k=q(()=>{let t=f.modelValue<0?0:f.modelValue>1?1:f.modelValue;return f.vertical?`height:${100*t}%`:`width:${100*t}%`}),_=q(()=>{let t=f.preload<0?0:f.preload>1?1:f.preload;return f.vertical?`height:${100*t}%`:`width:${100*t}%`}),D=q(()=>{let t=L.hoverPosition<0?0:L.hoverPosition>1?1:L.hoverPosition;return f.vertical?`bottom:${100*t}%`:`left:${100*t}%`}),o=t=>{t.preventDefault()},S=t=>{f.disabled||(t.preventDefault(),L.dragging=!0,h(t),qe(window,"mousemove",y),qe(window,"touchmove",y),qe(window,"mouseup",d),qe(window,"touchend",d))},m=t=>{if(!f.hover)return;let i=T(t);if(C("onMousemove",t,i),L.hoverPosition=i,f.vertical)return;let e=R.value,s=E.value.clientWidth/2,l=t.clientX-e.getBoundingClientRect().left;l<s?L.hoverTipsLeft=s-l+"px":e.clientWidth-l<s?L.hoverTipsLeft=e.clientWidth-l-s+"px":L.hoverTipsLeft="50%"},h=t=>{let i=T(t);C("update:modelValue",i),C("change",t,i)},T=t=>{let i=R.value,e=0;if(f.vertical){let s=i.clientHeight;e=(i.getBoundingClientRect().bottom-t.clientY)/s}else e=(t.clientX-i.getBoundingClientRect().left)/i.clientWidth;return e<0?0:e>1?1:e},y=t=>{h(t)},d=t=>{L.dragging&&(Le(window,"mousemove",y),Le(window,"touchmove",y),Le(window,"mouseup",d),Le(window,"touchend",d),Le(window,"contextmenu",d),setTimeout(()=>{L.dragging=!1},0))};return(t,i)=>(J(),re("div",{ref:R,class:Ve(["d-slider",{"is-vertical":f.vertical}]),onMousedown:ot(S,["stop"]),onContextmenu:o},[V("div",{class:"d-slider__runway",onMousemove:m},[Ee(V("div",{class:"d-slider__cursor",style:He(K(D))},[Ee(V("div",{class:"d-slider__tips",ref:E,style:He({left:K(L).hoverTipsLeft})},ce(f.hoverText),5),[[Ae,f.hoverText]])],4),[[Ae,f.hover]]),V("div",{class:"d-slider__preload",style:He(K(_))},null,4),V("div",{class:"d-slider__bar",style:He(K(k))},null,4)],32)],42,hi))}}));Je.__scopeId="data-v-5a794390";Ye("data-v-570fa0d1");const fi={key:0,class:"d-player-dialog"},vi={class:"d-player-dialog-body"},gi={class:"d-player-dialog-title"},pi={class:"d-player-hotkey-panel"},mi={class:"d-player-filter-panel"},yi={class:"d-player-filter-panel-item"},Ei=V("span",null,"\u9971\u548C\u5EA6",-1),Ti={class:"d-player-filter-panel-item"},Si=V("span",null,"\u4EAE\u5EA6",-1),bi={class:"d-player-filter-panel-item"},Li=V("span",null,"\u5BF9\u6BD4\u5EA6",-1),Ai={key:0,class:"d-player-contextmenu"},ki=["dplayerKeyCode"],Di=V("input",{class:"d-player-copyText"},null,-1);Xe();var er=Be({setup(P){const C=Re({show:!1,dialogType:"",dialogTitle:"",version:"1.3.1-beta.6",mouseX:0,mouseY:0}),f=[{label:"\u89C6\u9891\u8272\u5F69\u8C03\u6574",key:"filter"},{label:"\u5FEB\u6377\u952E\u8BF4\u660E",key:"hotkey"},{label:"\u590D\u5236\u89C6\u9891\u7F51\u5740",key:"copy"},{label:"\u7248\u672C\uFF1A1.3.1-beta.6",key:"version"}],R=[{key:"Space",label:"\u64AD\u653E/\u6682\u505C"},{key:"\u2192",label:"\u5355\u6B21\u5FEB\u8FDB10s\uFF0C\u957F\u63095\u500D\u901F\u64AD\u653E"},{key:"\u2190",label:"\u5FEB\u90005s"},{key:"\u2191",label:"\u97F3\u91CF\u589E\u52A010%"},{key:"\u2193",label:"\u97F3\u91CF\u589E\u52A0\u964D\u4F4E10%"},{key:"Esc",label:"\u9000\u51FA\u5168\u5C4F/\u9000\u51FA\u7F51\u9875\u5168\u5C4F"},{key:"F",label:"\u5168\u5C4F/\u9000\u51FA\u5168\u5C4F"}],E=Re({saturate:.392,brightness:.392,contrast:.392}),L=q(()=>({left:C.mouseX+"px",top:C.mouseY+"px"}));oe(E,S=>{let m=document.querySelector("#dPlayerVideo"),h=(2.55*S.saturate).toFixed(2),T=(2.55*S.brightness).toFixed(2),y=(2.55*S.contrast).toFixed(2);m.style.filter=`saturate(${h}) brightness(${T}) contrast(${y})`});const k=()=>{E.saturate=.392,E.brightness=.392,E.contrast=.392},_=S=>{S.key=="Escape"&&o(0)},D=S=>{S.preventDefault(),qe(window,"keydown",_),qe(window,"click",o);let m=document.querySelector("#refPlayerWrap"),h=m.clientWidth;m.clientHeight,C.mouseX=S.clientX-m.getBoundingClientRect().left,h-C.mouseX<130&&(C.mouseX=C.mouseX+(h-C.mouseX-130)),C.mouseY=S.clientY-m.getBoundingClientRect().top,C.show=!0},o=S=>{let m=S.path[0].tagName=="LI",h=S.path[0].attributes.dplayerKeyCode&&S.path[0].attributes.dplayerKeyCode.value,T=f.map(y=>y.key);if(m&&T.includes(h))if(C.dialogTitle=S.path[0].innerText,C.dialogType=h,h=="copy"){let y=document.querySelector(".d-player-copyText");y.value=window.location.href,y.select(),document.execCommand("copy"),C.dialogType=""}else h=="version"&&(C.dialogType="");C.show=!1,Le(window,"keydown",_),Le(window,"click",o)};return vt(()=>{let S=document.querySelector("#refPlayerWrap");Le(window,"keydown",_),Le(window,"click",o),Le(S,"contextmenu",D),qe(S,"contextmenu",D)}),kt(()=>{let S=document.querySelector("#refPlayerWrap");Le(window,"keydown",_),Le(window,"click",o),Le(S,"contextmenu",D)}),(S,m)=>(J(),re("div",null,[X(St,{name:"d-fade-in"},{default:de(()=>[K(C).dialogType?(J(),re("div",fi,[V("div",vi,[V("h5",gi,[ye(ce(K(C).dialogTitle)+" ",1),V("i",{onClick:m[0]||(m[0]=h=>K(C).dialogType=!1),class:"icon icon-close"},"X")]),Ee(V("ul",pi,[(J(),re(Oe,null,Ne(R,h=>V("li",{class:"d-player-hotkey-panel-item",key:h.key},[V("span",null,ce(h.key),1),V("span",null,ce(h.label),1)])),64))],512),[[Ae,K(C).dialogType=="hotkey"]]),Ee(V("ul",mi,[V("li",yi,[Ei,X(Je,{class:"filter-panel-slider",size:"5px",modelValue:K(E).saturate,"onUpdate:modelValue":m[1]||(m[1]=h=>K(E).saturate=h)},null,8,["modelValue"]),V("span",null,ce(Math.round(255*K(E).saturate)),1)]),V("li",Ti,[Si,X(Je,{class:"filter-panel-slider",size:"5px",modelValue:K(E).brightness,"onUpdate:modelValue":m[2]||(m[2]=h=>K(E).brightness=h)},null,8,["modelValue"]),V("span",null,ce(Math.round(255*K(E).brightness)),1)]),V("li",bi,[Li,X(Je,{class:"filter-panel-slider",size:"5px",modelValue:K(E).contrast,"onUpdate:modelValue":m[3]||(m[3]=h=>K(E).contrast=h)},null,8,["modelValue"]),V("span",null,ce(Math.round(255*K(E).contrast)),1)]),V("span",{onClick:k,title:"\u91CD\u7F6E","aria-label":"\u91CD\u7F6E",class:"d-player-filter-reset"},"\u91CD\u7F6E")],512),[[Ae,K(C).dialogType=="filter"]])])])):me("",!0)]),_:1}),K(C).show?(J(),re("div",Ai,[V("ul",{class:"d-player-contextmenu-body",style:He(K(L))},[(J(),re(Oe,null,Ne(f,h=>V("li",{dplayerKeyCode:h.key,key:h.key},ce(h.label),9,ki)),64))],4),Di])):me("",!0)]))}});er.__scopeId="data-v-570fa0d1";const Tt=P=>{let C=~~(P/3600),f=~~(P%3600/60),R=~~(P%60);return C=C<10?"0"+C:C,f=f<10?"0"+f:f,R=R<10?"0"+R:R,`${C}:${f}:${R}`},it="ontouchstart"in window,Kt=["loadstart","play","pause","playing","seeking","seeked","waiting","durationchange","progress","canplay","timeupdate","ended","error","stalled"],_i={width:{type:String,default:"800px"},height:{type:String,default:"450px"},color:{type:String,default:"#409eff"},src:{required:!0,type:String,default:""},title:{type:String,default:""},type:{type:String,default:"video/mp4"},poster:{type:String,default:""},webFullScreen:{type:Boolean,default:!1},speed:{type:Boolean,default:!0},currentTime:{type:Number,default:0},playsinline:{type:Boolean,default:!1},muted:{type:Boolean,default:!1},speedRate:{type:Array,default:()=>["2.0","1.5","1.25","1.0","0.75","0.5"]},autoPlay:{type:Boolean,default:!1},loop:{type:Boolean,default:!1},mirror:{type:Boolean,default:!1},ligthOff:{type:Boolean,default:!1},volume:{type:[String,Number],default:.3},control:{type:Boolean,default:!0},controlBtns:{type:Array,default:["audioTrack","quality","speedRate","volume","setting","pip","pageFullScreen","fullScreen"]},preload:{type:String,default:"auto"}};Ye("data-v-01791e9e");const Ri={class:"d-player-video",id:"dPlayerVideo"},Ii=["controls","webkit-playsinline","playsinline","volume","muted","loop","preload","src","poster"],Ci={class:"d-player-lightoff"},wi={key:1,class:"d-player-state"},xi={class:"d-play-btn"},Oi=["onKeyup","onKeydown"],Pi={class:"d-control-progress"},Fi={class:"d-tool-bar"},Mi={key:0,class:"d-tool-item d-tool-time audioTrack-btn"},Ni=V("span",{style:{margin:"0 3px"}},"/",-1),Bi={class:"total-time"},Ui={class:"d-tool-bar"},Gi={key:0,class:"d-tool-item quality-btn"},ji={class:"d-tool-item-main"},Ki={class:"speed-main",style:{"text-align":"center"}},Vi=["onClick"],Hi={key:1,class:"d-tool-item speedRate-btn"},zi={class:"d-tool-item-main"},qi={class:"speed-main"},Wi=["onClick"],Yi={key:2,class:"d-tool-item volume-btn"},Xi={class:"d-tool-item-main volume-box",style:{width:"52px"}},$i={class:"volume-text-size"},Qi={key:3,class:"d-tool-item setting-btn"},Zi={class:"d-tool-item-main"},Ji={class:"speed-main"},en=ye(" \u955C\u50CF\u753B\u9762 "),tn=ye(" \u5FAA\u73AF\u64AD\u653E "),rn=ye(" \u5173\u706F\u6A21\u5F0F "),nn=V("div",{class:"d-tool-item-main"},"\u753B\u4E2D\u753B",-1),an=V("div",{class:"d-tool-item-main"},"\u7F51\u9875\u5168\u5C4F",-1),sn=V("div",{class:"d-tool-item-main"},"\u5168\u5C4F",-1);Xe();var st=Be(Lt(bt({},{name:"vue3VideoPlay",inheritAttrs:!1}),{props:_i,emits:[...Kt,"mirrorChange","loopChange","lightOffChange"],setup:function(P,{expose:C,emit:f}){const R=P;Dt(w=>({"51d4439c":K(T),"77e758a6":w.width,b8a1afc0:w.height}));const E=new Et({fragLoadingTimeOut:2e3}),L=ee(null),k=ee(null),_=ee(null),D=ee(null),o=Re(Lt(bt({dVideo:null},R),{muted:R.muted,playBtnState:R.autoPlay?"pause":"play",loadStateType:"loadstart",fullScreen:!1,handleType:"",currentTime:"00:00:00",preloadBar:0,totalTime:"00:00:00",isVideoHovering:!0,speedActive:"1.0",playProgress:0,isMultiplesPlay:!1,longPressTimeout:null,progressCursorTime:"00:00:00",qualityLevels:[],currentLevel:0})),S=(...w)=>O=>w.reverse().reduce((F,M)=>M(F),O),m=Kt.reduce((w,O)=>{var F;return w[`on${F=O,F.charAt(0).toUpperCase()+F.slice(1)}`]=M=>{o.loadStateType=O,f(O,M)},w},{});m.onCanplay=S(m.onCanplay,()=>{o.playBtnState!="play"&&o.dVideo.play(),o.autoPlay&&(o.dVideo.play(),o.playBtnState="pause")}),m.onEnded=S(m.onEnded,()=>{o.playBtnState="replay"}),m.onDurationchange=w=>{f("durationchange",w),R.currentTime!=0&&(o.dVideo.currentTime=R.currentTime),m.onTimeupdate(w)},m.onProgress=w=>{console.log("\u7F13\u51B2\u4E2D..."),f("progress",w);let O=w.target.duration,F=w.target.buffered,M=w.target.buffered.length&&w.target.buffered.end(F-1);o.preloadBar=M/O},m.onTimeupdate=w=>{f("timeupdate",w);let O=w.duration||w.target.duration||0,F=w.currentTime||w.target.currentTime;o.playProgress=F/O,o.currentTime=Tt(F),o.totalTime=Tt(O)},m.onError=S(m.onError,()=>{o.playBtnState="replay"});let h=Tr();for(let w in h)m[w]=h[w];const T=(y=o.color,`${parseInt("0x"+y.slice(1,3))},${parseInt("0x"+y.slice(3,5))},${parseInt("0x"+y.slice(5,7))}`);var y;const d=jt(500,()=>{o.handleType=""}),t=w=>{w.preventDefault(),w.code=="ArrowUp"?o.volume=o.volume+.1>1?1:o.volume+.1:o.volume=o.volume-.1<0?0:o.volume-.1,o.muted=!1,o.handleType="volume",d()},i=w=>{R.speed&&(o.dVideo.currentTime=o.dVideo.currentTime<10?.1:o.dVideo.currentTime-10,m.onTimeupdate(o.dVideo),l())},e=w=>{w.preventDefault();let O=w.type;if(w.key=="ArrowRight"){if(l(),O=="keyup"){if(clearTimeout(o.longPressTimeout),!R.speed&&!o.longPressTimeout)return;o.isMultiplesPlay?(o.dVideo.playbackRate=o.speedActive,o.isMultiplesPlay=!1):(o.dVideo.currentTime=o.dVideo.currentTime+10,m.onTimeupdate(o.dVideo))}else if(O=="keydown"){if(!R.speed)return;o.isMultiplesPlay&&clearTimeout(o.longPressTimeout),o.longPressTimeout=setTimeout(()=>{o.isMultiplesPlay=!0,o.dVideo.playbackRate=5,o.handleType="playbackRate",d()},500)}}},s=()=>{it||D.value.focus()},l=()=>{o.loadStateType="play",o.dVideo.play().catch(()=>{setTimeout(()=>{o.playBtnState="replay",o.loadStateType="error"},500)}),o.playBtnState="pause"},n=()=>{o.dVideo.pause(),o.playBtnState="play"},u=w=>{w&&w.preventDefault(),o.playBtnState=="play"||o.playBtnState=="replay"?l():o.playBtnState=="pause"&&n()},p=()=>{o.muted=!o.muted,o.volume==0&&(o.volume=.05)},v=(w,O)=>{let F=o.dVideo.duration||o.dVideo.target.duration;o.dVideo.currentTime=F*O,o.playBtnState=="play"&&(o.dVideo.play(),o.playBtnState="pause")},g=(w,O)=>{o.progressCursorTime=Tt(o.dVideo.duration*O)},r=jt(2500,()=>{o.isVideoHovering=!1}),a=w=>{o.isVideoHovering=!0,r()},c=w=>{f("mirrorChange",w,o.dVideo)},b=w=>{f("loopChange",w,o.dVideo)},A=w=>{f("lightOffChange",w,o.dVideo)},I=()=>{var w;w=o.dVideo,document.pictureInPictureElement?document.exitPictureInPicture().catch(O=>{console.log(O,"Video failed to leave Picture-in-Picture mode.")}):w.requestPictureInPicture().catch(O=>{console.log(O,"Video failed to enter Picture-in-Picture mode.")})},x=()=>{o.fullScreen=(w=>{let O=document,F=O.webkitIsFullScreen||O.fullscreen;return F?(document.exitFullscreen||O.webkitExitFullScreen).call(O):(w.requestFullscreen||w.webkitRequestFullScreen).call(w),!F})(L.value)};return oe(()=>R.src,()=>{ut(()=>{o.dVideo.canPlayType(R.type)||o.dVideo.canPlayType("application/vnd.apple.mpegurl")?o.muted=R.autoPlay:Et.isSupported()&&(E.detachMedia(),E.attachMedia(o.dVideo),E.on(Et.Events.MEDIA_ATTACHED,()=>{E.loadSource(R.src),E.on("hlsManifestParsed",(w,O)=>{console.log(O),o.currentLevel=O.level,o.qualityLevels=O.levels||[]})}),E.on("hlsLevelSwitching",(w,O)=>{console.log(O),console.log("LEVEL_SWITCHING")}),E.on("hlsLevelSwitched",(w,O)=>{o.currentLevel=O.level,console.log("LEVEL_SWITCHED")}))})},{immediate:!0}),vt(()=>{o.dVideo=k,s()}),C({play:l,pause:n,togglePlay:u}),(w,O)=>(J(),re("div",{ref:L,id:"refPlayerWrap",class:Ve(["d-player-wrap",{"web-full-screen":K(o).webFullScreen,"is-lightoff":K(o).lightOff,"d-player-wrap-hover":K(o).playBtnState=="play"||K(o).isVideoHovering}]),onMousemove:a},[V("div",Ri,[V("video",dt({ref:k,class:["d-player-video-main",{"video-mirror":K(o).mirror}],id:"dPlayerVideoMain",controls:!(!K(it)||!K(o).speed),"webkit-playsinline":R.playsinline,playsinline:R.playsinline},K(m),{volume:K(o).volume,muted:K(o).muted,loop:K(o).loop,preload:w.preload,width:"100%",height:"100%",src:R.src,poster:R.poster}),"\u60A8\u7684\u6D4F\u89C8\u5668\u4E0D\u652F\u6301Video\u6807\u7B7E\u3002",16,Ii)]),X(St,{name:"d-fade-in"},{default:de(()=>[Ee(V("div",Ci,null,512),[[Ae,K(o).lightOff]])]),_:1}),K(o).fullScreen?(J(),ze(ei,{key:0,title:R.title},null,8,["title"])):me("",!0),K(it)?me("",!0):(J(),re("div",wi,[X(St,{name:"d-scale-out"},{default:de(()=>[Ee(V("div",xi,[X(ke,{icon:"icon-play",size:40})],512),[[Ae,K(o).playBtnState=="play"]])]),_:1}),X(Zt,{state:K(o)},null,8,["state"])])),K(it)?me("",!0):(J(),re("input",{key:2,type:"input",readonly:"readonly",ref:D,onDblclick:x,onKeyup:[rt(x,["f"]),O[0]||(O[0]=rt(F=>K(o).webFullScreen=!1,["esc"])),e],onClick:u,onKeydown:[rt(u,["space"]),rt(i,["arrow-left"]),rt(t,["arrow-up","arrow-down"]),e],class:"d-player-input",maxlength:"0"},null,40,Oi)),X(Jt,{loadType:K(o).loadStateType},null,8,["loadType"]),X(er),!K(it)&&K(o).control?(J(),re("div",{key:3,class:"d-player-control",ref:_},[V("div",Pi,[X(Je,{class:"d-progress-bar",onOnMousemove:g,onChange:v,disabled:!K(o).speed,hoverText:K(o).progressCursorTime,modelValue:K(o).playProgress,"onUpdate:modelValue":O[1]||(O[1]=F=>K(o).playProgress=F),preload:K(o).preloadBar},null,8,["disabled","hoverText","modelValue","preload"])]),V("div",{class:"d-control-tool",onClick:s},[V("div",Fi,[V("div",{class:"d-tool-item",onClick:u},[X(ke,{size:"24",icon:`icon-${K(o).playBtnState}`},null,8,["icon"])]),R.controlBtns.includes("audioTrack")?(J(),re("div",Mi,[V("span",null,ce(K(o).currentTime),1),Ni,V("span",Bi,ce(K(o).totalTime),1)])):me("",!0)]),V("div",Ui,[K(o).qualityLevels.length&&R.controlBtns.includes("quality")?(J(),re("div",Gi,[ye(ce(K(o).qualityLevels.length&&(K(o).qualityLevels[K(o).currentLevel]||{}).height)+"P ",1),V("div",ji,[V("ul",Ki,[(J(!0),re(Oe,null,Ne(K(o).qualityLevels,(F,M)=>(J(),re("li",{class:Ve({"speed-active":K(o).currentLevel==M}),onClick:N=>((B,U)=>{E.currentLevel=U,o.currentLevel=U})(0,M),key:F},ce(F.height)+"P",11,Vi))),128))])])])):me("",!0),R.controlBtns.includes("speedRate")?(J(),re("div",Hi,[ye(ce(K(o).speedActive=="1.0"?"\u500D\u901F":K(o).speedActive+"x")+" ",1),V("div",zi,[V("ul",qi,[(J(!0),re(Oe,null,Ne(K(o).speedRate,F=>(J(),re("li",{class:Ve({"speed-active":K(o).speedActive==F}),onClick:M=>(N=>{o.speedActive=N,o.dVideo.playbackRate=N})(F),key:F},ce(F)+"x",11,Wi))),128))])])])):me("",!0),R.controlBtns.includes("volume")?(J(),re("div",Yi,[V("div",Xi,[V("div",{class:Ve(["volume-main",{"is-muted":K(o).muted}])},[V("span",$i,ce(K(o).muted?0:~~(100*K(o).volume))+"%",1),X(Je,{onChange:O[2]||(O[2]=F=>K(o).muted=!1),hover:!1,size:"5px",vertical:!0,modelValue:K(o).volume,"onUpdate:modelValue":O[3]||(O[3]=F=>K(o).volume=F)},null,8,["modelValue"])],2)]),V("span",{onClick:p,style:{display:"flex"}},[X(ke,{size:"20",icon:"icon-volume-"+(K(o).volume==0||K(o).muted?"mute":K(o).volume>.5?"up":"down")},null,8,["icon"])])])):me("",!0),R.controlBtns.includes("setting")?(J(),re("div",Qi,[X(ke,{size:"20",class:"rotateHover",icon:"icon-settings"}),V("div",Zi,[V("ul",Ji,[V("li",null,[en,X(lt,{onChange:c,modelValue:K(o).mirror,"onUpdate:modelValue":O[4]||(O[4]=F=>K(o).mirror=F)},null,8,["modelValue"])]),V("li",null,[tn,X(lt,{onChange:b,modelValue:K(o).loop,"onUpdate:modelValue":O[5]||(O[5]=F=>K(o).loop=F)},null,8,["modelValue"])]),V("li",null,[rn,X(lt,{onChange:A,modelValue:K(o).lightOff,"onUpdate:modelValue":O[6]||(O[6]=F=>K(o).lightOff=F)},null,8,["modelValue"])])])])])):me("",!0),R.controlBtns.includes("pip")?(J(),re("div",{key:4,class:"d-tool-item pip-btn",onClick:I},[X(ke,{size:"20",icon:"icon-pip"}),nn])):me("",!0),R.controlBtns.includes("pageFullScreen")?(J(),re("div",{key:5,class:"d-tool-item pip-btn",onClick:O[7]||(O[7]=F=>K(o).webFullScreen=!K(o).webFullScreen)},[X(ke,{size:"20",icon:"icon-web-screen"}),an])):me("",!0),R.controlBtns.includes("fullScreen")?(J(),re("div",{key:6,class:"d-tool-item fullScreen-btn",onClick:x},[sn,X(ke,{size:"20",icon:"icon-screen"})])):me("",!0)])])],512)):me("",!0)],34))}}));function on(P){P.component(st.name,st)}st.__scopeId="data-v-01791e9e",st.install=on;const ln={style:{overflow:"auto","background-color":"rgba(0, 0, 0, 0.4)"}},un={style:{color:"orange",overflow:"hidden"}},dn={class:"row justify-center"},cn={style:{padding:"0",margin:"0","background-color":"rgba(0, 0, 0, 0)",display:"flex","flex-direction":"row","justify-content":"space-between",width:"100%"}},hn=["onClick"],fn=["onClick"],vn={class:"text-subtitle2",style:{overflow:"auto",padding:"0"}},gn={__name:"PlayingVideo",setup(P){var y,d,t;const C=Xt(),f=ee(null),R=q(()=>C.Playing||{}),E=ee(""),L=q(()=>C.drawerRight),k=wr(),_=Re({playList:[]});oe(R,i=>{i&&i.Id?(T.src=Ct(i.Id),setTimeout(()=>{f.value.play()},1),E.value||(E.value=i.Actress,D())):T.src=null}),oe(L,i=>{i&&!_.playList&&D()});const D=async()=>{const i=await xr({...C.FileSearchParam,Page:1,PageSize:999,Keyword:E.value});console.log(i),_.playList=i.Data,C.Playing||(C.Playing=_.playList[0])},o=()=>{C.drawerRight=!1},S=()=>{C.PlayMode==800?C.PlayMode=k.screen.width:C.PlayMode=800},m=()=>{o(),C.Playing=null},h=i=>{var e;if(!!_.playList){for(let s=0;s<_.playList.length;s++)if(_.playList[s].Id===((e=C.Playing)==null?void 0:e.Id))if(s==_.playList.length-1){C.Playing=_.playList[0];return}else if(s+i<=0){C.Playing=_.playList[0];return}else{C.Playing=_.playList[s+i];return}}},T=Re({width:"100%",height:"auto",color:"#409eff",title:null,src:Ct(R.value.Id),muted:!1,preload:"false",webFullScreen:!1,speedRate:["1.0","1.25","1.5","2.0"],autoPlay:!1,loop:!1,mirror:!1,ligthOff:!0,currentTime:10,volume:(y=C.videoOptions)==null?void 0:y.volume,control:(d=C.videoOptions)==null?void 0:d.control,controlBtns:(t=C.videoOptions)==null?void 0:t.controlBtns});return(i,e)=>(J(),re(Oe,null,[X(It,{class:"q-dialog-plugin",style:{height:"auto",width:"auto","background-color":"rgba(0,0,0,0.7)"}},{default:de(()=>[X(K(st),dt({ref_key:"vue3VideoPlayRef",ref:f,style:[{"object-fit":"contain",height:"auto",width:"100%","max-height":"95vh"},{width:K(C).PlayMode!==800?"90%":"100%"}]},T,{onEnded:e[0]||(e[0]=s=>h(1))}),null,16,["style"]),X(br,{align:"left"},{default:de(()=>{var s,l;return[X(_e,{flat:"",style:{color:"#59d89d"},label:(s=R.value.Actress)==null?void 0:s.substring(0,8),onClick:e[1]||(e[1]=n=>{E.value=R.value.Actress,D()})},null,8,["label"]),X(_e,{flat:"",style:{color:"goldenrod"},label:(l=R.value.Code)==null?void 0:l.substring(0,8),onClick:e[2]||(e[2]=n=>{E.value=R.value.Code,D()})},null,8,["label"]),X(Lr,{modelValue:E.value,"onUpdate:modelValue":[e[3]||(e[3]=n=>E.value=n),D],dense:!0,clearable:""},null,8,["modelValue"]),X(_e,{color:"primary",label:K(C).PlayMode!==800?"\u5C0F\u5C4F":"\u5168\u5C4F",onClick:S},null,8,["label"]),X(_e,{color:"primary",label:"\u5173\u95ED",onClick:m}),_.playlist?me("",!0):(J(),ze(_e,{key:0,color:"primary",label:"\u4E0A\u4E00\u4E2A",onClick:e[4]||(e[4]=n=>h(-1))})),_.playlist?me("",!0):(J(),ze(_e,{key:1,color:"primary",label:"\u4E0B\u4E00\u4E2A",onClick:e[5]||(e[5]=n=>h(1))})),X(_e,{color:"primary",label:"\u9690\u85CF",onClick:o})]}),_:1})]),_:1}),V("div",ln,[V("span",un,ce(R.value.Title),1),V("div",dn,[(J(!0),re(Oe,null,Ne(_.playList,s=>(J(),ze(It,{class:"q-ma-sm example-item",key:s.Id},{default:de(()=>[X(Ir,{fit:"cover",easier:"",draggable:"",src:K(Cr)(s.Id),class:"item-img",onClick:l=>K(C).Playing=s},{default:de(()=>[V("div",cn,[V("div",{onClick:ot(()=>{},["stop"]),style:{display:"flex","flex-direction":"column","justify-content":"flex-start",width:"fit-content"}},[(J(!0),re(Oe,null,Ne(s.Tags,l=>(J(),ze(mt,{square:"",color:"red","text-color":"white",key:l,style:{"margin-left":"0px",padding:"0 4px"}},{default:de(()=>[V("span",{onClick:n=>D(l)},ce(l),9,fn)]),_:2},1024))),128))],8,hn),X(mt,{onClick:ot(()=>{},["stop"]),square:"",color:"green","text-color":"white",style:{width:"fit-content","margin-right":"0px",padding:"0 6px"}},{default:de(()=>[V("span",null,ce(s.MovieType),1)]),_:2},1032,["onClick"])])]),_:2},1032,["src","onClick"]),X(Ar,{style:{overflow:"auto",padding:"4px"}},{default:de(()=>[V("div",vn,[X(mt,{onClick:ot(()=>{},["stop"]),square:"",color:"green","text-color":"white",style:{padding:"0px 4px"}},{default:de(()=>[ye(ce(s.SizeStr),1)]),_:2},1032,["onClick"]),ye(ce(s.Title),1)])]),_:2},1024)]),_:2},1024))),128))])])],64))}};var pn=Sr(gn,[["__scopeId","data-v-4e268366"]]);const Vt=Be({__name:"EssentialLink",props:{title:{},caption:{default:""},link:{default:"#"},icon:{default:""}},setup(P){return(C,f)=>(J(),ze(Pr,{clickable:"",tag:"a",target:"_self",to:C.link},{default:de(()=>[X(Fr,null,{default:de(()=>[X(Yt,null,{default:de(()=>[C.icon?(J(),ze(kr,{key:0,name:C.icon},null,8,["name"])):me("",!0),ye(ce(C.title),1)]),_:1})]),_:1})]),_:1},8,["to"]))}}),wn=Be({__name:"MainLayout",setup(P){const C=Xt(),f=ee(!1),R=q(()=>C.PlayMode),E=q(()=>Dr().path),L=[{title:"\u9996\u9875",caption:"quasar.dev",icon:"home",link:"/"},{title:"\u641C\u7D22",caption:"github.com/quasarframework",icon:"search",link:"/search"},{title:"\u56FE\u9274",caption:"chat.quasar.dev",icon:"image",link:"/picture"},{title:"\u8BBE\u7F6E",caption:"chat.quasar.dev",icon:"settings",link:"/setting"},{title:"\u7CFB\u7EDF",caption:"forum.quasar.dev",icon:"chat",link:"/system"}];return(k,_)=>{const D=_r("router-view");return J(),re("div",null,[X(Vr,{view:"lhh LpR lff",container:"",style:{height:"100vh"},class:"shadow-2 rounded-borders"},{default:de(()=>[X(Ur,{reveal:"",class:"bg-black"},{default:de(()=>[X(Br,null,{default:de(()=>[X(_e,{flat:"",onClick:_[0]||(_[0]=o=>f.value=!f.value),round:"",dense:"",icon:"menu"}),X(Mr,null,{default:de(()=>[ye("\u6587\u4EF6\u641C\u7D22")]),_:1}),X(wt),(J(),re(Oe,null,Ne(L,o=>X(Vt,dt({key:o.title},o,{style:{color:E.value==o.link?"red":"",scale:1.2}}),null,16,["style"])),64)),X(wt),X(_e,{onClick:_[1]||(_[1]=o=>K(Or)())},{default:de(()=>[ye("\u5173\u673A")]),_:1}),X(_e,{flat:"",onClick:_[2]||(_[2]=o=>K(C).drawerRight=!K(C).drawerRight),round:"",dense:"",icon:"menu"},{default:de(()=>{var o;return[ye(ce(`${((o=K(C).Playing)==null?void 0:o.Code)||""}`),1)]}),_:1})]),_:1})]),_:1}),X(Nt,{modelValue:f.value,"onUpdate:modelValue":_[3]||(_[3]=o=>f.value=o),width:200,breakpoint:700,bordered:"",class:"bg-grey-3"},{default:de(()=>[X(jr,{class:"fit"},{default:de(()=>[X(Rr,null,{default:de(()=>[X(Yt,{header:""},{default:de(()=>[ye(" \u4F60\u7684\u641C\u7D22\u5DE5\u5177 ")]),_:1}),(J(),re(Oe,null,Ne(L,o=>X(Vt,dt({key:o.title},o,{style:{color:E.value==o.link?"red":"",scale:1.2}}),null,16,["style"])),64))]),_:1})]),_:1})]),_:1},8,["modelValue"]),X(Nt,{side:"right",modelValue:K(C).drawerRight,"onUpdate:modelValue":_[4]||(_[4]=o=>K(C).drawerRight=o),bordered:"",width:R.value,class:"bg-grey-3"},{default:de(()=>[X(pn)]),_:1},8,["modelValue","width"]),X(Kr,{style:{height:"100%"}},{default:de(()=>[X(D)]),_:1})]),_:1})])}}});export{wn as default};
